

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Google Tag Manager: DOM Listener | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2014\/04\/test-page.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/google-tag-manager-dom-listener\/",
  "datePublished": "2014-04-22T05:10:17\u002b00:00",
  "dateModified": "2014-04-22T05:10:17\u002b00:00",
  "description": "Create a DOM listener using Google Tag Manager. This can be used to detect dynamic changes in the page layout.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Google Tag Manager: DOM Listener | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/google-tag-manager-dom-listener/">
    
    <meta name="description" content="Create a DOM listener using Google Tag Manager. This can be used to detect dynamic changes in the page layout.">
    <meta property="og:description" content="Create a DOM listener using Google Tag Manager. This can be used to detect dynamic changes in the page layout.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Google Tag Manager: DOM Listener">
    <meta property="og:url" content="https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Google Tag Manager: DOM Listener">
    <meta name="twitter:description" content="Create a DOM listener using Google Tag Manager. This can be used to detect dynamic changes in the page layout.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2014/04/test-page.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2014/04/test-page.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Google Tag Manager: DOM Listener
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2014-04-22T05:10:17Z">
        
  April 22, 2014

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/google-tag-manager-dom-listener/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>In this post, I&rsquo;ll walk you through a tutorial on how to create a <a href="http://www.google.com/tagmanager">Google Tag Manager</a> extension. This extension will be a <a href="https://www.simoahava.com/analytics/auto-event-tracking-google-tag-manager/">new listener</a>, whose sole job is to listen for changes in the HTML and CSS markup on the page.</p>
<p>The reason I&rsquo;m teaching you how to create a DOM listener is simple. Ever so often I come across people asking for help, but they are unable to touch on-page code. Usually the problem is magnified with <a href="https://www.simoahava.com/analytics/form-tracking-google-tag-manager/">form handlers</a>, since the developers might have installed some custom jQuery form manager, for instance, which simply refuses to cooperate with GTM&rsquo;s form listeners. That is why you might want to fire a GTM event when a certain message pops up on the screen, for example.</p>
<p>With a DOM listener, you can fire a GTM event every time something changes on the page. Well, not <em>every time</em>. Actually, in this example you&rsquo;re restricted to element insertion and attribute changes. A working use case might be form validation: if you want to track invalid forms, maybe by sending the content of the validation error message with an event, you might just as well create a DOM listener. This listener will then trigger when an error message appears on the page.</p>
<p><strong>DISCLAIMER</strong>: To be truthful, I feel quite strongly about using hacks such as this to fix faulty markup or an otherwise shoddy tag implementation. The main idea behind this post is to introduce a feature of JavaScript which can alleviate some of your tag management pains. However, if you find that you need hacks such as the DOM listener to circumvent development problems on your website, I would strongly suggest that you take this up with your developers and try to come up with a solution which works with GTM&rsquo;s standard features.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="the-premise">The premise</h2>
<p>To create the DOM listener, I will leverage an API known as <a href="https://developer.mozilla.org/en/docs/Web/API/MutationObserver">MutationObserver</a>. This little piece of magic will create an observer object, which triggers every time a <em>mutation</em> takes place. This mutation can come in different sizes and shapes, but for the purposes of this guide, I will listen for two kinds of mutations, for two kinds of use cases:</p>
<ol>
<li>
<p>Node insertion - when a new <code>&lt;span class=&quot;error&quot;&gt;</code> is injected in the DOM</p>
</li>
<li>
<p>CSS style change - when a previously hidden <code>&lt;span class=&quot;error&quot;&gt;</code> is displayed</p>
</li>
</ol>
<p>So the first use case is when your form injects a new SPAN element into the DOM upon an error. The script will check if the injected node is really the error message, and if it is, it pushes a dataLayer event with the content of the SPAN (the message itself).</p>
<p>The second use case is when an invalid form causes a hidden SPAN to appear, with the error message within.</p>
<p>Listening for node insertion is a bit different than listening to an attribute change. A node insertion listener can be primed on any node on the DOM, meaning you have much more to work with in terms of flexibility. Listening for attribute changes requires you to pinpoint exactly which node you want to observe, and the attribute change will be reported for that node only.</p>

                
                  <h2 id="preparations">Preparations</h2>
<p>Here are the ingredients:</p>
<ol>
<li>
<p>A page where a <code>&lt;span class=&quot;error&quot;&gt;</code> is either inserted or revealed with a CSS style change</p>
</li>
<li>
<p>Custom HTML tag(s)</p>
</li>
</ol>
<p>My test page code looks like this (I combined both use cases into one here):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
<span style="color:#00a">function</span> addHTML() {
  <span style="color:#00a">var</span> myDiv = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;contents&#34;</span>);
  <span style="color:#00a">var</span> newSpan = <span style="color:#0aa">document</span>.createElement(<span style="color:#a50">&#34;span&#34;</span>);
  newSpan.className = <span style="color:#a50">&#34;error&#34;</span>;
  newSpan.innerHTML = <span style="color:#a50">&#34;This form contained errors&#34;</span>;
  myDiv.appendChild(newSpan);
}
<span style="color:#00a">function</span> changeCSS() {
  <span style="color:#00a">var</span> mySpan = <span style="color:#0aa">document</span>.getElementsByClassName(<span style="color:#a50">&#34;error&#34;</span>)[<span style="color:#099">0</span>];
  mySpan.style.display = <span style="color:#a50">&#34;block&#34;</span>;
}
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">a</span> <span style="color:#1e90ff">href</span>=<span style="color:#a50">&#34;#&#34;</span> <span style="color:#1e90ff">onClick</span>=<span style="color:#a50">&#34;addHTML();&#34;</span>&gt;Add span with .innerHTML&lt;/<span style="color:#1e90ff;font-weight:bold">a</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">a</span> <span style="color:#1e90ff">href</span>=<span style="color:#a50">&#34;#&#34;</span> <span style="color:#1e90ff">onClick</span>=<span style="color:#a50">&#34;changeCSS();&#34;</span>&gt;Add span with CSS&lt;/<span style="color:#1e90ff;font-weight:bold">a</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;contents&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">span</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;error&#34;</span> <span style="color:#1e90ff">style</span>=<span style="color:#a50">&#34;display: none;&#34;</span>&gt;This form contained errors&lt;/<span style="color:#1e90ff;font-weight:bold">span</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;</code></pre></div>
<p>Let&rsquo;s just quickly go over this page.</p>
<p>First, you have two functions. The function <strong>addHTML()</strong> will insert the following in the DIV#contents below:</p>
<p><code>&lt;span class=&quot;error&quot;&gt;This form contained errors&lt;/span&gt;</code></p>
<p>The insertion is done upon clicking a link whose text is &ldquo;Add span with .innerHTML&rdquo;.</p>
<p>In the second function, the SPAN.error is already in the DOM, but it&rsquo;s been hidden with a <strong>display: none</strong> CSS command. When the link labelled &ldquo;Add span with CSS&rdquo; is clicked, this style directive will be changed to <strong>display: block</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/04/test-page.jpg" title="Simple test page">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/04/test-page.jpg#ZgotmplZ" alt="Simple test page" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 798 239'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This is just my test page. Obviously you&rsquo;ll need to navigate around your current implementation to make things work.</p>
<p>Finally, you&rsquo;ll need your custom HTML magic. The next two chapters will go over the tags and the code you&rsquo;ll need to write for them.</p>

                
                  <h2 id="case-1-node-insertion">Case 1: node insertion</h2>
<p>In this use case, a new node (<code>&lt;span class=&quot;error&quot;&gt;</code>) is inserted into a DIV on the page. The markup on the page looks something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
<span style="color:#00a">function</span> addHTML() {
  <span style="color:#00a">var</span> myDiv = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;contents&#34;</span>);
  <span style="color:#00a">var</span> newSpan = <span style="color:#0aa">document</span>.createElement(<span style="color:#a50">&#34;span&#34;</span>);
  newSpan.className = <span style="color:#a50">&#34;error&#34;</span>;
  newSpan.innerHTML = <span style="color:#a50">&#34;This form contained errors&#34;</span>;
  myDiv.appendChild(newSpan);
}
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">a</span> <span style="color:#1e90ff">href</span>=<span style="color:#a50">&#34;#&#34;</span> <span style="color:#1e90ff">onClick</span>=<span style="color:#a50">&#34;addHTML();&#34;</span>&gt;Add span with .innerHTML&lt;/<span style="color:#1e90ff;font-weight:bold">a</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;contents&#34;</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;</code></pre></div>
<p>So as you can see, there&rsquo;s an empty DIV (#contents), which is then appended with a new SPAN, created by the function addHTML() which, in turn, waits for a click event on the link on the page.</p>
<p>Now, the next step is to create the listener itself. You&rsquo;ll need to use the MutationObserver API to listen for any node which is inserted into the observed target. The node itself can be on any level in the DOM hierarchy, but I chose the DIV#contents to keep things simple. When a node is inserted, a dataLayer push is done with a new GTM event and the text content of the SPAN.</p>
<p>Here&rsquo;s what you Custom HTML Tag should look like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  <span style="color:#00a">var</span> contentDiv = <span style="color:#0aa">document</span>.querySelector(<span style="color:#a50">&#34;#contents&#34;</span>);
  <span style="color:#00a">var</span> MutationObserver = <span style="color:#0aa">window</span>.MutationObserver || <span style="color:#0aa">window</span>.WebKitMutationObserver;
  <span style="color:#00a">var</span> observer = <span style="color:#00a">new</span> MutationObserver(<span style="color:#00a">function</span>(mutations) {
    mutations.forEach(<span style="color:#00a">function</span>(mutation) {
      <span style="color:#00a">if</span>(mutation.type===<span style="color:#a50">&#34;childList&#34;</span> &amp;&amp; mutation.addedNodes[<span style="color:#099">0</span>].className===<span style="color:#a50">&#34;error&#34;</span>) {
        dataLayer.push({<span style="color:#a50">&#39;event&#39;</span>: <span style="color:#a50">&#39;newErrorSpan&#39;</span>, <span style="color:#a50">&#39;spanErrorMessage&#39;</span>: mutation.addedNodes[<span style="color:#099">0</span>].innerHTML});
        observer.disconnect();
      }
    });    
  });
  <span style="color:#00a">var</span> config = { attributes: <span style="color:#00a">true</span>, childList: <span style="color:#00a">true</span>, characterData: <span style="color:#00a">true</span> }
  observer.observe(contentDiv, config);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>OK, OK, lots of stuff going on here. Let&rsquo;s go through the script and see what it does. First, you create a reference to the DIV you will be listening to. I&rsquo;m using the <em><a href="https://developer.mozilla.org/en-US/docs/Web/API/document.querySelector">querySelector()</a></em> function, because it&rsquo;s a nice way to combine CSS selectors and JavaScript.</p>
<p>Next, you create the MutationObserver itself by first tackling a known cross-browser issue with WebKit browsers. The observer listens for mutations of type <strong>childList</strong> (a new child node is inserted) and checks if the first added node has CSS class &ldquo;error&rdquo;. You&rsquo;ll have to modify this code if the SPAN with the error is not the first node that your script inserts into the DOM.</p>
<p>If such a mutation is detected, a GTM event is pushed into dataLayer (<strong>newErrorSpan</strong>), and the error message contents are sent as a data layer variable as well. Note that I use <em>innerHTML</em> to get the contents of the SPAN. If your SPAN has HTML formatting within, you might want to use <em>innerText</em> instead.</p>
<p>The disconnection means that after this particular mutation takes place, no further mutations are listened for. So if someone keeps on pushing the &ldquo;submit&rdquo; button, the observer will shut down after the first error. You might want to remove this line if you want to track ALL the potential errors your visitor propagates on the form.</p>
<p>Lastly, I create a configuration for the MutationObserver and prime it on the DIV.</p>
<p>And that&rsquo;s it for node insertion. If you set this new listener to fire on pages where the SPAN with class &ldquo;error&rdquo; is created in a DIV with ID &ldquo;contents&rdquo;, a dataLayer.push() will take place every time the SPAN is inserted into the DOM. Try it for yourself!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/04/error-message-datalayer.jpg" title="DataLayer error message">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/04/error-message-datalayer.jpg#ZgotmplZ" alt="DataLayer error message" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 509 497'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="case-2-css-change">Case 2: CSS change</h2>
<p>In this case, you have a hidden SPAN with the error message, which is then revealed when the form validation fails. Here&rsquo;s what the HTML might look like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
<span style="color:#00a">function</span> changeCSS() {
  <span style="color:#00a">var</span> mySpan = <span style="color:#0aa">document</span>.querySelector(<span style="color:#a50">&#34;.error&#34;</span>);
  mySpan.style.display = <span style="color:#a50">&#34;block&#34;</span>;
}
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">a</span> <span style="color:#1e90ff">href</span>=<span style="color:#a50">&#34;#&#34;</span> <span style="color:#1e90ff">onClick</span>=<span style="color:#a50">&#34;changeCSS();&#34;</span>&gt;Add span with CSS&lt;/<span style="color:#1e90ff;font-weight:bold">a</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;contents&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">span</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;error&#34;</span> <span style="color:#1e90ff">style</span>=<span style="color:#a50">&#34;display: none;&#34;</span>&gt;This form contained errors&lt;/<span style="color:#1e90ff;font-weight:bold">span</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;</code></pre></div>
<p>So I have a simple SPAN within a DIV with the error message. This is initially set to <em>display: none</em>, but when the link is clicked, the display status is changed to <em>block</em>.</p>
<p>As for your Custom HTML Tag, you&rsquo;ll need something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  <span style="color:#00a">var</span> spanError = <span style="color:#0aa">document</span>.querySelector(<span style="color:#a50">&#39;.error&#39;</span>);
  <span style="color:#00a">var</span> MutationObserver = <span style="color:#0aa">window</span>.MutationObserver || <span style="color:#0aa">window</span>.WebKitMutationObserver;
  <span style="color:#00a">var</span> observer = <span style="color:#00a">new</span> MutationObserver(<span style="color:#00a">function</span>(mutations) {
    mutations.forEach(<span style="color:#00a">function</span>(mutation) {
      <span style="color:#00a">if</span> (mutation.type===<span style="color:#a50">&#34;attributes&#34;</span> &amp;&amp; mutation.target.style.display===<span style="color:#a50">&#34;block&#34;</span>) {
        dataLayer.push({<span style="color:#a50">&#39;error&#39;</span>: <span style="color:#a50">&#39;modErrorSpan&#39;</span>, <span style="color:#a50">&#39;spanErrorMessage&#39;</span>: mutation.target.innerHTML});
        observer.disconnect();
      }
    });    
  });
  <span style="color:#00a">var</span> config = { attributes: <span style="color:#00a">true</span>, childList: <span style="color:#00a">true</span>, characterData: <span style="color:#00a">true</span> }
  observer.observe(spanError, config);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>It&rsquo;s pretty similar to the previous one but with one or two small changes. First, you&rsquo;re not listening to the DIV, you&rsquo;re listening to the actual node you know will be the target of the style change. This is important, and it means that you have to know exactly what the target will be when creating this script.</p>
<p>Next, in the observer itself, you&rsquo;ll need to specify just what the style change was. I used simply a change from <em>display: none</em> to <em>display: block</em>, but you might have something different in your code. So don&rsquo;t forget to change the content of the if-clause to match what the new style is.</p>
<p>The benefit here is that you&rsquo;re listening to just one single node, so there&rsquo;s a performance boost. I&rsquo;ve got the <strong>observer.disconnect();</strong> again, but you might want to remove that if you want to send events perpetually for each invalid click of the submit button.</p>
<p>Don&rsquo;t forget to test.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/04/span-error.jpg" title="Span with error and dataLayer">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/04/span-error.jpg#ZgotmplZ" alt="Span with error and dataLayer" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 465 489'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="conclusions">Conclusions</h2>
<p>This might seem like a cool hack to you. After all, you&rsquo;re listening for changes on the page without actually any page refresh happening! Also, you&rsquo;re extending GTM&rsquo;s default listeners so you&rsquo;re kind of like a Google engineer, right?</p>
<p>Well, remember what I said in the disclaimer of this text. This is a hack, a circumvention, a <em>band-aid</em>, designed to overcome problems with your markup or your JavaScript. Having a custom form handler which doesn&rsquo;t propagate a proper form submit event (which is required by GTM&rsquo;s default form submit listener) is a bit suspect and reeks of bad practices. So before you resort to this DOM listener, make sure you exhaust all other, more orthodox possibilities with your developers.</p>
<p>Then again, you might not need this to overcome any development problems, but rather to complement your current tag setup. In that case, go crazy! It&rsquo;s an excellent way to add more flexibility to your tags. Do note the <a href="https://developer.mozilla.org/en/docs/Web/API/MutationObserver#Browser_compatibility">cross-browser support</a>, however. Support is not comprehensive enough to warrant using this listener as a firing rule for some business-critical tag.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/extension/">extension</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/send-mail-upon-google-tag-manager-event/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/accuracy-test-gtm-default-events/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20DOM%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-dom-listener/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/send-mail-upon-google-tag-manager-event/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/accuracy-test-gtm-default-events/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20DOM%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-dom-listener/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20DOM%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-dom-listener/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-dom-listener/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

