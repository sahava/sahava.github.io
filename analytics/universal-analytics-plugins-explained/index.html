

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Universal Analytics Plugins Explained | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2015/04/universal-analytics-plugins.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/universal-analytics-plugins-explained/",
  "datePublished": "2015-04-27T13:21:05+00:00",
  "dateModified": "2015-04-27T13:21:05+00:00",
  "description": "Guide to how plugins work in Google Analytics.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31 with theme Tranquilpeak 0.4.3-BETA">
    <title>Universal Analytics Plugins Explained | Simo Ahava's blog</title>
    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;

j.addEventListener('load', function() {
  var _ge = new	CustomEvent('gtm_loaded', { bubbles: true });
  d.dispatchEvent(_ge);
});

f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PZ7GMV9');
</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/universal-analytics-plugins-explained/">
    
    <meta name="description" content="Guide to how plugins work in Google Analytics.">
    <meta property="og:description" content="Guide to how plugins work in Google Analytics.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Universal Analytics Plugins Explained">
    <meta property="og:url" content="/analytics/universal-analytics-plugins-explained/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Universal Analytics Plugins Explained">
    <meta name="twitter:description" content="Guide to how plugins work in Google Analytics.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/04/universal-analytics-plugins.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/04/universal-analytics-plugins.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Universal Analytics Plugins Explained
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-04-27T13:21:05Z">
        
  April 27, 2015

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/universal-analytics-plugins-explained/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p>There are many tools and methods to make <a href="http://www.google.com/analytics/">Google Analytics</a> more manageable. <a href="http://tagmanager.google.com">Google Tag Manager</a> is probably the best known of these, and you can find many, many <a href="https://www.simoahava.com/tags/google-tag-manager/">articles about GTM</a> on these pages as well.</p>

<p>However, today I want to tell you about one of the features of Universal Analytics that hasn&rsquo;t, as far as I know, received too much attention. It&rsquo;s funny, because at the same time almost everyone uses the feature in the shape of <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/ecommerce">eCommerce</a>, <a href="https://support.google.com/analytics/answer/2558867?hl=en">enhanced link attribution</a>, and <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cross-domain#autolink">cross-domain tracking</a>. I&rsquo;m talking, of course, about <strong>Universal Analytics plugins</strong>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/04/universal-analytics-plugins.png" title="Universal Analytics Plugins">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/04/universal-analytics-plugins.png#ZgotmplZ" alt="Universal Analytics Plugins">
  
    </a>
  
  
</div>



<p>Plugins are JavaScript objects, which you can load and execute using the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/plugins">Universal Analytics global object interface</a>. This is accessed, by default, using the <code>ga()</code> function.</p>

<p>Plugins allow you to do a number of useful things:</p>

<ol>
<li><p>Decouple tracker object access from JavaScript embedded in the page HTML, allowing you to crete, execute, and maintain often used <code>ga()</code> commands in library files instead of directly in the page</p></li>

<li><p>Quickly access the tracker object of choice, without having to prefix every command with the tracker name, or to loop through all the existing trackers to find the correct one</p></li>

<li><p>Execute the plugin commands <em>synchronously</em>, which means you can be 100 % sure that anything the plugin does will be available to commands that come after it in the command queue</p></li>
</ol>

<p>All the benefits listed above facilitate a plug-and-play integration between a platform and Google Analytics. If you&rsquo;re the developer of the platform, you can create a plugin that does most of the legwork, such as assigning a new Custom Dimension with its respective value, and the user only has to load the plugin to reap the benefits.</p>

<h2 id="how-plugins-work">How plugins work</h2>

<p>Before getting into a technical description of plugins themselves, there&rsquo;s something we need to clear up about the Universal Analytics tracker object first. Here&rsquo;s a typical tracking code on a typical website:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
  (<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">i</span>,<span style="color:#a6e22e">s</span>,<span style="color:#a6e22e">o</span>,<span style="color:#a6e22e">g</span>,<span style="color:#a6e22e">r</span>,<span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">m</span>){<span style="color:#a6e22e">i</span>[<span style="color:#e6db74">&#39;GoogleAnalyticsObject&#39;</span>]<span style="color:#f92672">=</span><span style="color:#a6e22e">r</span>;<span style="color:#a6e22e">i</span>[<span style="color:#a6e22e">r</span>]<span style="color:#f92672">=</span><span style="color:#a6e22e">i</span>[<span style="color:#a6e22e">r</span>]<span style="color:#f92672">||</span><span style="color:#66d9ef">function</span>(){
  (<span style="color:#a6e22e">i</span>[<span style="color:#a6e22e">r</span>].<span style="color:#a6e22e">q</span><span style="color:#f92672">=</span><span style="color:#a6e22e">i</span>[<span style="color:#a6e22e">r</span>].<span style="color:#a6e22e">q</span><span style="color:#f92672">||</span>[]).<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">arguments</span>)},<span style="color:#a6e22e">i</span>[<span style="color:#a6e22e">r</span>].<span style="color:#a6e22e">l</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span><span style="color:#66d9ef">new</span> Date();<span style="color:#a6e22e">a</span><span style="color:#f92672">=</span><span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">o</span>),
  <span style="color:#a6e22e">m</span><span style="color:#f92672">=</span><span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#a6e22e">o</span>)[<span style="color:#ae81ff">0</span>];<span style="color:#a6e22e">a</span>.<span style="color:#66d9ef">async</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;<span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#a6e22e">g</span>;<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">parentNode</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">m</span>)
  })(window,document,<span style="color:#e6db74">&#39;script&#39;</span>,<span style="color:#e6db74">&#39;//www.google-analytics.com/analytics.js&#39;</span>,<span style="color:#e6db74">&#39;ga&#39;</span>);

  <span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>);
  <span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>);

&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>If you want to understand what the code above does statement by statement, <a href="http://code.stephenmorley.org/javascript/understanding-the-google-analytics-tracking-code/">this</a> and <a href="https://www.thyngster.com/how-does-the-universal-analytics-snippet-work/">this</a> are good places to start.</p>

<p>What&rsquo;s important, however, is that the <em>analytics.js</em> library is loaded <em>asynchronously</em>. The loading starts when the immediately invoked function expression (IIFE) is executed, but the browser&rsquo;s JavaScript engine moves right to the two <code>ga()</code> commands <em>before the analytics.js library has loaded</em>. This means that the two <code>ga()</code> calls are not actually interacting with <em>analytics.js</em>, but instead they are pushing commands into a <em>command queue</em>, which is processed first-in first-out as soon as the library has loaded.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/04/process.png" title="The tracker load process">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/04/process.png#ZgotmplZ" alt="The tracker load process">
  
    </a>
  
  
</div>



<p>This, in turn, has a significant implication on what you can do with the code. Consider the following example:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
...<span style="color:#a6e22e">the</span> <span style="color:#a6e22e">IIFE</span> <span style="color:#a6e22e">here</span>...

<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>, {
  <span style="color:#e6db74">&#39;dimension1&#39;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">ga</span>.<span style="color:#a6e22e">getAll</span>()[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;clientId&#39;</span>)
});
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>If you know your tracker methods, you&rsquo;ll see that this attempts to send the <strong>clientId</strong> of the tracker object as a Custom Dimension with the page view hit.</p>

<p>This code will, however, result in the error: <strong>ga.getAll is not a function</strong>. The reason for this error is due to the library not having loaded yet when the JavaScript engine processes the command in the <code>ga()</code> call. It&rsquo;s the <em>analytics.js</em> library that sets up the interface for the global object, not the tracking code.</p>

<p>There are two ways to overcome this. You can pass a <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#pushIt">callback function as an argument</a> to the <code>ga()</code> call, and any code within that function will not be executed until the library has loaded. The second method would be to use a <strong>plugin</strong>.</p>

<p>When you call the <code>ga('require', 'pluginName')</code> method, this request is added to the command queue. When the <em>analytics.js</em> library has finally loaded, the command queue will be processed in order. Once the processing reaches this &lsquo;require&rsquo; command, the queue will halt until a &lsquo;provide&rsquo; call with the same plugin name is found in or added to the queue. This means that the following code would work nicely:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
...<span style="color:#a6e22e">the</span> <span style="color:#a6e22e">IIFE</span> <span style="color:#a6e22e">here</span>...

<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>);
<span style="color:#75715e">// Load the getClientId plugin, which gets the
</span><span style="color:#75715e">// clientId and sets it as dimension1 on following hits
</span><span style="color:#75715e"></span><span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;require&#39;</span>, <span style="color:#e6db74">&#39;getClientId&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>);
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>Even though the tracker interface is not available when the &lsquo;require&rsquo; command is added to the queue, the interface <em>will</em> be available once the queue is being processed.</p>

<h2 id="how-to-create-a-plugin">How to create a plugin</h2>

<p>Let&rsquo;s create the <strong>getClientId</strong> plugin from the previous chapter. The plugin code itself consists of <strong>two</strong> required components:</p>

<ol>
<li><p>A <strong>constructor</strong> that is executed when the plugin is loaded</p></li>

<li><p>A <strong>&lsquo;provide&rsquo;</strong> command that links the constructor with the plugin name</p></li>
</ol>

<p>To create the plugin <strong>getClientId</strong>, you would need something like the following code loaded on the page:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">GetClientId</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tracker</span>) {
  <span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;dimension1&#39;</span>, <span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;clientId&#39;</span>));
};
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ga</span> <span style="color:#f92672">=</span> window[window[<span style="color:#e6db74">&#39;GoogleAnalyticsObject&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;ga&#39;</span>];
<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ga</span>) {
  <span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;provide&#39;</span>, <span style="color:#e6db74">&#39;getClientId&#39;</span>, <span style="color:#a6e22e">GetClientId</span>);
}</code></pre></div>

<p>The first lines are for the constructor. It&rsquo;s just a JavaScript function, but it turns into an object constructor  with the <code>ga('require', 'getClientId')</code> call, which creates a new object instance of <code>GetClientId</code>.</p>

<p>If object-oriented JavaScript confuses you, take a look at the excellent JavaScript track at <a href="http://www.codecademy.com/en/tracks/javascript-original">codecademy</a>.</p>

<p>Anyway, the tracker object used in the call to the constructor is automatically passed as an argument to the function. This means that you can run commands on the tracker object, and you don&rsquo;t have to worry about interacting with the right tracker or sending the hits to the right Google Analytics property.</p>

<p>The next lines first make sure that the <code>ga()</code> command exists. The <code>ga()</code> function is created in the Universal Analytics tracking snippet, so if your plugin code is executed <em>before</em> the browser parses the tracking snippet, it might not work.</p>

<p>Finally, the <code>ga('provide', 'pluginName', Constructor)</code> command is run so that the plugin can be found with its respective &lsquo;require&rsquo; call.</p>

<p>To briefly recap, here is how plugins are loaded and linked to trackers:</p>

<ol>
<li><p>The Universal Analytics tracking snippet creates the <code>ga()</code> function and the command queue</p></li>

<li><p>All function calls to <code>ga()</code> are added to this command queue</p></li>

<li><p>If you have a plugin, both its &lsquo;require&rsquo; and &lsquo;provide&rsquo; calls will be added to the queue as well</p></li>

<li><p>Once the <em>analytics.js</em> library has loaded, the commands in the queue are processed in order</p></li>

<li><p>If a &lsquo;require&rsquo; command is encountered, the queue processing halts indefinitely, until a &lsquo;provide&rsquo; call with the same plugin name is run</p></li>

<li><p>The entire plugin constructor function is executed before queue processing continues</p></li>
</ol>

<p>Below is an example of the loading order in action. The plugin &lsquo;require&rsquo; call is between the &lsquo;create&rsquo; and &lsquo;send&rsquo; calls, and the library itself is loaded after the Universal Analytics tracking code snippet. This is to secure that the <code>ga()</code> function is created before the plugin.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
...<span style="color:#a6e22e">the</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">expression</span> <span style="color:#a6e22e">here</span>...

<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;require&#39;</span>, <span style="color:#e6db74">&#39;getClientId&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>);
&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://www.simoahava.com/scripts/getClientId.js&#34;</span> <span style="color:#a6e22e">async</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>Note that the &lsquo;require&rsquo; command waits for the respective &lsquo;provide&rsquo; command <em>indefinitely</em>. This means that if you misspell the plugin name, or if you only have the &lsquo;require&rsquo; command there for some reason, the queue processing <em>will not proceed</em>. So try to avoid breaking your analytics implementation, please!</p>

<h2 id="example-simoplugin-library">Example: SimoPlugin library</h2>

<p>Here&rsquo;s an example of a plugin I might be tempted to use over and over again. In it, I have two special features:</p>

<ol>
<li><p>A <strong>generic event pusher</strong>, which I can use with all my trackers to send events to their respective properties</p></li>

<li><p>A <strong>hit duplicator</strong>, which duplicates the hit to the Universal Analytics collection endpoint, and sends it as an HTTP request to any custom endpoint of my choice</p></li>
</ol>

<p>I&rsquo;m storing the plugin in a file called <strong>simoPlugin.js</strong>, which I then load asynchronously after my tracking code:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
...<span style="color:#a6e22e">the</span> <span style="color:#a6e22e">IIFE</span> <span style="color:#a6e22e">here</span>...

<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;create&#39;</span>, <span style="color:#e6db74">&#39;UA-1234567-2&#39;</span>, <span style="color:#e6db74">&#39;auto&#39;</span>, {<span style="color:#e6db74">&#39;name&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;rollup&#39;</span>});
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;require&#39;</span>, <span style="color:#e6db74">&#39;simoPlugin&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;rollup.require&#39;</span>, <span style="color:#e6db74">&#39;simoPlugin&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>);
<span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;rollup.send&#39;</span>, <span style="color:#e6db74">&#39;pageview&#39;</span>);
&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://www.simoahava.com/scripts/simoPlugin.js&#34;</span> <span style="color:#a6e22e">async</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>As you can see, I have my normal tracker and a tracker with the name <strong>rollup</strong>, and I&rsquo;m loading the plugin for both trackers using the typical <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#multipletrackers">multiple tracker</a> syntax.</p>

<p>The way the <strong>hit duplicator</strong> works is that whenever a &lsquo;send&rsquo; command is used, e.g. <code>ga('send', 'pageview')</code>, the exact payload to the Universal Analytics endpoint is copied and sent to a (fictional) endpoint of mine at <em><a href="http://process.simoahava.com/collect">http://process.simoahava.com/collect</a></em>:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/04/local-copy.png" title="Hit duplication">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/04/local-copy.png#ZgotmplZ" alt="Hit duplication">
  
    </a>
  
  
</div>



<p>By duplicating hits like this, you can create your own data collection mechanism. You can even use a cloud endpoint, which will give you a lot more processing power and scale. You might even use this to overcome the <a href="https://www.simoahava.com/analytics/the-schema-conspiracy/">schema conspiracy</a> I&rsquo;ve been ranting about before.</p>

<p>The <strong>generic event pusher</strong> works by sending a custom event object to a plugin method called <code>trackEvent</code>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;simoPlugin:trackEvent&#39;</span>, {
  <span style="color:#e6db74">&#39;cat&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Link Click&#39;</span>, 
  <span style="color:#e6db74">&#39;act&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Outbound&#39;</span>, 
  <span style="color:#e6db74">&#39;lab&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://www.google.com&#39;</span>, 
  <span style="color:#e6db74">&#39;di&#39;</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">4</span>, 
  <span style="color:#e6db74">&#39;dv&#39;</span> <span style="color:#f92672">:</span> document.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">pathname</span>
});</code></pre></div>

<p>As you can see, an object literal is passed as the second argument of the <code>ga()</code> call. This argument, in turn, is passed to the <code>trackEvent</code> method in the plugin code. The method takes the arguments, makes sure no undefined fields are sent, and pushes an event hit to the property associated with the tracker that was used to call the plugin method. If I wanted to send the call to my <em>rollup</em> tracker, I would have used the syntax <code>ga('rollup.simoPlugin:trackEvent')</code>.</p>

<h3 id="simoplugin-code">simoPlugin code</h3>

<p>The code stored in the <strong>simoPlugin.js</strong> library looks like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>() {

  <span style="color:#75715e">// Assign the ga variable to the Google Analytics global function
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ga</span> <span style="color:#f92672">=</span> window[window[<span style="color:#e6db74">&#39;GoogleAnalyticsObject&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;ga&#39;</span>];

  <span style="color:#75715e">// Helper function for registering the Plugin
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">providePlugin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">pluginName</span>, <span style="color:#a6e22e">pluginConstructor</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ga</span>) { 
      <span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;provide&#39;</span>, <span style="color:#a6e22e">pluginName</span>, <span style="color:#a6e22e">pluginConstructor</span>);
    }
  };
  
  <span style="color:#75715e">// Constructor for simoPlugin
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// Copies payload to custom host
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">SimoPlugin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tracker</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tracker</span>;
    
    <span style="color:#75715e">// Copy the original hit dispatch function
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">originalSendHitTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>);
    
    <span style="color:#75715e">// Modify the existing hit dispatcher to send a local copy of the hit
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
      <span style="color:#a6e22e">originalSendHitTask</span>(<span style="color:#a6e22e">model</span>); <span style="color:#75715e">// Send the original hit as usual
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
      <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;http://process.simoahava.com/collect&#39;</span>, <span style="color:#66d9ef">true</span>);
      <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>));
    });
  };
  
  <span style="color:#75715e">// Set up a generic event dispatcher
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">SimoPlugin</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">trackEvent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">evt</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;cat&#39;</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;act&#39;</span>];
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">l</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;lab&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;val&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> {};
    <span style="color:#a6e22e">x</span>[<span style="color:#e6db74">&#39;nonInteraction&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;ni&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">false</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;di&#39;</span>]) {
      <span style="color:#a6e22e">x</span>[<span style="color:#e6db74">&#39;dimension&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;di&#39;</span>]] <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;dv&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;event&#39;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">x</span>);
  };
  
  <span style="color:#a6e22e">providePlugin</span>(<span style="color:#e6db74">&#39;simoPlugin&#39;</span>, <span style="color:#a6e22e">SimoPlugin</span>);
})();</code></pre></div>

<p>First things first: the whole thing is wrapped in an <em>immediately invoked function expression</em>. This is a good habit in general, since it will scope all variables within to function scope, and thus you&rsquo;ll avoid polluting the global namespace. Here&rsquo;s good overview of why IIFEs rock: <a href="http://gregfranko.com/blog/i-love-my-iife/">I Love My IIFE - Greg Frank</a>.</p>

<p>The next few lines are for making the plugin loader more generic. Since it&rsquo;s possible to <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#renaming">change the global function name</a> in the <em>analytics.js</em> tracking code, we&rsquo;ll need to make sure the plugin loader works even if the function name is no longer <code>ga</code>.</p>

<p>The <code>providePlugin</code> is a generic helper function which is largely redundant, but it will provide useful if you&rsquo;re loading multiple plugins in the same library.</p>

<h3 id="the-constructor">The constructor</h3>

<p>We create the constructor function in these lines:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">SimoPlugin</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">tracker</span>) {
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tracker</span>;
    
  <span style="color:#75715e">// Copy the original hit dispatch function
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">originalSendHitTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>);
    
  <span style="color:#75715e">// Modify the existing hit dispatcher to send a local copy of the hit
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
    <span style="color:#a6e22e">originalSendHitTask</span>(<span style="color:#a6e22e">model</span>); <span style="color:#75715e">// Send the original hit as usual
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;http://process.simoahava.com/collect&#39;</span>, <span style="color:#66d9ef">true</span>);
    <span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>));
  });
};</code></pre></div>

<p>As you can see, the first argument to the function will be the tracker object used to load the plugin. This means that we can manipulate and use this tracker object interface without having to worry about accidentally sending hits to wrong GA properties!</p>

<p>I use <code>this.tracker = tracker;</code> to store a reference to the tracker object into each instance of the plugin created with this constructor. This is why commands like <code>ga('simoPlugin:trackEvent')</code> and <code>ga('rollup.simoPlugin:trackEvent')</code> access a different tracker object. They both have their own, unique bindings of <code>this</code>, and thus they both have their own, unique tracker object references.</p>

<p>The next line accesses the <strong>sendHitTask</strong> <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">property of the tracker object</a>. Whenever a &lsquo;send&rsquo; command is used with the Universal Analytics global function, a series of tasks are executed. <strong>sendHitTask</strong> is one of these, and it is used to send the hit payload to the Universal Analytics collection endpoint.</p>

<p>The last call in the block is for updating the <strong>sendHitTask</strong> task in the tracker. This update uses the original <strong>sendHitTask</strong> (now stored in a variable called <code>originalSendHitTask</code>), and sends the payload to the Universal Analytics collection endpoint as before. The next three lines create a new HTTP request to the endpoint of your choice. The payload of this request is the exactly same payload that is sent to Universal Analytics.</p>

<p>By using this code, you will be able to create a perfect copy of the hit sent to Universal Analytics, and you can send this copy anywhere you want, such as a local hit processor, or a custom endpoint in a cloud server, for example.</p>

<p>Because this code is in the constructor, it is automatically applied to <strong>all</strong> &lsquo;send&rsquo; commands that take place on the page after the plugin has been loaded.</p>

<h3 id="the-event-pusher">The event pusher</h3>

<p>The event pusher is defined as a method of the <code>SimoPlugin</code> object prototype. The reason we&rsquo;re applying it to the prototype is because we want it to be available to all instances created with the <code>SimoPlugin</code> constructor. If we&rsquo;d leave the <code>prototype</code> object out of the declaration, the <code>trackEvent</code> method would be added to an object literal called <code>SimoPlugin</code>, and not the object prototype. This means that the instances created from this prototype would not be able to use that method.</p>

<p>Again, if this is confusing, be sure to read up on object-oriented JavaScript. It&rsquo;s interesting stuff, and it really shows what a complex and powerful programming language JavaScript is!</p>

<p>The event pusher code looked like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">SimoPlugin</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">trackEvent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">evt</span>) {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;cat&#39;</span>];
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;act&#39;</span>];
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">l</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;lab&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;val&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">=</span> {};
  <span style="color:#a6e22e">x</span>[<span style="color:#e6db74">&#39;nonInteraction&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;ni&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">false</span>;
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;di&#39;</span>]) {
    <span style="color:#a6e22e">x</span>[<span style="color:#e6db74">&#39;dimension&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;di&#39;</span>]] <span style="color:#f92672">=</span> <span style="color:#a6e22e">evt</span>[<span style="color:#e6db74">&#39;dv&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">undefined</span>;
  }
  <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">tracker</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;event&#39;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">x</span>);
};</code></pre></div>

<p>This code takes an object as an argument. This object is sent with the <code>ga()</code> command when the method is invoked:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">ga</span>(<span style="color:#e6db74">&#39;simoPlugin:trackEvent&#39;</span>, {
  <span style="color:#e6db74">&#39;cat&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;category&#39;</span>,
  <span style="color:#e6db74">&#39;act&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;action&#39;</span>,
  <span style="color:#e6db74">&#39;lab&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;label&#39;</span>,
  <span style="color:#e6db74">&#39;val&#39;</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
  <span style="color:#e6db74">&#39;ni&#39;</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>,
  <span style="color:#e6db74">&#39;di&#39;</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
  <span style="color:#e6db74">&#39;dv&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dimensionValue&#39;</span>
});</code></pre></div>

<p>There are fields for Category, Action, Label, and Value, and I also let you determine whether the hit is non-interaction or not. Finally, you can also add one dimension with the index number and value exposed in the parameters.</p>

<p>Because Category and Action are required fields for events, the code will fail if these are not in the object. All the other fields can be left out, which is why I have them resolve to <em>undefined</em> if they don&rsquo;t exist in the event object. The exception is the <strong>nonInteraction</strong> field, which defaults to <em>false</em>.</p>

<p>Using this generic event pusher, it&rsquo;s pretty trivial to send simple AND complex events to Universal Analytics.</p>

<p>The final line, <code>this.tracker.send()</code>, sends the event using the tracker object&rsquo;s <code>send()</code> method. As you can see, we&rsquo;re using <code>this.tracker</code>, which accesses the interface of the tracker object used to call the method. The beauty of object-oriented JavaScript, right here ladies and gentlemen! If we didn&rsquo;t use the power of object instances like this, we&rsquo;d need to loop through all the trackers on the page to find the one we want to use. Way too complex!</p>

<h2 id="platform-integrations">Platform integrations</h2>

<p>Well, if the event pusher didn&rsquo;t persuade you with its potential, and if you&rsquo;re left unimpressed by the hit duplicator, another great idea for plugins is to integrate a SaaS platform and Google Analytics together.</p>

<p>For example, let&rsquo;s say you have a platform through which you can create a new Custom Dimension in a Universal Analytics property, and then you can populate it with some value. This would happen programmatically, and the platform would use the <a href="https://developers.google.com/analytics/devguides/config/mgmt/v3/">Google Analytics Management API</a> to create the Custom Dimension.</p>

<p>Once the dimension is created, you&rsquo;d dynamically generate the JavaScript plugin library to include these programmatically created Custom Dimensions. Then you use the plugin commands to send hits to the trackers, using the correct Custom Dimensions.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/04/integration.png" title="Platform integration with plugin">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/04/integration.png#ZgotmplZ" alt="Platform integration with plugin">
  
    </a>
  
  
</div>



<p>This makes the integration between the platform and the website very plug-and-play, and you don&rsquo;t need to ask the users to look up the correct dimension number, add it to the inline code, and risk some silly misunderstanding ruining the integration.</p>

<p>It&rsquo;s such an elegant way of associating a website with your platform with just two lines of code at best (one for loading the library, and one for the <code>ga('require', 'pluginName')</code> call).</p>

<h2 id="summary">Summary</h2>

<p>Plugins are an excellent way of associating often made calls with their respective tracker objects.</p>

<p>Also, they allow you to decouple all of the Universal Analytics commands from inline code. This allows you to write complex handlers for these commands without polluting the page template.</p>

<p>Plugins are, however, quite an advanced use case for data collection. They require a very good understanding of JavaScript and of how the Universal Analytics library works.</p>

<p>Especially if you&rsquo;re working with platform integrations and want to minimize the amount of work that users willing to implement the plugin need to do, I strongly recommend talking to your developers about creating a custom plugin for the integration.</p>

<p>Unfortunately, plugins are not supported by the Google Tag Manager Universal Analytics tag template yet, so you might have to use a Custom HTML Tag to load plugins with GTM. See <a href="https://www.simoahava.com/analytics/improve-data-collection-with-four-custom-dimensions/">this article</a> for inspiration.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/plugins/">plugins</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/universal-analytics/">universal analytics</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/spam-filter-insertion-tool/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/use-the-all-pages-trigger-correctly/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Universal%20Analytics%20Plugins%20Explained%20https://www.simoahava.com/analytics/universal-analytics-plugins-explained/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/spam-filter-insertion-tool/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/use-the-all-pages-trigger-correctly/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Universal%20Analytics%20Plugins%20Explained%20https://www.simoahava.com/analytics/universal-analytics-plugins-explained/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Universal%20Analytics%20Plugins%20Explained%20https://www.simoahava.com/analytics/universal-analytics-plugins-explained/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

