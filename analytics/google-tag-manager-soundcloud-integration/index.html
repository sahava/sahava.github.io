

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <script>
      function gtag() { window.dataLayer = window.dataLayer || []; window.dataLayer.push(arguments); }
      gtag('event', 'optimize.callback', {
	    callback: function(e) {
	      window.__flickerTestMilestones = window.__flickerTestMilestones || {};
          window.__flickerTestMilestones.experimentLoaded = new Date().getTime();
	    }
      });
    </script>
    <script async src="https://www.googleoptimize.com/optimize.js?id=GTM-NGM64B"></script>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Google Tag Manager: SoundCloud Integration | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2015\/06\/gtm-soundcloud.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/google-tag-manager-soundcloud-integration\/",
  "datePublished": "2015-06-18T12:28:45\x2b00:00",
  "dateModified": "2015-06-18T12:28:45\x2b00:00",
  "description": "Track interactions with your embedded SoundCloud widget using Google Tag Manager. You can send the data to Google Analytics, for example.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Google Tag Manager: SoundCloud Integration | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/google-tag-manager-soundcloud-integration/">
    
    <meta name="description" content="Track interactions with your embedded SoundCloud widget using Google Tag Manager. You can send the data to Google Analytics, for example.">
    <meta property="og:description" content="Track interactions with your embedded SoundCloud widget using Google Tag Manager. You can send the data to Google Analytics, for example.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Google Tag Manager: SoundCloud Integration">
    <meta property="og:url" content="https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Google Tag Manager: SoundCloud Integration">
    <meta name="twitter:description" content="Track interactions with your embedded SoundCloud widget using Google Tag Manager. You can send the data to Google Analytics, for example.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/06/gtm-soundcloud.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/06/gtm-soundcloud.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Google Tag Manager: SoundCloud Integration
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-06-18T12:28:45Z">
        
  June 18, 2015

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/#commento">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>According to their website, <a href="https://soundcloud.com/">SoundCloud</a> is &ldquo;the worldâ€™s leading social sound platform where anyone can create sounds and share them everywhere&rdquo;. For artists, it's a channel for distributing previews of their tracks, and for people like me it's a nice way to do some API tinkering. To each their own, I guess!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/06/gtm-soundcloud.jpg" title="Google Tag Manager SoundCloud">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/06/gtm-soundcloud.jpg#ZgotmplZ" alt="Google Tag Manager SoundCloud">
  
    </a>
  
  
</div>


<p>I saw a number of requests in the <a href="https://plus.google.com/u/0/communities/104865292981489764063">Google+ Google Tag Manager</a> community about a SoundCloud integration, so I decided to look into it to see if I could just build one.</p>
<p>SoundCloud has something called the <a href="https://developers.soundcloud.com/docs/api/html5-widget">Widget API</a>, which listens for <code>window.postMessage</code> calls from within the embedded SoundCloud iframes. The benefit of this versus, for example, the <a href="http://www.cardinalpath.com/youtube-video-tracking-with-gtm-and-ua-a-step-by-step-guide/">YouTube API</a> is that you don't need to do anything to the iframe itself to make this work. All you need to do is load the Widget API, and then indicate which iframe(s) you want to listen to for interactions.</p>
<h2 id="the-setup">The setup</h2>
<p>For this to work, you will need the following:</p>
<ul>
<li>
<p><strong>Custom HTML Tag</strong> which loads the Widget API, adds the listeners, and does the <code>dataLayer.push()</code> calls</p>
</li>
<li>
<p><strong>Custom Event Trigger</strong> which fires your Tag when a SoundCloud event is registered</p>
</li>
<li>
<p><strong>Data Layer Variables</strong> for Event Category, Event Action, and Event Label</p>
</li>
<li>
<p><strong>Event Tag</strong> which fires when the Trigger is activated, and sends the event hit to Google Analytics</p>
</li>
</ul>
<p>The most complex component is the Custom HTML Tag, so let's start there.</p>
<h2 id="the-custom-html-tag">The Custom HTML Tag</h2>
<p>Here's the full Tag code. Copy-paste it into a new Custom HTML Tag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#aaa;font-style:italic">&lt;!--</span><span style="color:#aaa;font-style:italic"> Load the SoundCloud API synchronously </span><span style="color:#aaa;font-style:italic">--&gt;</span>
&lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">src</span>=<span style="color:#a50">&#34;https://w.soundcloud.com/player/api.js&#34;</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
<span style="color:#aaa;font-style:italic">&lt;!--</span><span style="color:#aaa;font-style:italic"> Initiate the API integration </span><span style="color:#aaa;font-style:italic">--&gt;</span>
&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  (<span style="color:#00a">function</span>() {
    <span style="color:#00a">try</span> {
      <span style="color:#aaa;font-style:italic">// initWidget is called when a SoundCloud iframe is found on the page
</span><span style="color:#aaa;font-style:italic"></span>      <span style="color:#00a">var</span> initWidget = <span style="color:#00a">function</span>(w) {
        <span style="color:#00a">var</span> currentSound, act, pos, q1, q2, q3, go, lab;
        <span style="color:#00a">var</span> cat = <span style="color:#a50">&#39;SoundCloud&#39;</span>;
        <span style="color:#00a">var</span> widget = SC.Widget(w);
        
        <span style="color:#aaa;font-style:italic">// Events.READY is dispatched when the widget has been loaded
</span><span style="color:#aaa;font-style:italic"></span>        widget.bind(SC.Widget.Events.READY, <span style="color:#00a">function</span>() {
          
          <span style="color:#aaa;font-style:italic">// Get the title of the currently playing sound
</span><span style="color:#aaa;font-style:italic"></span>          widget.getCurrentSound(<span style="color:#00a">function</span>(cs) { 
            lab = cs[<span style="color:#a50">&#39;title&#39;</span>]; 
          });
          
          <span style="color:#aaa;font-style:italic">// Fire a dataLayer event when Events.PLAY is dispatched
</span><span style="color:#aaa;font-style:italic"></span>          widget.bind(SC.Widget.Events.PLAY, <span style="color:#00a">function</span>() { 
            act = <span style="color:#a50">&#39;Play&#39;</span>; 
            sendDl(cat, act, lab); 
          });
          
          <span style="color:#aaa;font-style:italic">// Fire a dataLayer event when Events.PAUSE is dispatched
</span><span style="color:#aaa;font-style:italic"></span>          <span style="color:#aaa;font-style:italic">// The only exception is when the sound ends, and the auto-pause is not reported
</span><span style="color:#aaa;font-style:italic"></span>          widget.bind(SC.Widget.Events.PAUSE, <span style="color:#00a">function</span>(obj) { 
            pos = <span style="color:#0aa">Math</span>.round(obj[<span style="color:#a50">&#39;relativePosition&#39;</span>] * <span style="color:#099">100</span>);
            <span style="color:#00a">if</span> (pos !== <span style="color:#099">100</span>) {
              act = <span style="color:#a50">&#39;Pause&#39;</span>; 
              sendDl(cat, act, lab); 
            }
          });
          
          <span style="color:#aaa;font-style:italic">// As the play progresses, send events at 25%, 50% and 75%
</span><span style="color:#aaa;font-style:italic"></span>          widget.bind(SC.Widget.Events.PLAY_PROGRESS, <span style="color:#00a">function</span>(obj) { 
            go = <span style="color:#00a">false</span>;
            pos = <span style="color:#0aa">Math</span>.round(obj[<span style="color:#a50">&#39;relativePosition&#39;</span>] * <span style="color:#099">100</span>);
            <span style="color:#00a">if</span> (pos === <span style="color:#099">25</span> &amp;&amp; !q1) {
              act = <span style="color:#a50">&#39;25%&#39;</span>;
              q1 = <span style="color:#00a">true</span>;
              go = <span style="color:#00a">true</span>;
            }
            <span style="color:#00a">if</span> (pos === <span style="color:#099">50</span> &amp;&amp; !q2) {
              act = <span style="color:#a50">&#39;50%&#39;</span>;
              q2 = <span style="color:#00a">true</span>;
              go = <span style="color:#00a">true</span>;
            }
            <span style="color:#00a">if</span> (pos === <span style="color:#099">75</span> &amp;&amp; !q3) {
              act = <span style="color:#a50">&#39;75%&#39;</span>;
              q3 = <span style="color:#00a">true</span>;
              go = <span style="color:#00a">true</span>;
            }
            <span style="color:#00a">if</span> (go) {
              sendDl(cat, act, lab);
            }
          });
          
          <span style="color:#aaa;font-style:italic">// When the sound finishes, send an event at 100%
</span><span style="color:#aaa;font-style:italic"></span>          widget.bind(SC.Widget.Events.FINISH, <span style="color:#00a">function</span>() { 
            act = <span style="color:#a50">&#39;100%&#39;</span>; 
            q1 = q2 = q3 = <span style="color:#00a">false</span>; 
            sendDl(cat, act, lab); 
          });
        });
      };
      
      <span style="color:#aaa;font-style:italic">// Generic method for pushing the dataLayer event
</span><span style="color:#aaa;font-style:italic"></span>      <span style="color:#aaa;font-style:italic">// Use a Custom Event Trigger with &#34;scEvent&#34; as the event name
</span><span style="color:#aaa;font-style:italic"></span>      <span style="color:#aaa;font-style:italic">// Remember to create Data Layer Variables for eventCategory, eventAction, and eventLabel
</span><span style="color:#aaa;font-style:italic"></span>      <span style="color:#00a">var</span> sendDl = <span style="color:#00a">function</span>(cat, act, lab) {
        <span style="color:#0aa">window</span>.dataLayer.push({
          <span style="color:#a50">&#39;event&#39;</span> : <span style="color:#a50">&#39;scEvent&#39;</span>,
          <span style="color:#a50">&#39;eventCategory&#39;</span> : cat,
          <span style="color:#a50">&#39;eventAction&#39;</span> : act,
          <span style="color:#a50">&#39;eventLabel&#39;</span> : lab
        });
      };

      <span style="color:#aaa;font-style:italic">// For each SoundCloud iFrame, initiate the API integration
</span><span style="color:#aaa;font-style:italic"></span>      <span style="color:#00a">var</span> i,len;
      <span style="color:#00a">var</span> iframes = <span style="color:#0aa">document</span>.querySelectorAll(<span style="color:#a50">&#39;iframe[src*=&#34;api.soundcloud.com&#34;]&#39;</span>);
      <span style="color:#00a">for</span> (i = <span style="color:#099">0</span>, len = iframes.length; i &lt; len; i += <span style="color:#099">1</span>) {
        initWidget(iframes[i]);
      }
    } <span style="color:#00a">catch</span>(e) { console.log(<span style="color:#a50">&#39;Error with SoundCloud API: &#39;</span> + e.message); }
  })();
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>Make sure this Custom HTML Tag fires upon a <strong>Page View</strong> Trigger, where the Trigger Type is <strong>DOM Ready</strong>. If it doesn't work, try changing the Trigger Type to <strong>Window Loaded</strong>. It's possible a race condition emerges, where the Custom HTML Tag is fired before your SoundCloud widgets are loaded, and shifting the Trigger to fire on Window Loaded should remedy that.</p>
<p>Let's chop it up into pieces so we'll understand what's happening. This time, we'll start from the end!</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// For each SoundCloud iFrame, initiate the API integration
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">var</span> i,len;
<span style="color:#00a">var</span> iframes = <span style="color:#0aa">document</span>.querySelectorAll(<span style="color:#a50">&#39;iframe[src*=&#34;api.soundcloud.com&#34;]&#39;</span>);
<span style="color:#00a">for</span> (i = <span style="color:#099">0</span>, len = iframes.length; i &lt; len; i += <span style="color:#099">1</span>) {
  initWidget(iframes[i]);
}
</code></pre></div>
<p>The code above goes through all the iframes on the page. If it encounters an iframe that loads an embedded SoundCloud Widget, it calls the <code>initWidget</code> method, using the iframe object as a parameter. This is as simple as it gets. The cool thing is that each iframe gets its own bindings, so you can run the script with multiple SoundCloud widgets on the page!</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> initWidget = <span style="color:#00a">function</span>(w) {
  <span style="color:#00a">var</span> currentSound, act, pos, q1, q2, q3, go, lab;
  <span style="color:#00a">var</span> cat = <span style="color:#a50">&#39;SoundCloud&#39;</span>;
  <span style="color:#00a">var</span> widget = SC.Widget(w);
        
  <span style="color:#aaa;font-style:italic">// Events.READY is dispatched when the widget has been loaded
</span><span style="color:#aaa;font-style:italic"></span>  widget.bind(SC.Widget.Events.READY, <span style="color:#00a">function</span>() {
          
    <span style="color:#aaa;font-style:italic">// Get the title of the currently playing sound
</span><span style="color:#aaa;font-style:italic"></span>    widget.getCurrentSound(<span style="color:#00a">function</span>(cs) { 
      lab = cs[<span style="color:#a50">&#39;title&#39;</span>]; 
    });          
</code></pre></div>
<p>The <code>initWidget</code> function is called for all the SoundCloud iframes on the page. First, it declares some utility variables. Next, it uses the Widget API <code>SC.Widget</code> constructor to create a new widget object the API uses for the bindings.</p>
<p>On the following lines, the <code>SC.Widget.Events.READY</code> event is bound to the widget object. This event is fired when the embedded SoundCloud object has loaded and is ready to be interacted with. All the listeners are put into this function callback, as we don't want to start listening for events before the embedded file has loaded, right?</p>
<p>The first thing we do is get the title of the sound, and for that we need to use the asynchronous <code>getCurrentSound</code> function, whose callback returns the sound object. Then, we access this object's <code>title</code> key and store it in a variable. Now we have all the static variables defined, and we can create our four listeners.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Fire a dataLayer event when Events.PLAY is dispatched
</span><span style="color:#aaa;font-style:italic"></span>widget.bind(SC.Widget.Events.PLAY, <span style="color:#00a">function</span>() { 
  act = <span style="color:#a50">&#39;Play&#39;</span>; 
  sendDl(cat, act, lab); 
});
</code></pre></div>
<p>The first listener is bound to the <code>SC.Widget.Events.PLAY</code> event, which, surprisingly, is dispatched when a &ldquo;Play&rdquo; event is recorded in the widget. Once that happens, we set the <code>act</code> variable to &ldquo;Play&rdquo;, and invoke the <code>sendDl</code> (see below) method, which does the <code>dataLayer.push()</code>. Parameters are the <code>cat</code> (&ldquo;SoundCloud&rdquo;), <code>act</code> (&ldquo;Play&rdquo;), and <code>lab</code> (Sound title) variables.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Fire a dataLayer event when Events.PAUSE is dispatched
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// The only exception is when the sound ends, and the auto-pause is not reported
</span><span style="color:#aaa;font-style:italic"></span>widget.bind(SC.Widget.Events.PAUSE, <span style="color:#00a">function</span>(obj) { 
  pos = <span style="color:#0aa">Math</span>.round(obj[<span style="color:#a50">&#39;relativePosition&#39;</span>] * <span style="color:#099">100</span>);
  <span style="color:#00a">if</span> (pos !== <span style="color:#099">100</span>) {
    act = <span style="color:#a50">&#39;Pause&#39;</span>; 
    sendDl(cat, act, lab); 
  }
});
</code></pre></div>
<p>The next event we'll bind is <code>SC.Widget.Events.PAUSE</code>, which is dispatched when a &ldquo;Pause&rdquo; event is recorded in the widget. It's practically the same as the &ldquo;Play&rdquo; event, but we need to add one extra check there. SoundCloud auto-pauses the sound when it's completed, so GA would receive a number of &ldquo;Pause&rdquo; events that were not initiated by the user. That's why we have the check on the first line of the callback, where we basically see if the &ldquo;Pause&rdquo; event occurred when the position of the sound is at 100%. This would indicate that it's an auto-pause, and we won't invoke <code>sendDl</code> in that case.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// As the play progresses, send events at 25%, 50% and 75%
</span><span style="color:#aaa;font-style:italic"></span>widget.bind(SC.Widget.Events.PLAY_PROGRESS, <span style="color:#00a">function</span>(obj) { 
  go = <span style="color:#00a">false</span>;
  pos = <span style="color:#0aa">Math</span>.round(obj[<span style="color:#a50">&#39;relativePosition&#39;</span>] * <span style="color:#099">100</span>);
  <span style="color:#00a">if</span> (pos === <span style="color:#099">25</span> &amp;&amp; !q1) {
    act = <span style="color:#a50">&#39;25%&#39;</span>;
    q1 = <span style="color:#00a">true</span>;
    go = <span style="color:#00a">true</span>;
  }
  <span style="color:#00a">if</span> (pos === <span style="color:#099">50</span> &amp;&amp; !q2) {
    act = <span style="color:#a50">&#39;50%&#39;</span>;
    q2 = <span style="color:#00a">true</span>;
    go = <span style="color:#00a">true</span>;
  }
  <span style="color:#00a">if</span> (pos === <span style="color:#099">75</span> &amp;&amp; !q3) {
    act = <span style="color:#a50">&#39;75%&#39;</span>;
    q3 = <span style="color:#00a">true</span>;
    go = <span style="color:#00a">true</span>;
  }
  <span style="color:#00a">if</span> (go) {
    sendDl(cat, act, lab);
  }
});
</code></pre></div>
<p>The next binding is for the <code>SC.Widget.Events.PLAY_PROGRESS</code>. This event is dispatched every few milliseconds, and the object it returns has the <em>relative position</em> of the sound at the time of the event. This relative position is actually a percentage of how far the user has listened to the track. So, because I've chosen to send an event at 25%, 50%, 75% and 100%, I need to check if the relative position is at these milestones. I also use a couple of booleans, <code>q1 q2 q3 go</code>, which prevent the same milestone from being sent multiple times. The <code>go</code> variable ensures that the GA Event is only fired when the milestones are reached, and not for every single iteration of the PLAY_PROGRESS event.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// When the sound finishes, send an event at 100%
</span><span style="color:#aaa;font-style:italic"></span>widget.bind(SC.Widget.Events.FINISH, <span style="color:#00a">function</span>() { 
  act = <span style="color:#a50">&#39;100%&#39;</span>; 
  q1 = q2 = q3 = <span style="color:#00a">false</span>; 
  sendDl(cat, act, lab); 
});
</code></pre></div>
<p>Finally, when the sound finishes, we send the 100% event, and we also reset the utility variables. If we don't reset them, repeated listenings would not be recorded.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Generic method for pushing the dataLayer event
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// Use a Custom Event Trigger with &#34;scEvent&#34; as the event name
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// Remember to create Data Layer Variables for eventCategory, eventAction, and eventLabel
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">var</span> sendDl = <span style="color:#00a">function</span>(cat, act, lab) {
  <span style="color:#0aa">window</span>.dataLayer.push({
    <span style="color:#a50">&#39;event&#39;</span> : <span style="color:#a50">&#39;scEvent&#39;</span>,
    <span style="color:#a50">&#39;eventCategory&#39;</span> : cat,
    <span style="color:#a50">&#39;eventAction&#39;</span> : act,
    <span style="color:#a50">&#39;eventLabel&#39;</span> : lab
  });
};
</code></pre></div>
<p>And here's the <code>sendDl</code> method. It just takes the parameters, and pushes them into a <code>dataLayer</code> object.</p>
<h2 id="the-trigger">The Trigger</h2>
<p>To activate GTM Tags when a SoundCloud event is registered, create a new Custom Event Trigger that looks like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/06/custom-event.jpg" title="Custom Event Trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/06/custom-event.jpg#ZgotmplZ" alt="Custom Event Trigger">
  
    </a>
  
  
</div>


<p>It's a simple one. This Trigger will fire your Tags when the <code>sendDl</code> method we built above is invoked.</p>
<h2 id="the-data-layer-variables">The Data Layer Variables</h2>
<p>Next, make sure you have <strong>three</strong> Data Layer Variables. One for <code>eventCategory</code>, one for <code>eventAction</code>, and one for <code>eventLabel</code>. They'd look something like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/06/data-layer-variables.jpg" title="Data Layer Variables for soundcloud">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/06/data-layer-variables.jpg#ZgotmplZ" alt="Data Layer Variables for soundcloud">
  
    </a>
  
  
</div>


<p>These are pretty generic, so you might find them useful <a href="https://www.simoahava.com/analytics/create-a-generic-event-tag/">elsewhere</a> as well.</p>
<h2 id="the-event-tag">The Event Tag</h2>
<p>Finally, you need an Event Tag to carry this information to Google Analytics. Set it up as you would any other Event Tag, and make sure it fires with the Trigger you created before (<strong>Event - scEvent</strong>). Then, add the three Variables you created to their respective fields:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/06/soundcloud-event-tag.jpg" title="SoundCloud Event Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/06/soundcloud-event-tag.jpg#ZgotmplZ" alt="SoundCloud Event Tag">
  
    </a>
  
  
</div>


<p>And that's it! Now your site should be ready to collect hits from SoundCloud widgets.</p>
<h2 id="summary-and-caveats">Summary and caveats</h2>
<p>First, some caveats.</p>
<p>Every now and then I noticed an annoying race condition, where the widget had loaded before the GTM Custom HTML Tag had time to complete. This means that the <code>SC.Widget.Events.READY</code> was dispatched too early for the listener to catch it. This race condition could be fixed by having a timeout of a second or something, which then does the bindings anyway. I didn't write it into this solution, but it should be pretty trivial to implement once you understand how the Widget API works.</p>
<p>Some other things I noticed were quota errors from the API. There's nothing you can do about these, though I believe you can subscribe to some Premium account where these errors don't crop up. As far as I could tell, however, they had no impact on this tracking solution, and the events were sent nevertheless.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/06/post-error.jpg" title="SoundCloud quota error">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/06/post-error.jpg#ZgotmplZ" alt="SoundCloud quota error">
  
    </a>
  
  
</div>


<p>Anyway, this is a pretty simple solution for tracking SoundCloud widgets on your site. I've tried to mirror the excellent <a href="http://www.cardinalpath.com/youtube-video-tracking-with-gtm-and-ua-a-step-by-step-guide/">YouTube tracking guide</a> by Cardinal Path.</p>
<p>The <a href="https://developers.soundcloud.com/docs/api/html5-widget">Widget API</a> has a number of other interfaces you can tap into if you want to make the solution even better. Let me know if you encountered any problems, or if you have ideas how to improve this solution!</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom/">custom</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/soundcloud/">soundcloud</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/remove-email-addresses-from-url-parameters/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/take-the-google-tag-manager-fundamentals-course/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20SoundCloud%20Integration%20https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/remove-email-addresses-from-url-parameters/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/take-the-google-tag-manager-fundamentals-course/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20SoundCloud%20Integration%20https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20SoundCloud%20Integration%20https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-soundcloud-integration/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

