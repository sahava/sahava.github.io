

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    

<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Send Weather Data To Google Analytics In GTM V2 | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2015/03/flow-chart-1.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/",
  "datePublished": "2015-03-19T09:48:55+00:00",
  "dateModified": "2015-03-19T09:48:55+00:00",
  "description": "How to collect and send weather data from users who visit your website. You can send this information to Google Analytics using Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31 with theme Tranquilpeak 0.4.3-BETA">
    <title>Send Weather Data To Google Analytics In GTM V2 | Simo Ahava's blog</title>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
    
    <meta name="description" content="How to collect and send weather data from users who visit your website. You can send this information to Google Analytics using Google Tag Manager.">
    <meta property="og:description" content="How to collect and send weather data from users who visit your website. You can send this information to Google Analytics using Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Send Weather Data To Google Analytics In GTM V2">
    <meta property="og:url" content="/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Send Weather Data To Google Analytics In GTM V2">
    <meta name="twitter:description" content="How to collect and send weather data from users who visit your website. You can send this information to Google Analytics using Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/03/flow-chart-1.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/03/flow-chart-1.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Send Weather Data To Google Analytics In GTM V2
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-03-19T09:48:55Z">
        
  March 19, 2015

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p>In 2013, I wrote <a href="https://www.simoahava.com/web-development/universal-analytics-weather-custom-dimension/">a guide</a> for Universal Analytics and <a href="http://tagmanager.google.com">Google Tag Manager</a> on how to poll for weather conditions, and send this information to <a href="http://analytics.google.com">Google Analytics</a> as a custom dimension of the session. The guide was intended as a technical introduction to Google Tag Manager, and I think it succeeded in that.</p>

<p>However, GTM has <a href="https://support.google.com/tagmanager/answer/4620708?hl=en">changed a lot</a> over the last 1.5 years, and I&rsquo;ve made some improvements to the method along the way. So I wanted to update the guide for <a href="http://analytics.blogspot.fi/2014/10/making-tag-management-more-accessible.html">the new version</a> of Google Tag Manager (V2), and introduce some changes to the code that make it more flexible and efficient.</p>

<p><strong>(UPDATE 21 August 2017)</strong> - I updated this article to work with the Weather Unlocked API (thanks to KÃ©vin Coppens for the tip), due to openWeatherMap upgrading their SSL plan to a pretty expensive level. Do note that Weather Unlocked requires the use of an API key, and passing the API key client-side is risky, and opens up your API plan to abuse. For those who want to take this weather analysis seriously, I really recommend moving to a 100% server-side solution, where the weather data is polled before the page itself is rendered, and the data is written in the <code>dataLayer</code> of the page.</p>

<p>Since this is a whopper of a post, I&rsquo;ve got a <strong>table of contents</strong> right here:</p>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-what-it-does">1. What it does</a></li>
<li><a href="#2-core-requirements">2. Core requirements</a>
<ul>
<li><a href="#2-1-trigger">2.1. Trigger</a></li>
<li><a href="#2-2-data-layer-variables">2.2. Data Layer Variables</a></li>
<li><a href="#2-3-1st-party-cookie-variable">2.3. 1st Party Cookie Variable</a></li>
<li><a href="#2-4-session-scoped-custom-dimensions">2.4. Session-scoped Custom Dimensions</a></li>
<li><a href="#2-5-universal-analytics-event-tag">2.5. Universal Analytics Event Tag</a></li>
</ul></li>
<li><a href="#3-building-the-script">3. Building the script</a>
<ul>
<li><a href="#3-1-geolocation">3.1. Geolocation</a></li>
<li><a href="#3-2-building-the-api-call">3.2. Building the API call</a></li>
<li><a href="#3-3-maintaining-state-with-a-cookie">3.3. Maintaining state with a cookie</a></li>
</ul></li>
<li><a href="#4-summary">4. Summary</a></li>
</ul></li>
</ul>
</nav>

<h2 id="1-what-it-does">1. What it does</h2>

<p>The idea behind the solution is to poll a weather service, so that all sessions in Google Analytics would be annotated with information on what the weather conditions were at the time of the session. The underlying question we&rsquo;re trying to answer is: &ldquo;Does weather play a part in how people interact with your website or your brand?&rdquo;. This might be a very relevant question for businesses very dependent on weather conditions, such as those with golf courses and ski slopes.</p>

<p>The technical method is split into three parts:</p>

<ol>
<li><p><strong>Geolocation</strong> - we need to get an approximation of the geographic area the visitor is browsing from.</p></li>

<li><p><strong>Weather API</strong> - we will use this geolocation data to query for the weather conditions in the visitor&rsquo;s region.</p></li>

<li><p><strong>Data Layer</strong> - finally, we will store all the information we get in the dataLayer object to be available for our Tags.</p></li>
</ol>

<p>It&rsquo;s not the simplest of processes, and there are many ways you can optimize it (I&rsquo;ll expound these in the relevant chapters). Also, one of the main reasons for writing this guide in the first place is to show a prototype for <em>any</em> generic API call you might want to make. So it&rsquo;s not just weather, but share price, traffic details, basketball results, and so on. <a href="http://www.programmableweb.com/apis/directory">If there&rsquo;s an API</a> for it, you can use this method to enrich your visitors&rsquo; sessions with new Custom Dimensions and Metrics.</p>

<p>The solution itself follows the following flow, visualized with my mad PowerPoint skills:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/flow-chart-1.png" title="Flow chart">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/flow-chart-1.png#ZgotmplZ" alt="Flow chart">
  
    </a>
  
  
</div>



<p>It&rsquo;s a fairly straightforward process, with only two junctions: session cookie state and success / failure of the API call itself.</p>

<h2 id="2-core-requirements">2. Core requirements</h2>

<p>Regardless of how you wind up doing the solution, you will require some core components. These are:</p>

<ol>
<li><p><a href="http://www.geoplugin.com/premium#ssl_access_per_year">geoPlugin API key</a> and <a href="https://developer.weatherunlocked.com/signup">Weather Unlocked API credentials</a></p></li>

<li><p>Custom HTML Tag to poll the API and store the information in dataLayer</p></li>

<li><p>Trigger to fire an Event Tag when the data is in dataLayer
Data Layer Variables to pull the information from the dataLayer into the Event Tag</p></li>

<li><p>1st Party Cookie Variable to maintain session state</p></li>

<li><p>Session-scoped Custom Dimensions set up in Google Analytics to receive the API data from the Tag</p></li>

<li><p>Universal Analytics Event Tag to send the data to Google Analytics</p></li>
</ol>

<p>We&rsquo;ll create the Custom HTML Tag later, since it requires a bit more work and deliberation than the other core requirements.</p>

<h3 id="2-1-trigger">2.1. Trigger</h3>

<p>The Trigger is simple. It&rsquo;s just a Custom Event Trigger that fires when an &lsquo;event&rsquo; key with value &lsquo;weatherDone&rsquo; is pushed into dataLayer. Give it a descriptive name, such as <strong>Event - weatherDone</strong>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/event-weatherdone.png" title="Custom Event Trigger">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/event-weatherdone.png#ZgotmplZ" alt="Custom Event Trigger">
  
    </a>
  
  
</div>



<p>Make sure the Trigger looks like the one in the screenshot above.</p>

<h3 id="2-2-data-layer-variables">2.2. Data Layer Variables</h3>

<p>In this solution, we&rsquo;ll use two Data Layer Variables. One to hold a simplified description of the weather conditions (e.g. &ldquo;Cloudy&rdquo;, &ldquo;Rain&rdquo;, &ldquo;Storm&rdquo;), and one to store the temperature, also simplified (e.g. &ldquo;5Â°C - 15Â°C&rdquo;).</p>

<p>So, create two Data Layer Variables, one for Variable Name <strong>weather</strong>, and one for Variable Name <strong>temperature</strong>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/dlv-weather.png" title="Data Layer Variable Weather">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/dlv-weather.png#ZgotmplZ" alt="Data Layer Variable Weather">
  
    </a>
  
  
</div>



<p>The Variable above is named <strong>DLV - weather</strong>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/dlv-temperature-1.png" title="Data Layer Variable temperature">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/dlv-temperature-1.png#ZgotmplZ" alt="Data Layer Variable temperature">
  
    </a>
  
  
</div>



<p>Give the second Variable a name such as <strong>DLV - temperature</strong>. This is the naming convention I use (DLV stands for Data Layer Variable, of course), but you can name them as you wish.</p>

<h3 id="2-3-1st-party-cookie-variable">2.3. 1st Party Cookie Variable</h3>

<p>We&rsquo;ll be artificially maintaining session state using a custom cookie, written by the script and refreshed each time the page loads. The reason we want to maintain state like this is because <strong>we only want to send weather data once per session</strong>.</p>

<p>The API call to the weather service is not light-weight. We want to avoid making calls like this as much as we can, because that way the page load process won&rsquo;t be hindered by slowly loading asynchronous API calls like this. So, when the visitor first lands on the site, a cookie is created that mimics GA&rsquo;s session logic by having a 30-minute expiration. Naturally, this isn&rsquo;t the entire session logic (we&rsquo;re missing stuff like referral exclusions, cross-domain tracking, etc.), but it&rsquo;s close enough to save us from making unnecessary calls.</p>

<p>The cookie script is in the actual API script introduced later in this article, but the Variable you&rsquo;ll need to create should look like this:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/08/1st-party-cookie.png" title="Session alive 1st party cookie">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2017/08/1st-party-cookie.png#ZgotmplZ" alt="Session alive 1st party cookie">
  
    </a>
  
  
</div>



<h3 id="2-4-session-scoped-custom-dimensions">2.4. Session-scoped Custom Dimensions</h3>

<p>Because we have two measurements we want to send as extra data, we&rsquo;ll need two Custom Dimensions to store them. Now, you might wonder: &ldquo;Why not use Custom Metrics for temperature? It&rsquo;s numeric, after all?&rdquo;. That&rsquo;s a good question, and the reason is that you can&rsquo;t calculate on Custom Metrics yet. So all temperature data that you would be sending would end up as cumulative across your reports. It doesn&rsquo;t make sense to ask &ldquo;What was the sum of all temperatures for converting visits from Helsinki?&rdquo;, but it makes a lot of sense to ask &ldquo;What was the average of all temperatures for converting visits from Helsinki?&rdquo;. The latter, unfortunately, is not yet available through Google Analytics.</p>

<p>Anyway, <a href="https://support.google.com/analytics/answer/2709829?hl=en&amp;topic=2709827&amp;ctx=topic">create two session-scoped Custom Dimensions</a>, and name them so that you&rsquo;ll find them when going through your dimension lists. I&rsquo;ve used simply &ldquo;Weather&rdquo; and &ldquo;Temperature&rdquo;.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/custom-dimensions-1.png" title="Weather custom dimensions">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/custom-dimensions-1.png#ZgotmplZ" alt="Weather custom dimensions">
  
    </a>
  
  
</div>



<p>It&rsquo;s important to make note of the dimension index number for both new dimensions. We&rsquo;ll need this information for our Event Tag.</p>

<h3 id="2-5-universal-analytics-event-tag">2.5. Universal Analytics Event Tag</h3>

<p>The Event Tag has two &ldquo;customizations&rdquo;, if you will. First of all, we&rsquo;re sending this hit as a non-interaction event. This means that it will not affect the bounce rate of the session. The reasoning for this is that weather data isn&rsquo;t something that results from a visitor action. It&rsquo;s just meta information about the session, so it&rsquo;s not interactive.</p>

<p>Use the Trigger you created in step 2.1. to fire this Event Tag.</p>

<p>Why not use a Page View Tag, then? Another great question. Well, the API calls we&rsquo;ll be making in the Custom HTML Tag take time to complete, since they&rsquo;re executed asynchronously. This means that we won&rsquo;t be able to pinpoint the moment in the page load sequence when the data is actually sent, but we will know it will be deferred for as long as the API call takes. If the call takes up a long time to complete, it will delay our Page View Tag from firing. This, I think, is a definite no-no. Page Views are a crucial part of session-based hit collection, and missing them simply is not an option.</p>

<p>There&rsquo;s no down-side to using a non-interaction event.</p>

<p>Anyway, the Tag I&rsquo;ve used here has the following event parameters:</p>

<p><strong>Event Category</strong> - Weather<br />
<strong>Event Action</strong> - {{DLV - weather}}<br />
<strong>Event Label</strong> - {{DLV - temperature}}<br />
<strong>Non-Interaction</strong> - True</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/event-tag.png" title="Universal Analytics weather event tag">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/event-tag.png#ZgotmplZ" alt="Universal Analytics weather event tag">
  
    </a>
  
  
</div>



<p>Next, scroll down to More Settings, and expand Custom Dimensions. Here, you will need to add two new rows of Custom Dimensions to accommodate the two dimensions that are hungrily waiting for data to pass through the GA interface.</p>

<p>At this point, you will need to remember or look up the dimension index numbers from Google Analytics Admin. In my example, they&rsquo;re simply 1 (for Temperature) and 2 (for Weather), but remember to adjust if necessary.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/custom-dimensions-gtm.png" title="custom Dimensions google tag manager">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/custom-dimensions-gtm.png#ZgotmplZ" alt="custom Dimensions google tag manager">
  
    </a>
  
  
</div>



<p>Add the respective Data Layer Variables to the value fields, as in the image above.</p>

<p>That&rsquo;s it for the core requirements.</p>

<p>The next bit gets quite complicated.</p>

<h2 id="3-building-the-script">3. Building the script</h2>

<p>If you remember from the beginning, this technical solution falls into three parts: geolocation, weather query, and storing the information in <code>dataLayer</code>.</p>

<p>To get started, you will need a Custom HTML Tag that uses the <strong>All Pages</strong> Trigger. Give it a descriptive name. I&rsquo;ve used <strong>Utility - HTML - Weather Query</strong>, but, again, you are free to go with your own naming convention.</p>

<p>This code has been rewritten to work with HTTPS-protected sites. If your site isn&rsquo;t using HTTPS, much of this will be overkill and needlessly expensive, but I do recommend you upgrade your site security as soon as possible.</p>

<p>The code within, in all its JavaScript glory, is this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span>&gt;
  (<span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fetchWeatherData</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>) {
      <span style="color:#75715e">// You need to sign up to Weather Unlocked for an account. Once you do,
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// you will find your APP ID and APP KEY in your account dashboard.
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wuAppId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_weather_unlocked_app_id_here&#39;</span>;
      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wuAppKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_weather_unlocked_app_key_here&#39;</span>;
      <span style="color:#a6e22e">jQuery</span>.<span style="color:#a6e22e">getJSON</span>(<span style="color:#e6db74">&#39;https://api.weatherunlocked.com/api/current/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;?app_id=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">wuAppId</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&amp;app;_key=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">wuAppKey</span>)
        .<span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) { 
          window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
            <span style="color:#a6e22e">event</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;weatherDone&#39;</span>,
            <span style="color:#a6e22e">weather</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wx_desc</span>,
            <span style="color:#a6e22e">temperature</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">temp_c</span>
          });
        }).<span style="color:#a6e22e">fail</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">jq</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">msg</span>) {
          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Weather request failed: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; - &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msg</span>);
        });
    };     
    
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">geoLocateUser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
      <span style="color:#75715e">// This is your API key for GeoPlugin, which you can purchase at
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// http://www.geoplugin.com/premium#ssl_access_per_year
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">geoPluginAPIKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_api_key_here&#39;</span>;
      <span style="color:#a6e22e">jQuery</span>.<span style="color:#a6e22e">getJSON</span>(<span style="color:#e6db74">&#39;https://ssl.geoplugin.net/json.gp?k=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">geoPluginAPIKey</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&amp;jsoncallback;=?&#39;</span>)
        .<span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
          <span style="color:#a6e22e">fetchWeatherData</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">geoplugin_longitude</span>, <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">geoplugin_latitude</span>);
        }).<span style="color:#a6e22e">fail</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">jq</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">msg</span>) {
          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Geolocation failed: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; - &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msg</span>);
        });
    };

    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> {{<span style="color:#a6e22e">Session</span> <span style="color:#a6e22e">alive</span>}} <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
      <span style="color:#a6e22e">geoLocateUser</span>();
    }
    
    <span style="color:#75715e">// Reset &#34;session&#34; cookie with a 30-minute expiration
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
    <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">setTime</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">getTime</span>()<span style="color:#f92672">+</span><span style="color:#ae81ff">1800000</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">expires</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;expires=&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">toGMTString</span>();
    document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;session=1; &#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">expires</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;; path=/&#34;</span>;
  })();
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>Oh my, that&rsquo;s a lot of code. In the next chapters I&rsquo;ll walk you through just what the heck is going on here.</p>

<p>It&rsquo;s important to notice that I&rsquo;m loading jQuery at the very top of the script. Also, I&rsquo;ve wrapped the whole script itself in an <em>immediately invoked function expression</em> to scope all variables to the function and thus avoid polluting the global namespace.</p>

<p>If you&rsquo;re already loading jQuery on the site, you shouldn&rsquo;t load it again in this Tag, but then you will need to ensure the Custom HTML Tag fires only after jQuery has completely loaded. If you load jQuery asynchronously, it leaves you little choice but to fire the Custom HTML Tag upon the <strong>Window Loaded</strong> Trigger, since that&rsquo;s the only moment you can be sure that jQuery has been loaded.</p>

<p>For error logging, I simply invoke the <code>.fail()</code> callback of the JSON requests to the two APIs (<a href="http://www.geoplugin.com/">geoPlugin</a> and <a href="https://www.weatherunlocked.com">Weather Unlocked</a>). In case of an error, the message is simply written to the console, but you can also invoke a <code>dataLayer.push()</code> to log the error elsewhere, such as Google Analytics.</p>

<h3 id="3-1-geolocation">3.1. Geolocation</h3>

<p>There are many ways to do geolocation, but for usability&rsquo;s sake I use an API call for this as well. If you&rsquo;re serious about this solution, you might want to install a geolocation service on your own web server, so that you&rsquo;ll avoid needing to make any extra API calls in the client.</p>

<p>Geolocation hinges on one thing: the visitor&rsquo;s IP address. There are many ways to get this data, as it is public information, exposed in the HTTP headers of the visitor&rsquo;s requests. You might have guessed at this point that the accuracy of the solution is thus dependent on what type of proxies or VPNs the visitor might be using. This is something we will not be able to work around, and thus you will need to take the geolocation data, as any other data in the public web, with a grain of salt.</p>

<p>What we&rsquo;ll need back from the geolocation service are the latitude and longitude of the visitor. IP-based geolocation is usually accurate down to the city the visitor is from, but in many cases it might be a much broader spectrum, such as an entire state or even country. Nevertheless, we&rsquo;ll take what we can get.</p>

<p>The method in the script uses an all-in-one API for both getting the IP address and retrieving the longitude and latitude of the visit. The service is called <a href="http://www.geoplugin.com">geoPlugin</a>, and the SSL plan is fairly inexpensive.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">geoLocateUser</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// This is your API key for GeoPlugin, which you can purchase at
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// http://www.geoplugin.com/premium#ssl_access_per_year
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">geoPluginAPIKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_api_key_here&#39;</span>;
  <span style="color:#a6e22e">jQuery</span>.<span style="color:#a6e22e">getJSON</span>(<span style="color:#e6db74">&#39;https://ssl.geoplugin.net/json.gp?k=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">geoPluginAPIKey</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&amp;jsoncallback;=?&#39;</span>)
    .<span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) {
      <span style="color:#a6e22e">fetchWeatherData</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">geoplugin_longitude</span>, <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">geoplugin_latitude</span>);
    }).<span style="color:#a6e22e">fail</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">jq</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">msg</span>) {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Geolocation failed: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; - &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msg</span>);
    });
};</code></pre></div>

<p>In this method, you first need to write your API key into the <code>geoPluginAPIKey</code> variable. You&rsquo;ll get this API key by subscribing to a <a href="http://www.geoplugin.com/premium#ssl_access_per_year">very cheap plan</a> at geoPlugin. Next, we use the JSONP endpoint of the geoPlugin API to fetch the geolocation data for the user. It&rsquo;s all wrapped in jQuery&rsquo;s extremely useful <code>getJSON()</code> method.</p>

<p>The asynchronous request is supplemented with the <code>done()</code> callback, which is invoked if everything goes well. In this callback, we pass the longitude and latitude information to the next function in the chain: <code>fetchWeatherData()</code>.</p>

<p>In case of an error, the error information is output into the browser console.</p>

<h3 id="3-2-building-the-api-call">3.2. Building the API call</h3>

<p>So now we&rsquo;ve got geolocation down. The next thing we need to do is use this information to poll for weather data.</p>

<p>I use the <strong>Weather Unlocked</strong> service for this. It has a pretty generous <a href="https://developer.weatherunlocked.com/localweather/pricing">free plan</a>, and it supports both SSL and non-SSL requests. (<strong>UPDATE:</strong> Looks like Weather Unlocked Developer API for SSL requests requires a small subscription fee now.)</p>

<p>Once you&rsquo;ve signed up to the service, you will find your APP ID and APP KEY in the dashboard.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/03/wu-dashboard.png" title="Weather Unlocked dashboard">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/03/wu-dashboard.png#ZgotmplZ" alt="Weather Unlocked dashboard">
  
    </a>
  
  
</div>



<p>The <code>fetchWeatherData()</code> method itself looks like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fetchWeatherData</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">longitude</span>, <span style="color:#a6e22e">latitude</span>) {
  <span style="color:#75715e">// You need to sign up to Weather Unlocked for a free account. Once you do,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// you will find your APP ID and APP KEY in your account dashboard.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wuAppId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_weather_unlocked_app_id_here&#39;</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wuAppKey</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;paste_your_weather_unlocked_app_key_here&#39;</span>;
  <span style="color:#a6e22e">jQuery</span>.<span style="color:#a6e22e">getJSON</span>(<span style="color:#e6db74">&#39;https://api.weatherunlocked.com/api/current/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">latitude</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">longitude</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;?app_id=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">wuAppId</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&amp;app;_key=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">wuAppKey</span>)
    .<span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">data</span>) { 
      window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
        <span style="color:#a6e22e">event</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;weatherDone&#39;</span>,
        <span style="color:#a6e22e">weather</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">wx_desc</span>,
        <span style="color:#a6e22e">temperature</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">temp_c</span>
      });
    }).<span style="color:#a6e22e">fail</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">jq</span>, <span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">msg</span>) {
      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Weather request failed: &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">status</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; - &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">msg</span>);
    });
};</code></pre></div>

<p>It&rsquo;s fairly similar to the geolocation method. We use the latitude and longitude information to query the Weather Unlocked API. You&rsquo;ll need your APP ID and APP KEY handy for this!</p>

<p>Upon a successful request, the response is parsed for the description of the current weather (<code>data.wx_desc</code>) as well as the current temperature (<code>data.temp_c</code>). These are added to the dataLayer object under their respective keys.</p>

<p>Note that all <strong>Ajax</strong> calls are made using jQuery. Now, the benefits and pitfalls of being dependent on an external, bloated framework like jQuery can be debated, but jQuery handles Ajax requests beautifully. It&rsquo;s perfect for what we&rsquo;re trying to achieve here, so I don&rsquo;t mind using the framework.</p>

<p>And that&rsquo;s about it! The solution is fairly simple, relying on fairly simple, chained asynchronous requests. If one fails, then the rest doesn&rsquo;t get executed, so you might want to add some error handling if you want to know what your success rate is. But since we&rsquo;re using session-scoped Custom Dimensions, you can already get a success rate by looking at how many sessions have weather data out of all sessions.</p>

<p>Just one thing remaining.</p>

<h3 id="3-3-maintaining-state-with-a-cookie">3.3. Maintaining state with a cookie</h3>

<p>The final bit of the puzzle is to fire the tag just once per session. We do this by only starting the whole process if a custom 1st party cookie has <strong>not been set</strong>. The {{Session alive}} Variable returns <em>undefined</em> if the cookie is not set, so we can check against this before executing the first step (the geolocation).</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> {{<span style="color:#a6e22e">Session</span> <span style="color:#a6e22e">alive</span>}} <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
    ...<span style="color:#a6e22e">the</span> <span style="color:#a6e22e">geolocation</span> <span style="color:#a6e22e">call</span>...
  }    
    
  <span style="color:#75715e">// Reset &#34;session&#34; cookie with a 30-minute expiration
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
  <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">setTime</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">getTime</span>()<span style="color:#f92672">+</span><span style="color:#ae81ff">1800000</span>);
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">expires</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;expires=&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">toGMTString</span>();
  document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;session=1; &#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">expires</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;; path=/&#34;</span>;</code></pre></div>

<p>At the end of the script, regardless of whether the cookie was set or not, we create / update the cookie with a new 30-minute expiration.</p>

<p>And that&rsquo;s it. Easy, right?</p>

<p>Remember to test it carefully in Preview mode. Check the JavaScript console for any errors, test that the cookie logic works, and monitor Real-Time reports in Google Analytics to verify that data is flowing in.</p>

<h2 id="4-summary">4. Summary</h2>

<p>So this is the weather script for Google Tag Manager V2. Feel free to swap the Weather Unlocked API with any other API endpoint you might want to query. You will need to study the API, modify the parameters, and parse the data differently, but the logic is the same.</p>

<p>It would be cool to know if weather analysis has brought you any insights. A great idea for modifying the script would be to not just track <em>today&rsquo;s</em> weather, but the weather next weekend or over a holiday. Does a warm Easter contribute to fewer bookings in the ski slopes, and does a rainy weekend ahead make green fee sales plummet at the local golf course?</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/api/">api</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/v2/">v2</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/weather/">weather</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debugging-tag-execution-properly/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/track-url-fragments-as-pageviews/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Send%20Weather%20Data%20To%20Google%20Analytics%20In%20GTM%20V2%20https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debugging-tag-execution-properly/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/track-url-fragments-as-pageviews/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Send%20Weather%20Data%20To%20Google%20Analytics%20In%20GTM%20V2%20https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=%25!s%28BADINDEX%29">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fwww.simoahava.com%2Fanalytics%2Fsend-weather-data-to-google-analytics-in-gtm-v2%2F%20%25!s%28BADINDEX%29%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=%25!s%28BADINDEX%29">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=%25!s%28BADINDEX%29">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

