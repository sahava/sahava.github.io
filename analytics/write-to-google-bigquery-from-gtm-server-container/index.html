

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Write To Google BigQuery From A GTM Server Container | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2021\/03\/bigquery-in-template.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/write-to-google-bigquery-from-gtm-server-container\/",
  "datePublished": "2021-03-03T09:57:51\u002b02:00",
  "dateModified": "2021-03-03T09:57:51\u002b02:00",
  "description": "Utilize the BigQuery API in Google Tag Manager\u0027s server-side templates to build a data stream from your Clients and tags directly to Google BigQuery.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Write To Google BigQuery From A GTM Server Container | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/write-to-google-bigquery-from-gtm-server-container/">
    
    <meta name="description" content="Utilize the BigQuery API in Google Tag Manager&#39;s server-side templates to build a data stream from your Clients and tags directly to Google BigQuery.">
    <meta property="og:description" content="Utilize the BigQuery API in Google Tag Manager&#39;s server-side templates to build a data stream from your Clients and tags directly to Google BigQuery.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Write To Google BigQuery From A GTM Server Container">
    <meta property="og:url" content="https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Write To Google BigQuery From A GTM Server Container">
    <meta name="twitter:description" content="Utilize the BigQuery API in Google Tag Manager&#39;s server-side templates to build a data stream from your Clients and tags directly to Google BigQuery.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
	  <meta property="og:image" content="https://www.simoahava.com/images/2021/03/write-to-google-big-query-from-a-gtm-server-container.jpg">
      <meta name="twitter:image" content="https://www.simoahava.com/images/2021/03/write-to-google-big-query-from-a-gtm-server-container.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
    <div class="figure nocaption">
      <img class="cover" src="https://www.simoahava.com/images/2021/03/write-to-google-big-query-from-a-gtm-server-container.jpg">
    </div>
  
  

    <h1>
      Write To Google BigQuery From A GTM Server Container
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-03-03T09:57:51&#43;02:00">
        
  March 3, 2021

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>Ever since it was released that <a href="https://www.simoahava.com/analytics/server-side-tagging-google-tag-manager/">server-side tagging in Google Tag Manager</a> would run on the <strong>Google Cloud Platform</strong> stack, my imagination has been running wild.</p>
<p>By running on GCP, the potential for integrations with <em>other</em> GCP components is limitless. The output to <a href="https://www.simoahava.com/analytics/tips-for-logging-server-side-tagging/">Cloud Logging</a> already introduces interesting pipeline opportunities, but now it gets even better.</p>
<p><strong>It&rsquo;s finally possible to write directly to Google BigQuery from a <a href="https://developers.google.com/tag-manager/serverside/api">Client or tag template</a>!</strong></p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/bigquery-in-template.jpg" title="BigQuery in a custom template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/bigquery-in-template.jpg#ZgotmplZ" alt="BigQuery in a custom template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1202 452'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This means that instead of treating server-side tagging as a &ldquo;simple&rdquo; <strong>proxy</strong>, whose purpose is mainly to replace data streams that would otherwise connect a client directly with an endpoint, it&rsquo;s now possible to use a Server container as a data collection machine itself.</p>
<p>In this article, I&rsquo;ll show you <strong>how to use the BigQuery API</strong> with a use case <a href="https://www.simoahava.com/analytics/google-tag-manager-monitor/">you might already be familiar with</a>. We&rsquo;re going to build a <em>monitoring system</em> that writes tag execution data into a Google BigQuery table.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#official-documentation">Official documentation</a></li>
    <li><a href="#full-example-build-a-monitoring-system">Full example: build a monitoring system</a>
      <ul>
        <li><a href="#create-the-table">Create the table</a></li>
        <li><a href="#the-tag-template">The tag template</a></li>
        <li><a href="#create-the-monitoring-tag">Create the monitoring tag</a></li>
        <li><a href="#add-the-trigger">Add the trigger</a></li>
        <li><a href="#edit-all-tags-metadata">Edit all tags&rsquo; metadata</a></li>
        <li><a href="#check-the-results-in-bigquery">Check the results in BigQuery</a></li>
      </ul>
    </li>
    <li><a href="#the-bigquery-api">The BigQuery API</a>
      <ul>
        <li><a href="#the-connectioninfo-object">The connectionInfo object</a></li>
        <li><a href="#permissions">Permissions</a></li>
        <li><a href="#the-rows-array">The <code>rows</code> array</a></li>
        <li><a href="#the-options-object">The <code>options</code> object</a></li>
        <li><a href="#the-onsuccess-callback">The <code>onSuccess</code> callback</a></li>
        <li><a href="#the-onfailure-callback">The <code>onFailure</code> callback</a></li>
      </ul>
    </li>
    <li><a href="#authentication">Authentication</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
<p>This won&rsquo;t be the last I&rsquo;ll write about this integration – there are a <strong>lot</strong> of possibilities available now that a way to natively write data to a data warehouse from the Server container has become available.</p>
<p>We&rsquo;ll start with a <strong>walkthrough</strong> before diving into the <a href="#the-bigquery-api"><strong>API specs</strong></a>.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="official-documentation">Official documentation</h2>
<p>You can find the official documentation for the BigQuery template API by following these links:</p>

                
                  <h2 id="full-example-build-a-monitoring-system">Full example: build a monitoring system</h2>
<p>To get started, we&rsquo;ll build a <a href="https://www.simoahava.com/analytics/google-tag-manager-monitor/">Google Tag Manager monitor</a> for your server-side tags.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/bigquery-monitor.jpg" title="BigQuery monitor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/bigquery-monitor.jpg#ZgotmplZ" alt="BigQuery monitor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1640 890'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <strong>schema</strong> is very simple. It&rsquo;s designed to collect information about the Client that caused the tag(s) to fire, whether they fired successfully (or failed), and how long the execution time of the tag was.</p>
<p>You can use this to proactively monitor for issues in your Server container setup.</p>
<h3 id="create-the-table">Create the table</h3>
<p>Before we get started, we need to create a <strong>table</strong> in BigQuery. I recommend using the same project as the one where your Server container is running. This way you don&rsquo;t have to worry about setting up authentication, as the Server container will already have full access to all cloud components running in the same project.</p>
<p>First, <a href="https://console.cloud.google.com/bigquery">Go to BigQuery</a>.</p>
<p>Then, find your project ID in the navigation, and select the project.</p>
<p>Finally, click <strong>CREATE DATASET</strong> to create a new dataset.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/create-dataset.jpg" title="Create dataset">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/create-dataset.jpg#ZgotmplZ" alt="Create dataset" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2002 900'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Give dataset an ID, such as <code>gtm_monitoring</code>, and set the data location, if you wish. Once ready, click the <strong>Create dataset</strong> button.</p>
<p>Once the dataset is created, make sure it&rsquo;s selected in the navigation, and then click <strong>CREATE TABLE</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/create-table.jpg" title="Create table">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/create-table.jpg#ZgotmplZ" alt="Create table" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2270 776'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The three settings you&rsquo;ll want to edit are <strong>Table name</strong>, <strong>Schema</strong>, and <strong>Partitioning</strong>.</p>
<p>Set the <strong>Table name</strong> to whatever you want to name the table as, e.g. <code>event_data</code>.</p>
<p>Next, click <strong>+Add field</strong> to start creating the <strong>schema</strong>.</p>
<p>The schema is essentially a blueprint for what type of data the table expects to be inserted into it. You need to define the <strong>fields</strong> (or columns) of the table, whether they are <strong>required</strong> or something else, and what the expected <strong>data type</strong> is.</p>
<p>See <a href="https://cloud.google.com/bigquery/docs/schemas">the BigQuery documentation</a> for more details on what options you have at your disposal.</p>
<p>This is the schema I&rsquo;ve chosen for the monitoring data:</p>
<table>
<thead>
<tr>
<th>Field name</th>
<th>Type</th>
<th>Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event_name</code></td>
<td>STRING</td>
<td>REQUIRED</td>
</tr>
<tr>
<td><code>event_timestamp</code></td>
<td>INTEGER</td>
<td>REQUIRED</td>
</tr>
<tr>
<td><code>client_name</code></td>
<td>STRING</td>
<td>REQUIRED</td>
</tr>
<tr>
<td><code>tag</code></td>
<td>RECORD</td>
<td>REPEATABLE</td>
</tr>
<tr>
<td><code>tag.id</code></td>
<td>STRING</td>
<td>NULLABLE</td>
</tr>
<tr>
<td><code>tag.name</code></td>
<td>STRING</td>
<td>NULLABLE</td>
</tr>
<tr>
<td><code>tag.status</code></td>
<td>STRING</td>
<td>NULLABLE</td>
</tr>
<tr>
<td><code>tag.execution_time</code></td>
<td>INTEGER</td>
<td>NULLABLE</td>
</tr>
</tbody>
</table>
<p>For <strong>Partitioning</strong>, I&rsquo;ve chosen to partition by <strong>day</strong>, which means that a table suffix is added to each row with the date of when the data was written to the table. This makes analysis much easier because you can scope your queries by day very easily.</p>
<p>This is what the final configuration for the table looks like:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/table-settings.jpg" title="Table settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/table-settings.jpg#ZgotmplZ" alt="Table settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1370 1794'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h3 id="the-tag-template">The tag template</h3>
<p>You can find the template soon in the Community Template Gallery. For now, you can also download the <code>template.tpl</code> file by saving <a href="https://raw.githubusercontent.com/gtm-templates-simo-ahava/server-container-monitor/main/template.tpl">this page</a> with that filename.</p>
<p>To load the template in the container, go to the Server container, select <strong>Templates</strong>, and then <strong>create a new tag template</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/new-tag-template.jpg" title="New tag template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/new-tag-template.jpg#ZgotmplZ" alt="New tag template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2484 1002'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, in the overflow menu, choose <strong>Import</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/import-template.jpg" title="Import template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/import-template.jpg#ZgotmplZ" alt="Import template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1180 574'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Locate the <code>template.tpl</code> file you downloaded and import that using the system dialog.</p>
<p>Click <strong>Save</strong> to save the template.</p>
<p>To understand how the template works, read on&hellip;</p>
<h3 id="create-the-monitoring-tag">Create the monitoring tag</h3>
<p>Go to <strong>Tags</strong> in the Server container, and click <strong>NEW</strong> to create a new tag.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/new-tag.jpg" title="New tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/new-tag.jpg#ZgotmplZ" alt="New tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2424 482'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Now you need to <strong>configure</strong> the tag. There are three fields you need to set:</p>
<ul>
<li><strong>Project ID</strong> – set to the GCP project ID of the project where the BigQuery table is. If it&rsquo;s the same project as the one running your Server container, <strong>you can leave this field blank</strong>.</li>
<li><strong>Dataset ID</strong> – set to the Dataset ID of the BigQuery table.</li>
<li><strong>Table ID</strong> – set to the Table ID of the BigQuery table.</li>
</ul>
<p>If you&rsquo;ve followed the examples of this tutorial, Dataset ID would be <code>gtm_monitoring</code> and Table ID would be <code>event_data</code>.</p>
<p>Next, expand <strong>Advanced Settings</strong> and <strong>Additional Tag Metadata</strong>, and add a new metadata row with:</p>
<ul>
<li><strong>Key</strong>: <code>exclude</code></li>
<li><strong>Value</strong>: <code>true</code></li>
</ul>
<p>This is what the tag should look like:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/server-container-tag-ready.jpg" title="Server container tag ready">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/server-container-tag-ready.jpg#ZgotmplZ" alt="Server container tag ready" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1776 1346'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <strong>Project ID</strong>, <strong>Dataset ID</strong>, and <strong>Table ID</strong> are used by the tag to make sure the data is written into the correct table.</p>
<p>The <code>exclude</code> key in the <strong>Additional Tag Metadata</strong> can be used to exclude tags from being monitored. In this case, I find that monitoring the monitoring tag itself just adds to noise and confusion, which is why I&rsquo;ve chosen to exclude it.</p>
<h3 id="add-the-trigger">Add the trigger</h3>
<p>Once you&rsquo;ve made the modifications to the monitoring tag, you need to <strong>add a trigger</strong> to it. This is quite simple – you need a trigger that fires for <strong>every single</strong> event because every single event has the capability of firing tags.</p>
<p>So go to <strong>Triggers</strong> and click <strong>NEW</strong> to create a new trigger.</p>
<p>This is what the <strong>All events</strong> trigger should look like:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/all-events-trigger.jpg" title="All events trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/all-events-trigger.jpg#ZgotmplZ" alt="All events trigger" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1026 504'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Add this trigger to your monitoring tag, and then save the tag.</p>
<h3 id="edit-all-tags-metadata">Edit all tags&rsquo; metadata</h3>
<p>The next step is to edit <strong>all the tags</strong> in the container. For each tag, you need to expand <strong>Additional Tag Metadata</strong> again.</p>
<p>Here, you need to check <strong>Include tag name</strong>, and in the <strong>Key for tag name</strong> field you need to type <code>name</code>. Like so:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/key-for-tag-name.jpg" title="Key for tag name">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/key-for-tag-name.jpg#ZgotmplZ" alt="Key for tag name" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 886 386'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>All the fields in <strong>Additional Tag Metadata</strong> are passed to the event callback which is set in the monitoring tag template itself. This callback is executed once <strong>all</strong> tags for that event have completed, and the metadata object gives additional details about the tags themselves.</p>
<p>If you wish, you could add even more key-value pairs to the tag metadata – you just need to modify the monitoring template to add these to the BigQuery API call. And, of course, you need a BigQuery table schema that accepts the new values.</p>
<h3 id="check-the-results-in-bigquery">Check the results in BigQuery</h3>
<p>At this point you should have the following:</p>
<ul>
<li>You&rsquo;ve <strong>imported the template</strong> from my repository (or the gallery).</li>
<li>You&rsquo;ve <strong>created a new monitoring tag</strong> with the template.</li>
<li>You&rsquo;ve <strong>configured</strong> the monitoring tag with your BigQuery table details.</li>
<li>You&rsquo;ve <strong>added</strong> the <em>All events</em> trigger to the monitoring tag.</li>
<li>You&rsquo;ve <strong>edited</strong> all the tags in the container, and you&rsquo;ve added the tag name as additional metadata to them.</li>
</ul>
<p>You can now either Preview the container (recommended), or you can just publish it. If you take the Preview route, you should see the <code>BigQuery success!</code> message in the <strong>Console tab</strong> of Preview mode when any event is selected:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/console-tab.jpg" title="Console tab">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/console-tab.jpg#ZgotmplZ" alt="Console tab" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1814 498'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you see anything else, the error messages should tell you what the problem is (see <a href="#the-onfailure-callback">this chapter</a> for more details).</p>
<p>You can check <a href="https://console.cloud.google.com/bigquery">the data in BigQuery</a> as well. The easiest way to do this is to browse to the table itself, and then click Preview.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/preview-bigquery.jpg" title="Preview BigQuery">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/preview-bigquery.jpg#ZgotmplZ" alt="Preview BigQuery" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1322 762'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you see rows here, it means it&rsquo;s working!</p>
<p>You&rsquo;ve now built a simple monitoring system. While this is mostly a proof-of-concept, you can actually utilize this setup to see if tags are consistently signaling failure. Similarly, it should alert you if there are events where no tags fire (even though they should), or if there are unreasonably long execution times with your tags.</p>
<p>And that&rsquo;s it for this simple walkthrough! Now it&rsquo;s time to <strong>dive into</strong> the API design itself.</p>

                
                  <h2 id="the-bigquery-api">The BigQuery API</h2>
<p>To use the API, you need either a <strong>Client</strong> or a <strong>tag</strong> template. If you&rsquo;re unfamiliar with templates, check out these resources:</p>
<ul>
<li><a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">Custom Templates Guide For Google Tag Manager</a></li>
<li><a href="https://www.youtube.com/watch?v=_c4JEfSkP6U&amp;feature=emb_imp_woyt">Build A Universal Analytics Client (YouTube)</a></li>
</ul>
<blockquote>
<p>Note, only a <strong>write</strong> API has been released thus far. We&rsquo;re anxiously waiting for a <strong>read</strong> API, so that data could be pulled in from BigQuery, too.</p>
</blockquote>
<p>The API itself is quite simple, but right now it has a caveat: <strong>the table you want to write to must exist already</strong>. Unlike some other BigQuery API clients, the custom template API does not automatically create a table for you if one doesn&rsquo;t already exist.</p>
<p>This is good for control but bad for flexibility. It&rsquo;s possible this will change in the future. But until it does, you need to have a BQ table ready with a <strong>schema</strong> in place as well.</p>
<p>The API is called like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Load the BQ API
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> BigQuery = require(<span style="color:#a50">&#39;BigQuery&#39;</span>);

BigQuery.insert(connectionInfo, rows, options, onSuccess, onFailure);
</code></pre></div>
<h3 id="the-connectioninfo-object">The connectionInfo object</h3>
<p>The first parameter is a <strong>connectionInfo</strong> object, and it looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  projectId: <span style="color:#a50">&#39;gtm-abc123-z1def&#39;</span>,
  datasetId: <span style="color:#a50">&#39;gtm_monitoring&#39;</span>,
  tableId: <span style="color:#a50">&#39;event_data&#39;</span>
}
</code></pre></div>
<p>Here are the keys you need to use in the object:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample value</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>projectId</code></td>
<td><code>gtm-abc123-z1def</code></td>
<td>No*</td>
<td>Set to the Google Cloud project ID where the BigQuery dataset and table are. You can also omit this from the API call (see below for more information).</td>
</tr>
<tr>
<td><code>datasetId</code></td>
<td><code>gtm_monitoring</code></td>
<td>Yes</td>
<td>Set to the dataset ID of the BigQuery dataset which hosts the table.</td>
</tr>
<tr>
<td><code>tableId</code></td>
<td><code>event_data</code></td>
<td>Yes</td>
<td>Set to the table ID of the BigQuery table.</td>
</tr>
</tbody>
</table>
<p><code>projectId</code> is optional, but only in a specific circumstance. If the API call doesn&rsquo;t have <code>projectId</code> included, then you <strong>must</strong> set the <strong>Permissions</strong> for BigQuery so that Project ID is <em>either</em> <code>*</code> or <code>GOOGLE_CLOUD_PROJECT</code>.</p>
<h3 id="permissions">Permissions</h3>
<p>When you set the Project ID permission to <code>GOOGLE_CLOUD_PROJECT</code>, the project ID is derived from an environment variable named <strong>GOOGLE_CLOUD_PROJECT</strong>. The good news is that if you&rsquo;re running this container on Google Cloud (as is the default), then the environment variable is automatically populated with the current project ID.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/bigquery-permissions-project-id.jpg" title="BigQuery permissions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/bigquery-permissions-project-id.jpg#ZgotmplZ" alt="BigQuery permissions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1776 394'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you want to send the data to a table that&rsquo;s outside the current project, then it&rsquo;s easiest to just add the project ID to the permission list or to just use the wildcard (though the former is recommended over the latter).</p>
<p>You can wildcard dataset ID and table ID, too, but you should only do this if you&rsquo;re designing the template for sharing via the Community Template Gallery.</p>
<h3 id="the-rows-array">The <code>rows</code> array</h3>
<p>The second parameter in the <code>BigQuery.insert</code> call is the <code>rows</code> array.</p>
<p>And this is where it gets tricky.</p>
<p>The <code>rows</code> array <strong>must</strong> comply with the schema of the table if you want the data to be written correctly. You should try to use the types and formats required by the BigQuery table schema when building the objects in the <code>rows</code> array.</p>
<p>For example, consider a schema like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/bq-schema.jpg" title="BigQuery Schema">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/bq-schema.jpg#ZgotmplZ" alt="BigQuery Schema" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1176 824'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>To create a valid row for this schema, the object would look like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">[{
  event_name: <span style="color:#a50">&#39;page_view&#39;</span>, <span style="color:#aaa;font-style:italic">// String, required
</span><span style="color:#aaa;font-style:italic"></span>  event_timestamp: <span style="color:#a50">&#39;1614628341914&#39;</span>, <span style="color:#aaa;font-style:italic">// Integer, required
</span><span style="color:#aaa;font-style:italic"></span>  client_name: <span style="color:#a50">&#39;GA4&#39;</span>, <span style="color:#aaa;font-style:italic">//String, required
</span><span style="color:#aaa;font-style:italic"></span>  tag: [{ <span style="color:#aaa;font-style:italic">// Record, repeated
</span><span style="color:#aaa;font-style:italic"></span>    id: <span style="color:#a50">&#39;1&#39;</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    name: <span style="color:#00a">undefined</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    status: <span style="color:#a50">&#39;success&#39;</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    execution_time: <span style="color:#a50">&#39;3&#39;</span> <span style="color:#aaa;font-style:italic">// Integer, nullable
</span><span style="color:#aaa;font-style:italic"></span>  }, {
    id: <span style="color:#a50">&#39;3&#39;</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    name: <span style="color:#a50">&#39;GA4&#39;</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    status: <span style="color:#a50">&#39;success&#39;</span>, <span style="color:#aaa;font-style:italic">// String, nullable
</span><span style="color:#aaa;font-style:italic"></span>    execution_time: <span style="color:#a50">&#39;10&#39;</span> <span style="color:#aaa;font-style:italic">// Integer, nullable
</span><span style="color:#aaa;font-style:italic"></span>  }]
}]
</code></pre></div>
<p>As you can see, each property set in a row object corresponds with a key in the BigQuery schema, and the values need to match the expected types.</p>
<blockquote>
<p>Note: &ldquo;Integer&rdquo; refers to the data format, not the JavaScript type. So it can be sent as a Number type or as a String type as in the example above.</p>
</blockquote>
<p>The most difficult things to get right, typically, are <strong>repeated records</strong>. Perhaps it&rsquo;s easier to think of this in JavaScript terms. A <strong>repeated record</strong> is essentially an <strong>array of objects</strong>. Or a <strong>list of dictionaries</strong> if Python vernacular suits you better.</p>
<p>In any case, the object dispatched to the table <strong>must</strong> conform to the schema, otherwise you risk running into errors or getting patchy data.</p>
<h3 id="the-options-object">The <code>options</code> object</h3>
<p>You can control what the API does when encountering invalid calls.</p>
<p>The <code>options</code> object is the third parameter to the <code>BigQuery.insert</code> method, and it has the following keys:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Possible values</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ignoreUnknownValues</code></td>
<td><code>true</code> / <code>false</code></td>
<td><code>false</code></td>
<td>If set to <code>true</code>, then rows that have values that do <strong>not</strong> conform to the schema are accepted, but the unknown values are ignored in the write.</td>
</tr>
<tr>
<td><code>skipInvalidRows</code></td>
<td><code>true</code> / <code>false</code></td>
<td><code>false</code></td>
<td>If set to <code>true</code> then all <strong>valid</strong> rows of the request are inserted into the table, even if there are also invalid rows in the request.</td>
</tr>
</tbody>
</table>
<p>What you choose for these options depends on the type of data you want to collect. If you set <code>ignoreUnknownValues</code> to <code>true</code>, you might end up with a patchy table because expected values might end up missing from the table.</p>
<p>If you set <code>skipInvalidRows</code> to <code>true</code>, it might be difficult to debug problems, as requests are allowed to complete even if they had invalid rows.</p>
<h3 id="the-onsuccess-callback">The <code>onSuccess</code> callback</h3>
<p>You can <strong>optionally</strong> pass a method as an <code>onSuccess</code> callback. This method is invoked without any arguments, and you can use it to run some code after the rows were successfully inserted.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">...
<span style="color:#00a">const</span> onBigQuerySuccess = () =&gt; {
  log(<span style="color:#a50">&#39;BigQuery rows inserted successfully!&#39;</span>);
  data.gtmOnSuccess();
};

BigQuery.insert(connectionInfo, rows, {}, onBigQuerySuccess, data.gtmOnFailure);
</code></pre></div>
<h3 id="the-onfailure-callback">The <code>onFailure</code> callback</h3>
<p>You can <strong>optionally</strong> pass a method as an <code>onFailure</code> callback. This method is invoked when an error occurs, and an array of all the errors that happened is passed automatically to this method.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">...
<span style="color:#00a">const</span> onBQFailure = (errors) =&gt; {
  log(<span style="color:#a50">&#39;BigQuery failure!&#39;</span>);
  log(errors);
  data.gtmOnFailure();
};
</code></pre></div>
<blockquote>
<p>Note that you don&rsquo;t generally have to log these explicitly, as the BigQuery errors will show up in the Console tab of Preview mode and in your <a href="https://www.simoahava.com/analytics/tips-for-logging-server-side-tagging/"><code>stdout</code> logs</a> regardless.</p>
</blockquote>
<p>If the error happened because insertion didn&rsquo;t happen at all, for example when trying to insert a row into a non-existent table, the error is simple:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">[{
  reason: <span style="color:#a50">&#39;invalid&#39;</span>
}]
</code></pre></div>
<p>If, however, there is an error in the insertion itself, the array of errors is more complex. For every error encountered, an object is added to the array. This object has two keys:</p>
<p><code>errors</code> is an array with a single object which has the <code>reason</code> key. This key is set to the <strong>reason why the error happened</strong> (e.g. <code>&quot;invalid&quot;</code>).</p>
<p><code>row</code> is an object which describes the row itself where the error happened.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/03/three-errors.jpg" title="Three errors">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/three-errors.jpg#ZgotmplZ" alt="Three errors" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2572 292'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the image above, <strong>three</strong> errors were encountered. The first error was due to an invalid value being sent with the call. Due to <code>skipInvalidRows</code> being set to <code>false</code> (the default value), this results in the execution of the insert stopping, and all the remaining rows throw an error with the reason <code>stopped</code>.</p>
<p>Note that it&rsquo;s completely optional to use the <code>onFailure</code> callback, but it might be a very good idea if you want to get to the bottom of missing or faulty data in your table!</p>

                
                  <h2 id="authentication">Authentication</h2>
<p>As long as your Server container is running in the same GCP project as the BigQuery table, <strong>you&rsquo;re all set</strong>. You don&rsquo;t need to do anything special in terms of authentication, as the default service account of App Engine has full access to any BigQuery tables added to the project.</p>
<p>If you want to write to a BigQuery table in <em>another</em> GCP project, you need to do the following:</p>
<ol>
<li>Locate the <em>App Engine default service account</em> (under <a href="https://console.cloud.google.com/apis/credentials"><strong>APIs &amp; Services / Credentials</strong></a>) of the Server container project.</li>
<li>Copy the email address of this service account to the clipboard.</li>
<li>In the <a href="https://console.cloud.google.com/iam-admin/iam"><strong>IAM</strong></a> of the GCP project with the BigQuery table, add a new member.</li>
<li>Set the email address of the member to the email address in the clipboard.</li>
<li>Set the role of this new member to <strong>BigQuery Data Editor</strong>.</li>
</ol>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2021/03/service-account.jpg" title="Service accounts in the Server container project.">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/service-account.jpg#ZgotmplZ" alt="Service accounts in the Server container project." src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1944 350'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Service accounts in the Server container project.</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2021/03/bigquery-data-editor.jpg" title="New member creation in the project with the BigQuery table.">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/03/bigquery-data-editor.jpg#ZgotmplZ" alt="New member creation in the project with the BigQuery table." src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1272 984'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">New member creation in the project with the BigQuery table.</span>
  
</div>


<p>In other words, you are allowing the Server container GCP project to edit the BigQuery datasets in the target project.</p>
<blockquote>
<p>You can, of course, create a dedicated service account just for this purpose to avoid giving too broad access to the Server container project. But this is an easy way to get the integration to work.</p>
</blockquote>
<p>If you want to authenticate a <em>non-GCP</em> source to write to BigQuery, it gets quite a bit trickier. I recommend you follow the manual setup guide to do this.</p>

                
                  <h2 id="summary">Summary</h2>
<p>You can ignore <strong>everything</strong> I&rsquo;ve written in this article and just rejoice about one single thing:</p>
<p><strong>Server containers now have access to Google BigQuery!!!</strong></p>
<p>I can&rsquo;t overstate how important this is. Being able to communicate with other cloud components without having to go through the motions of complicated service account bindings and authentication schemes is very nice. But being able to utilize one of the most powerful and disruptive data warehouses in existence is the real deal.</p>
<p>With the BigQuery API, the sky is the limit for innovation.</p>
<p>How about writing the incoming GA4 requests directly to Google BigQuery, instead of taking the roundtrip through Google Analytics?</p>
<p>How about logging errors and other monitoring data into a BigQuery table for more detailed and cost-efficient analysis later?</p>
<p>How about writing all transactions collected by Facebook into a BigQuery table for deduplication or debugging later?</p>
<p>There&rsquo;s just <em>so much</em> you can do with Google BigQuery. I can&rsquo;t wait to see what folks in the template design community come up with.</p>
<p>I hope that this is just foreshadowing the introduction of other Google Cloud APIs as well. Let&rsquo;s wish for a <strong>Cloud Storage</strong> API (for quick file read and write operations), and a <strong>Pub / Sub</strong> API (for intializing other cloud processes), for example.</p>
<p>I also hope that BigQuery gets a <code>read</code> API as well, soon. Having <code>insert</code> capabilities is awesome, but if we could use BigQuery to actually enrich our Server container&rsquo;s data streams, it would make the setup even richer and more flexible.</p>
<p>What do you think about the BigQuery API? What kinds of things could you envision being done with it?</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/server-side-tagging/">server-side tagging</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom-templates/">custom templates</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/bigquery/">bigquery</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/data-layer-picker-variable-template/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Write%20To%20Google%20BigQuery%20From%20A%20GTM%20Server%20Container%20https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/data-layer-picker-variable-template/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Write%20To%20Google%20BigQuery%20From%20A%20GTM%20Server%20Container%20https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Write%20To%20Google%20BigQuery%20From%20A%20GTM%20Server%20Container%20https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/write-to-google-bigquery-from-gtm-server-container/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

