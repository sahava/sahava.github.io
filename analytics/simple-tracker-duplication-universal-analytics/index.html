

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Simple Tracker Duplication For Universal Analytics | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2016\/05\/duplicator.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/simple-tracker-duplication-universal-analytics\/",
  "datePublished": "2016-05-25T10:49:46\u002b00:00",
  "dateModified": "2016-05-25T10:49:46\u002b00:00",
  "description": "How to duplicate all requests sent to Google Analytics using JavaScript and a Universal Analytics plugin.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Simple Tracker Duplication For Universal Analytics | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/simple-tracker-duplication-universal-analytics/">
    
    <meta name="description" content="How to duplicate all requests sent to Google Analytics using JavaScript and a Universal Analytics plugin.">
    <meta property="og:description" content="How to duplicate all requests sent to Google Analytics using JavaScript and a Universal Analytics plugin.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Simple Tracker Duplication For Universal Analytics">
    <meta property="og:url" content="https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Simple Tracker Duplication For Universal Analytics">
    <meta name="twitter:description" content="How to duplicate all requests sent to Google Analytics using JavaScript and a Universal Analytics plugin.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2016/05/duplicator.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2016/05/duplicator.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://mastodon.social/@ahava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Simple Tracker Duplication For Universal Analytics
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2016-05-25T10:49:46Z">
        
  May 25, 2016

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>First of all, I&rsquo;m sorry about the title. I should really stop throwing the word &ldquo;simple&rdquo; around, since people always tell me that the stuff I claim to be easy and straightforward is rarely so. But since this is my blog, I reserve the right to use whatever stupid and misleading terminology I want. I maintain that what follows IS quite simple, especially when considering the amount of complexity it reduces in your <a href="https://analytics.google.com/">Universal Analytics</a> setup.</p>
<p>Next, I want to direct your gaze to my latest Keynote / PowerPoint creation:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/05/duplicator.jpg" title="Hit duplicator">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/05/duplicator.jpg#ZgotmplZ" alt="Hit duplicator" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1270 872'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This piece of art is called &ldquo;&hellip;while waiting for the cosmos&rdquo;. Note the enigmatic ellipsis in the beginning, the lack of capitalization, and the fact that the title has nothing to do with the image. Yes, friend. This is post-post-modernism at its best!</p>
<p>So, I guess my amazing art kind of gave away what I want to show to you in this article. In short, it&rsquo;s a simple little plugin I&rsquo;ve been using in projects I work on, which duplicates all hits sent to a Google Analytics property. These duplicated hits are sent to <em>another</em> Google Analytics property, whose property ID you specify when initiating the plugin.</p>
<p>This tutorial uses a <a href="https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">Universal Analytics plugin</a> (d&rsquo;oh), which, in turn, utilizies the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">Tasks API</a>.</p>
<p>Before I proceed, I want to direct you to <a href="https://www.thyngster.com/universal-analytics-plugin-dual-tracking/">David Vallejo&rsquo;s blog</a>, where he and a bunch of other people are working together on an <a href="https://github.com/thyngster/universal-analytics-dual-tracking-plugin">open-source project</a> which does similar stuff, but on a WAY more configurable level. The plugin I&rsquo;m about to walk you through will simply make an <em>exact</em> duplicate of the hit you sent, without letting you modify the payload one bit.</p>
<p>Why, you may ask? Well, a surprisingly large number of projects I work with have a need for a &ldquo;rollup&rdquo; property, which collects data from all sites in the organization. The data sent to the rollup often mirrors whatever is collected in the local sites. It&rsquo;s quite a chore to duplicate <code>send</code> commands across all trackers, so if the project is fine with simple duplication, I use this plugin.</p>
<p><strong>CAVEAT</strong>: This will <strong>best</strong> work with <strong>named trackers</strong>. Thus <a href="https://tagmanager.google.com/">Google Tag Manager</a> setting this up in Google Tag Manager is difficult, as you&rsquo;ll have to mess with the <a href="https://www.simoahava.com/gtm-tips/be-careful-with-the-tracker-name-setting/">Tracker name</a> field. If you&rsquo;re confident with your GTM implementation skills, feel free to do whatever you wish, of course. Nevertheless, in its current state, the plugin caters best to an on-page Universal Analytics implementation.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="modifying-the-tracking-code">Modifying the tracking code</h2>
<p>For this to work, you will need to make a small change to your Universal Analytics tracking code. Let&rsquo;s say the code looks like this now:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  (<span style="color:#00a">function</span>(i,s,o,g,r,a,m){i[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]=r;i[r]=i[r]||<span style="color:#00a">function</span>(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=<span style="color:#099">1</span>*<span style="color:#00a">new</span> <span style="color:#0aa">Date</span>();a=s.createElement(o),
  m=s.getElementsByTagName(o)[<span style="color:#099">0</span>];a.async=<span style="color:#099">1</span>;a.src=g;m.parentNode.insertBefore(a,m)
  })(<span style="color:#0aa">window</span>,<span style="color:#0aa">document</span>,<span style="color:#a50">&#39;script&#39;</span>,<span style="color:#a50">&#39;https://www.google-analytics.com/analytics.js&#39;</span>,<span style="color:#a50">&#39;ga&#39;</span>);

  ga(<span style="color:#a50">&#39;create&#39;</span>, <span style="color:#a50">&#39;UA-12345-1&#39;</span>, <span style="color:#a50">&#39;auto&#39;</span>);
  ga(<span style="color:#a50">&#39;send&#39;</span>, <span style="color:#a50">&#39;pageview&#39;</span>);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>You&rsquo;ll need to add the following modification:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  (<span style="color:#00a">function</span>(i,s,o,g,r,a,m){i[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]=r;i[r]=i[r]||<span style="color:#00a">function</span>(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=<span style="color:#099">1</span>*<span style="color:#00a">new</span> <span style="color:#0aa">Date</span>();a=s.createElement(o),
  m=s.getElementsByTagName(o)[<span style="color:#099">0</span>];a.async=<span style="color:#099">1</span>;a.src=g;m.parentNode.insertBefore(a,m)
  })(<span style="color:#0aa">window</span>,<span style="color:#0aa">document</span>,<span style="color:#a50">&#39;script&#39;</span>,<span style="color:#a50">&#39;https://www.google-analytics.com/analytics.js&#39;</span>,<span style="color:#a50">&#39;ga&#39;</span>);

  ga(<span style="color:#a50">&#39;create&#39;</span>, <span style="color:#a50">&#39;UA-12345-1&#39;</span>, <span style="color:#a50">&#39;auto&#39;</span>);

  <span style="color:#aaa;font-style:italic">// ADD THIS LINE:
</span><span style="color:#aaa;font-style:italic"></span>  ga(<span style="color:#a50">&#39;require&#39;</span>, <span style="color:#a50">&#39;simolatorDuplicator&#39;</span>, {<span style="color:#a50">&#39;newId&#39;</span> : <span style="color:#a50">&#39;UA-12345-2&#39;</span>});

  ga(<span style="color:#a50">&#39;send&#39;</span>, <span style="color:#a50">&#39;pageview&#39;</span>);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>There&rsquo;s a single addition: <code>ga('require', 'simolatorDuplicator', {'newId' : 'UA-12345-2'});</code>. This line invokes a plugin called <code>simolatorDuplicator</code> (I know! The awesomest plugin name in the UNIVERSE!), after which you pass an <em>object</em> with a single key-value pair: <code>{newId : newTrackerId}</code>. In place of <code>newTrackerId</code>, you place a String with the Google Analytics property ID to which you want to duplicate all the hits.</p>

                
                  <h2 id="the-plugin-itself">The plugin itself</h2>
<p>There are two quick and easy (sorry about those words again) ways to load the plugin. Either host it in its own JavaScript file which you then load with a <code>&lt;script&gt;&lt;/script&gt;</code> loader, or just run the code in the page template itself.</p>
<p>What&rsquo;s important is that the <strong>plugin code needs to be loaded AFTER the tracking code</strong>.
The code looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#00a">function</span>() {
  <span style="color:#00a">var</span> ga = <span style="color:#0aa">window</span>[<span style="color:#0aa">window</span>[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]];
  <span style="color:#00a">var</span> GADuplicate = <span style="color:#00a">function</span>(tracker, propertyId) {
    <span style="color:#00a">var</span> o = tracker.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);
    <span style="color:#00a">var</span> temp;
    tracker.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, <span style="color:#00a">function</span>(model) {
      o(model);
      temp = model.get(<span style="color:#a50">&#39;hitPayload&#39;</span>).replace(<span style="color:#00a">new</span> <span style="color:#0aa">RegExp</span>(model.get(<span style="color:#a50">&#39;trackingId&#39;</span>), <span style="color:#a50">&#39;g&#39;</span>), propertyId.newId);
      <span style="color:#00a">if</span> (temp) {
        model.set(<span style="color:#a50">&#39;hitPayload&#39;</span>, temp, <span style="color:#00a">true</span>);
        o(model);
      }
    });
  };
  ga(<span style="color:#a50">&#39;provide&#39;</span>, <span style="color:#a50">&#39;simolatorDuplicator&#39;</span>, GADuplicate);
})();
</code></pre></div>
<p>So either write this in a file named <strong>something.js</strong> (feel free to replace <strong>something</strong> with something else), or just add the code in its own <code>&lt;script&gt;</code> block after the tracking snippet.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#aaa;font-style:italic">&lt;!-- METHOD 1 --&gt;</span>
&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  <span style="color:#aaa;font-style:italic">// GA Tracking code here
</span><span style="color:#aaa;font-style:italic"></span>&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">src</span>=<span style="color:#a50">&#34;something.js&#34;</span> <span style="color:#1e90ff">async</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;

<span style="color:#aaa;font-style:italic">&lt;!-- METHOD 2 --&gt;</span>
&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  <span style="color:#aaa;font-style:italic">// GA Tracking code here
</span><span style="color:#aaa;font-style:italic"></span>&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
(<span style="color:#00a">function</span>() {
  <span style="color:#00a">var</span> ga = <span style="color:#0aa">window</span>[<span style="color:#0aa">window</span>[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]] || <span style="color:#00a">function</span>() {};
  <span style="color:#00a">var</span> GADuplicate = <span style="color:#00a">function</span>(tracker, config) {
    <span style="color:#00a">var</span> o = tracker.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);
    <span style="color:#00a">var</span> temp;
    tracker.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, <span style="color:#00a">function</span>(model) {
      o(model);
      temp = model.get(<span style="color:#a50">&#39;hitPayload&#39;</span>).replace(<span style="color:#00a">new</span> <span style="color:#0aa">RegExp</span>(model.get(<span style="color:#a50">&#39;trackingId&#39;</span>), <span style="color:#a50">&#39;g&#39;</span>), config.newId);
      <span style="color:#00a">if</span> (temp) {
        model.set(<span style="color:#a50">&#39;hitPayload&#39;</span>, temp, <span style="color:#00a">true</span>);
        o(model);
      }
    });
  };
  ga(<span style="color:#a50">&#39;provide&#39;</span>, <span style="color:#a50">&#39;simolatorDuplicator&#39;</span>, GADuplicate);
})();
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>Both are equally fine, though to keep things nice and tidy I do recommend the first method.</p>
<p>Let&rsquo;s take a quick stroll through the code.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#00a">function</span>() {
  <span style="color:#00a">var</span> ga = <span style="color:#0aa">window</span>[<span style="color:#0aa">window</span>[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]] || <span style="color:#00a">function</span>() {};
  ...
  ga(<span style="color:#a50">&#39;provide&#39;</span>, <span style="color:#a50">&#39;simolatorDuplicator&#39;</span>, GADuplicate);
})();
</code></pre></div>
<p>These lines wrap the plugin code in an <a href="https://en.wikipedia.org/wiki/Immediately-invoked_function_expression">immediately invoked function expression</a>, which I use to protect the global namespace. No, you didn&rsquo;t need to understand any of that.</p>
<p>The next line establishes the <code>ga()</code> interface locally, by scoping it to the global Google Analytics Object. This is so that the plugin still works even if you&rsquo;ve renamed the global GA interface from <code>ga</code> to something else.</p>
<p>After the plugin code (represented by the &ldquo;&hellip;&quot;) we make the plugin available to the <code>ga</code> interface. This is a very important line, as it is the counterpart to the <code>ga('require', 'simolatorDuplicator'...);</code> command used in the tracking code. If you didn&rsquo;t have this line, or if you had a typo in the plugin name, your GA code would not work at all! So remember to test, test, TEST.</p>
<p>Next, the plugin constructor itself:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">  <span style="color:#00a">var</span> GADuplicate = <span style="color:#00a">function</span>(tracker, config) {
    <span style="color:#00a">var</span> o = tracker.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);
    <span style="color:#00a">var</span> temp;
    tracker.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, <span style="color:#00a">function</span>(model) {
      o(model);
      temp = model.get(<span style="color:#a50">&#39;hitPayload&#39;</span>).replace(<span style="color:#00a">new</span> <span style="color:#0aa">RegExp</span>(model.get(<span style="color:#a50">&#39;trackingId&#39;</span>), <span style="color:#a50">&#39;g&#39;</span>), config.newId);
      <span style="color:#00a">if</span> (temp) {
        model.set(<span style="color:#a50">&#39;hitPayload&#39;</span>, temp, <span style="color:#00a">true</span>);
        o(model);
      }
    });
  };
</code></pre></div>
<p>Lots of things going on here.</p>
<p>First, the function expression establishes a new function called <code>GADuplicate</code>, which takes two parameters: <code>tracker</code> and <code>config</code>. The <code>tracker</code> parameter is passed automatically by the plugin logic, and it contains a reference to the Universal Analytics tracker object which invoked the plugin. The <code>config</code> object is passed as a parameter in the modified tracking code. It&rsquo;s the <code>{'newId' : 'UA-12345-2'}</code> which we covered earlier.</p>
<p>Next, we make a copy of the original <code>sendHitTask</code>. This little method is actually the entire dispatch logic of analytics.js, so we&rsquo;ll need it to send our data to Google Analytics.</p>
<p>We need it especially because on the very next line after the variable declarations we <em>overwrite</em> the <code>sendHitTask</code> of the tracker with a new one!</p>
<p>First, the <em>original</em> <code>sendHitTask</code>, temporarily copied to the method <code>o()</code>, is used to send the regular hit to Universal Analytics. This is really important, as without this you&rsquo;d just be sending your duplicate hit!</p>
<p>Then, we take the <code>hitPayload</code> you just sent to GA, and we replace all instances of the current property ID with the new property ID that you configured in the tracking code! This is the main logic in this plugin. We take the payload, we send it first regularly, and then we modify it and send the modified version. By using <code>model.set('hitPayload', temp, true);</code> we&rsquo;re rewriting the payload, which is then submitted with a new invocation of the <code>o()</code> method.</p>
<p>I maintain that it&rsquo;s really quite simple when you think about it, but naturally it does require some understanding of how the APIs work. So feel free to plunge into <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">the documentation</a>.</p>
<p>And that&rsquo;s it! That&rsquo;s the code, the setup, and the implementation. Remember, you will need to modify the tracking code accordingly on all pages of your site where you want to use this plugin. You can use it with named trackers, too; just modify the plugin call to:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">ga(<span style="color:#a50">&#39;myNamedTracker:require&#39;</span>, <span style="color:#a50">&#39;simolatorDuplicator&#39;</span>, {<span style="color:#a50">&#39;newId&#39;</span> : <span style="color:#a50">&#39;UA-12345-2&#39;</span>});
</code></pre></div>
<p>And <em>yes</em>, you can rename the plugin to something else than <code>simolatorDuplicator</code>, though I will love you slightly less if you do so.</p>

                
                  <h2 id="summary">Summary</h2>
<p>Please remember, this is an <em>exact</em> hit duplication method. If you want to modify the payload, you&rsquo;ll need to add some additional logic to the code, and I really recommend you check out the link to David Vallejo&rsquo;s blog in the introductory chapter of this article.</p>
<p>Let me know if you&rsquo;re having problems with this, or if you have suggestions! Please do test this thoroughly before implementing it. You are messing with code that can potentially cripple your Google Analytics implementation.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/plugins/">plugins</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tasks/">tasks</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/universal-analytics/">universal analytics</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/measure-google-tag-manager-event-duration/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/using-document-write-safely-gtm-tags/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Simple%20Tracker%20Duplication%20For%20Universal%20Analytics%20https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/measure-google-tag-manager-event-duration/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/using-document-write-safely-gtm-tags/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Simple%20Tracker%20Duplication%20For%20Universal%20Analytics%20https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Simple%20Tracker%20Duplication%20For%20Universal%20Analytics%20https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/simple-tracker-duplication-universal-analytics/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

