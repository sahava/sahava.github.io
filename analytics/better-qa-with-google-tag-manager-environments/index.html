

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Better QA With Google Tag Manager Environments | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2015/11/publish-to-qa.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/",
  "datePublished": "2015-11-18T05:14:20+00:00",
  "dateModified": "2015-11-18T05:14:20+00:00",
  "description": "Introducing Google Tag Manager's environments. This guide will walk you through the feature, and how you can use it to enhance quality assurance in your data organization.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.31 with theme Tranquilpeak 0.4.3-BETA">
    <title>Better QA With Google Tag Manager Environments | Simo Ahava's blog</title>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/better-qa-with-google-tag-manager-environments/">
    
    <meta name="description" content="Introducing Google Tag Manager&#39;s environments. This guide will walk you through the feature, and how you can use it to enhance quality assurance in your data organization.">
    <meta property="og:description" content="Introducing Google Tag Manager&#39;s environments. This guide will walk you through the feature, and how you can use it to enhance quality assurance in your data organization.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Better QA With Google Tag Manager Environments">
    <meta property="og:url" content="/analytics/better-qa-with-google-tag-manager-environments/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Better QA With Google Tag Manager Environments">
    <meta name="twitter:description" content="Introducing Google Tag Manager&#39;s environments. This guide will walk you through the feature, and how you can use it to enhance quality assurance in your data organization.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/11/publish-to-qa.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/11/publish-to-qa.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Better QA With Google Tag Manager Environments
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-11-18T05:14:20Z">
        
  November 18, 2015

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p><a href="https://tagmanager.google.com/">Google Tag Manager</a>, our favorite free tag management solution, has always struggled with its enterprise-worthiness. There are many features still lacking, most of which have to do with working in multi-user environments. Now, grab the last word of that sentence (see what I did there), and hug it tightly, for GTM just introduced a new, enterprise-friendly feature: <strong>Environments</strong>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/publish-to-qa.png" title="Publish to QA">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/publish-to-qa.png#ZgotmplZ" alt="Publish to QA">
  
    </a>
  
  
</div>



<p>These <em>Environments</em> are actually browser cookies, which you use to link a Google Tag Manager container <strong>state</strong> with the browser of the user who needs to or wants to view that particular state. In other words, if you have a QA (quality assurance) process, as you should have, or if you do most of your testing on a staging server, as you should do, you can create an <em>Environment</em> in GTM, after which you can publish container versions (even the draft) into that particular Environment alone.</p>

<p>This is, actually, pretty significant compared to how GTM used to work. Before, you had to <strong>Share a Preview</strong> version, but that was always a <em>container version</em>. When the version changed, you had to retrieve a new authentication token. Now, GTM will distribute <em>Environment</em> tokens instead, meaning as long as the Environment is linked to Google Tag Manager and the authentication is not revoked, that particular token will have access to whatever versions are published into said Environment. Cool!</p>

<p>This makes GTM more manageable across multiple contexts. There are two ways to do this: by sharing a link, as before, or by adding a piece of code into the page templates of each Environment, in which case the link between GTM and the Environment works without you having to distribute authentication tokens via cumbersome links.</p>

<p>Official support documents can be viewed <a href="https://support.google.com/tagmanager/answer/6311518">here</a>. Let&rsquo;s get cracking!</p>

<h2 id="why-this-change">Why this change?</h2>

<p>This development is necessary not only because it makes GTM function better across environments and teams, but also because the old Share Preview feature was not optimal. In this chapter, I&rsquo;ll briefly walk you through how container version sharing <em>used to work</em>, so that you&rsquo;ll understand why this development is necessary.</p>

<p>Many thanks to <a href="https://twitter.com/briankuhn">Brian Kuhn</a>, again, for his invaluable insight into the inner workings of Google Tag Manager.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/share-preview.png" title="Share Preview link">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/share-preview.png#ZgotmplZ" alt="Share Preview link">
  
    </a>
  
  
</div>



<p>Thus far, when you&rsquo;ve clicked the <strong>Share Preview</strong> link either in the yellow preview bar (seen above), or via the <strong>Versions</strong> page, you get a URL which you can then distribute to whomever should be able to preview (or debug) this particular container version.</p>

<p>This URL, when executed in the browser, actually writes a secret authentication token into the user&rsquo;s browser while on the <strong>googletagmanager.com</strong> domain. Now, when requesting the <strong>gtm.js</strong> library from <strong>googletagmanager.com</strong> on the website where the container is installed on, GTM will detect this authentication token in the cookies written on <strong>googletagmanager.com</strong>. Once it detects the authentication token, it will know to download the container version with which this particular token is associated. The following modern art masterpiece illustrates this relationship:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/cookie-share-preview.png" title="Share preview and cookies">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/cookie-share-preview.png#ZgotmplZ" alt="Share preview and cookies">
  
    </a>
  
  
</div>



<p>As you can see, the authentication token in the Share Preview link matches that of a specific cookie found on the <strong>googletagmanager.com</strong> domain.</p>

<p>In other words, since an authentication token links a specific version with the user&rsquo;s browser, it means that that user is <strong>permanently</strong> forced to digest that particular container version in their browser.</p>

<p>OK, well, I might be exaggerating a little. The cookie itself is a <strong>session</strong> cookie, meaning it will expire when you close the browser. However, the token is permanent. So if the user saves the link, they can revisit that version as much as you like, and there&rsquo;s very little you can do about it (short of deleting the version).</p>

<p>Also, to get rid of Preview mode without having to shut down the browser is a bother as well. Basically, you need to browse again to the page you get when copy-pasting the Share Preview link, and then click the &ldquo;Exit Preview&rdquo; link you see. It&rsquo;s easy to miss and easy to forget.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/exit-preview.png" title="exit-preview">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/exit-preview.png#ZgotmplZ" alt="exit-preview">
  
    </a>
  
  
</div>



<p>Not very streamlined.</p>

<p>Anyway, this is how it&rsquo;s worked thus far. The main problems with the current setup are:</p>

<ol>
<li><p><strong>Authentication tokens are permanent</strong>, so there&rsquo;s no way for you to revoke authentication. Also, cookies are session cookies, and it&rsquo;s difficult to delete them (unless you remember to click the &ldquo;Exit Preview&rdquo; link on the Share Preview page). The permanence of the authentication token is especially problematic with the Container Draft, as once a user has the authentication token for the draft, they&rsquo;ll be authenticated against ALL future drafts as well!</p></li>

<li><p>Since the token is linked to a specific <strong>version</strong>, it makes the QA process cumbersome. Optimally, you&rsquo;d want the cookie to be bound to the <em>environment</em>, not the <em>version</em>. Now QA needs a new authentication token whenever a new version of the container is ready for testing.</p></li>

<li><p>Sharing the container preview link is a hassle, looks suspicious, and is sensitive to errors. Also, it does not scream &ldquo;FLEXIBILITY&rdquo;, which is what I do a lot when working with GTM (my co-workers find it amusing).</p></li>
</ol>

<p>These are the problems the Google Tag Manager team wanted to tackle with <strong>Environments</strong>, and they sure did take a step in the right direction with the new feature.</p>

<h2 id="introducing-environments">Introducing Environments</h2>

<p>The main benefit of <strong>Environments</strong> is that you no longer share a <em>version</em> cookie, but rather an <em>Environment</em> cookie. In other words, if you want to link a user&rsquo;s browser with an Environment created in GTM, you don&rsquo;t have to send them a new token each time the version updates. Instead, you give them the authentication token to that particular Environment, after which you simply publish <strong>to that Environment</strong>, and the user on the other end with their QA browser will have access to whichever version is currently published to that Environment.</p>

<p>Another thing that has been made simpler is <strong>revoking access</strong>. You can now nullify an authentication token via GTM, helping you manage who has access to which Environments.</p>

<p>To get started, you will need to <strong>enable Environments</strong> in your Google Tag Manager container. If you don&rsquo;t do that, nothing will change in your Google Tag Manager user interface. So, head on over to the <strong>Admin</strong> section of your container, and click the new <strong>Environments</strong> link.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/environments.png" title="Environments in GTM Admin">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/environments.png#ZgotmplZ" alt="Environments in GTM Admin">
  
    </a>
  
  
</div>



<p>This is where you&rsquo;ll create your own, long-lived Environments. I stress <em>long-lived</em>, since you really only want to create an Environment which lasts more than the lifespan of a single version. I mean, you CAN use Environments to substitute the old &ldquo;Share Preview&rdquo; functionality, but they truly come to life when actually creating an Environment for a permanent process in your organization, and then using it methodically to test new versions of the container, without having to share cookies every single time.</p>

<h2 id="manage-environments">Manage Environments</h2>

<p>In the list of Environments, you&rsquo;ll see three <strong>default</strong> Environments. These can&rsquo;t be deleted or published to manually. They are:</p>

<ul>
<li><p>Live - The currently live Container Version is automatically added to this Environment</p></li>

<li><p>Latest - The newest created version (not the Draft)</p></li>

<li><p>Now Editing - The current container draft</p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/manage-environments.png" title="Default environments">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/manage-environments.png#ZgotmplZ" alt="Default environments">
  
    </a>
  
  
</div>



<p>Now, these are all states that exist in GTM with or without creating custom Environments. When you <strong>edit</strong> a container, the version is maintained in the &ldquo;Now Editing&rdquo; Environment. When you <strong>save</strong> a draft as a container version, the version is maintained in the &ldquo;Latest&rdquo; Environment. And when you publish a version, it is published into the &ldquo;Live&rdquo; Environment.</p>

<p>Click <strong>New</strong> to create your first, custom Environment. Give it a honest name and a good description. You can also choose to enable the Debug panel by default (if you don&rsquo;t check this, then Environments will be Preview only by default, meaning users won&rsquo;t see the debug panel).</p>

<p>If you want, you can set the hostname of the site where the Environment is. This way the Share Preview dialog will directly link the user to the website.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/create-new-environment.png" title="Create new environment">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/create-new-environment.png#ZgotmplZ" alt="Create new environment">
  
    </a>
  
  
</div>



<p>So, now you&rsquo;ve created your first custom Environment, and you&rsquo;ll see it in its own list in the Environments page.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/custom-environment.png" title="Custom Environment">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/custom-environment.png#ZgotmplZ" alt="Custom Environment">
  
    </a>
  
  
</div>



<p>As you can see, the <strong>Version ID</strong> field is empty, meaning you <em>haven&rsquo;t published a version into this Environment yet</em>.</p>

<p>Let&rsquo;s take a look at the <strong>Actions</strong> menu.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/actions-menu.png" title="Actions menu Environments">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/actions-menu.png#ZgotmplZ" alt="Actions menu Environments">
  
    </a>
  
  
</div>



<p>NOTE! The default containers have the same menu, except they do not have the <strong>Delete</strong> or <strong>Publish to&hellip;</strong> options available.</p>

<p>The options are:</p>

<ol>
<li><p><strong>Edit Settings</strong> - lets you edit the settings you first set when creating the Environment</p></li>

<li><p><strong>Publish To&hellip;</strong> - opens a publish dialog, where you can select <em>which container version</em> you want to publish <em>to the selected Environment</em>. After this, sharing a preview link to this Environment will allow users to preview the published container only.</p></li>

<li><p><strong>Share Preview</strong> - shares a preview link to the Environment, allowing users with access to this particular Environment preview and debug it with their browsers.</p></li>

<li><p><strong>Reset Link</strong> - removes authentication from the previously shared link AND from the new snippet (see below). This is very cool but also dangerous (see the next chapter).</p></li>

<li><p><strong>Get Snippet</strong> - gives you the updated <strong>GTM Container Snippet</strong> which <em>replaces</em> the original snippet. All pages with this Environment will automatically be in preview mode for the Environment.</p></li>

<li><p><strong>Delete</strong> - lets you delete the Environment.</p></li>
</ol>

<p>Let&rsquo;s move on to how the sharing works.</p>

<h2 id="sharing-environment-access">Sharing Environment access</h2>

<p>To share Environment access, you have two options.</p>

<p>You can distribute it as a link, as before, which binds the user&rsquo;s browser to the Environment via an authentication token. This way, the user&rsquo;s browser is linked to that particular Environment until the authentication token is revoked or the user manually deletes the token cookie using the Share Preview page.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/share-preview1.png" title="Share Preview to environment">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/share-preview1.png#ZgotmplZ" alt="Share Preview to environment">
  
    </a>
  
  
</div>



<p>An alternate, more robust way is to modify the container snippet on the website of the Environment (e.g. QA or staging site). The simple modification enables the authentication token to be accessed whenever that site is visited, meaning the <em>site</em> (read: the container snippet) is bound to the Environment instead of just the user&rsquo;s browser. This method dispenses with the need to share the authentication link, and it allows the user to browse other Environments on the same domain (e.g. the live site) without interference.</p>

<p>In other words, the Environment will only be active on pages with the new container snippet. When you browse to a page or site (even under the same domain) that does not have the authentication token in the snippet, you will be privy to the live, published container as usual.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/install-snippet.png" title="Install authentication snippet">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/install-snippet.png#ZgotmplZ" alt="Install authentication snippet">
  
    </a>
  
  
</div>



<p><strong>NOTE!</strong> When you reset the link to the Environment, it will also make the container snippet for that Environment change! In other words, only reset a link which is used in a container snippet if you are certain it&rsquo;s necessary. Otherwise you&rsquo;ll have hell to pay with your developers.</p>

<p>On that note, it&rsquo;s probably best to avoid using the same Environment both with Share Preview links and distributing the authentication token via the container snippet. Make a note of what the Environment is used for in the <strong>Description</strong> field or, even better, in the <strong>Name</strong> field. That way you&rsquo;ll know what you risk if you want to reset the link.</p>

<h2 id="things-you-can-do-via-the-gtm-ui">Things you can do via the GTM UI</h2>

<p>Once you enable Environments, you can selectively publish to these Environments, you can use a new Built-In Variable to query which Environment the user is currently in, and you can view which version is currently live in which Environment.</p>

<p>First, go to the <strong>Versions</strong> screen. As you can see, there&rsquo;s a new column &ldquo;Environments&rdquo;. That column contains information about to which Environments a particular version has been published.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/versions-list.png" title="Versions list">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/versions-list.png#ZgotmplZ" alt="Versions list">
  
    </a>
  
  
</div>



<p>Next, if you click the <strong>Actions</strong> menu next to a version, you&rsquo;ll find the <strong>Publish To&hellip;</strong> link again. Here, you can publish the selected version to an Environment of your choice! So no need to go through the Environments page every single time you want to publish a version to an Environment.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/versions-publish-to.png" title="Publish To versions">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/versions-publish-to.png#ZgotmplZ" alt="Publish To versions">
  
    </a>
  
  
</div>



<p>Next, go to the <strong>Container</strong> overview and click the red <strong>Publish</strong> button. As you can see, you can now choose to which Environment you actually want to publish the container draft to! <strong>Live</strong> is selected by default, of course.</p>

<p>NOTE! When you publish a container draft, it is first created into a version, and then automatically published to the <strong>Latest</strong> Environment in addition to whichever Environment you chose in the Publish dialog. Also, the version in the &ldquo;Now Editing&rdquo; Environment is updated to the NEW container draft. Phew!</p>

<h2 id="the-new-environment-name-variable">The new Environment Name variable</h2>

<p>Yes, there&rsquo;s a new Built-In Variable in town: Environment Name.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/environment-name-variable1.png" title="Environment Name Built-In">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/environment-name-variable1.png#ZgotmplZ" alt="Environment Name Built-In">
  
    </a>
  
  
</div>



<p>You might be surprised that this variable returns the <strong>name of the Environment</strong> the user&rsquo;s browser is currently viewing (shocker!). My favorite use case for this is to create a Lookup Table Variable, which distributes hits to different Google Analytics properties depending on which Environment the user is in:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/environment-lookup.png" title="Lookup Table with Environment Name">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/environment-lookup.png#ZgotmplZ" alt="Lookup Table with Environment Name">
  
    </a>
  
  
</div>



<p>You can also use this Variable in a Trigger, creating a powerful Exception to avoid firing expensive Tags in certain Environments.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/11/exception-staging.png" title="Exception - block from staging">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2015/11/exception-staging.png#ZgotmplZ" alt="Exception - block from staging">
  
    </a>
  
  
</div>



<p>All in all, a very useful addition to your arsenal of variables.</p>

<h2 id="summary">Summary</h2>

<p>Environments are really useful. They&rsquo;re a huge leap in the right direction, again, turning Google Tag Manager into a more manageable mess, especially in multi-user projects.</p>

<p>The first thing you&rsquo;ll want to do is establish some permanent Environments (e.g. QA and Staging), and update the web servers with the Environment container snippet. Then, make sure to write it down clearly that the link for these Environments should not be reset without good reason! If you reset the link, the container snippet needs to be rewritten.</p>

<p>After that, you can start using other Environments for your own purposes as well. Perhaps you want to create an Environment only for a particular side project, where you need to allow preview and debug access to an agency or consultant. Or perhaps you want to start your own &ldquo;branch&rdquo; of versions, debugging and previewing them in your own, enclosed Environment, distributing links to anyone who might be able to help you in your work.</p>

<p>The fact that giving and revoking authentication is now completely in your administrator&rsquo;s hands is also an excellent change. Now you don&rsquo;t have to hunt down the person you shared the container draft link with, as you can just reset the link to the &ldquo;Now Editing&rdquo; Environment, revoking preview access from anyone who used to have it.</p>

<p>One thing that&rsquo;s missing is the <em>end user&rsquo;s</em> ability to revoke access by themselves. A simple &ldquo;Close&rdquo; link in the debug panel would be awesome. Now you have to revisit the &ldquo;Share Preview&rdquo; page to remove access. If the authentication is done via the container snippet, there&rsquo;s no way to get rid of Preview mode while in that environment. It would be nice if you could temporarily (e.g. via a session cookie) revoke the authentication imposed by the container snippet while browsing the site.</p>

<p>It&rsquo;s also a bit strange that you can see deleted versions in the Environment lists. For example, if you create a new version and then delete it, it still appears in the &ldquo;Latest&rdquo; Environment, and you can publish it to any Environment you want via the Actions dropdown.</p>

<p>Finally, remember that tools don&rsquo;t create processes, they facilitate them. If you don&rsquo;t have a process the Environment is designed for, this new GTM feature will bring very little gratification. It will make some aspects of testing and previewing easier, but Google Tag Manager Environments truly shine when they reflect and facilitate existing processes.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/environments/">environments</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/referral-exclusion-on-receipt-page/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/from-project-to-process/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Better%20QA%20With%20Google%20Tag%20Manager%20Environments%20https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/referral-exclusion-on-receipt-page/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/from-project-to-process/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Better%20QA%20With%20Google%20Tag%20Manager%20Environments%20https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Better%20QA%20With%20Google%20Tag%20Manager%20Environments%20https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

