

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Understanding Tag Sequencing In Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2015\/05\/tag-sequencing.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/understanding-tag-sequencing-in-google-tag-manager\/",
  "datePublished": "2015-08-19T06:18:10\u002b00:00",
  "dateModified": "2015-08-19T06:18:10\u002b00:00",
  "description": "Guide to tag sequencing in Google Tag Manager. You can use this feature to set dependencies in the firing order of related tags.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Understanding Tag Sequencing In Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/understanding-tag-sequencing-in-google-tag-manager/">
    
    <meta name="description" content="Guide to tag sequencing in Google Tag Manager. You can use this feature to set dependencies in the firing order of related tags.">
    <meta property="og:description" content="Guide to tag sequencing in Google Tag Manager. You can use this feature to set dependencies in the firing order of related tags.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Understanding Tag Sequencing In Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Understanding Tag Sequencing In Google Tag Manager">
    <meta name="twitter:description" content="Guide to tag sequencing in Google Tag Manager. You can use this feature to set dependencies in the firing order of related tags.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/05/tag-sequencing.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/05/tag-sequencing.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Understanding Tag Sequencing In Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-08-19T06:18:10Z">
        
  August 19, 2015

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>A recent update to <a href="http://tagmanager.google.com">Google Tag Manager</a> introduced a feature which has been on the wishlist of many users for a long time. It&rsquo;s called <strong>Tag sequencing</strong>, and its purpose is to facilitate the sequential firing of Tags. The idea is that you can specify a <strong>setup</strong> and a <strong>cleanup</strong> for each Tag in your container.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/05/tag-sequencing.jpg" title="Tag Sequencing">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/05/tag-sequencing.jpg#ZgotmplZ" alt="Tag Sequencing" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1556 458'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This article is intended to function as a quick tour of the feature. It&rsquo;s not the simplest feature to understand, as Tag sequencing runs parallel but separate from the normal flow of your container. Don&rsquo;t worry, I&rsquo;ll get back to this soon.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="1sequence-in-a-nutshell">1.Sequence in a nutshell</h2>
<p>A <em>sequence</em> comprises three phases:</p>
<p>The <strong>setup</strong>, which is a Tag which must <em>successfully</em> complete before the main Tag fires.</p>
<p>The <strong>main tag</strong>, which is the Tag with the dependencies. It&rsquo;s either dependent on the <strong>setup</strong>, or it establishes a dependency with the <strong>cleanup</strong>.</p>
<p>The <strong>cleanup</strong>, which is a Tag which fires after the <strong>main tag</strong> has completed successfully.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/08/setup-cleanup.jpg" title="Setup Cleanup">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/08/setup-cleanup.jpg#ZgotmplZ" alt="Setup Cleanup" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1084 416'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The sequence is created by editing the <strong>Advanced Settings</strong> of the <strong>main tag</strong>. You will see two new settings here:</p>
<ul>
<li>
<p>Fire a tag before&hellip;</p>
</li>
<li>
<p>Fire a tag after&hellip;</p>
</li>
</ul>
<p>The first setting is for choosing the <strong>setup</strong> for the <strong>main Tag</strong>. The latter is for the <strong>cleanup</strong>. If you choose a <strong>setup</strong>, it will need to complete before the <strong>main tag</strong> itself fires. If you choose a <strong>cleanup</strong>, the <strong>main tag</strong> will need to complete before the <strong>teardown</strong> is fired. For both, you can choose whether or not a failure in either the <strong>setup</strong> or the <strong>main tag</strong> will abort the sequence.</p>
<p>OK. That was confusing. Allow me to visualize it with my superior PowerPoint skills.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/05/sequence.jpg" title="tag sequence visualized">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/05/sequence.jpg#ZgotmplZ" alt="tag sequence visualized" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1514 992'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the sequence above, the Page View Tag (<strong>setup</strong>) must successfully complete before the Event Tag (<strong>main tag</strong>) fires. If the Page View Tag fails, the sequence is aborted. Similarly, the Event Tag must successfully complete before the final Event Tag (<strong>cleanup</strong>) fires. If the main Tag fails, the final Event Tag will not fire.</p>
<p>You can, of course, specify that the Tags fire even if some member in the sequence fails.</p>
<p>The key thing to understand about the sequence is that it&rsquo;s <em>isolated</em>. Using Tag sequencing lets you specify a sequence of hits that fire when the <strong>main tag</strong> is triggered. This means that the <strong>setup</strong> and <strong>cleanup</strong> Tags will act completely oblivious to any Triggers you might have added to them.</p>
<p>Indeed, no matter what Triggers you have or have not equipped on them, they are completely ignored if the Tag is used as a <strong>setup</strong> or <strong>cleanup</strong>. For this reason, it might be prudent to <em>not</em> use <strong>setup</strong> and <strong>cleanup</strong> Tags for anything except sequencing, but there is a way to make it work both ways (I&rsquo;ll get back to this soon).</p>
<p>I emphasize again that this is a difficult concept to grasp. I&rsquo;m sure the UX / UI could be made more intuitive, but the reason it&rsquo;s difficult is that it relies on callbacks, which are invisible in actual GTM usage (unless you start debugging on a really granular level).</p>

                
                  <h2 id="2-the-callbacks">2. The callbacks</h2>
<p>We still have some theory to cover before delving deeper into the practical stuff.</p>
<p>In GTM, each Tag has a callback. With Tag templates, these callbacks depend on how the Tag works. For example, the Google Analytics Tag uses the <a href="https://www.simoahava.com/gtm-tips/hitcallback-eventcallback/">hitCallback</a> feature as its callback.</p>
<p>So, when you establish a <strong>setup</strong>, for example, the <strong>main tag</strong> will not fire until the <code>onSuccess</code> callback of <strong>setup</strong> is invoked. With the Google Analytics Tag template, the <strong>tag</strong> will be fired only after the hitCallback of the <strong>setup</strong> is executed successfully. Similarly, the <strong>cleanup</strong> will not be fired until the <code>onSuccess</code> callback of the <strong>main tag</strong> is called.</p>
<p>Phew!</p>
<p>The other callback is <code>onFailure</code>. This is invoked in case the Tag does not successfully complete. In the settings for Tag sequencing, you can specify that the <strong>main tag</strong> must not fire if <strong>setup</strong> fails, or you can choose to ignore the failure. Similarly, you can specify that the <strong>cleanup</strong> must not fire if <strong>main tag</strong> fails, or you can, again, choose to ignore the failure.</p>
<p>You don&rsquo;t have to worry about these callbacks when using Tag templates. GTM takes care of calling <code>onSuccess</code> and <code>onFailure</code> for you, and all you need to do is make sure that you&rsquo;ve checked the correct boxes in the settings (I promise, we&rsquo;re going to get to the settings very soon!).</p>

                
                  <h2 id="3-the-custom-html-tag">3. The Custom HTML Tag</h2>
<p>The exception is the <strong>Custom HTML Tag</strong>. Since you might want to tell Google Tag Manager not to proceed to the next tag until something has happened (e.g. an asynchronous operation has completed), a workaround is required. If you go to the <strong>Built-in Variables</strong>, you should see a new one: <strong>HTML ID</strong>:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/05/html-id.jpg" title="HTML ID built-in variable">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/05/html-id.jpg#ZgotmplZ" alt="HTML ID built-in variable" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 654 566'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This is used to invoke either the <code>onSuccess</code> or <code>onFailure</code> callback for the Custom HTML Tag.</p>
<p>So, if you want to use a Custom HTML Tag as either the <strong>setup</strong> or the <strong>main tag</strong>, and you want to establish a sequence with success and/or failure conditions, you will need the following:</p>
<ol>
<li>
<p>The <strong>HTML ID</strong> Built-In Variable</p>
</li>
<li>
<p>The <strong>Container ID</strong> Built-In Variable</p>
</li>
<li>
<p>The <strong>Custom HTML Tag</strong> itself</p>
</li>
</ol>
<p>In the following code example, I&rsquo;m running some custom JavaScript, and once it&rsquo;s done, I&rsquo;m letting the sequence know that <code>onSuccess</code> has been called.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  (<span style="color:#00a">function</span>() {
    <span style="color:#00a">var</span> gtm = <span style="color:#0aa">window</span>.google_tag_manager[{{Container ID}}];
    <span style="color:#00a">var</span> el = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#39;content-head&#39;</span>);
    <span style="color:#00a">try</span> {
      el.innerHTML = <span style="color:#a50">&#39;We have taken over your website!&#39;</span>;
      gtm.onHtmlSuccess({{HTML ID}});
    } <span style="color:#00a">catch</span>(e) {
      gtm.onHtmlFailure({{HTML ID}});
    }
  })();
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>In the first line of the script, you copy a reference to the GTM container interface into the <code>gtm</code> variable. This is a very specific interface into GTM&rsquo;s mechanisms, so don&rsquo;t worry about it too much. Suffice to say that this reference allows you to pass the <code>onSuccess</code> and <code>onFailure</code> callbacks, which is why it&rsquo;s important here.</p>
<p>Next, there&rsquo;s a <code>try...catch</code> block, where a DOM method is executed. Once it&rsquo;s completed, the <code>onHtmlSuccess()</code> method of the interface is invoked. The parameter to this method is the new <strong>HTML ID</strong> Built-In Variable. This way GTM will be able to communicate to the next member of the sequence that it was precisely <em>this</em> particular Custom HTML Tag that just completed.</p>
<p>If there&rsquo;s an error, then the <code>onHtmlFailure()</code> method is invoked, and information is passed to the sequence that this Tag did not complete successfully.</p>
<p>By now it shouldn&rsquo;t be too complicated anymore to understand what&rsquo;s happening. Each Tag template has an <code>onSuccess</code> and <code>onFailure</code> callback, except for the Custom HTML Tag, where you can to provide them yourself.</p>
<blockquote>
<p><strong>UPDATE 23 July 2018</strong>: Be sure to read my article on <a href="https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">Custom HTML tags with tag sequencing</a> for more details on how Custom HTML tags and tag sequencing work together.</p>
</blockquote>

                
                  <h2 id="4-how-to-create-the-sequence">4. How to create the sequence</h2>
<p>Finally! Some practical information!</p>
<p>Under the <strong>Advanced Settings</strong> of each Tag template, you will find three new options:</p>
<ol>
<li>
<p><strong>Tag firing options</strong> - Lets you delimit the Tag to fire either just <em>Once per event</em>, <em>Once per page</em>, or just let it fire <em>Unlimited</em> times.</p>
</li>
<li>
<p><strong>Tag Sequencing -&gt; SETUP</strong> - Lets you choose the Tag which must complete before the Tag whose settings you are currently editing. You can specify whether the <strong>setup</strong> must complete successfully, or if failures should still make this Tag fire.</p>
</li>
<li>
<p><strong>Tag Sequencing -&gt; CLEANUP</strong> - Lets you choose the Tag which must fire after the current Tag has completed execution. Again, you can specify whether the current Tag must complete successfully, or if its failure should be ignored, and the <strong>cleanup</strong> should fire regardless.</p>
</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/05/new-settings.jpg" title="Tag Advanced Settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/05/new-settings.jpg#ZgotmplZ" alt="Tag Advanced Settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1582 982'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>That&rsquo;s how you set up a <strong>Tag Sequence</strong>.</p>
<p>Now, in the very beginning I mentioned that the sequence works in isolation. This means that the setup you establish for any particular Tag will run the sequence regardless of what other Triggers you might have attached to the <strong>setup</strong> or <strong>cleanup</strong>. This also means that a sequence is always bound to the event of the <strong>main tag</strong>. Thus, if the <strong>main tag</strong> fires upon the &ldquo;All Pages&rdquo; Trigger, for example, then the entire sequence will be completed during this event.</p>
<p>Because you can use a Tag both independently and as part of a sequence, the new <strong>Tag firing options</strong> are very useful, indeed. For example, if you have Tag A as the <strong>setup</strong> for some Tag, as well as firing on its own, individual Trigger, you can specify that Tag A must only fire <em>Once per page</em> to prevent multiple hits from being sent. This means simply that after it has fired once, either independently or as part of a sequence, it will not fire again while the user is on the page.</p>
<p>You can also specify <em>Once per event</em>, which means that the Tag will only fire once for any given <strong>data layer event</strong>. So, you might have Tag A firing on the &ldquo;All Pages&rdquo; Trigger, and you might also have it as the <strong>cleanup</strong> of some Tag which also fires on the &ldquo;All Pages&rdquo; Trigger. By using the <em>Once per event</em> setting, Tag A will only fire once during the &ldquo;All Pages&rdquo; event.</p>

                
                  <h2 id="5-note-about-using-datalayerpush-in-the-sequence">5. Note about using <code>dataLayer.push()</code> in the sequence</h2>
<p>One of the main use cases for using tag sequencing would be to have the <strong>setup</strong> Tag push something into <code>dataLayer</code> for the main Tag to use.</p>
<p>Hold your horses!</p>
<p>If you know your Google Tag Manager, you&rsquo;ll know that the Data Layer available to any Tag is fixed for the <strong>duration of the Data Layer Event</strong>! So any Tags which fire on the initial <code>dataLayer.push()</code> will only be able to access the values in this push. If some Tag tries to modify the values in the Data Layer, these values will not be registered until the <strong>next</strong> <code>dataLayer.push()</code> with an event.</p>
<p>(<strong>UPDATE:</strong> Some time after this article was written, GTM&rsquo;s behavior changed so that variables are resolved separately for every tag in a sequence. This means that you <em>don&rsquo;t</em> need to use <code>google_tag_manager[...].dataLayer.get()</code> if you want to retrieve a variable that changed from one tag in the sequence to the next. Instead, you can just use regular Google Tag Manager Variables, as their values will update for each tag in the sequence!)</p>
<p>This hampers development a little, since it sounds like <code>dataLayer</code> can&rsquo;t be used as a messaging medium within a sequence, as the entire sequence operates in the span of a single Data Layer Event (the one which fired the main Tag in the first place).</p>
<p>The <a href="https://support.google.com/tagmanager/answer/6238868?vid=1-635767739658514293-2846637075">developer guide</a> actually has a note about this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/08/tag-sequencing-help.jpg" title="Tag Sequencing note dataLayer.set()">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/08/tag-sequencing-help.jpg#ZgotmplZ" alt="Tag Sequencing note dataLayer.set()" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1448 244'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>However, at the time of writing this, <code>dataLayer.set()</code> does not exist. I asked the developers, and this seems to be a mistake in the guide. Instead, you need to use the following command to <em>set</em> values in the Data Layer even during the tag sequence:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// To set a value, use set() with the key as the first parameter, and value as the second
</span><span style="color:#aaa;font-style:italic"></span>google_tag_manager[{{Container ID}}].dataLayer.set(<span style="color:#a50">&#39;someKey&#39;</span>, <span style="color:#a50">&#39;someValue&#39;</span>);
</code></pre></div>
<p>Once you use this, any Tag that fires after this one (in the same sequence), will have its Data Layer Variable reference to <strong>someKey</strong> updated to return <em>someValue</em>.</p>
<p>If you want to retrieve this changed value in the <em>same</em> Tag it was changed in, you can&rsquo;t use a Data Layer Variable, since it&rsquo;s resolved before the Tag is executed (and the <code>set()</code> command is run). You&rsquo;ll need to use this syntax instead:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// To get a value, use get() with the key as the parameter
</span><span style="color:#aaa;font-style:italic"></span>google_tag_manager[{{Container ID}}].dataLayer.get(<span style="color:#a50">&#39;someKey&#39;</span>);
</code></pre></div>
<p>Remember to enable the <strong>Container ID</strong> Built-in Variable!</p>
<p>These are fairly advanced use cases, but it&rsquo;s very good to keep this in mind when working with Tag sequences that are scoped to a single Data Layer event.</p>

                
                  <h2 id="6-why-use-tag-sequencing">6. Why use tag sequencing?</h2>
<p>The asynchronous loading of JavaScript is taken for granted these days. It&rsquo;s a nice way for browsers to ensure a decent browsing experience even with large, bulky linked assets.</p>
<p>However, asynchronous JavaScript makes it difficult to establish <em>order</em>, as you can&rsquo;t predict when some script or library finishes loading. Order is introduced with <em>callbacks</em> or <em>promises</em>, but these are difficult concepts to manoeuvre around, and the Google Tag Manager UI doesn&rsquo;t necessarily let you take advantage of them, especially if using templates.</p>
<p>Sequencing lets you tap into callbacks that GTM establishes by default (the tag templates), or that you create manually (Custom HTML Tags). It lets you chain Tags together, which is particularly useful if you want to establish dependencies.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tag-sequencing/">tag sequencing</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/track-form-engagement-with-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/two-ways-to-persist-data-via-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Understanding%20Tag%20Sequencing%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2021 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/track-form-engagement-with-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/two-ways-to-persist-data-via-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Understanding%20Tag%20Sequencing%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Understanding%20Tag%20Sequencing%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
    
    <script>
      !function(){
	    var baitPath = 'https://sgtm.simoahava.com/ads-min.js';
	  var pixelPath = 'https://sgtm.simoahava.com/4dchk';
	  var e=document.createElement("script");e.src=baitPath,document.body.appendChild(e);var t=!1;fetch("https://www.google-analytics.com/analytics.js",{method:"HEAD",mode:"no-cors"}).catch(function(){t=!0}),window.addEventListener("load",function(){var e={adb_blocked:!document.querySelector("#ECKckuBYwZaP"),gtm_blocked:!(window.google_tag_manager&&window.google_tag_manager.dataLayer),ga_blocked:t},o=Math.floor(1e6*Math.random()+1)+"_"+(new Date).getTime(),a=document.createElement("img");a.style="width: 1; height: 1; display: none;",a.src=pixelPath+"?client_id="+o+"&"+Object.keys(e).reduce(function(t,o){return t.concat(o+"="+e[o])},[]).join("&"),document.body.appendChild(a)})}();
    </script>
      

    
  </body>
</html>

