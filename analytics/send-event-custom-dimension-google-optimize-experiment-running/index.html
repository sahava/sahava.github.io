

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Send Event And Custom Dimension If Google Optimize Experiment Is Running | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2017\/11\/custom-dim-exp-id.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/send-event-custom-dimension-google-optimize-experiment-running\/",
  "datePublished": "2017-11-16T14:52:07\u002b00:00",
  "dateModified": "2017-11-16T14:52:07\u002b00:00",
  "description": "Use customTask to detect if Google Optimize is running an experiment, and send this data to Google Analytics for segmenting.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Send Event And Custom Dimension If Google Optimize Experiment Is Running | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
    
    <meta name="description" content="Use customTask to detect if Google Optimize is running an experiment, and send this data to Google Analytics for segmenting.">
    <meta property="og:description" content="Use customTask to detect if Google Optimize is running an experiment, and send this data to Google Analytics for segmenting.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Send Event And Custom Dimension If Google Optimize Experiment Is Running">
    <meta property="og:url" content="https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Send Event And Custom Dimension If Google Optimize Experiment Is Running">
    <meta name="twitter:description" content="Use customTask to detect if Google Optimize is running an experiment, and send this data to Google Analytics for segmenting.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2017/11/custom-dim-exp-id.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2017/11/custom-dim-exp-id.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Send Event And Custom Dimension If Google Optimize Experiment Is Running
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2017-11-16T14:52:07Z">
        
  November 16, 2017

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>I really like <a href="https://optimize.google.com/optimize/home/">Google Optimize</a>. It has a fairly intuitive UI, setting up experiments is easy, and there&rsquo;s integrations for both <a href="https://tagmanager.google.com/">Google Tag Manager</a> and <a href="https://analytics.google.com/">Google Analytics</a> built into the system. It&rsquo;s still a JavaScript-based, client-side A/B-testing tool, so problems with flicker and asynchronous loading are ever-present (though this is somewhat mitigated by the <a href="https://developers.google.com/optimize/#the_page-hiding_snippet_code">page-hiding snippet</a>).</p>
<p>One issue with the Google Analytics integration is the difficulty of creating segments for sessions where the users were actively participating in the experiment. In fact, there&rsquo;s no specific signal in Google Analytics that tells you the <strong>NOW</strong> the user is &ldquo;experiencing&rdquo; an experiment. You&rsquo;ll find the <strong>Experiment Name</strong> and <strong>Experiment ID</strong> dimensions, yes, but they have one drawback:</p>
<p><strong>The <em>Experiment Name</em> and <em>Experiment ID</em> dimensions are <em>user-scoped</em> for the duration of the experiment!</strong></p>
<p>So if the user takes part in an experiment, all their hits and sessions from that moment on until the experiment is over will be annotated with the Experiment Name and Experiment ID values.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/custom-dim-exp-id.jpg" title="Custom Dimension with Experiment ID">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/custom-dim-exp-id.jpg#ZgotmplZ" alt="Custom Dimension with Experiment ID" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 925 297'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>But I want to know <em>exactly</em> and <em>only</em> the sessions where my users were seeing the experiment content. I want to use this information to create segments where I can view other conversion goals or funnels than those configured into Optimize. This is increasingly important if you want to use Optimize for some quick personalization proofs-of-concept, since then it&rsquo;s vital to know how the user reacted during the session when they saw the change in the content.</p>
<p>Anyway, to make this whole thing work with the rarified <strong>analytics.js</strong> snippet and <strong>Google Tag Manager</strong>, we will use a feature I have seldom written about: <code>customTask</code>. OK, I&rsquo;ve written about it <a href="https://www.simoahava.com/tags/customtask/">plenty</a>.</p>
<p>With <code>customTask</code>, we can automatically add a session-scoped Custom Dimension to all hits that took part in an experiment, and in some edge cases we&rsquo;ll also send an event to GA to make sure the data is carried over.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="how-it-works">How it works</h2>
<p>When you land on a page where an Optimize experiment is running (i.e. the page is (one of) the target(s) of the experiment), your Google Analytics hits will contain the <strong>&amp;exp</strong> parameter with a value consisting of all the experiment IDs and variant IDs the user is participating in:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/exp-key.jpg" title="exp key in payload">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/exp-key.jpg#ZgotmplZ" alt="exp key in payload" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1001 427'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This key is what GA then uses to attribute the user to these particular experiments. So once that hit reaches GA, my Client ID will be associated with those two experiment IDs until the experiment is over.</p>
<p>Now, what I actually want to happen is for a Custom Dimension to be added to that Page View hit if it has the <strong>&amp;exp</strong> key. For this, I need to use <code>customTask</code> so that it can sniff the requests to Google Analytics, and in case they contain this key, dynamically add the Custom Dimension parameter with the experiment string. That way I&rsquo;ll have the experiment data sent to Google Analytics nicely in the Custom Dimension of my choice!</p>
<p>If you&rsquo;re using <strong>Google Tag Manager</strong> to deploy Google Optimize, the same code will apply, but instead of leveraging a Page View hit, the Optimize tag will use a special <code>hitType === 'data'</code> hit, which takes your experiment data to GA.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/data-hittype-gtm.jpg" title="hittype data parameter gtm">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/data-hittype-gtm.jpg#ZgotmplZ" alt="hittype data parameter gtm" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 947 312'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Unfortunately for us, this <code>data</code> hit type is not exposed in Google Analytics, so we can&rsquo;t use that to segment our visitors, nor does piggy-backing it with a Custom Dimension do anything. So, we need to configure Google Tag Manager to actually send an extra <strong>event</strong> when a <code>data</code> hit is encountered that also has the <strong>&amp;exp</strong> parameter with it.</p>

                
                  <h2 id="implement-via-analyticsjs">Implement via analytics.js</h2>
<p>If you&rsquo;re using the <strong>analytics.js</strong> snippet, here&rsquo;s what you need to do:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  <span style="color:#aaa;font-style:italic">// Analytics.js snippet
</span><span style="color:#aaa;font-style:italic"></span>  (<span style="color:#00a">function</span>(i,s,o,g,r,a,m){i[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]=r;i[r]=i[r]||<span style="color:#00a">function</span>(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=<span style="color:#099">1</span>*<span style="color:#00a">new</span> <span style="color:#0aa">Date</span>();a=s.createElement(o),
m=s.getElementsByTagName(o)[<span style="color:#099">0</span>];a.async=<span style="color:#099">1</span>;a.src=g;m.parentNode.insertBefore(a,m)
})(<span style="color:#0aa">window</span>,<span style="color:#0aa">document</span>,<span style="color:#a50">&#39;script&#39;</span>,<span style="color:#a50">&#39;https://www.google-analytics.com/analytics.js&#39;</span>,<span style="color:#a50">&#39;ga&#39;</span>);

  ga(<span style="color:#a50">&#39;create&#39;</span>, <span style="color:#a50">&#39;UA-XXXXXX-Y&#39;</span>,<span style="color:#a50">&#39;auto&#39;</span>)

  <span style="color:#aaa;font-style:italic">// NEW: Add customTask field to tracker
</span><span style="color:#aaa;font-style:italic"></span>  ga(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;customTask&#39;</span>,  <span style="color:#00a">function</span>(model) {

    <span style="color:#aaa;font-style:italic">// Change this to the Custom Dimension index to which you want to send the experiment data!
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> customDimensionIndex = <span style="color:#a50">&#39;6&#39;</span>;
    
    <span style="color:#aaa;font-style:italic">// Make sure the new hit is only generated once (thanks Vibhor Jain!)
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> hasNewHitBeenGenerated = <span style="color:#00a">false</span>;
    
    <span style="color:#00a">var</span> globalSendTaskName = <span style="color:#a50">&#39;_&#39;</span> + model.get(<span style="color:#a50">&#39;trackingId&#39;</span>) + <span style="color:#a50">&#39;_sendHitTask&#39;</span>;
    
    <span style="color:#00a">var</span> originalSendTask = <span style="color:#0aa">window</span>[globalSendTaskName] = <span style="color:#0aa">window</span>[globalSendTaskName] || model.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);
    
    model.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, <span style="color:#00a">function</span>(sendModel) {
      <span style="color:#00a">var</span> ga = <span style="color:#0aa">window</span>[<span style="color:#0aa">window</span>[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]];
      <span style="color:#00a">var</span> hitPayload = sendModel.get(<span style="color:#a50">&#39;hitPayload&#39;</span>);
      <span style="color:#00a">if</span> (sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>)) {
        <span style="color:#00a">if</span> (sendModel.get(<span style="color:#a50">&#39;hitType&#39;</span>) === <span style="color:#a50">&#39;data&#39;</span> &amp;&amp; !hasNewHitBeenGenerated) {
          <span style="color:#00a">var</span> tracker = sendModel.get(<span style="color:#a50">&#39;name&#39;</span>);
          originalSendTask(sendModel);
          ga(tracker + <span style="color:#a50">&#39;.send&#39;</span>, <span style="color:#a50">&#39;event&#39;</span>, <span style="color:#a50">&#39;Optimize&#39;</span>, sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>), {nonInteraction: <span style="color:#00a">true</span>});
          hasNewHitBeenGenerated = <span style="color:#00a">true</span>;
          <span style="color:#00a">return</span>;
        }
        <span style="color:#00a">if</span> (hitPayload.indexOf(<span style="color:#a50">&#39;&amp;cd&#39;</span> + customDimensionIndex + <span style="color:#a50">&#39;=&#39;</span>) === -<span style="color:#099">1</span>) {
          sendModel.set(<span style="color:#a50">&#39;hitPayload&#39;</span>, hitPayload + <span style="color:#a50">&#39;&amp;cd&#39;</span> + customDimensionIndex + <span style="color:#a50">&#39;=&#39;</span> + sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>), <span style="color:#00a">true</span>);
        }
      }
      originalSendTask(sendModel);
    });
  });
  <span style="color:#aaa;font-style:italic">// NEW BLOCK ENDS
</span><span style="color:#aaa;font-style:italic"></span>
  ga(<span style="color:#a50">&#39;require&#39;</span>, <span style="color:#a50">&#39;GTM-XXXXXX&#39;</span>);
  ga(<span style="color:#a50">&#39;send&#39;</span>, <span style="color:#a50">&#39;pageview&#39;</span>);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>The change to the original Optimize-modified analytics.js snippet is the entire block starting with <code>// NEW:...</code> and ending with <code>// NEW BLOCK ENDS</code>.</p>
<p>This code listens to all GA hits sent with the default tracker, and if they have the <strong>&amp;exp</strong> parameter, then the Custom Dimension is dynamically added to the hits, along with the experiment ID string the user is associated with. Note that you must change the value of <code>var customDimensionIndex</code> to reflect the Custom Dimension index you&rsquo;ve created in Google Analytics. I prefer to use a <strong>Session-scoped Custom Dimension</strong>, but you could use hit-scoped, too, for increased granularity.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/custom-dimension.jpg" title="Custom Dimension in GA">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/custom-dimension.jpg#ZgotmplZ" alt="Custom Dimension in GA" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1089 201'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>That&rsquo;s all you need to do with <strong>analytics.js</strong>. On pages not included in the experiment, no Custom Dimension or any extra hit is sent. Business will be as usual.</p>

                
                  <h2 id="implement-via-google-tag-manager">Implement via Google Tag Manager</h2>
<p>In Google Tag Manager, you need to create a new <strong>Custom JavaScript variable</strong>, and give it a name like <strong>{{JS - customTask - Optimize experiment}}</strong>. The variable should look like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> <span style="color:#00a">function</span>(model) {
    
    <span style="color:#aaa;font-style:italic">// Change this to the Custom Dimension index to which you want to send the experiment data!
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> customDimensionIndex = <span style="color:#a50">&#39;6&#39;</span>;

    <span style="color:#aaa;font-style:italic">// Make sure the new hit is only generated once (thanks Vibhor Jain!)
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> hasNewHitBeenGenerated = <span style="color:#00a">false</span>;
    
    <span style="color:#00a">var</span> globalSendTaskName = <span style="color:#a50">&#39;_&#39;</span> + model.get(<span style="color:#a50">&#39;trackingId&#39;</span>) + <span style="color:#a50">&#39;_sendHitTask&#39;</span>;
    
    <span style="color:#00a">var</span> originalSendTask = <span style="color:#0aa">window</span>[globalSendTaskName] = <span style="color:#0aa">window</span>[globalSendTaskName] || model.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);

    model.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, <span style="color:#00a">function</span>(sendModel) {
      <span style="color:#00a">var</span> ga = <span style="color:#0aa">window</span>[<span style="color:#0aa">window</span>[<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>]];
      <span style="color:#00a">var</span> hitPayload = sendModel.get(<span style="color:#a50">&#39;hitPayload&#39;</span>);
      <span style="color:#00a">if</span> (sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>)) {
        <span style="color:#00a">if</span> (sendModel.get(<span style="color:#a50">&#39;hitType&#39;</span>) === <span style="color:#a50">&#39;data&#39;</span> &amp;&amp; !hasNewHitBeenGenerated) {
          <span style="color:#00a">var</span> tracker = sendModel.get(<span style="color:#a50">&#39;name&#39;</span>);
          originalSendTask(sendModel);
          ga(tracker + <span style="color:#a50">&#39;.send&#39;</span>, <span style="color:#a50">&#39;event&#39;</span>, <span style="color:#a50">&#39;Optimize&#39;</span>, sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>), {nonInteraction: <span style="color:#00a">true</span>});
          hasNewHitBeenGenerated = <span style="color:#00a">true</span>;
          <span style="color:#00a">return</span>;
        }
        <span style="color:#00a">if</span> (hitPayload.indexOf(<span style="color:#a50">&#39;&amp;cd&#39;</span> + customDimensionIndex + <span style="color:#a50">&#39;=&#39;</span>) === -<span style="color:#099">1</span>) {
          sendModel.set(<span style="color:#a50">&#39;hitPayload&#39;</span>, hitPayload + <span style="color:#a50">&#39;&amp;cd&#39;</span> + customDimensionIndex + <span style="color:#a50">&#39;=&#39;</span> + sendModel.get(<span style="color:#a50">&#39;exp&#39;</span>), <span style="color:#00a">true</span>);
        }
      }
      originalSendTask(sendModel);
    });
  };
}
</code></pre></div>
<p>It&rsquo;s pretty much exactly the same code you would use in the <strong>analytics.js</strong>.</p>
<p>Then, go to your <strong>Google Optimize</strong> tag, and scroll down to <strong>Fields to set</strong>. Add a new field with:</p>
<p>Field name: <strong>customTask</strong><br>
Value: <strong>{{JS - customTask - Optimize experiment}}</strong></p>
<p>So that it looks like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/optimize-tag-gtm.jpg" title="Optimize tag in Google Tag Manager">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/optimize-tag-gtm.jpg#ZgotmplZ" alt="Optimize tag in Google Tag Manager" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 883 527'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>And that should be it. Now when you browser the experiment pages, you should see a hit with type <code>'data'</code> being sent, and immediately after that an event hit which looks like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/11/extra-event-hit.jpg" title="Extra event hit">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/11/extra-event-hit.jpg#ZgotmplZ" alt="Extra event hit" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 991 426'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="summary">Summary</h2>
<p>I really wish that the Optimize / Google Analytics integration would give us a hit or dimension we could use to segment sessions that actively participated in an experiment. Right now you either need to replicate the test conditions in a segment (and if you sample only a part of your visitors even this won&rsquo;t cut it), or use a solution like the one described in this article.</p>
<p>Even if this were superfluous and unnecessary, I&rsquo;m giddy with excitement to show yet another cool use case for <code>customTask</code>. I&rsquo;m fairly certain that if we hadn&rsquo;t already given our baby boy a gorgeous name, the world would have come to know him as <strong>customTask Ahava</strong>. For now, it will have to do as his nickname. That&rsquo;s how much I love <code>customTask</code>!</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/customtask/">customtask</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-optimize/">google optimize</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/universal-analytics/">universal analytics</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/respect-opt-out-from-advertising-and-analytics/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Send%20Event%20And%20Custom%20Dimension%20If%20Google%20Optimize%20Experiment%20Is%20Running%20https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/respect-opt-out-from-advertising-and-analytics/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Send%20Event%20And%20Custom%20Dimension%20If%20Google%20Optimize%20Experiment%20Is%20Running%20https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Send%20Event%20And%20Custom%20Dimension%20If%20Google%20Optimize%20Experiment%20Is%20Running%20https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

