

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Consent Mode For Google Tags | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2020\/10\/consent-mode.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/consent-mode-google-tags\/",
  "datePublished": "2020-10-07T12:08:47\u002b03:00",
  "dateModified": "2020-10-07T12:08:47\u002b03:00",
  "description": "Overview of the new Consent Mode for managing storage access and data processing rules for Google\u0027s tags.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Consent Mode For Google Tags | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/consent-mode-google-tags/">
    
    <meta name="description" content="Overview of the new Consent Mode for managing storage access and data processing rules for Google&#39;s tags.">
    <meta property="og:description" content="Overview of the new Consent Mode for managing storage access and data processing rules for Google&#39;s tags.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Consent Mode For Google Tags">
    <meta property="og:url" content="https://www.simoahava.com/analytics/consent-mode-google-tags/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Consent Mode For Google Tags">
    <meta name="twitter:description" content="Overview of the new Consent Mode for managing storage access and data processing rules for Google&#39;s tags.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2020/10/consent-mode.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2020/10/consent-mode.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" loading="lazy" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://masto.measure.chat/@SimoAhava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Consent Mode For Google Tags
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2020-10-07T12:08:47&#43;03:00">
        
  October 7, 2020

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/consent-mode-google-tags/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <blockquote>
<p><strong>Note!</strong> This is about the original version of Consent Mode. While the content is still very valid and you should read through it to understand how it works, Google has since released a &ldquo;V2&rdquo; update with additional consent signals. You can read about <a href="https://www.simoahava.com/analytics/consent-mode-v2-google-tags/">Consent Mode V2 here</a>.
.
Not too long ago, Google announced a new <a href="https://support.google.com/analytics/answer/9976101">consent mode</a> for Google tags. It allows you to build a mechanism where Google&rsquo;s tags parse, react, and respond to the consent status of your site visitors.</p>
</blockquote>



<div style="aspect-ratio: 1808 / 1176;" class="figure ">
  
    <a href="https://www.simoahava.com/images/2020/10/consent-mode.jpg" title="Consent Mode with a custom Google Tag Manager template">
  
    <img class="fig-img" height="1176" width="1808" loading="lazy" src="https://www.simoahava.com/images/2020/10/consent-mode.jpg#ZgotmplZ" alt="Consent Mode with a custom Google Tag Manager template">
  
    </a>
  
   
    <span class="caption">Consent Mode with a custom Google Tag Manager template</span>
  
</div>


<p>In short, consent mode is a <strong>beta</strong> feature, which lets you determine whether or not Google&rsquo;s advertising tags (Ads and Floodlight) and analytics tags (Universal Analytics, App + Web) can utilize browser storage when sending pings to Google&rsquo;s servers.</p>
<p>This is (somewhat) in line with, for example, the General Data Protection Regulation (GDPR) and the ePrivacy Directive (ePD) in the European Union, which restrict the storage and processing of personal data (GDPR) and the storage of other data (ePD) with regard to data subjects.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#how-consent-mode-works">How consent mode works</a>
      <ul>
        <li><a href="#the-gtag-call">The gtag() call</a></li>
        <li><a href="#restrict-advertising-storage">Restrict advertising storage</a></li>
        <li><a href="#redact-advertising-data">Redact advertising data</a></li>
        <li><a href="#restrict-analytics-storage">Restrict analytics storage</a></li>
      </ul>
    </li>
    <li><a href="#what-happens-when-consent-is-updated">What happens when consent is updated</a></li>
    <li><a href="#url-passthrough">URL passthrough</a></li>
    <li><a href="#google-tag-manager-support">Google Tag Manager support</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
<p>Much of this guide revolves around how to set this up in <a href="https://tagmanager.google.com/">Google Tag Manager</a>, but the overview of the feature applies to implementation using the <a href="https://developers.google.com/analytics/devguides/collection/gtagjs">Global Site Tag (gtag.js)</a> as well.</p>
<blockquote>
<p>Disclaimer: This article is a technical overview of how consent mode works. You need to align the implementation with whatever laws and regulations apply to your organization and the users that visit your site(s).</p>
</blockquote>
<p>Make sure you read the official <a href="https://support.google.com/analytics/answer/9976101">support documentation</a> as well as the <a href="https://developers.google.com/gtagjs/devguide/consent">developer guide</a> to get up to speed.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="how-consent-mode-works">How consent mode works</h2>
<p>First of all, <strong>consent mode</strong> is not a <strong>consent management platform</strong>. For consent mode to be effective, you need to already have a system or solution in place for collecting and resolving the user&rsquo;s consent with regard to the data being collected on your site.</p>
<p>Consent mode has two variants. There are the <strong>default</strong> settings the page will use while waiting for the user&rsquo;s consent status to be resolved. Then there are the <strong>updated</strong> settings that are sent as soon as consent has been resolved.</p>
<p>Default settings should be established as early as possible in the page load. Ideally, you&rsquo;d add a new <code>gtag</code> snippet to the top of the page template, and establish the default consent settings in that snippet.</p>
<blockquote>
<p><strong>Note!</strong> You do <strong>not</strong> have to be using <strong>gtag.js</strong> to deploy consent mode. The API just happens to be the global <code>gtag()</code> method, but it works fine with Google Tag Manager&rsquo;s tags.</p>
</blockquote>
<p>When Google&rsquo;s tags fire, they will check the consent status from the default settings and act accordingly.</p>
<p>Once you&rsquo;ve established the user&rsquo;s consent, you can call the <code>update</code> command. This lets you change (or keep) the status of <strong>advertising storage</strong> and of <strong>analytics storage</strong>.</p>
<h3 id="the-gtag-call">The gtag() call</h3>
<p>As mentioned above, consent mode utilizes the <code>gtag()</code> API. The Google tags firing on the site will automatically read the consent status from this API when determining whether to read or write cookies and how to compile the network request to Google&rsquo;s servers.</p>
<p>Here&rsquo;s what the <strong>default</strong> snippet would look like. Remember, ideally this would be positioned at the top of the page. You can also fire it through Google Tag Manager using a Custom HTML tag or a custom template, but in that case you must make sure that it fires before any Google tags fire.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
<span style="color:#00a">function</span> gtag() { <span style="color:#0aa">window</span>.dataLayer.push(arguments); }
gtag(<span style="color:#a50">&#39;consent&#39;</span>, <span style="color:#a50">&#39;default&#39;</span>, {
  ad_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  analytics_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  wait_for_update: <span style="color:#099">500</span>,
  region: [<span style="color:#a50">&#39;US-CA&#39;</span>, <span style="color:#a50">&#39;FI&#39;</span>]
});
</code></pre></div>
<p>The <code>gtag()</code> command above sets default consent settings for visitors from California (<code>US-CA</code>) and Finland (<code>FI</code>) to deny access to advertising and analytics storage. For these users, only cookieless pings will be sent to Google servers. There&rsquo;s also a wait time of 500 milliseconds before any Google tags are allowed to fire, to give time for the <code>update</code> command to be invoked.</p>
<blockquote>
<p>The <code>region</code> parameter is only relevant in the <code>default</code> command, as by the time you run <code>update</code> you should know whether to enable or disable storage for the current user regardless of where they are from.</p>
</blockquote>
<p>Once you&rsquo;ve established the user&rsquo;s consent choices, you can execute the <code>update</code> command. In the following example, the user has given storage access for analytics tags but has denied access to storage for advertising scripts.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">gtag(<span style="color:#a50">&#39;consent&#39;</span>, <span style="color:#a50">&#39;update&#39;</span>, {
  ad_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  analytics_storage: <span style="color:#a50">&#39;granted&#39;</span>
});
</code></pre></div>
<p>You don&rsquo;t have to provide <code>ad_storage</code> again, as it was already <code>denied</code> in the default settings. However, I recommend to explicitly include them in the <code>update</code> command as well to make sure mistakes don&rsquo;t lead to storage being used when the user hasn&rsquo;t opted in to such a thing.</p>
<h3 id="restrict-advertising-storage">Restrict advertising storage</h3>
<p>To restrict advertising storage, you need to call the <code>default</code> or <code>update</code> command and set the value of <code>ad_storage</code> to <code>'denied'</code> in the consent object.</p>
<p>When advertising storage is restricted, here&rsquo;s what happens:</p>
<ul>
<li><strong>No new advertising cookies are written</strong>. This means that if the URL has the <code>gclid</code> from a Google search ad click, for example, it will not be written in a first-party cookie.</li>
<li><strong>No existing advertising cookies may be read</strong>. If there already was a cookie with a click identifier, this would not be used by or sent with the tags.</li>
<li><strong>Third-party cookies are solely used for spam and fraud detection</strong>. If there already are cookies written on, for example, <code>doubleclick.net</code>, they would be included in the request (assuming the browser doesn&rsquo;t <a href="https://www.cookiestatus.com/">block third-party cookies</a>), but Google says it will only use them for spam and fraud detection.</li>
<li><strong>Google Analytics will not read or write advertising cookies, nor will it use them for Google Signals</strong>.</li>
<li><strong>IP addresses are used solely for geolocation</strong>. They are not collected by Google Ads or Floodlight tags. Google Analytics <strong>does</strong> collect them, but you can opt in to <a href="https://support.google.com/analytics/answer/2763052">IP anonymization</a>.</li>
<li><strong>The full page URL is collected with possible click identifiers</strong>. If the current page URL has click identifiers, they are sent to the advertising and analytics platforms with the current page URL.</li>
</ul>
<h3 id="redact-advertising-data">Redact advertising data</h3>
<p>You can increase the fidelity of advertising storage restrictions by additionally calling the following <code>gtag()</code> API:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">gtag(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;ads_data_redaction&#39;</span>, <span style="color:#00a">true</span>);
</code></pre></div>



<div style="aspect-ratio: 972 / 258;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2020/10/redact-ads-data.jpg" title="Redact ads data">
  
    <img class="fig-img" height="258" width="972" loading="lazy" src="https://www.simoahava.com/images/2020/10/redact-ads-data.jpg#ZgotmplZ" alt="Redact ads data">
  
    </a>
  
  
</div>


<blockquote>
<p>This <strong>only</strong> works when you set <code>ad_storage</code> to <code>denied</code>.</p>
</blockquote>
<p>When you do this, the following additional restrictions will apply:</p>
<ul>
<li><strong>Advertising hits will be routed through a new cookieless domain</strong>. Instead of routing them to <code>doubleclick.net</code> or <code>google.com</code>, the requests are sent to <code>googleadsyndication.com</code>, which would not have any (advertising-related) cookies set on it by Google.</li>
<li><strong>Ad click identifiers will be redacted from advertising requests and consent pings</strong>.</li>
<li><strong>Page URLs with click identifiers will be redacted</strong>. Note that Google Analytics will still collect the full page URL with click identifiers in place.</li>
</ul>



<div style="aspect-ratio: 3418 / 194;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2020/10/ads-data-redacted.jpg" title="Ads data redacted">
  
    <img class="fig-img" height="194" width="3418" loading="lazy" src="https://www.simoahava.com/images/2020/10/ads-data-redacted.jpg#ZgotmplZ" alt="Ads data redacted">
  
    </a>
  
  
</div>


<h3 id="restrict-analytics-storage">Restrict analytics storage</h3>
<p>If you choose to restrict analytics storage by setting the value of <code>analytics_storage</code> to <code>denied</code> in the consent object, Google Analytics will not be able to read or write first-party cookies.</p>
<p>This means that <strong>all hits</strong> that fire before the user <strong>reloads or navigates to another page</strong> will have the same client identifier (because it&rsquo;s stored in a global variable). However, as soon as the user navigates away from the current page or reloads the page, a new client identifier will be sent with the hits on this new page load.</p>
<p>In other words, Google Analytics will not read or write the <code>_ga</code> cookie (even if one already exists). Instead, it will use an ephemeral identifier that exists solely for the duration of the current page load.</p>
<p>Importantly, <strong>restricting analytics STORAGE will not prevent hits to Google Analytics from being sent</strong>. The consent mode setting solely prevents Google Analytics from storing data in or reading data from browser cookies (or other storage).</p>
<p>However, these cookieless hits are sent to Google Analytics with a new <code>gcs</code> parameter, which includes the consent status of the hit. The cookieless hits are thus identified by Google Analytics and <strong>for now</strong> are not collected or exposed in reporting at all.</p>
<p>Most likely Google will at some point build actionable data out of the cookieless data set as well, perhaps after applying extensive modelling to make it align with the data that was collected with storage consent.</p>

                
                  <h2 id="what-happens-when-consent-is-updated">What happens when consent is updated</h2>
<p>If you send the <code>update</code> command, you will be able to either <strong>deny</strong> or <strong>grant</strong> advertising and analytics storage access to all Google tags regardless of region.</p>



<div style="aspect-ratio: 944 / 578;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2020/10/update-consent.jpg" title="Update consent">
  
    <img class="fig-img" height="578" width="944" loading="lazy" src="https://www.simoahava.com/images/2020/10/update-consent.jpg#ZgotmplZ" alt="Update consent">
  
    </a>
  
  
</div>


<p>If you <strong>deny</strong> storage access, then any tags that fire after the <code>update</code> call will be restricted as described in the previous chapters.</p>
<p>If you <strong>grant</strong> storage access, then tags will have full access to storage. If you grant access to advertising storage, then any <a href="#redact-advertising-data">ads data redactions</a> you might have established will no longer apply.</p>
<p>In addition to this - as soon as you run the <code>update</code> command and <code>grant</code> access to advertising storage, all advertising pings that might have already fired <em>without</em> storage access will fire again. Thus cookies will be written and read, and the requests will be routed through domains that can carry third-party cookies as well.</p>

                
                  <h2 id="url-passthrough">URL passthrough</h2>
<p>If you&rsquo;re using <code>gtag.js</code>, you can toggle <strong>URL passthrough</strong> on. It checks the current page URL for advertising parameters (<code>gclid</code>, <code>dclid</code>, <code>gclsrc</code>, <code>_gl</code>), and adds them to all internal link URLs the user might be clicking through.</p>
<p>It&rsquo;s a useful feature to have in case consent is granted outside the landing page, but it does lead to URL pollution and can mess up sites where functionality is based on a strict set of URL parameters (especially beyond obvious landing pages).</p>
<p>The command looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">gtag(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;url_passthrough&#39;</span>, <span style="color:#00a">true</span>);
</code></pre></div>
<p>For this to work, the site <strong>must</strong> load a <code>gtag.js</code> library, so just using the <code>gtag()</code> API will not work.</p>
<p>If you&rsquo;re using Google Tag Manager, you can achieve the same functionality by using the cross-domain linking capabilities of the <a href="https://support.google.com/tagmanager/answer/7549390?hl=en">Conversion Linker tag</a>.</p>

                
                  <h2 id="google-tag-manager-support">Google Tag Manager support</h2>
<p>As you might have surmised, for now the Google Tag Manager support for consent mode is a bit flaky. Being forced to use the <code>gtag()</code> API is a bit backwards, considering we already have a global message queue named <code>dataLayer</code> at our disposal.</p>
<p>I&rsquo;m absolutely positive that a more tightly-knit integration with GTM is on the way. I&rsquo;m particularly hoping to see some or all of the following features:</p>
<ul>
<li><strong>Consent status exposed in <code>dataLayer</code></strong>. Right now the <code>gtag()</code> consent commands are not available in <code>dataLayer</code>, making it impossible to check advertising and analytics storage status in case one wanted to apply them to other, non-Google tags as well.</li>
<li><strong>Pre-load trigger</strong>. This is something I&rsquo;ve been wanting to see for years. It would be so useful to have a trigger event for which <strong>all</strong> other Google Tag Manager events have to wait to complete before being initialized. It would be the perfect place for a consent mode tag, as all the other tags in the container would not be able to fire until the pre-load event has been completed.</li>
<li><strong>First-class consent awareness</strong>. With this I mean it should be possible to have tags be consent-aware <em>without</em> having to build elaborate trigger setups. One of the most difficult things to set up when using GTM with a consent management platform is the conditional firing of tags depending on consent status.</li>
<li><strong>Consent-aware APIs for templates</strong>. A logical extension of consent mode is that it should apply to non-Google tags as well. A perfect place for this would be in <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">custom templates</a>, where consent mode status could be applied to the APIs and network requests generated by custom templates as well.</li>
</ul>

                
                  <h2 id="summary">Summary</h2>
<p>First of all, remember that <strong>consent mode</strong> is a <strong>beta</strong> feature. It&rsquo;s likely to change before it&rsquo;s officially out of beta (at which point I&rsquo;ll update this article accordingly).</p>
<p>In addition to a better Google Tag Manager integration, I&rsquo;m also looking forward to more consent options, as limiting just &ldquo;advertising storage&rdquo; and &ldquo;analytics storage&rdquo; doesn&rsquo;t really cut it when it comes to the granularity of how users should be able to decide how their data is collected and processed.</p>
<p>Nevertheless, consent mode gives you a nice way to control storage especially with advertising tags. You&rsquo;ve already been able to control Google Analytics storage with the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookies-user-id#disabling_cookies"><code>storage</code></a> tracker setting, but now it&rsquo;s also configurable via this <code>gtag()</code> API.</p>
<blockquote>
<p>The main difference between consent mode and using the <code>storage</code> field to block analytics tags from having access to storage is that consent mode will not surface the data in reports whereas setting <code>storage</code> to <code>none</code> will.</p>
</blockquote>
<p>It&rsquo;s important to note that consent mode mostly applies to <strong>storage</strong> access and doesn&rsquo;t actually block any requests. I&rsquo;m certain there will be debate about whether this is enough or not. However, especially in the European Union the laws seem to be rather clear that as long as the nothing is stored (or read from storage), and as long as only ephemeral identifiers that can in no way be linked back to a natural person are used, this approach should be good enough.</p>
<p>You will need to trust Google on the <code>ad_storage</code> bit, though. Google promises they won&rsquo;t use third-party cookies for other than spam and fraud detection, but this is difficult to audit.</p>
<p>Similarly, consent mode only covers the identifiers <strong>that we know about</strong>. There might be data leaks, intentional and unintentional, in requests to Google that allow far more data controlling options than the user has opted in to.</p>
<p>Still, I think any effort taken by Google to improve security and privacy control over their services is welcome. It&rsquo;s just important that this doesn&rsquo;t lead to complacency, though. Just because Google offers it natively doesn&rsquo;t mean you can abandon due diligence in making sure that consent (and any other legitimate purposes) are observed and periodically audited.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/privacy/">privacy</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/consent-mode/">consent mode</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/new-preview-mode-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/search-bulk-actions-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-mode-google-tags/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/consent-mode-google-tags/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-mode-google-tags/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/new-preview-mode-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/search-bulk-actions-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-mode-google-tags/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/consent-mode-google-tags/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-mode-google-tags/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-mode-google-tags/">
          <i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/consent-mode-google-tags/%20via%20@SimoAhava">
          <i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-mode-google-tags/">
          <i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

