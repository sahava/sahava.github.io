

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Google Tag Manager: The History Listener | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2014\/03\/ajax-example.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/google-tag-manager-history-listener\/",
  "datePublished": "2014-03-08T10:16:24\u002b00:00",
  "dateModified": "2014-03-08T10:16:24\u002b00:00",
  "description": "Guide to the History Listener in Google Tag Manager. Today, this is known as the History Change trigger.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Google Tag Manager: The History Listener | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/google-tag-manager-history-listener/">
    
    <meta name="description" content="Guide to the History Listener in Google Tag Manager. Today, this is known as the History Change trigger.">
    <meta property="og:description" content="Guide to the History Listener in Google Tag Manager. Today, this is known as the History Change trigger.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Google Tag Manager: The History Listener">
    <meta property="og:url" content="https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Google Tag Manager: The History Listener">
    <meta name="twitter:description" content="Guide to the History Listener in Google Tag Manager. Today, this is known as the History Change trigger.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2014/03/ajax-example.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2014/03/ajax-example.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" loading="lazy" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://masto.measure.chat/@SimoAhava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Google Tag Manager: The History Listener
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2014-03-08T10:16:24Z">
        
  March 8, 2014

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/google-tag-manager-history-listener/#commento"><comentario-count path="/analytics/google-tag-manager-history-listener/" 
                  placeholder="..."
                  error-text="N/A "
                  zero-text="0 "
                  prefix=""
                  suffix=" "></comentario-count>Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>There&rsquo;s a new listener in town! It&rsquo;s a few days now since the <a href="http://www.google.com/tagmanager">Google Tag Manager</a> team unleashed the <strong>History Listener</strong>, and the time has come for me to tell you what this baby can do.</p>
<p>The History Listener is designed to be used on websites where content is loaded dynamically. Typically, these websites make heavy use of <a href="https://www.w3schools.com/xml/ajax_intro.asp">AJAX</a> (<strong>A</strong>synchronous <strong>J</strong>avaScript <strong>a</strong>nd <strong>X</strong>ML), which is designed for loading content in the background and serving it dynamically without having to reload the page.</p>



<div style="aspect-ratio: 998 / 626;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/ajax-example.jpg" title="AJAX basics">
  
    <img class="fig-img" height="626" width="998" loading="lazy" src="https://www.simoahava.com/images/2014/03/ajax-example.jpg#ZgotmplZ" alt="AJAX basics">
  
    </a>
  
  
</div>


<p>Because I don&rsquo;t want to go too deep into how a dynamic website works, this tutorial should be pretty simple. The key is to understand what events trigger the History Listener, and how you can track your page views in a website without static URLs bound to static content.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="background">Background</h2>
<p>A site which loads content dynamically is usually incompatible with certain default browser events. For example, if you have a site which dynamically loads its content without any change in the URL of the page (nothing happens in the address bar), what do you think happens when a visitor navigates away from your site and then clicks the browser <strong>Back</strong> button? I can give you a hint, they won&rsquo;t see whatever dynamic state the page was in just before they left.</p>
<p>This is, of course, a <a href="http://searchengineland.com/bing-offers-recommendations-for-seo-friendly-ajax-suggests-html5-pushstate-152946">problem for search engines</a> as well, since they want to index pages with unique URL addresses, which each return a static, unique piece of content. This is why <strong>URL fragments</strong> (AKA anchors AKA hashes) were introduced to solve the problems with browser history. If you loaded content clicking an &ldquo;About Us&rdquo; link, your URL would have looked like <code>https://www.simoahava.com/main#aboutus</code>.</p>
<p>This fixed the problem with browser history, since now you could detect changes in the URL fragment and serve appropriate content again, even if the user used the Back button. However, this wasn&rsquo;t good enough for search engines or for Google Analytics, which have a hard time dealing with URL fragments.</p>
<p>Enter the <strong>hashbang</strong> (coolest name to be ever given to anything anywhere). The hashbang is a hash followed by an exclamation mark: <strong>#!</strong>. It&rsquo;s an old invention, having existed in UNIX systems to facilitate script loading. Google adopted it as a schema to signify an AJAX site with crawlable content. When search crawlers came across the hashbang sequence, they translated it to a proper URL query parameter (<strong><em>escaped_fragment=_the-original-fragment</em></strong>). A query parameter meant that the page could be crawled and indexed for search engine users to find.</p>
<p>However, the hashbang isn&rsquo;t the easiest solution to implement, it looks <a href="http://www.slideshare.net/RobOusbey/new-technologies-11724391/22">absolutely horrible</a>, and <a href="http://danwebb.net/2011/5/28/it-is-about-the-hashbangs">it&rsquo;s just not how you should treat your URLs</a>.</p>
<p>The final chapter of the story, and the most relevant one for the History Listener, is brought about by the HTML5 standard. HTML5 introduced the <strong><a href="http://diveintohtml5.info/history.html">window.history</a></strong> API, which can be used to manually manipulate browser history when loading content dynamically. You can now manually push a state into the browser history, and when someone navigates with the browser&rsquo;s Back button to your page, you can look for stored states and load them in order, just like the default behavior of a static website.</p>
<p>The History Listener listens for changes in browser history. If it detects such a change event, it will tell you what happened, whether there&rsquo;s a state object stored in history, and if there was a URL fragment change involved. You can use this information to send virtual page views, prevent certain tags from firing again, serve dynamic tags, and basically anything that you&rsquo;d normally do when a page is loaded.</p>

                
                  <h2 id="set-up-the-history-listener">Set up the History Listener</h2>
<p>You set up the History Listener like you would <a href="https://www.simoahava.com/analytics/auto-event-tracking-google-tag-manager/">any other listener</a>.</p>
<ol>
<li>
<p>Create a new tag</p>
</li>
<li>
<p>Name it wisely</p>
</li>
<li>
<p>Set Tag Type to <strong>Event Listener &gt; History Listener</strong></p>
</li>
<li>
<p>Set firing rule to All pages (<strong>{{url}} matches regex .</strong>*)</p>
</li>
</ol>



<div style="aspect-ratio: 885 / 289;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/history-listener.jpg" title="The History Listener">
  
    <img class="fig-img" height="289" width="885" loading="lazy" src="https://www.simoahava.com/images/2014/03/history-listener.jpg#ZgotmplZ" alt="The History Listener">
  
    </a>
  
  
</div>


<p>And that&rsquo;s it. This will set your listener up on all pages to wait for the triggers that activate it.</p>
<p>You&rsquo;ll also notice that a bunch of new auto-event variables have been provided. You can use these to access properties of the history event change after the History Listener has fired. Read more about these in my <a href="https://www.simoahava.com/analytics/macro-guide-google-tag-manager/">Macro Guide</a>.</p>

                
                  <h2 id="the-triggers">The triggers</h2>
<p>The History Listener will activate every time one of the following occurs:</p>
<ul>
<li>
<p>Call to the <strong>window.history.pushState() method</strong></p>
</li>
<li>
<p>Call to the <strong>window.history.replaceState() method</strong></p>
</li>
<li>
<p>A <strong>popstate</strong> event is detected</p>
</li>
<li>
<p>The URL fragment (hash) changes</p>
</li>
</ul>
<p><strong>window.history.pushState()</strong> is used to add a state into the browser history stack. <strong>pushState()</strong> takes three arguments: a state object, a title, and a URL.</p>
<p>The state object is where you store details about the content, which you can use later to serve the same content to the returning visitor. The title is just a way to name the history entry, though it can be used with <strong>popstate</strong> to set the page title. The URL is what will appear in the address bar of your browser after the <strong>pushState()</strong> csll is completed. This is especially useful, because your site visitors can share this &ldquo;virtual&rdquo; URL, which can be then used to serve the correct content to visitors arriving via this link.</p>
<p><strong>window.history.replaceState()</strong> is pretty much the same as pushState(), except that it replaces the current history state with the new state.</p>
<p><strong>popstate</strong> is what occurs every time the active history entry changes. For example, the browser&rsquo;s Back and Forward buttons trigger <strong>popstate</strong>. If the history entry which is activated upon <strong>popstate</strong> was created by <strong>pushState()</strong> or <strong>replaceState()</strong>, the <strong>popstate</strong> event will have the stored state object as a property. You can use this object to serve the same content to people navigating through browser history to your AJAX site.</p>
<p><strong>Note!</strong> There are some differences as to how and when browsers send the <strong>popstate</strong>. Chrome and Safari, for example, fire a <strong>popstate</strong> with every page load (since that&rsquo;s when the active history entry changes), but Firefox doesn&rsquo;t. Firefox requires a history entry that was created by a <strong>pushState()</strong> or <strong>replaceState()</strong> call.</p>
<p><strong>URL fragment changes</strong> are remnants of the hashbang era, but fragments are still widely used on websites. For example, if you have internal anchor links, you&rsquo;ll trigger a fragment change event every time the visitor jumps to an anchor on your page. In AJAX sites, you can listen for fragment change events, and use these to send a page view or fire a tag of your choosing.</p>

                
                  <h2 id="event-equals-gtmhistorychange">{{event}} equals gtm.historyChange</h2>
<p>When the History Listener is running, and any of the events described in the previous chapter occur, a <em>gtm.historyChange</em> is pushed into the data layer. Most of the properties in this event can be accessed by the auto-event macros, but it&rsquo;s good to know what the data layer entry looks like.</p>
<p>Here&rsquo;s what your dataLayer object looks like after a pushState() event. Here, the state object I push is very simple. It contains just a single key-value pair, <strong>page: &ldquo;About Us&rdquo;</strong>.</p>



<div style="aspect-ratio: 288 / 157;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/pushstate.jpg" title="Data Layer after pushState()">
  
    <img class="fig-img" height="157" width="288" loading="lazy" src="https://www.simoahava.com/images/2014/03/pushstate.jpg#ZgotmplZ" alt="Data Layer after pushState()">
  
    </a>
  
  
</div>


<p>Here&rsquo;s what you dataLayer looks like after a replaceState() event. The parameters are the same as in pushState(). Note that I fired replaceState() just after pushState(), so you&rsquo;ll see the previous state object stored in the <strong>gtm.oldHistoryState</strong> property!</p>



<div style="aspect-ratio: 306 / 179;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/replacestate.jpg" title="Data Layer after replaceState()">
  
    <img class="fig-img" height="179" width="306" loading="lazy" src="https://www.simoahava.com/images/2014/03/replacestate.jpg#ZgotmplZ" alt="Data Layer after replaceState()">
  
    </a>
  
  
</div>


<p>Now, if I navigate away from the page and return with the browser Back button, a <strong>popstate</strong> event occurs with my state object neatly stored within:</p>



<div style="aspect-ratio: 276 / 180;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/popstate.jpg" title="Data Layer after popstate">
  
    <img class="fig-img" height="180" width="276" loading="lazy" src="https://www.simoahava.com/images/2014/03/popstate.jpg#ZgotmplZ" alt="Data Layer after popstate">
  
    </a>
  
  
</div>


<p>As you can see, the old state and the new state are the same, because I navigated away from the Contact page and arrived on the same page after clicking Back in my browser. When popstate occurs, I can look into the history state object and send the correct page view for the dynamic content. In this case, I can see that the visitor returned to the Contact page.</p>
<p>Finally, here&rsquo;s me navigating from one URL fragment to another:</p>



<div style="aspect-ratio: 278 / 123;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/fragmentchange.jpg" title="Data Layer after fragment change">
  
    <img class="fig-img" height="123" width="278" loading="lazy" src="https://www.simoahava.com/images/2014/03/fragmentchange.jpg#ZgotmplZ" alt="Data Layer after fragment change">
  
    </a>
  
  
</div>


<p>As you can see, I first went to the bottom of the page via URL fragment <strong>#bottom</strong>. This triggers a <strong>popstate</strong> event, with <strong>#bottom</strong> as gtm.newUrlFragment. After that, I clicked &ldquo;Back to top&rdquo;, which transported me to URL <strong>#backtotop</strong>, and this is reflected in the screenshot above.</p>

                
                  <h2 id="example-of-use">Example of use</h2>
<p>I&rsquo;ll show a quick example, expanding the idea of navigating to the &ldquo;Contact&rdquo; page, where the page details are stored in a state object, created using <strong>pushState()</strong>.</p>
<p>The premise is that when your visitor clicks a link to the &ldquo;Contact&rdquo; page, the contents are loaded dynamically. To account for history changes, the <strong>pushState()</strong> method is called with something like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> page = {page:<span style="color:#a50">&#34;Contact&#34;</span>};
history.pushState(page,<span style="color:#a50">&#39;Contact&#39;</span>,<span style="color:#a50">&#39;contact.html&#39;</span>);
</code></pre></div>
<p>This pushes a new entry into your browser history stack, with a single property within the state object. This property is the one we&rsquo;ll want to access in a <strong>popstate</strong> instance, i.e. when someone returns to the contact page via a history event (browser Back, for example).</p>
<ul>
<li>
<p>Make sure your History Listener is running</p>
</li>
<li>
<p>Create a new Data Layer Variable macro to identify what history event took place:</p>
</li>
</ul>



<div style="aspect-ratio: 651 / 526;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/history-change-source.jpg" title="History Change Source macro">
  
    <img class="fig-img" height="526" width="651" loading="lazy" src="https://www.simoahava.com/images/2014/03/history-change-source.jpg#ZgotmplZ" alt="History Change Source macro">
  
    </a>
  
  
</div>


<ul>
<li>Create a new Data Layer Variable macro to get the <strong>page</strong> property of the new history state:</li>
</ul>



<div style="aspect-ratio: 644 / 522;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/page-property.jpg" title="New macro for Page property">
  
    <img class="fig-img" height="522" width="644" loading="lazy" src="https://www.simoahava.com/images/2014/03/page-property.jpg#ZgotmplZ" alt="New macro for Page property">
  
    </a>
  
  
</div>


<ul>
<li>Create a new rule for your page view tag:</li>
</ul>



<div style="aspect-ratio: 449 / 293;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/rule-for-history-change.jpg" title="Rule for the History Change">
  
    <img class="fig-img" height="293" width="449" loading="lazy" src="https://www.simoahava.com/images/2014/03/rule-for-history-change.jpg#ZgotmplZ" alt="Rule for the History Change">
  
    </a>
  
  
</div>


<p>And that&rsquo;s it. You can attach this sequence to your page view tag, for example, ensuring that the page view is sent every time someone navigates back to your Contact content via browser history (see below for how to make sure the page view properties are in order).</p>
<p>The firing rule is important. You&rsquo;re looking for a <strong>gtm.historyChange</strong> event. This is pushed into the data layer when the History Listener is triggered. After that, you&rsquo;ll want to make sure that the event was <strong>popstate</strong> (the macro in (2)), and that the <strong>page</strong> property of the new history state has value &ldquo;Contact&rdquo;.</p>
<p>Now when you send a page view, the URL will be correctly contact.html (since you provide that in the pushState() call). However, your document title might be off, unless you explicitly set it in your AJAX logic. A nice way to send the page title is to use the Document Path setting in your page view tag, and populate it with the value of a Lookup Table macro, which in turn evaluates the <strong>page</strong> property again. Allow me to demonstrate:</p>



<div style="aspect-ratio: 479 / 391;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/page-view.jpg" title="Page View tag with document title">
  
    <img class="fig-img" height="391" width="479" loading="lazy" src="https://www.simoahava.com/images/2014/03/page-view.jpg#ZgotmplZ" alt="Page View tag with document title">
  
    </a>
  
  
</div>


<p>That&rsquo;s your page view tag. In the Document Title field, you&rsquo;re retrieving the value from a Lookup Table macro, which I&rsquo;ve named <strong>{{ AJAX - Page Title }}</strong>.</p>



<div style="aspect-ratio: 643 / 518;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2014/03/lookup-table-ajax.jpg" title="Lookup Table from AJAX Page Title">
  
    <img class="fig-img" height="518" width="643" loading="lazy" src="https://www.simoahava.com/images/2014/03/lookup-table-ajax.jpg#ZgotmplZ" alt="Lookup Table from AJAX Page Title">
  
    </a>
  
  
</div>


<p>This sets the page title depending on the <strong>page</strong> property, pushed into the data layer when the history listener is fired. You could set a default value to the Lookup Table macro, but on the other hand, if it doesn&rsquo;t return a value, the tag will just send whatever is found in the <strong>document.title</strong> property.</p>

                
                  <h2 id="conclusions">Conclusions</h2>
<p>Phew! This turned into a monster of a tutorial. But that&rsquo;s to be expected. Working with AJAX and dynamic content is not easy, as there are so many things to factor in. Not only are there usability and browser compatibility issues involved, you&rsquo;ll also need to take <a href="http://moz.com/blog/create-crawlable-link-friendly-ajax-websites-using-pushstate">search engines into account</a>, and you&rsquo;ll need to understand how history events work.</p>
<p>As always, I highly recommend that you brush up on your JavaScript before you start working with the History Listener. There&rsquo;s no damage to be done, but you don&rsquo;t want to screw your tracking by not understanding how state objects work, for example. Also, it&rsquo;s very likely that you&rsquo;ll have to return to your AJAX setup to make sure that pushState() calls and replaceState() calls provide all the necessary data for you to use.</p>
<p>Using the History Listener on a dynamic site is so much better than resorting to Link Click Listeners. More often than not, you&rsquo;ll come across <a href="https://www.simoahava.com/analytics/dont-gtm-listeners-work/">event propagation problems</a> with your listeners, since most of AJAX navigation is designed to prevent the default behavior of links. With the History Listener, you&rsquo;re only listening for browser history events, so on-page conflicts won&rsquo;t affect the listener&rsquo;s basic functionality.</p>
<p>You&rsquo;ll need to be careful and precise with your rules. Make use of all the properties of the gtm.historyChange event, because you&rsquo;ll want to do different things upon <strong>pushState()</strong> and <strong>popstate</strong>, for example.</p>
<p>And if you have any questions, drop me a mail or leave a comment below!</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/history-listener/">history listener</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/listeners/">listeners</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tags/">tags</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/gtm-listener-firing-order-test/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-tag-manager-playing-rules/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20The%20History%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-history-listener/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <a name="commento"></a>
<comentario-comments></comentario-comments>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2025 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/gtm-listener-firing-order-test/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-tag-manager-playing-rules/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20The%20History%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-history-listener/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
          <i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Google%20Tag%20Manager:%20The%20History%20Listener%20https://www.simoahava.com/analytics/google-tag-manager-history-listener/%20via%20@SimoAhava">
          <i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-tag-manager-history-listener/">
          <i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script defer src="https://comentario.simoahava.com/comentario.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>



    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

