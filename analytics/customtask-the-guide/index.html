

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "customTask - The Guide | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2018/02/customtask-the-guide.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/customtask-the-guide/",
  "datePublished": "2018-02-21T07:15:38+02:00",
  "dateModified": "2018-02-21T07:15:38+02:00",
  "description": "Guide to the customTask feature in Universal Analytics. Includes instructions how to use customTask, and how to combine multiple customTask solutions.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.42.2 with theme Tranquilpeak 0.4.3-BETA">
    <title>customTask - The Guide | Simo Ahava's blog</title>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/customtask-the-guide/">
    
    <meta name="description" content="Guide to the customTask feature in Universal Analytics. Includes instructions how to use customTask, and how to combine multiple customTask solutions.">
    <meta property="og:description" content="Guide to the customTask feature in Universal Analytics. Includes instructions how to use customTask, and how to combine multiple customTask solutions.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="customTask - The Guide">
    <meta property="og:url" content="/analytics/customtask-the-guide/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="customTask - The Guide">
    <meta name="twitter:description" content="Guide to the customTask feature in Universal Analytics. Includes instructions how to use customTask, and how to combine multiple customTask solutions.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2018/02/customtask-the-guide.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2018/02/customtask-the-guide.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      customTask - The Guide
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2018-02-21T07:15:38&#43;02:00">
        
  February 21, 2018

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/customtask-the-guide/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p><em>Last updated 23 August 2018</em></p>

<p>If you have been reading my blog articles over the past year, you might have noticed a disturbing trend. I&rsquo;ve published <a href="https://www.simoahava.com/tags/customtask/">9 articles on <code>customTask</code></a> since the API was released. It might not sound like much, but I can&rsquo;t think of a single feature in <a href="https://analytics.google.com/">Google Analytics</a> or <a href="https://tagmanager.google.com/">Google Tag Manager</a> that has so completely convinced me of its usefulness in such a short time.</p>

<p>The <code>customTask</code> API is a feature of the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">Universal Analytics library</a> (used by Google Tag Manager&rsquo;s tags, too). It lets you <code>get</code> and <code>set</code> values from and to the (Measurement Protocol) hit as it&rsquo;s being generated. This is really useful for a couple of reasons, which I&rsquo;ve covered in the previous articles, but I&rsquo;ll go over them briefly in the beginning of this guide, too.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/02/customtask-the-guide.png" title="customTask - The Guide">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2018/02/customtask-the-guide.png#ZgotmplZ" alt="customTask - The Guide">
  
    </a>
  
  
</div>



<p>Suffice to say that especially for Google Tag Manager, <code>customTask</code> adds a lot of value. With GTM, it&rsquo;s always been quite difficult to access the hit-building process when using tag templates. Luckily, <code>customTask</code> offers a solution to this problem, and at least for this particular developer it&rsquo;s opened a whole new world of Google Analytics customization.</p>

<p>However, in spite of writing all those articles on <code>customTask</code>, I recently realized that I never actually took the time to explain more thoroughly how it works. Also, I haven&rsquo;t yet shared solutions for combining multiple <code>customTask</code> tricks in a single tag. This guide seeks to address these points.</p>

<blockquote>
<p>Be sure to check out my <a href="https://www.simoahava.com/tools/customtask-builder/">customTask Builder</a> tool as well - it will help you compile the necessary JavaScript for <code>customTask</code> to run in your setup without conflicts!</p>
</blockquote>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#how-tasks-work">How Tasks work</a></li>
<li><a href="#things-you-can-do-with-customtask">Things you can do with <code>customTask</code></a>
<ul>
<li><a href="#1-set-client-id-as-a-custom-dimension">1. Set Client ID as a Custom Dimension</a></li>
<li><a href="#2-duplicate-google-analytics-tags-to-more-than-one-property">2. Duplicate Google Analytics tags to more than one property</a></li>
<li><a href="#3-track-offline-users-in-google-analytics">3. Track offline users in Google Analytics</a></li>
<li><a href="#4-remove-pii-from-ga-payloads">4. Remove PII from GA payloads</a></li>
<li><a href="#5-fix-site-speed-sampling-messing-with-your-custom-metrics">5. Fix site speed sampling messing with your Custom Metrics</a></li>
<li><a href="#6-respect-opt-out">6. Respect opt-out</a></li>
<li><a href="#7-send-details-about-optimize-experiments-to-google-analytics">7. Send details about Optimize experiments to Google Analytics</a></li>
<li><a href="#8-auto-link-domains-with-regular-expressions">8. Auto-link domains with regular expressions</a></li>
<li><a href="#9-send-google-analytics-payloads-to-snowplow">9. Send Google Analytics payloads to Snowplow</a></li>
<li><a href="#10-send-google-analytics-payload-length-as-a-custom-dimension">10. Send Google Analytics payload length as a Custom Dimension</a></li>
<li><a href="#11-send-hit-type-as-a-custom-dimension">11. Send Hit Type as a Custom Dimension</a></li>
<li><a href="#12-automatically-reduce-payload-length">12. Automatically reduce payload length</a></li>
<li><a href="#13-create-and-update-a-session-cookie">13. Create and update a session cookie</a></li>
</ul></li>
<li><a href="#putting-it-all-together-literally">Putting it all together (literally)</a></li>
<li><a href="#summary">Summary</a></li>
</ul></li>
</ul>
</nav>

<h2 id="how-tasks-work">How Tasks work</h2>

<p>When you run the <code>ga('send', 'pageview')</code> command either directly in your site JavaScript or indirectly via Google Tag Manager&rsquo;s Google Analytics tags, you actually request that the Universal Analytics JavaScript library (analytics.js) compile an HTTP request to the Google Analytics servers.</p>

<p>The endpoint to which the hits are sent is typically <code>/collect</code> on the Google Analytics collector domain. The process of building and sending hits to the GA servers is also known as <strong>Measurement Protocol</strong> (MP). In fact, MP is the underlying process used by <strong>all</strong> GA tracking mechanisms, be they the <code>ga('send'...)</code> JavaScript SDK, Google Tag Manager&rsquo;s GA tags, native SDKs for Android and iOS, and custom-built HTTP requests from point-of-sales systems, for example.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/02/tracker-process.png" title="Tracker process">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2018/02/tracker-process.png#ZgotmplZ" alt="Tracker process">
  
    </a>
  
  
</div>



<p>When you use the JavaScript SDK, either via <code>ga('send', 'pageview')</code> or the Google Analytics tags in GTM, you are thus initiating a sequence of processes, where the final product is the actual MP request to Google Analytics. This sequence comprises a number of <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks"><strong>tasks</strong></a>, of which <code>customTask</code> is the first one that is executed.</p>

<p>Here&rsquo;s a quick recap of what each task does, listed in the order they are applied to the hit.</p>

<table>
<thead>
<tr>
<th>Task</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>customTask</strong></td>
<td>No functionality of its own, but can be used to manipulate the <code>model</code> object before it is processed by the other tasks.</td>
</tr>

<tr>
<td><strong>previewTask</strong></td>
<td>If the request is generated from the pageview of a &ldquo;Top Sites&rdquo; thumbnail in Safari, abort the hit.</td>
</tr>

<tr>
<td><strong>checkProtocolTask</strong></td>
<td>Aborts the request if the page protocol is not valid (<strong>http</strong> or <strong>https</strong>).</td>
</tr>

<tr>
<td><strong>validationTask</strong></td>
<td>Checks if the fields in the request have valid and expected values. Aborts the request if this is not the case (e.g. trying to send a string as the Event Value).</td>
</tr>

<tr>
<td><strong>historyImportTask</strong></td>
<td>If there is still legacy tracking running on the site, this task imports information from the old GA library cookies into Universal Analytics. Very useful if the site is migrating to Universal Analytics.</td>
</tr>

<tr>
<td><strong>samplerTask</strong></td>
<td>If you&rsquo;ve decided to <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#sampleRate">manually sample</a> the users to stay within Google Analytics&rsquo; processing limits, this task aborts the request if the user is sampled out of data collection.</td>
</tr>

<tr>
<td><strong>buildHitTask</strong></td>
<td>Generates the <code>hitPayload</code> string, which is essentially the list of query parameters and their values passed to the Measurement Protocol request.</td>
</tr>

<tr>
<td><strong>sendHitTask</strong></td>
<td>Sends the <code>hitPayload</code> in a Measurement Protocol request to the GA servers.</td>
</tr>

<tr>
<td><strong>timingTask</strong></td>
<td>If you are automatically sampling pages for page speed measurements, this task sends the timing hit to Google Analytics.</td>
</tr>

<tr>
<td><strong>displayFeaturesTask</strong></td>
<td>If you have enabled display features in GA settings, this task compiles the request to the DoubleClick servers.</td>
</tr>
</tbody>
</table>

<p>Each tasks receives the <code>model</code> object as a parameter. The <code>model</code> object contains all the fields that have been set in the tracker, as well as any enhancements applied in the tasks themselves.</p>

<p>The beauty of <code>customTask</code> is that because it runs before any of the other tasks, you can use it to overwrite behavior of these other tasks. For example, if you want to <a href="https://www.simoahava.com/gtm-tips/gtmtips-deploy-gtm-chrome-extension/">run Google Analytics locally or in a Chrome Extension</a>, you&rsquo;ll need to make sure <code>checkProtocolTask</code> is never run, because it aborts the hit builder if the page protocol is not <strong>http</strong> or <strong>https</strong>. The <code>customTask</code> would look like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">customTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
  <span style="color:#75715e">// Prevent checkProtocolTask from running
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;checkProtocolTask&#39;</span>, <span style="color:#66d9ef">null</span>);
};
</code></pre></div>

<p>As you can see, the task is actually a field in the <code>model</code> object that you can manipulate just as you can manipulate any other field in the <code>model</code>. For example, if you want to grab the tracking ID (UA-XXXXXX-Y) and send it in the Custom Dimension with index 15, you can use the following <code>customTask</code>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">customTask</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
  <span style="color:#75715e">// Get the tracking ID from the model object
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">trackingId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;trackingId&#39;</span>);
  
  <span style="color:#75715e">// Set the tracking ID to Custom Dimension 15
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;dimension15&#39;</span>, <span style="color:#a6e22e">trackingId</span>);
};
</code></pre></div>

<p>To see what fields are available in the model object, check <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference">this developer documentation</a>. Note that it&rsquo;s not complete, since it&rsquo;s missing all the tasks.</p>

<p>By running these <code>model</code> interactions with <code>customTask</code>, you have a lot of control over how the task sequence is run. Especially with Google Tag Manager, it would be difficult to run any complicated logic for when and how to manipulate <code>sendHitTask</code>, if you applied it directly to the tag as a field.</p>

<h2 id="things-you-can-do-with-customtask">Things you can do with <code>customTask</code></h2>

<p>As written above, <code>customTask</code> is special for two reasons.</p>

<ol>
<li><p>It has no special functionality of its own. A task queue can and will run perfectly without <code>customTask</code> defined.</p></li>

<li><p>It runs before any other task, meaning you have full control over how the queue is processed.</p></li>
</ol>

<p>With these two things in mind, here&rsquo;s the list of all the <code>customTask</code> tricks I&rsquo;ve written about, with a description of what makes them special.</p>

<h3 id="1-set-client-id-as-a-custom-dimension">1. Set Client ID as a Custom Dimension</h3>

<p>Link to article: <a href="https://www.simoahava.com/gtm-tips/use-customtask-access-tracker-values-google-tag-manager/">#GTMTips: Use customTask To Access Tracker Values In Google Tag Manager</a>.</p>

<p>This is one of the simpler tricks. It doesn&rsquo;t manipulate the task queue itself at all, it simply <em>gets</em> the Client ID from the model object, and then <em>sets</em> it as the value of the specified Custom Dimension.</p>

<p>It&rsquo;s an elegant solution to a difficult problem. Without <code>customTask</code>, getting and setting the Client ID in a Google Analytics tag was difficult. If the tag is run for a first-time visitor who hasn&rsquo;t received a Client ID yet, the actual <code>clientId</code> field is not available when the regular tag fields are resolved. A typical hack for this solution was to fetch the Client ID by creating a <a href="https://www.simoahava.com/analytics/access-the-tracker-object-in-your-page-view-tag/">dummy tracker</a> or by sending the Client ID with an Event tag that fired after the Pageview.</p>

<p>But with <code>customTask</code>, there&rsquo;s no need for such unorthodox methods.</p>

<h3 id="2-duplicate-google-analytics-tags-to-more-than-one-property">2. Duplicate Google Analytics tags to more than one property</h3>

<p>Link to article: <a href="https://www.simoahava.com/gtm-tips/send-google-analytics-tag-multiple-properties/">#GTMTips: Send Google Analytics Tag To Multiple Properties</a>.</p>

<p>This is <code>customTask</code> at its purest. The <code>customTask</code> function first stores a reference to <code>sendHitTask</code> in a global variable, after which it overwrites <code>sendHitTask</code> in the current model object with the duplicator code.</p>

<p>The duplicator first lets the original hit fire to GA, after which it replaces the Tracking ID in the <code>hitPayload</code> with the Tracking ID of the second property. Then, the global <code>sendHitTask</code> is invoked again, and the hit is sent to the second property with an identical payload.</p>

<p><strong>Note!</strong> The reason the reference to <code>sendHitTask</code> is stored in a global variable is to avoid issues with field multiplication. Let&rsquo;s say you always use this to get the original <code>sendHitTask</code> reference:</p>

<p><code>var originalSendTask = model.get('sendHitTask');</code></p>

<p>Each time this <code>customTask</code> code is run, it will get a reference to what is stored in the model object&rsquo;s <code>sendHitTask</code>. Unfortunately, when building standard Ecommerce hits, or when automatically sampling timing hits, the tag is automatically sent more than once. Thus the reference to the original <code>sendHitTask</code> is recursively augmented with each iteration of <code>model.set('sendHitTask');</code>, resulting in code being executed erratically.</p>

<p>By having a global variable store the reference to the original <code>sendHitTask</code>, this recursive problem is avoided.</p>

<h3 id="3-track-offline-users-in-google-analytics">3. Track offline users in Google Analytics</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/track-users-who-are-offline-in-google-analytics/">Track Users Who Are Offline In Google Analytics</a>.</p>

<p>This is all <a href="https://www.thyngster.com/">David Vallejo</a>. His solution tackles the problem of lost internet connectivity and hits that are aborted because of this. It uses <code>customTask</code> to check if the user is offline, and if they are, the hits are stored in a batch queue. Once connectivity is restored, the queue is processed, and the hits are finally sent to GA.</p>

<h3 id="4-remove-pii-from-ga-payloads">4. Remove PII from GA payloads</h3>

<p>Link to article: <a href="https://www.simoahava.com/gtm-tips/remove-pii-google-analytics-hits/">#GTMTips: Remove PII From Google Analytics Hits</a>.</p>

<p>With GDPR coming soon, covering all your bases with regard to private data is a good idea. Fixing potential PII leaks before they hit Google Analytics servers is a good method as any to make sure you&rsquo;re complying with Google Analytics&rsquo; Terms of Service as well as the increasingly stricter regulations for sending and collecting personal data.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/02/redacted-email.png" title="Redacted email">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2018/02/redacted-email.png#ZgotmplZ" alt="Redacted email">
  
    </a>
  
  
</div>



<p>Here, <code>customTask</code> takes the hit payload before it is sent to GA, and purges it of all matches against any given regular expressions. These regular expressions can be built to match things like email addresses and social security numbers.</p>

<h3 id="5-fix-site-speed-sampling-messing-with-your-custom-metrics">5. Fix site speed sampling messing with your Custom Metrics</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/prevent-site-speed-sampling-rate-skewing-custom-dimensions-custom-metrics/">Prevent Site Speed Sampling Rate From Skewing Custom Dimensions And Custom Metrics</a>.</p>

<p>This is a fairly simple trick, but it fixes a potential issue with Custom Metric data being skewed by the automatically collected page timing hits. The issue is that the timing hit copies all parameters from the Page View tag that is being sampled, and thus any Custom Dimensions and Custom Metrics are sent more than once, too.</p>

<p>Here, <code>customTask</code> is attached to the Page View tag, where it checks if the hit type is <code>timing</code> (due to the automatically generated timing hit), and if it is, it removes all references to Custom Dimensions and Metrics from the request.</p>

<h3 id="6-respect-opt-out">6. Respect opt-out</h3>

<p>Link to article: <a href="https://www.simoahava.com/gtm-tips/respect-opt-out-from-advertising-and-analytics/">#GTMTips: Respect Opt-Out From Advertising And Analytics</a>.</p>

<p>A simple trick, again. This time <code>customTask</code> checks if the user has specific opt-out settings in the browser, and if they do, it aborts the requests to Google Analytics and DoubleClick. You&rsquo;ll need to manually create the setting itself, be it a pop-up that stores the opt-out in a browser cookie or something, but once you&rsquo;ve done it, this solution makes it easy to enact the opt-out programmatically.</p>

<h3 id="7-send-details-about-optimize-experiments-to-google-analytics">7. Send details about Optimize experiments to Google Analytics</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/send-event-custom-dimension-google-optimize-experiment-running/">Send Event And Custom Dimension If Google Optimize Experiment Is Running</a>.</p>

<p>This trick tackles an issue with how Google Optimize data is being reported in Google Analytics. Basically, the Experiment Name and Experiment ID dimensions are scoped to the user for the duration of the experiment. Thus it&rsquo;s not possible to get a segment of the actual sessions when the user was actively participating in an experiment page.</p>

<p>The <code>customTask</code> checks for certain features of the Page View tag it is attached to, and if these features are found, it updates a Custom Dimension in the hit payload with details about the experiment. You can then segment your GA data with these Custom Dimensions to see sessions where the user was actually active on an experiment page.</p>

<h3 id="8-auto-link-domains-with-regular-expressions">8. Auto-link domains with regular expressions</h3>

<p>Link to article: <a href="https://www.simoahava.com/gtm-tips/auto-link-domains-with-regex/">#GTMTips: Auto Link Domains With Regex</a>.</p>

<p>With this trick, <code>customTask</code> brings Google Tag Manager to feature parity with analytics.js. Regular, on-page Google Analytics tracking <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/linker#autolink">lets you use regular expressions</a> with the Auto-Link Domains plugin. Google Tag Manager only accepts string values.</p>

<p>Here, <code>customTask</code> actually applies the Auto-Link plugin to the tracker object itself, passing the array of regular expressions to the plugin. This way, domains can be automatically linked with cross-domain parameters based on a regular expression match, rather than an exhaustive list of strings.</p>

<h3 id="9-send-google-analytics-payloads-to-snowplow">9. Send Google Analytics payloads to Snowplow</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/automatically-fork-google-analytics-hits-snowplow/">#GTMTips: Automatically Duplicate Google Analytics Hits To Snowplow</a>.</p>

<p>I&rsquo;m a huge fan of <a href="https://snowplowanalytics.com">Snowplow</a>, mainly because it&rsquo;s open-source and tackles many difficult issues having to do with <a href="https://www.simoahava.com/analytics/the-schema-conspiracy/">sessionization and tracking schemas</a>. This trick uses <code>customTask</code> to replicate what the &ldquo;official&rdquo; Snowplow <a href="https://github.com/snowplow-incubator/snowplow-google-analytics-plugin">Google Analytics plugin</a> does.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/02/snowplow-open-source-img.png" title="Snowplow open source">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2018/02/snowplow-open-source-img.png#ZgotmplZ" alt="Snowplow open source">
  
    </a>
  
  
</div>



<p>Google Tag Manager doesn&rsquo;t support adding plugins to tags, so using <code>customTask</code> to replicate plugin features is as good a solution as any.</p>

<h3 id="10-send-google-analytics-payload-length-as-a-custom-dimension">10. Send Google Analytics payload length as a Custom Dimension</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/send-google-analytics-payload-length-as-custom-dimension/">Send Google Analytics Payload Length As Custom Dimension</a>.</p>

<p>This tip lets you collect the payload length of each Google Analytics request as a Custom Dimension in Google Analytics.</p>

<p>The maximum length of a Google Analytics payload is <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/reference#using-post">8192 bytes</a>. It&rsquo;s useful to check if you&rsquo;re approaching this value with some of your hits, because if the payload length exceeds this, the hit is never sent to Google Analytics.</p>

<p>Be sure to check my tip below on how to automatically reduce the payload length.</p>

<h3 id="11-send-hit-type-as-a-custom-dimension">11. Send Hit Type as a Custom Dimension</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/add-hit-type-custom-dimension/">#GTMTips: Add Hit Type As A Custom Dimension</a>.</p>

<p>With this trick, you can send the hit type (e.g. <code>pageview</code>, <code>event</code>, <code>timing</code>) as a Custom Dimension with every hit to which this <code>customTask</code> is attached.</p>

<p>Very useful for debugging, since you can now build segments where you directly refer to the hit type, which is not available (surprisingly) as a default dimension in Google Analytics.</p>

<h3 id="12-automatically-reduce-payload-length">12. Automatically reduce payload length</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/automatically-reduce-google-analytics-payload-length/">Automatically Reduce Google Analytics Payload Length</a>.</p>

<p>With this <code>customTask</code>, the payload sent to Google Analytics is automatically parsed and, if necessary, reduced to go under the maximum payload length of 8192 bytes.</p>

<p>It&rsquo;s very typical especially with Enhanced Ecommerce to send very long payloads to Google Analytics. Unfortunately, if these payloads exceed the maximum length, the hits are never sent and key data will thus be missing from your data set.</p>

<p>You can use this trick to recursively parse the payload and drop unnecessary parameters from it, which only serve to waste valuable space under the length cap.</p>

<h3 id="13-create-and-update-a-session-cookie">13. Create and update a session cookie</h3>

<p>Link to article: <a href="https://www.simoahava.com/analytics/create-and-update-google-analytics-session-timeout-cookie/">Create And Update Google Analytics Session Timeout Cookie</a>.</p>

<p>This trick creates (or updates) a browser cookie which expires after a timeout you have configured (30 minutes by default).</p>

<p>Each hit that uses this <code>customTask</code> will refresh the cookie very time the hit is fired.</p>

<p>Thus, if this cookie exists in the browser, it&rsquo;s an indication that there might well be a Google Analytics session active for the current user.</p>

<p>You can use the cookie to block event hits from being dispatched to Google Analytics if there is no active session, for example.</p>

<h2 id="putting-it-all-together-literally">Putting it all together (literally)</h2>

<blockquote>
<p><strong>NOTE!</strong> I&rsquo;ve built a <a href="https://www.simoahava.com/tools/customtask-builder/">tool</a> which you can use to compile the necessary JavaScript automatically. You&rsquo;ll still want to read through this chapter, though, as it explains why building the script can be a chore.</p>
</blockquote>

<p>If you like <code>customTask</code> as much as I do, chances are you&rsquo;ll want to use more than one trick listed above (and elsewhere) in your tags. There&rsquo;s a catch though. You need to respect the basic features of JavaScript, mainly:</p>

<ul>
<li><p>You can only <code>set</code> a single field once per tag, so you can only set one <code>customTask</code> field per tag.</p></li>

<li><p>You can only <code>set</code> a single model parameter once per tag, so you can only set one <code>sendHitTask</code> attribute per tag, for example.</p></li>
</ul>

<p>So, let&rsquo;s say you want to do both tricks (2) (<a href="#2-duplicate-google-analytics-tags-to-more-than-one-property">Send GA hit to more than one property</a>) and (4) (<a href="#4-remove-pii-from-ga-payloads">Remove PII from GA hits</a>). You might be tempted to try this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
  
    <span style="color:#75715e">// Specify the PII regular expressions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">piiRegEx</span> <span style="color:#f92672">=</span> [{
      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EMAIL&#39;</span>,
      <span style="color:#a6e22e">regex</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/.{4}@.{4}/g</span>
    }];
    
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">globalSendTaskName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;trackingId&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_originalSendTask&#39;</span>;
    
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">originalSendTask</span> <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">globalSendTaskName</span>] <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">globalSendTaskName</span>] <span style="color:#f92672">||</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>);
    
    <span style="color:#75715e">// Clear the payload from PII:
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">sendModel</span>) {
      
      ...
      
    });
    
    <span style="color:#75715e">// Duplicate the hit to another tracking ID:
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">sendModel</span>) {
      
      ...
      
    });
    
  };
}
</code></pre></div>

<p>Unfortunately, this would not work. You are setting the <code>sendHitTask</code> field twice, meaning the second one is the only one that counts (since it overwrites the first <code>set</code>).</p>

<p>Instead, you need to apply some JavaScript chops and combine both of these solutions in the same <code>sendHitTask</code>. It&rsquo;s not exactly trivial, and there&rsquo;s no textbook method for doing it. You&rsquo;ll need to figure out the order in which the code should be processed.</p>

<p>In this example, we want the PII purge to happen before any hits are sent or duplicated. So the final code would look something like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">model</span>) {
  
    <span style="color:#75715e">// Specify the PII regular expressions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">piiRegEx</span> <span style="color:#f92672">=</span> [{
      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;EMAIL&#39;</span>,
      <span style="color:#a6e22e">regex</span><span style="color:#f92672">:</span> <span style="color:#e6db74">/.{4}@.{4}/g</span>
    }];
  
    <span style="color:#75715e">// Specify the GA tracking ID of the property to which you want to duplicate the hits
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newTrackingId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;UA-12345-2&#39;</span>;
  
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">globalSendTaskName</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;_&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;trackingId&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_originalSendTask&#39;</span>;
  
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">originalSendTask</span> <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">globalSendTaskName</span>] <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">globalSendTaskName</span>] <span style="color:#f92672">||</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>);
  
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">hitPayload</span>, <span style="color:#a6e22e">parts</span>, <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">oldTrackingId</span>;
  
    <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;sendHitTask&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">sendModel</span>) {
  
      <span style="color:#75715e">// Clear the payload of PII:
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">hitPayload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sendModel</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;&amp;&#39;</span>);
    
      <span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">hitPayload</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
        <span style="color:#a6e22e">parts</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hitPayload</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;=&#39;</span>);
      
        <span style="color:#75715e">// Double-decode, to account for web server encode + analytics.js encode
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">val</span> <span style="color:#f92672">=</span> decodeURIComponent(decodeURIComponent(<span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">1</span>]));
      
        <span style="color:#a6e22e">piiRegEx</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">pii</span>) {
          <span style="color:#a6e22e">val</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">pii</span>.<span style="color:#a6e22e">regex</span>, <span style="color:#e6db74">&#39;[REDACTED &#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pii</span>.<span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;]&#39;</span>);
        });
      
        <span style="color:#a6e22e">parts</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> encodeURIComponent(<span style="color:#a6e22e">val</span>);
        <span style="color:#a6e22e">hitPayload</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">parts</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;=&#39;</span>);
      }
    
      <span style="color:#a6e22e">sendModel</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>, <span style="color:#a6e22e">hitPayload</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;&amp;&#39;</span>), <span style="color:#66d9ef">true</span>);
      <span style="color:#a6e22e">originalSendTask</span>(<span style="color:#a6e22e">sendModel</span>);
    
      <span style="color:#75715e">// Rewrite the tracking ID
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">hitPayload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sendModel</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>);
      <span style="color:#a6e22e">oldTrackingId</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RegExp(<span style="color:#a6e22e">sendModel</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;trackingId&#39;</span>), <span style="color:#e6db74">&#39;gi&#39;</span>);
      <span style="color:#a6e22e">sendModel</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;hitPayload&#39;</span>, <span style="color:#a6e22e">hitPayload</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#a6e22e">oldTrackingId</span>, <span style="color:#a6e22e">newTrackingId</span>), <span style="color:#66d9ef">true</span>);
      <span style="color:#a6e22e">originalSendTask</span>(<span style="color:#a6e22e">sendModel</span>);
    });
  };
}
</code></pre></div>

<p>The code is fairly complex, and complexity increases with each distinct trick you want to run. This is an unfortunate consequence of the limitations of JavaScript and the fact that there is only one <code>customTask</code> to manipulate.</p>

<p>In the end, it&rsquo;s really up to your JavaScript skills. You&rsquo;ll need to be aware of how the browser runs the code line-by-line, and thus you&rsquo;ll need to make sure that whatever you want to run first is also executed first by the browser. That&rsquo;s why in the example above I have the PII purge running before the hit duplication. If the PII purge happened AFTER the hit is duplicated, it would be redundant, since it would still allow PII to potentially flow to Google Analytics.</p>

<h2 id="summary">Summary</h2>

<p>As I wrote in the beginning, <code>customTask</code> is one of the nicest features to emerge in Google Analytics in a long time. With Google Tag Manager, it&rsquo;s a real powerhouse of customization.</p>

<p>It&rsquo;s a good idea to read about the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">Task queue</a> in general. Understanding how tasks work will give you great insight into how analytics.js compiles and dispatches hits to Google Analytics. Once you have a good grasp on all the different moving parts of the Tasks queue, you should be able to come up with cool <code>customTask</code> solutions of your own, which you can then share in the comments of this article, for example!</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/customtask/">customtask</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tasks/">tasks</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/check-for-undefined-value/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/edit-google-analytics-tag-settings/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=customTask%20-%20The%20Guide%20https://www.simoahava.com/analytics/customtask-the-guide/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/check-for-undefined-value/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/edit-google-analytics-tag-settings/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=customTask%20-%20The%20Guide%20https://www.simoahava.com/analytics/customtask-the-guide/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customtask-the-guide/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=customTask%20-%20The%20Guide%20https://www.simoahava.com/analytics/customtask-the-guide/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customtask-the-guide/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

