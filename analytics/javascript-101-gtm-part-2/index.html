

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "JavaScript 101 For GTM: Part 2 | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2014\/07\/browser-function.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/javascript-101-gtm-part-2\/",
  "datePublished": "2014-08-20T06:50:10\u002b00:00",
  "dateModified": "2014-08-20T06:50:10\u002b00:00",
  "description": "Second part of a two-part post which introduces core JavaScript concepts for Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>JavaScript 101 For GTM: Part 2 | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/javascript-101-gtm-part-2/">
    
    <meta name="description" content="Second part of a two-part post which introduces core JavaScript concepts for Google Tag Manager.">
    <meta property="og:description" content="Second part of a two-part post which introduces core JavaScript concepts for Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript 101 For GTM: Part 2">
    <meta property="og:url" content="https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="JavaScript 101 For GTM: Part 2">
    <meta name="twitter:description" content="Second part of a two-part post which introduces core JavaScript concepts for Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2014/07/browser-function.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2014/07/browser-function.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      JavaScript 101 For GTM: Part 2
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2014-08-20T06:50:10Z">
        
  August 20, 2014

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-2/#commento">Comments</a>
      
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>It&rsquo;s been an awesome summer, with temperatures soaring in the global warming range throughout our northern country. The heat has given me ample reason to not be near a computer, but now it&rsquo;s time to mine some JavaScript wisdom again. Here&rsquo;s the second part of my JavaScript for <a href="http://www.google.com/tagmanager">Google Tag Manager</a> series. The <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">first part</a> focused on GTM specific tips and tricks, and I hope that while reading it, you were treated to another grand example of the flexibility of this wonderful tool.</p>
<p>This second part was supposed to be more about general JavaScript practices, but I saw myself going back to the DOM with every step. So the theme here is the elusive Document Object Model. It&rsquo;s a defining quality of JavaScript in web development, and understanding its mechanics is key to understanding how tag management solutions work as well.</p>
<p>Here&rsquo;s the list of topics:</p>
<ol>
<li>
<p>The Document Object Model (DOM)</p>
</li>
<li>
<p>The DOM API</p>
</li>
<li>
<p>JavaScript injection + GTM</p>
</li>
<li>
<p>Handling false</p>
</li>
</ol>
<p>Here we go again. I implore you to take a look at the <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">list of resources</a> I linked to in the previous post. They should serve you really well in your journey towards JavaScript enlightenment.</p>
<h2 id="1-the-document-object-model-dom">1. The Document Object Model (DOM)</h2>
<p>Here&rsquo;s a very, very simplified account of how a browser works:</p>
<ol>
<li>
<p>The browser sends a request to the web server to retrieve a web document</p>
</li>
<li>
<p>This document is just an annotated source code file, so it needs to be parsed into a format the browser can interpret</p>
</li>
<li>
<p>The document is parsed into a parsed node tree, whose syntax is very standardized</p>
</li>
<li>
<p>The node tree is then rendered as a web page, which can be viewed in the browser window</p>
</li>
<li>
<p>The node tree is actually the Document Object Model (DOM), which also provides an interface for interacting with elements in the tree</p>
</li>
</ol>
<p>In short, what you see when looking at the <strong>page source</strong> of a web page in your browser is just that: the source code of the page. It isn&rsquo;t the <em>final</em> product, since the source code is parsed into a format which can be better understood by browsers.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/07/browser-function.jpg" title="How a browser works">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/07/browser-function.jpg#ZgotmplZ" alt="How a browser works">
  
    </a>
  
  
</div>


<p>If you&rsquo;ve messed around with a tag management system or with JavaScript, chances are you already know all this. The DOM is both a representation of on-page elements and an <em>interface</em> (more on this in the next chapter) which describes a standard for interacting with these elements. It&rsquo;s called the Document <strong>Object</strong> Model because the HTML elements you lovingly create in your source code are represented as objects, or nodes, or branches of a tree, in a top-level object called <strong>document</strong>. So when you <em>tag</em> a section of text as a DIV element in HTML, you are actually creating a new node with tag name DIV into the document hierarchy as a new element that can be interacted with.</p>
<p>So the DOM and your HTML document are related, in that they share the same elements, but they are not the same thing. The DOM is the browser&rsquo;s interpretation of the HTML document. The fact that it&rsquo;s standardized makes sure that all your sloppiness in HTML markup is glossed over in a perfectly structured DOM.</p>
<p>If you want to take a look at what the document object looks like for any given page, just open a JavaScript console, type <code>document</code> and press enter.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/07/document-object.jpg" title="Document Object in JavaScript Console">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/07/document-object.jpg#ZgotmplZ" alt="Document Object in JavaScript Console">
  
    </a>
  
  
</div>


<p>Almost all JavaScript that interacts with a page (such as analytics tags) utilizes the DOM. This is because representing a document with a collection of objects allows for scripting languages such as JavaScript to mimic the syntax of more traditional, object-oriented programming languages. Also, using a standardized set of objects and functions in the DOM normalizes the potentially chaotic and horrible markup that many, many web pages out there display.</p>
<p>The thing about the DOM is that if you understand its basic functions and if you read up on the standard, you should be inspired to create better markup as well. If the ID attribute was just a CSS selector to you before, after realizing what a crucial part it plays in the unique identification of a single DOM node, you&rsquo;ll be more inclined (hopefully) to utilize it in the future in all relevant markup situations.</p>
<p>The DOM is a huge standard and there&rsquo;s lots to learn. The best way to learn is to inspect objects in the model by utilizing the JavaScript console. Reading up on GTM articles is a good way to brush up your skills as well, since almost all GTM customizations have to do with manipulating the DOM in some way.</p>
<p>There&rsquo;s also the Browser Object Model (BOM), which is a de facto standard for interacting with the browser window. The BOM houses the <strong>window</strong> object, which, in turn, contains all the global variables and functions of the page AND the document object. So when you type <code>document</code> in the JavaScript console, you are actually accessing the <code>window.document</code> object.</p>
<p>Confusing? Perhaps, but in the end it&rsquo;s all quite logical. The DOM is a necessary interface between the client and the HTML document, because so much of today&rsquo;s web development revolves around dynamic and often subtle modification of the web pages. That&rsquo;s how you get your animations, transitions, event handlers and so forth to work.</p>
<p><strong>FURTHER READING:</strong></p>
<ul>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">Document Object Model description (MDN)</a></p>
</li>
<li>
<p><a href="http://www.w3schools.com/js/js_htmldom.asp">W3Schools HTML DOM guide</a></p>
</li>
<li>
<p><a href="http://www.w3schools.com/js/js_window.asp">JavaScript Window - the Browser Object Model (W3Schools)</a></p>
</li>
</ul>
<h2 id="2-the-dom-api">2. The DOM API</h2>
<p>The DOM API is actually the DOM itself (remember, it&rsquo;s a standard for interacting with the document), but for clarity&rsquo;s sake I use the term API here (<strong>a</strong>pplication <strong>p</strong>rogramming <strong>i</strong>nterface). Interacting with the document is done via the methods and objects exposed by the API.</p>
<p>When using JavaScript (as most often is the case) to interact with the DOM, all calls should naturally be in the context of a <code>&lt;script&gt;</code> element. This means that you either fetch the JavaScript in the declaration itself, or you add the code inline. Certain attributes such as &ldquo;onclick&rdquo; allow you to add JavaScript directly to the context of a HTML element without using <code>&lt;script&gt;</code>, but the most common instance is having the <code>&lt;script&gt;</code> tag in place.</p>
<p>There are many functions and objects you can access via the DOM, so I won&rsquo;t go into too much detail here. However, I will add an example of what DOM manipulation means in terms of HTML vs. JavaScript. Here&rsquo;s a typical HTML passage in a normal web page:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;content&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">span</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;header&#34;</span>&gt;Why Four Strings Is Enough&lt;/<span style="color:#1e90ff;font-weight:bold">span</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">p</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;paragraph&#34;</span>&gt;Many dismiss the ukulele because it only has four strings. However, it has more strings than a typical balalaika.&lt;/<span style="color:#1e90ff;font-weight:bold">p</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;request-access&#34;</span>&gt;
    &lt;<span style="color:#1e90ff;font-weight:bold">p</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;paragraph&#34;</span>&gt;Request access to ukulele vault by sending mail to &lt;<span style="color:#1e90ff;font-weight:bold">span</span> <span style="color:#1e90ff">class</span>=<span style="color:#a50">&#34;email&#34;</span>&gt;uku@lele.com&lt;/<span style="color:#1e90ff;font-weight:bold">span</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">p</span>&gt;
  &lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;</code></pre></div>
<p>So there are some unique elements where I utilize the ID attribute, and some elements which are reused, represented by the CLASS attribute. It&rsquo;s important to remember that if you use ID, you should only ever have one such element on the page. Otherwise you will make life difficult for anyone wishing to manipulate the element using the DOM API (plus it won&rsquo;t be valid HTML).</p>
<p>Here are some examples of JavaScript functions I can use to interact with the document:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> content = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;content&#34;</span>);
</code></pre></div>
<p>This stores the whole #content node with all its children into the JavaScript variable <code>content</code>. I can then use other functions of the DOM to manipulate the node further.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">content.setAttribute(<span style="color:#a50">&#34;id&#34;</span>, <span style="color:#a50">&#34;main-content&#34;</span>);
</code></pre></div>
<p>Changes the ID attribute of the #content DIV to #main-content. Here I utilize the JavaScript object where I stored the entire #content node just before.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> classArray = <span style="color:#0aa">document</span>.getElementsByClassName(<span style="color:#a50">&#34;paragraph&#34;</span>);
</code></pre></div>
<p>Stores all elements with CLASS .paragraph in an Array object referred to as <code>classArray</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">console.log(classArray[<span style="color:#099">0</span>].innerHTML);
</code></pre></div>
<p>Writes the entire HTML content of the first P element with class .paragraph into the console.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">alert(<span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;request-access&#34;</span>).children.length);
</code></pre></div>
<p>Pops up a dialog box with the number of child nodes for the HTML element with ID #request-access. In this case, the alert will contain the number 1.</p>
<p>There are many, many ways to interact with the document, its objects and functions using the interface of the DOM. You should be pretty comfortable with these especially if you want to do some advanced tag management and web analytics tweaking.</p>
<p><strong>FURTHER READING:</strong></p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element">Functions and properties of individual elements in the document (MDN)</a></li>
</ul>
<h2 id="3-javascript-injection--gtm">3. JavaScript injection + GTM</h2>
<p>Now that you understand perfectly how the DOM works, you&rsquo;re ready for the next big thing: code injection.</p>
<p>The whole premise of a JavaScript tag management system revolves around code injection. That&rsquo;s why you&rsquo;re fine with just adding <a href="https://www.simoahava.com/analytics/container-snippet-gtm-secrets-revealed/">the container snippet</a> into your source code when installing GTM. By adding this seemingly harmless piece of code into your source code, you&rsquo;re actually giving permission to the <strong>gtm.js</strong> library to inject more and more code, elements, and functions into your DOM.</p>
<p>And what is this injected code? Your tags and macros, of course!</p>
<p>Let&rsquo;s see how injection works with a simple example of adding a new <code>&lt;script&gt;</code> node into the HEAD of the document:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> s = <span style="color:#0aa">document</span>.createElement(<span style="color:#a50">&#34;script&#34;</span>);
s.innerHTML = <span style="color:#a50">&#34;alert(&#39;Injection successful&#39;);&#34;</span>;
<span style="color:#0aa">document</span>.head.appendChild(s);
</code></pre></div>
<ol>
<li>
<p>Line 1: A new SCRIPT element is created, but it isn&rsquo;t attached anywhere yet</p>
</li>
<li>
<p>Line 2: Some code is added into the content of the new tag</p>
</li>
<li>
<p>Line 3: The new element is added as the last child of the document HEAD</p>
</li>
</ol>
<p>If you copy-paste this code into a JavaScript console, you should see the pop-up dialog with &ldquo;Injection successful&rdquo;.</p>
<p>In this code you utilize the DOM with <code>createElement()</code> and <code>appendChild()</code> functions, the <code>innerHTML</code> property, and the <code>document</code> and <code>document.head</code> elements in the tree. If you now look at your elements (not the source code) by opening the developer tools of your favorite browser, you should see this new element as the last child of the HEAD.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/07/injection-example.jpg" title="Example of code injection">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/07/injection-example.jpg#ZgotmplZ" alt="Example of code injection">
  
    </a>
  
  
</div>


<p>All the Custom HTML tags you create via GTM are added to you page in a similar fashion. When you visit a page where such a tag is set to fire, the script is injected the moment the firing rule triggers. Any code in the tag is run there and then.</p>
<p>This also highlights the dangers of using a tag management solution to fix / hack errors in your web page. Code injection is brutal in the sense that any code within is run verbatim. There are no default checks in place to prevent your code from messing with global objects or your carefully crafted content. Since the DOM API opens <strong>all</strong> elements in the tree for manipulation, it&rsquo;s very easy to create AND destroy something beautiful.</p>
<p>So be careful.</p>
<p><strong>FURTHER READING:</strong></p>
<ul>
<li>
<p><a href="https://www.simoahava.com/analytics/container-snippet-gtm-secrets-revealed/">The Container Snippet: GTM Secrets Revealed</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/document.createElement">document.createElement() with examples (MDN)</a></p>
</li>
</ul>
<h2 id="4-handling-false">4. Handling false</h2>
<p>This was all too easy so far, so I&rsquo;ll leave you with something truly mind-boggling.</p>
<p>I&rsquo;ve written about this phenomenon <a href="https://www.simoahava.com/analytics/fun-with-google-tag-manager-part-1/">before</a>, and I still think its key to understanding how GTM and JavaScript work together.</p>
<p>First of all, I apologize in advance. JavaScript&rsquo;s treatment of &ldquo;falsy&rdquo; values such as undefined, null, and false is notoriously difficult to understand. Not only is it difficult to understand, it&rsquo;s even more difficult to teach in an understandable manner.</p>
<p>When talking about &ldquo;truthy&rdquo; and &ldquo;falsy&rdquo; values, we&rsquo;re not talking strictly about values which are either <em>true</em> or <em>false</em>. Rather, we mean values which are coerced to either <em>true</em> or <em>false</em> in a Boolean context. Boolean is a type which holds either <em>true</em> or <em>false</em> as its value, and a context is Boolean if some statement hinges on whether the expression evaluates to either <em>true</em> or <em>false</em>.</p>
<p>An if-clause is probably the most used Boolean context. The following piece of code is a prototypical example of type coercion:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">if</span>(t) {
  ...<span style="color:#00a">do</span> something <span style="color:#00a">if</span> t evaluates to <span style="color:#00a">true</span>...
} <span style="color:#00a">else</span> <span style="color:#00a">if</span> (!t) {
  ...<span style="color:#00a">do</span> something <span style="color:#00a">if</span> t evaluates to <span style="color:#00a">false</span>...
}
</code></pre></div>
<p>The if-clause is run if <code>t</code> is <em>true</em>, but it doesn&rsquo;t mean the <em>value</em> of <code>t</code> needs to be <em>true</em>. Rather, the value of <code>t</code> needs to be &ldquo;truthy&rdquo;. The else-clause is run if the value is not &ldquo;truthy&rdquo; but &ldquo;falsy&rdquo; (oh my those are stupid terms).</p>
<p>So in this context, <code>t</code> is coerced to Boolean values. It&rsquo;s easier to go through the values which evaluate to <em>false</em>, since there are only six of them.</p>
<p><strong>undefined<br>
null<br>
false<br>
0<br>
&quot;&rdquo;<br>
NaN</strong></p>
<p>So if a variable holds any of these values, it would evaluate to <em>false</em> in a Boolean context.</p>
<p>Still with me? Good. For GTM, we are particularly interested in the values <strong>undefined</strong> and <strong>null</strong>.</p>
<p><strong>undefined</strong> is a value (and a type, actually) reserved for variables which have either been declared but have no type assigned to them (via value assignment), OR have not been declared at all. This is very relevant for JavaScript, since often and especially with dynamic web pages many variables receive a value and type only after a specific user interaction (such as a click). If a function is executed before such an interaction and without the check for undefined, the function execution will fail in an ugly JS error.</p>
<p>The two simplest ways to safeguard your variable execution are:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">if</span>(!t) {
  alert(<span style="color:#a50">&#34;t is falsy and perhaps undefined!&#34;</span>);
}
<span style="color:#00a">if</span>(<span style="color:#00a">typeof</span>(t) === <span style="color:#00a">undefined</span>) {
  alert(<span style="color:#a50">&#34;t is undefined or has not been declared!&#34;</span>);
}
</code></pre></div>
<p>The difference is that using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators#Logical_operators">logical not operator</a> (!) is recommended when you know the variable has been declared but are not certain if it has a value assigned yet, whereas the <strong>typeof()</strong> operator should be used when you are not certain if the variable has been declared at all.</p>
<p>The logical not operator is literally &ldquo;not&rdquo;, so <code>if(!t) { ... }</code> is read as <strong>if (t is false is true) { &hellip;run this code&hellip; }</strong>. Thus, the if-clause is only run if <code>t</code> is one of the &ldquo;falsy&rdquo; values listed in the beginning of this chapter.</p>
<p>I can see your head spinning - again, I apologize!</p>
<p>The thing is, you shouldn&rsquo;t really use <code>typeof(var)===undefined</code>, since you should always be able to see whether a variable has been declared either by looking at the immediate local function context or by looking for the variable in the global object.</p>
<p>Yes, let me explain this as well.</p>
<p>JavaScript has static scope. This means that variables are either always global or scoped to the function they are wrapped in. If a variable is scoped to a function and if you&rsquo;ve observed best practices in your programming, you should quickly see whether or not a variable has been declared by the time your code is run.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> globalVar; <span style="color:#aaa;font-style:italic">// global variable
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">function</span> t() {
  <span style="color:#00a">var</span> localVar; <span style="color:#aaa;font-style:italic">// local variable
</span><span style="color:#aaa;font-style:italic"></span>  secondVar; <span style="color:#aaa;font-style:italic">// global but bad code
</span><span style="color:#aaa;font-style:italic"></span>}
alert(localVar); <span style="color:#aaa;font-style:italic">// error since trying to access local variable outside function
</span></code></pre></div>
<p>Another thing to note is that if a variable is scoped globally, it will be a property of the global <code>window</code> object. Thus, you can use the logical not operator to check for its absence:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">if</span>(!<span style="color:#0aa">window</span>.t) { something... } <span style="color:#aaa;font-style:italic">// run something if t is not a global variable
</span><span style="color:#aaa;font-style:italic"></span>...
<span style="color:#00a">if</span>(!t) { something... } <span style="color:#aaa;font-style:italic">// referenceError if t is not a global variable
</span></code></pre></div>
<p><strong>When working with GTM and GA</strong>, a very important thing to understand is how the DOM API works with elements that are not found on the page. You see, a function such as <code>getElementById()</code> or <code>getElementsByTagName()</code> will <strong>always</strong> return an object. An object, if you remember, was not among the &ldquo;falsy&rdquo; values listed in the beginning. However, this object will have the special value <strong>null</strong> if the actual HTML element is not found on the page.</p>
<p>If you stretch your memory again, <strong>null</strong> was among the values that are &ldquo;falsy&rdquo;. Thus:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> t = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;test&#34;</span>), <span style="color:#aaa;font-style:italic">// &#34;test&#34; exists, will return the DOM element
</span><span style="color:#aaa;font-style:italic"></span>    y = <span style="color:#0aa">document</span>.getElementById(<span style="color:#a50">&#34;testy&#34;</span>); <span style="color:#aaa;font-style:italic">// &#34;testy&#34; does not exist, will return object with value null
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">if</span>(<span style="color:#00a">typeof</span>(<span style="color:#a50">&#34;t&#34;</span>) === <span style="color:#00a">undefined</span>) { <span style="color:#aaa;font-style:italic">// does nothing
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;t is undefined&#34;</span>);
}
<span style="color:#00a">if</span>(!t) { <span style="color:#aaa;font-style:italic">// does nothing
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;t resolves to false&#34;</span>); 
}
<span style="color:#00a">if</span>(t===<span style="color:#00a">null</span>) { <span style="color:#aaa;font-style:italic">// does nothing
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;t is null&#34;</span>);
}
<span style="color:#00a">if</span>(<span style="color:#00a">typeof</span>(<span style="color:#a50">&#34;y&#34;</span>) === <span style="color:#00a">undefined</span>) { <span style="color:#aaa;font-style:italic">// does nothing
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;y is undefined&#34;</span>);
}
<span style="color:#00a">if</span>(!y) { <span style="color:#aaa;font-style:italic">// will alert the following message
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;y resolves to false&#34;</span>);
}
<span style="color:#00a">if</span>(y===<span style="color:#00a">null</span>) { <span style="color:#aaa;font-style:italic">// will alert the following message
</span><span style="color:#aaa;font-style:italic"></span>  alert(<span style="color:#a50">&#34;y is null&#34;</span>);
}
</code></pre></div>
<p>So the tips of this chapter are:</p>
<p>**1.**Use the global window object and the logical not operator as a fallback in case a variable hasn&rsquo;t been declared in global scope.</p>
<p><strong>2.</strong> Read through your code to see if a variable has been declared in local (function) scope OR if you&rsquo;re lazy, use the fallback <code>if(typeof(variable)===undefined) { do something; }</code>.</p>
<p><strong>3.</strong> Either use the logical not operator with a DOM element, e.g. if(!someDOMElement), OR check for null, e.g. if(someDOMElement===null), to fall back in case a DOM element you are referencing is not found in the DOM.</p>
<p>You don&rsquo;t want to write a long block of code only to see it miserably explode in JavaScript error mayhem thanks to race conditions or faulty declarations.</p>
<p><strong>FURTHER READING:</strong></p>
<ul>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators#Logical_operators">JavaScript logical operators (MDN)</a></p>
</li>
<li>
<p><a href="http://www.w3schools.com/jsref/jsref_undefined.asp">JavaScript undefined (W3Schools)</a></p>
</li>
<li>
<p><a href="http://designpepper.com/blog/drips/truthy-and-falsy-values-in-javascript.html">Truthy and falsy values in JavaScript</a></p>
</li>
</ul>
<h2 id="5-conclusions">5. Conclusions</h2>
<p>I&rsquo;m a huge, HUGE fan of JavaScript. I love it so much I&rsquo;m seriously considering naming my first-born with initials that spell JS (Jebediah Simo, for example). I also think that anyone wanting to extend the capabilities of Google Analytics, and DEFINITELY anyone working with Google Tag Manager, should understand at least the basics.</p>
<p>There&rsquo;s a lot to learn, and the splintered mess of cross-browser issues doesn&rsquo;t make it any easier. However, lots of ridiculously smart engineers are working on the standard, so if things go smoothly, we should see some pretty cool and facilitating additions in the next release of the language.</p>
<p>Remember, an excellent place for advice on JavaScript, especially related to GA and GTM, is Google+. Be sure to follow the communities, and drop a line if you need any assistance with your code.</p>
<p><a href="https://plus.google.com/u/0/communities/114481059214254340537">Google Analytics community in Google+</a></p>
<p><a href="https://plus.google.com/u/0/communities/104865292981489764063">Google Tag Manager community in Google+</a></p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/best-practices/">best practices</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-event-listeners-gtm/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/internalize-google-analytics-v1-0/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%202%20https://www.simoahava.com/analytics/javascript-101-gtm-part-2/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-event-listeners-gtm/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/internalize-google-analytics-v1-0/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%202%20https://www.simoahava.com/analytics/javascript-101-gtm-part-2/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%202%20https://www.simoahava.com/analytics/javascript-101-gtm-part-2/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

