

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Measure Ad And Content Blocker Impact | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2015\/10\/adblock.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/measure-ad-content-blocker-impact-on-traffic\/",
  "datePublished": "2015-10-02T08:52:11\x2b00:00",
  "dateModified": "2015-10-02T08:52:11\x2b00:00",
  "description": "How to measure ad and content blocker impact on your Google Analytics tracking using Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.59.1 with theme Tranquilpeak 0.4.3-BETA">
    <title>Measure Ad And Content Blocker Impact | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/measure-ad-content-blocker-impact-on-traffic/">
    
    <meta name="description" content="How to measure ad and content blocker impact on your Google Analytics tracking using Google Tag Manager.">
    <meta property="og:description" content="How to measure ad and content blocker impact on your Google Analytics tracking using Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Measure Ad And Content Blocker Impact">
    <meta property="og:url" content="/analytics/measure-ad-content-blocker-impact-on-traffic/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Measure Ad And Content Blocker Impact">
    <meta name="twitter:description" content="How to measure ad and content blocker impact on your Google Analytics tracking using Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/10/adblock.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/10/adblock.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Measure Ad And Content Blocker Impact
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-10-02T08:52:11Z">
        
  October 2, 2015

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p>So, looks like iOS 9 has built-in support for integrating &ldquo;<a href="https://developer.apple.com/videos/wwdc/2015/?id=511">content blocking</a>&rdquo; extensions on your iPhone. Now, blocking ads and other intrusive content is nothing new, nor do I want to get into a debate about whether it&rsquo;s a good thing or not. But as a data geek I&rsquo;m very interested in knowing just what share of my site tracking has some content blocker enabled. In this post, I&rsquo;ll show two tricks (easy and advanced) to expose these content blockers. It&rsquo;s always a good idea to keep tabs on the numbers, especially if you&rsquo;re concerned about them blocking your analytics tools as well (as you should be!).</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/10/adblock.jpg" title="Detect AdBlock with GTM and GA">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/10/adblock.jpg#ZgotmplZ" alt="Detect AdBlock with GTM and GA">
  
    </a>
  
  
</div>



<p>The two solutions I&rsquo;m going to introduce differ in their accuracy. Both require that you upload a small file to your web server. After that, the accuracy depends on whether or not you&rsquo;re interested in knowing how many of these content blockers end up blocking <a href="https://tagmanager.google.com/">Google Tag Manager</a> as well! As it turns out, there are some that do, and you might want to measure that traffic as well.</p>

<p><strong>NOTE</strong>! Just to dispel any confusion, the following solutions <strong>will not</strong> work if Google Analytics tracking is blocked by preventing the HTTP request from ever leaving the site. The hack using an <code>XMLHttpRequest()</code> will circumvent those blockers which simply prevent analytics.js from loading, but it will not help if the HTTP request to Google Analytics is blocked. To measure THAT share of traffic in GA, you&rsquo;ll need to relay the hits via a local web server endpoint, and send the Measurement Protocol hit to Google Analytics from your web server, where ad and content blockers can&rsquo;t reach it.</p>

<h2 id="create-the-javascript-file-and-upload-it">Create the JavaScript file and upload it</h2>

<p>First thing you need to do is create a simple JavaScript file called <code>advertisement.js</code> and upload it to the web server. This file has just one single line:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window[<span style="color:#e6db74">&#39;noBlocker&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</code></pre></div>

<p>This file functions as <strong>bait</strong>. It has the most blatant name you could think to give to an ad library, so most of the blockers should latch onto it with their greedy, publishers&rsquo;-livelihood-decimating-tendrils.</p>

<p>You need to upload this file to some location on your web server where you can link to it from your page template (or from GTM). Because I&rsquo;m using WordPress, I uploaded it to the directory <code>/wp-content/</code>.</p>

<p>Once you&rsquo;ve done this, you can follow either the easy solution (coming up soon), or the more intricate one (coming up later in the article). But start by reading the generic GTM configuration you&rsquo;ll need for either approach.</p>

<h2 id="google-tag-manager-configuration">Google Tag Manager configuration</h2>

<p>First, you&rsquo;ll need a <strong>Custom JavaScript Variable</strong>, which we&rsquo;ll call <strong>{{JS - noBlocker}}</strong>. This Variable has the following code within:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> window[<span style="color:#e6db74">&#39;noBlocker&#39;</span>] <span style="color:#f92672">?</span> <span style="color:#66d9ef">undefined</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;true&#39;</span>;
}
</code></pre></div>

<p>This will return nothing if the <code>advertisement.js</code> file loaded and created the global variable, and <strong>&lsquo;true&rsquo;</strong> if the file was not loaded. In other words, if a content blocker blocked <code>advertisement.js</code>, this Variable will return &lsquo;true&rsquo;.</p>

<p>Next, you&rsquo;ll need to create a Custom Dimension in Google Analytics. I&rsquo;ve chosen <strong>Session</strong> as the scope, as Hit-level might be too granular, and User-level might be too broad. But it&rsquo;s up to you. When you create the Custom Dimension, make note of the <strong>Index</strong> number that GA assigns to it.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/10/cd-ga.jpg" title="Custom Dimension in GA">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/10/cd-ga.jpg#ZgotmplZ" alt="Custom Dimension in GA">
  
    </a>
  
  
</div>



<p>Next, edit your generic <strong>Page View</strong> Tag. You need to add a new Custom Dimension row to it, with the Index number derived from Google Analytics&rsquo; settings, where you just created the new dimension. The value of this dimension needs to be the Custom JavaScript Variable you created earlier. So it would look like this:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/10/gtm-cd.jpg" title="Custom Dimension - GTM">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/10/gtm-cd.jpg#ZgotmplZ" alt="Custom Dimension - GTM">
  
    </a>
  
  
</div>



<p>Let&rsquo;s look at what&rsquo;s going on here. When this Tag fires, it tries to populate Custom Dimension with Index number 4 with whatever the variable <strong>{{JS - noBlocker}}</strong> returns. If the site did not load the file <code>advertisement.js</code>, this dimension gets the value <strong>&lsquo;true&rsquo;</strong>, which is what&rsquo;s dispatched to Google Analytics. If the file <em>did</em> load, the variable returns <code>undefined</code>, and the dimension <a href="https://www.simoahava.com/gtm-tips/undefined-dimensions-wont-get-sent/">does not get sent</a>.</p>

<p>And that&rsquo;s the generic setup! That&rsquo;s how we&rsquo;ll know if a content blocker is running on the site or not.</p>

<p>Next, we&rsquo;ll need to choose how to link the file to the site, and whether or not we want to account for blockers that actually block GTM as well.</p>

<h2 id="easy-link-the-file-via-gtm">Easy: link the file via GTM</h2>

<p>This is the &ldquo;easy&rdquo; setup, as we&rsquo;ll be only using Google Tag Manager to upload <code>advertisement.js</code>.</p>

<p>Start by creating a new <strong>Custom HTML Tag</strong>, named <strong>SETUP - Link to advertisement.js</strong>. This has the following code within:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
  (<span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;script&#39;</span>);
    <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/wp-content/advertisement.js&#39;</span>; <span style="color:#75715e">// Modify this!
</span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">d</span>);
  })();
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>This creates a new element in the DOM (a <code>script</code> element), adds a link to the file you&rsquo;ve uploaded earlier, and then appends it to the <code>head</code> of the document. Remember to modify the line with <code>d.src = ...</code> to reflect the actual location where you&rsquo;ve uploaded the file to!</p>

<p>Save the Tag. <strong>Note!</strong> Do NOT add any Triggers to it. Just save it. Good.</p>

<p>Next, open your <strong>Page View Tag</strong> (the one where you just added the Custom Dimension to), and open <strong>Advanced Settings</strong> -&gt; <strong>Tag Sequencing</strong>.</p>

<p>Under Tag Sequencing, check the box for &ldquo;Fire a tag before <em>Page View Tag</em> fires&rdquo;, and choose the <strong>SETUP - Link to advertisement.js</strong> from the drop-down list.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/10/tag-sequencing.jpg" title="Tag Sequencing setup">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/10/tag-sequencing.jpg#ZgotmplZ" alt="Tag Sequencing setup">
  
    </a>
  
  
</div>



<p>Save the Page View Tag.</p>

<p>Here&rsquo;s what&rsquo;s going to happen. When it&rsquo;s time for the Page View Tag to fire, the Custom HTML Tag is first executed. This Tag links to and executes the <code>advertisement.js</code> file you&rsquo;ve uploaded to your web server. Next, the Page View Tag fires, and the Custom JavaScript Variable either detects a content blocker (if one is activated) or doesn&rsquo;t (if one isn&rsquo;t activated), and sends the Custom Dimension accordingly.</p>

<p>Still with me? That&rsquo;s all you&rsquo;ll need. After this, data will start flowing in with your Page View Tags, annotating sessions which have a content blocker with the value <strong>&lsquo;true&rsquo;</strong> in the new Custom Dimension field.</p>

<h2 id="advanced-page-template-magic">Advanced: Page Template magic</h2>

<p>This is more advanced, as it requires you to modify the page template, but it will also account for traffic which also blocks Google Tag Manager (the b*stards!). It&rsquo;s not a large share by any count, but it&rsquo;s still something you might want to be wary of.</p>

<p><strong>NOTE!</strong> This solution uses a <code>XMLHttpRequest</code> to dispatch the data to GA, and many blockers filter block these requests as well. So you might be left with no other option than to send the data to an endpoint you own and are certain is not blocked by these tools. That&rsquo;s left up to you and your developers, of course.</p>

<p>Let&rsquo;s start with the technical stuff first.</p>

<p>You&rsquo;ll need to add the following tag to the page template <strong>before the Google Tag Manager container snippet</strong>. The logical place for it is in the <code>&lt;head&gt;</code> of the document.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/wp-content/advertisement.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>Remember to change the value of the <code>src</code> attribute to reflect the actual location of the file.</p>

<p>Next, add the following minified JavaScript code to the template as well. You can add it anywhere you want in the template, though adding it to the very end is logical as it&rsquo;s just synchronous JavaScript.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;<span style="color:#f92672">!</span><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">d</span>,<span style="color:#a6e22e">e</span>){window.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>,<span style="color:#66d9ef">function</span>(){<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>window.<span style="color:#a6e22e">noBlocker</span><span style="color:#f92672">&amp;&amp;!</span>window.<span style="color:#a6e22e">google_tag_manager</span>){<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">t</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>,<span style="color:#a6e22e">n</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">new</span> Date).<span style="color:#a6e22e">getTime</span>()<span style="color:#f92672">+</span>Math.<span style="color:#a6e22e">floor</span>(<span style="color:#ae81ff">1</span><span style="color:#a6e22e">e8</span><span style="color:#f92672">*</span>Math.<span style="color:#a6e22e">random</span>()),<span style="color:#a6e22e">o</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ab_gc=&#39;</span>,<span style="color:#a6e22e">a</span><span style="color:#f92672">=</span>document.<span style="color:#a6e22e">cookie</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;;&#39;</span>),<span style="color:#a6e22e">i</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;<span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">length</span>;<span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>){<span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span><span style="color:#f92672">=</span><span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">i</span>];<span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">==</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">charAt</span>(<span style="color:#ae81ff">0</span>);)<span style="color:#a6e22e">c</span><span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">1</span>);<span style="color:#ae81ff">0</span><span style="color:#f92672">==</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">o</span>)<span style="color:#f92672">&amp;&amp;</span>(<span style="color:#a6e22e">n</span><span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#a6e22e">o</span>.<span style="color:#a6e22e">length</span>,<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">length</span>))}<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;POST&#39;</span>,<span style="color:#e6db74">&#39;https://www.google-analytics.com/collect&#39;</span>);<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">r</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;tid=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">e</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;cd&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">d</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;=true&amp;t=pageview&amp;dp=&#39;</span><span style="color:#f92672">+</span>document.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">pathname</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&amp;v=1&amp;cid=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">n</span>;<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">r</span>);<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">g</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> Date;<span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">setTime</span>(<span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">getTime</span>()<span style="color:#f92672">+</span><span style="color:#ae81ff">63072</span><span style="color:#a6e22e">e6</span>);<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;expires=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">g</span>.<span style="color:#a6e22e">toUTCString</span>();document.<span style="color:#a6e22e">cookie</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ab_gc=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#39;; &#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">d</span>}})}(<span style="color:#e6db74">&#39;1&#39;</span>,<span style="color:#e6db74">&#39;UA-1234567-1&#39;</span>);&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>It looks nasty, I know! Read through the following bit carefully.</p>

<p>This script adds a <strong>window.onload</strong> listener, which fires after the entire <code>window</code> object has loaded. In other words, it waits for the page load <strong>and</strong> all scripts, images, and external assets to load as well.</p>

<p>Next, it checks for the existence of the <code>noBlocker</code> global variable, which, if you remember, is created in the <code>advertisement.js</code> file. It also checks for the existence of the <code>google_tag_manager</code> object, which is created by Google Tag Manager.</p>

<p>If both of these are missing, it means that a content blocker has <strong>blocked both <code>advertisement.js</code> and GTM!</strong>. How rude!</p>

<p>If these are blocked, the script proceeds with the following:</p>

<ol>
<li><p>Create a new randomized clientId, using the current timestamp and a random number.</p></li>

<li><p>If a cookie named <code>ab_gc</code> exists, use its value as the clientId instead.</p></li>

<li><p>Fire a Measurement Protocol hit to Google Analytics, using the clientId established in either step (1) or (2), and send the hit as a Page View, using the current page as the location, and setting the value &lsquo;true&rsquo; to a custom dimension.</p></li>

<li><p>Write/update the cookie <code>ab_gc</code> with the clientId.</p></li>
</ol>

<p>One important thing to note here. See the very last parentheses in the script: <code>('1','UA-1234567-1')</code>? You need to update those yourself.</p>

<p>The first value in the parentheses is the index number of the Custom Dimension you want to send details about the ad blocker to. You can, for example, just use the Custom Dimension you created earlier, or you can do what I&rsquo;ve done.</p>

<p>I created a <strong>new Google Analytics property</strong> to collect these hits, and the Custom Dimension is a hit-scoped dimension, used in an <strong>Include Only</strong> filter on the reporting view. In other words, this new property will only accept hits that have this Custom Dimension in them, meaning it will only collect data from users that block both <code>advertisement.js</code> and GTM (grrr!).</p>

<p>So that&rsquo;s what the second value in the parentheses is. It&rsquo;s the property ID where you want to dispatch the data to. Personally, I wouldn&rsquo;t use my main property, as this data simply isn&rsquo;t comparable. It&rsquo;s programmatically created, and is very limited as to what information is sent. You can, of course, populate all the dimension fields with some clever JavaScript magic, but I&rsquo;m not that interested in all those gimmicks.</p>

<p>I&rsquo;m just interested in knowing how many sessions are blocking both ads <em>and</em> GTM (stop it!).</p>

<h2 id="summary">Summary</h2>

<p>What you do next is up to you. You can create a custom report with session shares for those with a ad blocker vs. those without. With this data, you can optimize your site, making sure no critical information is behind potentially blocked sources.</p>

<p>There are <a href="https://github.com/sitexw/FuckAdBlock">other</a> <a href="http://esd.io/blog/detecting-adblock-javascript.html">solutions</a> out there as well that you might want to check out.</p>

<p>Uploading the <code>advertisement.js</code> might not be the most robust solution out there, as it doesn&rsquo;t require too much imagination from content blockers to disregard this file in the future. Some methods of blocker detection include creating elements in the DOM which resemble slots for advertisements. These will probably work nicely as well.</p>

<p>With this solution, you&rsquo;ll get some useful information about content blocker shares on your site, and you can immediately act on this information.</p>

<p>I really, really, wish Google Tag Manager wouldn&rsquo;t be blocked, as it&rsquo;s not an advertisement or content distribution platform by itself. It&rsquo;s just a JavaScript injector that can be used for benevolent, cool stuff as well.</p>

<p>Do note that one thing that&rsquo;s missing is checking whether or not <strong>Google Analytics</strong> was blocked but <strong>Google Tag Manager</strong> wasn&rsquo;t. That&rsquo;s an interesting use case as well, and it&rsquo;s simple enough to do with a check for <code>window['GoogleAnalyticsObject']</code> upon page load. You can do this via GTM or in the page template as well - it just requires some customization.</p>

<p>Do you have other tips for detecting ad and content blockers? What results are you seeing? On my blog, content blockers account for around <strong>25 %</strong> of the sessions, and those who block GTM as well are very few (but they do exist).</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/adblocker/">adblocker</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/content-blocker/">content blocker</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/setup-google-tag-manager-ios-with-swift/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/measure-serp-bounce-time-with-gtm/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Measure%20Ad%20And%20Content%20Blocker%20Impact%20https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/setup-google-tag-manager-ios-with-swift/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/measure-serp-bounce-time-with-gtm/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Measure%20Ad%20And%20Content%20Blocker%20Impact%20https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Measure%20Ad%20And%20Content%20Blocker%20Impact%20https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/measure-ad-content-blocker-impact-on-traffic/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

