

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Consent Settings In Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2021\/05\/consent-settings.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/consent-settings-google-tag-manager\/",
  "datePublished": "2021-05-28T07:00:00\u002b03:00",
  "dateModified": "2021-05-28T07:00:00\u002b03:00",
  "description": "Overview of Consent Settings and related functionality in Google Tag Manager containers.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Consent Settings In Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/consent-settings-google-tag-manager/">
    
    <meta name="description" content="Overview of Consent Settings and related functionality in Google Tag Manager containers.">
    <meta property="og:description" content="Overview of Consent Settings and related functionality in Google Tag Manager containers.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Consent Settings In Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Consent Settings In Google Tag Manager">
    <meta name="twitter:description" content="Overview of Consent Settings and related functionality in Google Tag Manager containers.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
	  <meta property="og:image" content="https://www.simoahava.com/images/2021/05/consent-settings-google-tag-manager.jpg">
      <meta name="twitter:image" content="https://www.simoahava.com/images/2021/05/consent-settings-google-tag-manager.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
    <div class="figure nocaption">
      <img class="cover" src="https://www.simoahava.com/images/2021/05/consent-settings-google-tag-manager.jpg">
    </div>
  
  

    <h1>
      Consent Settings In Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-05-28T07:00:00&#43;03:00">
        
  May 28, 2021

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/consent-settings-google-tag-manager/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>Ever since <a href="https://analytics.google.com">Google Analytics</a> released the first features of <a href="https://www.simoahava.com/analytics/consent-mode-google-tags/">consent mode</a>, I&rsquo;ve been anxiously waiting for news about a more tightly-knit integration with Google&rsquo;s preferred implementation solution: Google Tag Manager.</p>
<p>In a <a href="https://blog.google/products/marketingplatform/360/respect-user-consent-choices-google-tag-manager/">recent release</a>, Google released a veritable cornucopia of new features that <em>should</em> assist in determining and implementing consent not just across Google tags, but <em>any</em> tags running in the container.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/consent-settings.jpg" title="Consent settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/consent-settings.jpg#ZgotmplZ" alt="Consent settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 968 574'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The new features are:</p>
<ul>
<li>New <strong>consent types</strong> (in addition to <code>ad_storage</code> and <code>analytics_storage</code> which were introduced with <a href="https://www.simoahava.com/analytics/consent-mode-google-tags/">consent mode</a>).</li>
<li>Tag-specific <a href="https://support.google.com/tagmanager/answer/10718549#tag-settings">consent settings</a> with both <strong>built-in</strong> consent checks (if their behavior is modified by consent state) and <strong>additional</strong> consent checks, where you can determine if a tag requires specific types of consent to be allowed to fire in general.</li>
<li>A new <strong>Consent Overview</strong> screen, where you can quickly check which tags have already been configured for additional consent settings and which are still waiting to be updated.</li>
<li>New trigger types, with both a <strong>Consent Initialization</strong> trigger (fires before anything else in the container) and an <strong>Initialization</strong> trigger (fires before anything except the Consent Initialization trigger) being added to the mix.</li>
<li>New <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">custom template</a> sandbox <a href="https://developers.google.com/tag-manager/templates/cmp-consent">APIs</a> for making consent management platform templates (and why not others as well) <strong>consent-aware</strong>.</li>
</ul>
<blockquote>
<p>These features are available in both GTM 360 and regular (free) GTM containers.</p>
</blockquote>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#new-consent-types">New consent types</a></li>
    <li><a href="#consent-settings-in-tags">Consent settings in tags</a>
      <ul>
        <li><a href="#built-in-consent-checks">Built-in Consent Checks</a></li>
        <li><a href="#additional-consent-checks">Additional Consent Checks</a></li>
      </ul>
    </li>
    <li><a href="#consent-overview">Consent Overview</a></li>
    <li><a href="#new-trigger-types">New trigger types</a>
      <ul>
        <li><a href="#consent-initialization">Consent Initialization</a></li>
        <li><a href="#initialization">Initialization</a></li>
      </ul>
    </li>
    <li><a href="#new-template-apis">New template APIs</a>
      <ul>
        <li><a href="#set-default-consent-state">Set default consent state</a></li>
        <li><a href="#update-consent-state">Update consent state</a></li>
        <li><a href="#check-consent-state">Check consent state</a></li>
        <li><a href="#listen-for-changes-in-consent-state">Listen for changes in consent state</a></li>
        <li><a href="#new-permission-accesses-consent-state">New permission: Accesses consent state</a></li>
      </ul>
    </li>
    <li><a href="#working-with-consent-management-platforms">Working with Consent Management Platforms</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
<p>Let&rsquo;s take a closer look at all of these.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="new-consent-types">New consent types</h2>
<p>First of all, in addition to <code>ad_storage</code> and <code>analytics_storage</code>, which were introduced with <a href="(/analytics/consent-mode-google-tags/)">consent mode</a>, there are <strong>three</strong> additional consent types Google recommends to use with these APIs. Here&rsquo;s the full list (<a href="https://support.google.com/tagmanager/answer/10718549#consent-types">source</a>):</p>
<table>
<thead>
<tr>
<th>Consent type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ad_storage</code></td>
<td>Enables storage (such as cookies) related to advertising</td>
</tr>
<tr>
<td><code>analytics_storage</code></td>
<td>Enables storage (such as cookies) related to analytics e.g. visit duration</td>
</tr>
<tr>
<td><code>functionality_storage</code></td>
<td>Enables storage that supports the functionality of the website or app e.g. language settings</td>
</tr>
<tr>
<td><code>personalization_storage</code></td>
<td>Enables storage related to personalization e.g. video recommendations</td>
</tr>
<tr>
<td><code>security_storage</code></td>
<td>Enables storage related to security such as authentication functionality, fraud prevention, and other user protection</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Note! The three new consent types are <em>only</em> for non-Google tags. Google tags (e.g. Analytics, Ads, and Floodlight) are only sensitive to <code>ad_storage</code> and <code>analytics_storage</code>.</p>
</blockquote>
<p>It&rsquo;s somewhat odd seeing <code>functionality_storage</code> and <code>security_storage</code> here, as at least in the European Union they are typically deemed to be <strong>strictly necessary</strong> storage and thus wouldn&rsquo;t require consent at all. On the other hand, having more configuration options is rarely a bad thing.</p>
<blockquote>
<p>You can actually add <strong>any consent types you like</strong> into the respective API calls and tag settings. The three new consent types are Google&rsquo;s recommendations, but they&rsquo;re not an exhaustive list.</p>
</blockquote>

                
                  <h2 id="consent-settings-in-tags">Consent settings in tags</h2>
<p>If you open a tag, <em>any</em> tag, and scroll down to its <strong>Advanced Settings</strong>, you&rsquo;ll find a section titled <strong>Consent Settings</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/full-consent-settings.jpg" title="Full consent settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/full-consent-settings.jpg#ZgotmplZ" alt="Full consent settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 922 678'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>There are two sections here (although you might see just one in some cases).</p>
<h3 id="built-in-consent-checks">Built-in Consent Checks</h3>
<p><strong>Built-in Consent Checks</strong> means that the tag (or, more precisely, the template running the tag) is <em>consent-aware</em>. This means that the tag is doing <em>something</em> with consent state, although it isn&rsquo;t really explained <em>what</em> it is.</p>
<p>In the screenshot above, for example, you can see <code>ad_storage</code> and <code>functionality_storage</code> listed in the Built-in Consent Checks section. This means that this particular tag template has defined in its <a href="#new-permission-accesses-consent-state">permissions</a> that it needs read and/or write access to these particular consent types.</p>
<p>It&rsquo;s a good thing to be aware of, in case you are wondering why the tag isn&rsquo;t behaving as you&rsquo;d expect it to behave.</p>
<p>Google tags (Analytics, Ads, and Floodlight) have built-in checks for <code>analytics_storage</code> and <code>ad_storage</code>, and their behavior <a href="https://support.google.com/analytics/answer/9976101?hl=en">is documented</a>. Other tags might show <a href="#new-consent-types">other consent types</a> here, and it&rsquo;s up to these tags&rsquo; documentation to explain how they are accessing consent state.</p>
<blockquote>
<p>Note! Built-in Consent Checks is only visible if the template is accessing consent state in its code. If it has nothing to do with consent APIs, you won&rsquo;t see Built-in Consent Checks under these settings.</p>
</blockquote>
<h3 id="additional-consent-checks">Additional Consent Checks</h3>
<p>The <em>other</em> section is called <strong>Additional Consent Checks</strong>, and&hellip;</p>
<p>This. Is. Really. Cool.</p>
<p>With this setting, you can essentially handle consent checks <em>without having to apply consent check conditions to the tag&rsquo;s <strong>triggers</strong></em>!</p>
<p>There are three options here:</p>
<ul>
<li><strong>Not set</strong> – the default option. Use this to indicate this tag hasn&rsquo;t been properly reviewed for whether its triggering should be conditioned on consent or not.</li>
<li><strong>No additional consent required</strong> – Set this if the tag&rsquo;s triggering should <em>not</em> be limited based on consent.</li>
<li><strong>Require additional consent for this tag</strong> – Set this if the tag should only fire if consent has been granted to one or more consent types. When you check this option, a small table appears, and you can add any of the <a href="#new-consent-types">five consent types</a> into the table. The tag will <em>only</em> fire if all the listed consent types have the <code>granted</code> state.</li>
</ul>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/three-consent-checks.jpg" title="Three consent checks">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/three-consent-checks.jpg#ZgotmplZ" alt="Three consent checks" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1002 542'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The tag with the settings as above will only fire if <code>security_storage</code>, <code>functionality_storage</code>, and <code>analytics_storage</code> have been <strong>granted</strong> consent.</p>

                
                  <h2 id="consent-overview">Consent Overview</h2>
<p>To enable the Consent Overview screen, first go to <strong>Admin</strong> and then <strong>Container Settings</strong>.</p>
<p>Check the box next to <strong>Enable consent overview</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/container-settings.jpg" title="Container settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/container-settings.jpg#ZgotmplZ" alt="Container settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1216 902'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Now when you go to <strong>Tags</strong>, you can click the <strong>Consent Overview</strong> icon in the action bar.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/consent-overview-button.jpg" title="Consent Overview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/consent-overview-button.jpg#ZgotmplZ" alt="Consent Overview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2024 328'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Consent Overview lists all your tags in two sections.</p>
<p><strong>Consent Not Configured</strong> means that the <a href="#additional-consent-checks"><strong>Additional Consent Checks</strong></a> setting for these tags is the default <strong>Not set</strong>.</p>
<p><strong>Consent Configured</strong> means that the tag has been configured for additional consent checks (either <strong>None</strong> or one or more consent types that need to be granted for the tag to fire).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/consent-overview-screen.jpg" title="Consent overview screen">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/consent-overview-screen.jpg#ZgotmplZ" alt="Consent overview screen" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2678 1862'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can mass edit the consent check settings for tags by selecting them and then clicking the Edit Consent Settings button in the action bar.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/mass-edit-consent.jpg" title="Mass edit consent settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/mass-edit-consent.jpg#ZgotmplZ" alt="Mass edit consent settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1864 684'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Use the Consent Overview screen religiously, especially if you are integrating Google Tag Manager with a consent management platform (CMP). It&rsquo;s a great way to quickly see how and if your tags have been configured to work with the consent settings set by your CMP.</p>

                
                  <h2 id="new-trigger-types">New trigger types</h2>
<p>There are <strong>two</strong> new trigger types in Google Tag Manager. Both are also automatically added to each container as built-in triggers, and both appear in Preview mode as new trigger events.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/new-trigger-types.jpg" title="New trigger types">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/new-trigger-types.jpg#ZgotmplZ" alt="New trigger types" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 982 616'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<blockquote>
<p><strong>Note!</strong> These triggers can&rsquo;t really handle asynchronous requests. If you have an asynchronous call to fetch consent state, for example, then it&rsquo;s possible that even when firing the tag with the <strong>Consent Initialization</strong> trigger, it completes only after some other tags have already started firing on later triggers.</p>
</blockquote>
<h3 id="consent-initialization">Consent Initialization</h3>
<p><strong>Consent Initialization</strong> is a trigger that <strong>fires before any other trigger in the container</strong>. It is programmatically generated to be the very first trigger that can fire on any given page.</p>
<p>This means that it&rsquo;s good for, as the name implies, establishing the <strong>default consent state</strong> of the new consent types, for example (see <a href="#new-template-apis">below</a>).</p>
<p>In other words, if you are using a consent management platform and you want to run some code (perhaps their own custom template) that establishes the default consent state for the five different consent types, <strong>this</strong> is the correct trigger type to use.</p>
<p>The built-in trigger that&rsquo;s automatically available in all containers is called <strong>Consent Initialization - All Pages</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/consent-init-trigger.jpg" title="consent-init-trigger.jpg">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/consent-init-trigger.jpg#ZgotmplZ" alt="consent-init-trigger.jpg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 826 302'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <code>dataLayer</code> event for this trigger type is <code>gtm.init_consent</code> (although you won&rsquo;t actually find it in the <code>dataLayer</code> array), and in Preview mode it shows up as <strong>Consent Initialization</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/gtm-init-consent-event.jpg" title="gtm-init-consent-event.jpg">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/gtm-init-consent-event.jpg#ZgotmplZ" alt="gtm-init-consent-event.jpg" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1728 960'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h3 id="initialization">Initialization</h3>
<p>The other new trigger type is <strong>Initialization</strong>. This fires <em>after</em> Consent Initialization but <em>before</em> the first trigger events that were actually pushed into <code>dataLayer</code>.</p>
<p>It&rsquo;s where you&rsquo;d establish non-consent-related dependencies for the rest of the container to make use of.</p>
<p>As it fires before anything else that&rsquo;s pushed into <code>dataLayer</code>, it guarantees that tag execution begins before any trigger based on actual <code>dataLayer</code> events has a chance to fire. Just note the caveat about <a href="#new-trigger-types">asynchronous tags</a> above!</p>
<p>The built-in trigger is called <strong>Initialization – All Pages</strong>.</p>
<p>The <code>dataLayer</code> event for this trigger type is <code>gtm.init</code>, and in Preview mode it shows up as <strong>Initialization</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/gtm-init-event.jpg" title="gtm.init event">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/gtm-init-event.jpg#ZgotmplZ" alt="gtm.init event" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1502 856'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="new-template-apis">New template APIs</h2>
<blockquote>
<p>If you&rsquo;re not looking to build custom templates, you can <a href="#working-with-consent-management-platforms">skip to the next chapter</a>.</p>
</blockquote>
<p>If you&rsquo;re building a <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">custom template</a> for a consent management platform (or really any script that should define consent status), there are new template APIs available for you.</p>
<p>There are <strong>also</strong> some new APIs available for making templates generally sensitive to consent state on the site.</p>
<h3 id="set-default-consent-state">Set default consent state</h3>
<p><strong>Default consent state</strong> is something that&rsquo;s applied as soon as the tag fires (preferably on the <strong>Consent Initialization</strong> trigger). This establishes a baseline for consent settings. Its values can be derived from CMP-specific cookies or something in the <code>dataLayer</code>, for example.</p>
<p>The API is called <a href="https://developers.google.com/tag-manager/templates/api#setdefaultconsentstate"><code>setDefaultConsentState</code></a>, and it takes an object with five properties, each corresponding to a consent type listed in the <a href="#new-consent-types">table above</a>. You can also provide an optional <code>region</code> parameter to have the settings established in the API call apply to visitors from specific regions. The regions (and sub-regions) are provided in <a href="https://en.wikipedia.org/wiki/ISO_3166-2">ISO 3166-2 format</a>.</p>
<p>The default settings are applied until <a href="#update-consent-state">consent state is updated</a>.</p>
<p>In the example below, the CMP template establishes a default state of <code>denied</code> across the board, except for USA, where all but <code>ad_storage</code> is set to <code>granted</code> state.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> setDefaultConsentState = require(<span style="color:#a50">&#39;setDefaultConsentState&#39;</span>);

setDefaultConsentState({
  ad_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  analytics_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  functionality_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  personalization_storage: <span style="color:#a50">&#39;denied&#39;</span>,
  security_storage: <span style="color:#a50">&#39;denied&#39;</span>
});

setDefaultConsentState({
  analytics_storage: <span style="color:#a50">&#39;granted&#39;</span>,
  functionality_storage: <span style="color:#a50">&#39;granted&#39;</span>,
  personalization_storage: <span style="color:#a50">&#39;granted&#39;</span>,
  security_storage: <span style="color:#a50">&#39;granted&#39;</span>,
  region: [<span style="color:#a50">&#39;US&#39;</span>]
});
</code></pre></div>
<p>Naturally, you&rsquo;ll want to make the values dynamic based on, for example, existing consent cookies or settings in the <code>dataLayer</code>.</p>
<h3 id="update-consent-state">Update consent state</h3>
<p>If the user then interacts with the consent management platform and changes their preferences, you can have the template call the <a href="https://developers.google.com/tag-manager/templates/api#updateconsentstate"><code>updateConsentState</code></a> API with a similar structure as above.</p>
<blockquote>
<p>Note that <code>region</code> is not available in <code>updateConsentState</code>. That&rsquo;s because when you need to invoke this API you should already know what the state of the consent call should be, regardless of where the user is located.</p>
</blockquote>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> updateConsentState = require(<span style="color:#a50">&#39;updateConsentState&#39;</span>);

updateConsentState({
  ad_storage: data.ad_storage,
  analytics_storage: data.analytics_storage,
  functionality_storage: <span style="color:#a50">&#39;granted&#39;</span>,
  personalization_storage: data.personalization_storage,
  security_storage: <span style="color:#a50">&#39;granted&#39;</span>
});
</code></pre></div>
<p>In the example above, functionality and security storage are hard-coded to <code>granted</code>, and all the other consent states are pulled in from template fields, most likely configured to respond to user choice.</p>
<h3 id="check-consent-state">Check consent state</h3>
<p>If you want a template to change its behavior based on the current consent state, you can use the <a href="https://developers.google.com/tag-manager/templates/api#isconsentgranted"><code>isConsentGranted</code></a> API.</p>
<p>This takes a single parameter – one of the five consent types – and returns <code>true</code> or <code>false</code>, depending on what the state of consent is for the given consent type.</p>
<p>For example, to set a cookie only if <code>analytics_storage</code> consent has been granted, you can run this code:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> isConsentGranted = require(<span style="color:#a50">&#39;isConsentGranted&#39;</span>);

<span style="color:#00a">if</span> (isConsentGranted(<span style="color:#a50">&#39;analytics_storage&#39;</span>)) {
  <span style="color:#aaa;font-style:italic">// Custom method that handles setting the cookie
</span><span style="color:#aaa;font-style:italic"></span>  setCustomAnalyticsCookie();
}
</code></pre></div>
<h3 id="listen-for-changes-in-consent-state">Listen for changes in consent state</h3>
<p>Sometimes it&rsquo;s super clumsy to just add triggers to a tag to make it re-evaluate its functionality based on consent settings, for example. That&rsquo;s why there&rsquo;s a new API, <a href="https://developers.google.com/tag-manager/templates/api#addconsentlistener"><code>addConsentListener</code></a>, which can be used to execute a callback in a template once the consent state for any given consent type changes.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> addConsentListener = require(<span style="color:#a50">&#39;addConsentListener&#39;</span>);

<span style="color:#00a">const</span> consentCallback = (consentType, granted) =&gt; {
  <span style="color:#00a">if</span> (consentType === <span style="color:#a50">&#39;analytics_storage&#39;</span> &amp;&amp; granted) {
    setCustomAnalyticsCookie();
  }
};

addConsentListener(<span style="color:#a50">&#39;analytics_storage&#39;</span>, consentCallback);
</code></pre></div>
<p>The callback is passed the consent type and whether consent was granted or not (<code>true</code> / <code>false</code>) as arguments.</p>
<p>This is a pretty nifty solution, as it leaves the batching and dispatching logic to the tag itself. You don&rsquo;t need to overengineer the tag with custom triggers that detect the change in consent state – the template will handle this for you.</p>
<p>The template will simply listen for changes to consent state, and automatically send the hit that was blocked due to lack of consent before the state update.</p>
<h3 id="new-permission-accesses-consent-state">New permission: Accesses consent state</h3>
<p>There is also the new <strong>Accesses consent state</strong> permission, which controls which consent states the template is allowed to read/write.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/new-permission.jpg" title="New consent permissions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/new-permission.jpg#ZgotmplZ" alt="New consent permissions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2530 548'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Here are the permissions required by all of the APIs listed above:</p>
<table>
<thead>
<tr>
<th>API name</th>
<th>Requires <strong>read</strong></th>
<th>Requires <strong>write</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>setDefaultConsentState</code></td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><code>updateConsentState</code></td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><code>isConsentGranted</code></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><code>addConsentListener</code></td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Each consent type that your APIs want to read and/or write needs to be separately listed in the permissions table (thus it can have a maximum of five rows).</p>
<p>Any consent types you add to this permission table will be listed in the <strong>Built-in Consent Checks</strong> section of the tag.</p>

                
                  <h2 id="working-with-consent-management-platforms">Working with Consent Management Platforms</h2>
<p>It&rsquo;s no secret that these new consent settings have been created <em>specifically</em> with CMPs in mind.</p>
<p>However, for there to be an actual <em>benefit</em> to using a CMP with these new settings, a couple of things need to be in place:</p>
<ol>
<li>The CMP needs to build a custom template that makes use of the <a href="#new-consent-types">new consent types</a> <em>and</em> of both the <a href="#set-default-consent-state">default</a> and <a href="#update-consent-state">update</a> consent status APIs.</li>
<li>Ideally, tags you run in the container would <em>modify</em> their behavior based on consent state. They can do this with the <a href="#listen-for-changes-in-consent-state">new template APIs</a> that let templates react to consent state (and changes).</li>
<li>At the very least, you should go through every tag in the container and check its <strong>Advanced Settings</strong> to see if consent status should <strong>block</strong> the tag if not granted.</li>
</ol>
<p>The biggest bottlenecks are obviously (1) and (2). Judging by the <a href="https://support.google.com/tagmanager/answer/10718549#cmp-integrations">list provided by Google</a>, it doesn&rsquo;t look like the most popular CMPs are exactly jumping at the opportunity to integrate with either GTM or consent mode. Well, these are still fairly new features (and in beta), so let&rsquo;s hope the situation improves soon.</p>
<p>Hopefully, tag templates in general will be engineered to be consent-aware where necessary. It makes a whole lot of sense for templates that <em>can</em> work without storage to conditionally block setting cookies if there isn&rsquo;t appropriate consent available.</p>
<p>Similarly, vendors that <em>do</em> have a separate endpoint for &ldquo;privacy-friendly&rdquo; data collection (e.g. no third-party cookies) should make the decision which endpoint to use dependent on the state of the relevant consent.</p>
<p>As before, configuring consent management is <strong>a lot of work</strong>. This is by design, as consent needs to be deliberately integrated and engineered, as there are legal consequences for ignoring the granularity of what user choice actually is.</p>
<p>With these new consent settings in GTM, thankfully it&rsquo;s no longer the Google Tag Manager admin who has to do the bulk of the work, but vendors are required to participate and cooperate as well.</p>

                
                  <h2 id="summary">Summary</h2>
<p>Whenever Google Tag Manager makes a conscious effort to make life easier for its admins and users, it makes me happy.</p>
<p>Integrating consent management platforms with Google Tag Manager has historically been a veritable pain in the rump. The new consent features don&rsquo;t take away all of the friction, but they do make it more manageable to work together with CMPs to make sure that the GTM container is wired for consent options.</p>
<p>Similarly, service vendors now have new template APIs that allow them to add more granularity to their tags than just block vs. fire based on consent choice. I really, really hope vendors will make use of these features.</p>
<p>The new UI features make it easy to quickly audit a container for consent support, but I did find myself craving more even more transparency from the tag settings directly. It&rsquo;s good to know what the built-in consent choices are, for example, but it would be even more useful to know <em>how</em> the tag actually relies on consent without having to dig into the template code itself.</p>
<p>Other things that I feel like should be improved include:</p>
<ul>
<li>Incentivize using the new Consent Initialization and Initialization trigger types. Make them work with asynchronous requests as well (i.e. don&rsquo;t proceed to the next trigger event until a success signal has been sent).</li>
<li>Add consent support for server-side Google Tag Manager, too. The <code>gcs</code> parameter in the request URL (of Google tags) could be used to pass all five consent types, and the server-side tagging environment could then decipher user consent from this parameter, using purpose-built APIs in templates.</li>
<li>Make it possible to grant / deny consent on a vendor-by-vendor basis as well.</li>
<li>Make it possible to add custom purpose types instead of just the five consent types that are now available (although that is a whole lot better than the two (<code>ad_storage</code> and <code>analytics_storage</code>) we used to have!).</li>
<li>Expose consent state to outside Google Tag Manager as well, as it&rsquo;s possible that not all tags are running through Google Tag Manager.</li>
</ul>
<p>In general, consent is predicated on <strong>transparency</strong>. The more GTM can improve transparency to what the state of consent is, the better for all parties involved.</p>
<p>What do you think about the current state of consent management in Google Tag Manager?</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/consent/">consent</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/deploy-server-side-google-tag-manager-aws/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-gtm-loader-server-side-tagging/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Settings%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/consent-settings-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/deploy-server-side-google-tag-manager-aws/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-gtm-loader-server-side-tagging/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Settings%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/consent-settings-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Settings%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/consent-settings-google-tag-manager/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

