

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "JavaScript 101 For GTM: Part 1 | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2014\/06\/script-context.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/javascript-101-gtm-part-1\/",
  "datePublished": "2014-07-03T13:25:15\u002b00:00",
  "dateModified": "2014-07-03T13:25:15\u002b00:00",
  "description": "Part one of a two-parter, where I introduce some key JavaScript concepts for successful Google Tag Manager management and use.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>JavaScript 101 For GTM: Part 1 | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/javascript-101-gtm-part-1/">
    
    <meta name="description" content="Part one of a two-parter, where I introduce some key JavaScript concepts for successful Google Tag Manager management and use.">
    <meta property="og:description" content="Part one of a two-parter, where I introduce some key JavaScript concepts for successful Google Tag Manager management and use.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript 101 For GTM: Part 1">
    <meta property="og:url" content="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="JavaScript 101 For GTM: Part 1">
    <meta name="twitter:description" content="Part one of a two-parter, where I introduce some key JavaScript concepts for successful Google Tag Manager management and use.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2014/06/script-context.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2014/06/script-context.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://masto.measure.chat/@SimoAhava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      JavaScript 101 For GTM: Part 1
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2014-07-03T13:25:15Z">
        
  July 3, 2014

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p><em>Here&rsquo;s the link to <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">part 2 of this JavaScript guide</a>.</em></p>
<p>The thing about <a href="http://www.google.com/tagmanager">Google Tag Manager</a>, or any JavaScript tag manager for that matter, is that there&rsquo;s JavaScript involved. In fact, the tool itself is just a JavaScript library with some additional bells and whistles (such as a management UI). This means that to make the best of it, some knowledge of JavaScript is warranted, and that&rsquo;s the point of this post.</p>
<p>This will not be a how-to or <a href="http://www.dummies.com/how-to/computers-software/programming/javascript.html">JavaScript for dummies</a>, but rather a description of how JavaScript should be managed within GTM. However, I have added some of my favorite JavaScript learning resources to the mix, if you want to start from the beginning. JavaScript is a pretty easy programming language to learn, partly because it&rsquo;s been &ldquo;dumbed down&rdquo; and standardized so much over the years. The biggest difficulty with JavaScript, in my opinion, has nothing to do with the language itself. The biggest problem, by far, is how JavaScript is interpreted by the browsers out there. At its best, the same piece of code works perfectly across all browsers in existence. At its worst, you&rsquo;ll have to add complex cross-browser fallbacks to make sure your code runs even on certain modern browsers.</p>
<p>The good thing about using GTM, or any library, is that the library itself usually takes care of cross-browser concerns for you. With GTM, however, this is limited to the tag and macro templates that you use. When you start adding custom JavaScript yourself, it&rsquo;s up to you to be wary of cross-browser support for your scripts.</p>
<p><a href="http://www.quirksmode.org/compatibility.html">Quirksmode.org</a> is a pretty awesome resource if you want to find out more about browser compatibility.</p>
<p>Without further ado, let&rsquo;s go the guide:</p>
<ol>
<li>
<p>Favorite resources</p>
</li>
<li>
<p>JavaScript in Google Tag Manager</p>
</li>
<li>
<p>The dataLayer structure</p>
</li>
<li>
<p>Interacting with dataLayer</p>
</li>
<li>
<p>Custom HTML tag</p>
</li>
<li>
<p>Custom JavaScript macro</p>
</li>
</ol>
<p>This is, again, just the first of a two-part series. I&rsquo;m sorry, I&rsquo;m just lazy. The sun is finally shining here, I&rsquo;m looking at the garden, and for some reason the notion of outdoors, smell of freshly cut grass and the sweet liberation only a can of cold beer can provide are edging their way to the top of the &ldquo;things I&rsquo;d rather be doing than blogging&rdquo; list, which is a very, VERY short list indeed.</p>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="1-favorite-resources">1. Favorite resources</h2>
<p>Here are some resources to get you going on your JavaScript learning trail:</p>
<p><strong>WEBSITES</strong>:</p>
<p><a href="http://www.codecademy.com">Codecademy</a> - Interactive learning portal for a number of different programming disciplines. Their JavaScript track is excellent to get you started with the language.</p>
<p><a href="https://www.codeschool.com/paths/javascript">Code School</a> - Another training portal. Their JavaScript track is good as well.</p>
<p><a href="http://www.w3schools.com/js/DEFAULT.asp">w3schools.com</a> - Better as a reference than as a learning resource, but lots of good content nonetheless.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API">MDN Web API Interfaces</a> - Reference tool for all the web APIs you&rsquo;ll ever need.</p>
<p><strong>BOOKS</strong>:</p>
<p><a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742">Douglas Crockford - JavaScript: The Good Parts</a> - One of the best books on JavaScript best practices out there (intermediate to advanced).</p>
<p><a href="http://www.amazon.com/Professional-JavaScript-Developers-Nicholas-Zakas/dp/1118026691">Nicholas Jakas - Professional JavaScript for Web Developers</a> - My favorite JavaScript book. The most complete guide out there.</p>
<p><a href="http://eloquentjavascript.net/">Marijn Haverbeke - Eloquent JavaScript</a> - Excellent book on JavaScript, with a free digital edition!</p>
<p><strong>BLOGS</strong>:</p>
<p><a href="http://www.dailyjs.com">DailyJS</a> - Daily tips on JavaScript.</p>
<p><a href="http://davidwalsh.name/">David Walsh Blog</a> - Lots of stuff on web development, with many in-depth articles on JavaScript.</p>
<p><a href="http://joejimzs.com/">Joe Zim&rsquo;s JavaScript Blog</a> - Actionable tips and guides for JavaScript and related frameworks.</p>
<p>These are my favorite resources. If you have more suggestions, let me know via e-mail or in the blog comments.</p>

                
                  <h2 id="2-javascript-in-google-tag-manager">2. JavaScript in Google Tag Manager</h2>
<p>In almost all of my <a href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager posts</a>, I use JavaScript in one way or another to get the task done. That&rsquo;s because JavaScript is THE language of Google Tag Manager. The library itself is a JavaScript library, and all the bells and whistles of the UI are meant to control the type of JavaScript that the tool injects on the web page.</p>
<p>However, you can&rsquo;t just go around shooting JS code wherever you like. In the GTM UI, JavaScript can only be added <strong>in the context of a script</strong>. Currently, there are two places which accept JavaScript code raw and unfiltered: the <strong>Custom HTML Tag</strong> and the <strong>Custom JavaScript Macro</strong>. So don&rsquo;t try to write JavaScript in other tag fields, it won&rsquo;t work.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/06/script-context.jpg" title="script-context">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/06/script-context.jpg#ZgotmplZ" alt="script-context" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1448 569'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>So if you want to perform custom JavaScript functions, you will either need to create a Custom HTML Tag which executes some code, or if you want to use JavaScript to access DOM elements, for example, you might want to create a Custom JavaScript macro. We&rsquo;ll get to these soon, don&rsquo;t worry.</p>
<p><strong>FURTHER READING</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/devguide">Google Tag Manager Developer Guide</a></li>
</ul>

                
                  <h2 id="3-the-datalayer-structure">3. The dataLayer structure</h2>
<p>A JavaScript tag management solution is based on <em>code injection</em>. This means that the code it executes on your site is alien to the page template. The only thing the page template originally has is <a href="https://www.simoahava.com/analytics/container-snippet-gtm-secrets-revealed/">the container snippet</a>. This snippet acts as the invitation for GTM to perform its magic on your page.</p>
<p>Because GTM injects the code it wants to execute, it&rsquo;s vital that it uses its own data structure. If there was no proprietary data model, all the variables GTM would be accessing / modifying would run the risk of causing conflicts with other libraries. For instance, say you have a global variable <code>pageHeader</code> created by your developers, and it stores the main header of your page template. Then GTM comes along and uses <code>pageHeader</code> to manipulate the document title that is pushed to Google Analytics. Because it accesses the same global variable that you use to store on-page information, the risk that GTM would break your page template becomes a horrible reality.</p>
<p>With dataLayer, successful (read: smart) use of GTM is restricted to only those variables that are exposed within the dataLayer structure. Thus the only risk you run is having another library which ALSO uses dataLayer (spelled exactly like that). The better known that the dataLayer standard becomes, the less of a risk this will be, since other libraries will know to avoid using this name.</p>
<p>dataLayer is a <strong>JavaScript object</strong> of the type <strong>Array</strong>. An Array is a special type of object. The difference is that in JavaScript, objects have <em>properties</em>, whereas Arrays have <em>members</em>. An Array member can be an object.</p>
<p>Object properties are defined with specific notation, e.g.:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> sampleObject = {<span style="color:#a50">&#39;First-name&#39;</span>: <span style="color:#a50">&#39;Simo&#39;</span>};
alert(sampleObject[<span style="color:#a50">&#39;First-name&#39;</span>]);
alert(sampleObject.First-name); <span style="color:#aaa;font-style:italic">// Error!
</span></code></pre></div>
<p>So this is an object, not an Array. If you want to get the terminology straight, in the first line I created an object using <strong>object literal notation</strong>. That&rsquo;s the curly bracket thingamajig there. In the second line, I retrieved the &lsquo;First-name&rsquo; property of the object by using <strong>square bracket notation</strong>. You could also use <strong>dot notation</strong> to access object properties (third line), but with &lsquo;First-name&rsquo; that would cause a <strong>NaN</strong> (Not a Number) error, because the hyphen in the name is interpreted as a minus sign. Thus JavaScript in its infinite wisdom is misguided enough to think that <strong>sampleObject.First</strong> returns a number of which another number <strong>name</strong> is subtracted. But never mind, this was just a detour.</p>
<p>The thing to understand about dataLayer is that an Array behaves a bit differently than your run-of-the-mill JavaScript object. First of all, an Array is like a table or queue, however you want to look at it. You can add multiple members to it, and any one of these members can be of any JavaScript type, such as objects.</p>
<p>In GTM, dataLayer is (almost) always interpreted as an Array of objects. Thus you can have the sampleObject I created above as a member of dataLayer:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> dataLayer = [{<span style="color:#a50">&#39;First-name&#39;</span>: <span style="color:#a50">&#39;Simo&#39;</span>}];
</code></pre></div>
<p>As you can see, it doesn&rsquo;t matter any more that the object was called &lsquo;sampleObject&rsquo;, since from this moment on it will only be referenced to using its index number in the Array. Index numbers start from 0, so if this is the first object in the array, it&rsquo;s reference is <strong>dataLayer[0]</strong>. The next object that is added to the Array would have index number 1, and so on.</p>
<p>You can access object properties in an Array using the same notation as you just learned of in the beginning of this chapter. However, first you need to know which index the object whose property you want to access resides in.</p>
<p>So, if you&rsquo;re still following me, to access the &lsquo;First-name&rsquo; property of the FIRST dataLayer index, you&rsquo;d need to use something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">alert(dataLayer[<span style="color:#099">0</span>][<span style="color:#a50">&#39;First-name&#39;</span>]);
</code></pre></div>
<p>This would pop up a dialog with &ldquo;Simo&rdquo;. However, in GTM you don&rsquo;t need to worry about dataLayer index numbers, since you can just use the <a href="https://www.simoahava.com/analytics/macro-guide-google-tag-manager/">Data Layer Variable Macro</a>. I&rsquo;ll have more about interacting with dataLayer in the next chapter.</p>
<p><strong>FURTHER READING</strong>:</p>
<ul>
<li>
<p><a href="http://www.w3schools.com/js/js_arrays.asp">w3schools: JavaScript Arrays</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects">MDN: Working with JavaScript objects</a></p>
</li>
</ul>

                
                  <h2 id="4-interacting-with-datalayer">4. Interacting with dataLayer</h2>
<p>In GTM, you basically interact with dataLayer in three different ways:</p>
<ol>
<li>
<p>First, you <strong>define</strong> dataLayer as an Array</p>
</li>
<li>
<p>Next, you <strong>push</strong> objects and properties into dataLayer</p>
</li>
<li>
<p>Finally, you access these properties using a Data Layer Variable <strong>Macro</strong></p>
</li>
</ol>
<p>Let&rsquo;s go through these step-by-step.</p>
<p>You define dataLayer by declaring the variable and setting its type to Array. The most common way to do this is to use literal notation:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> dataLayer = [];
</code></pre></div>
<p>This tells your page that a new variable called dataLayer has now been declared, and the square brackets define its type as Array. After this, you can start pushing stuff into the structure, or if you have some properties that you already want to push, you can just add them to the declaration:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> dataLayer = [{
    <span style="color:#a50">&#39;pageTitle&#39;</span>: <span style="color:#a50">&#39;Homepage&#39;</span>,
    <span style="color:#a50">&#39;visitorType&#39;</span>: <span style="color:#a50">&#39;Loyal customer&#39;</span>,
    <span style="color:#a50">&#39;loggedIn&#39;</span>: <span style="color:#00a">true</span>
}];
</code></pre></div>
<p>So here I create dataLayer as an Array (that&rsquo;s the square brackets) with a single object (that&rsquo;s the curly brackets) with three properties (that&rsquo;s the &lsquo;key&rsquo;: &lsquo;value&rsquo;,) stuff. As you can see, there&rsquo;s no comma after the last property. Also, <strong>true</strong> does not have single quotes around it, since I&rsquo;m storing a value of Boolean type (true/false) and not a string.</p>
<p>The thing about the dataLayer declaration is that <strong>it should only ever be done once</strong>. You see, every time you redeclare a variable, its previous reference is overwritten! You have to be really careful about this, since if your developers accidentally add the dataLayer declaration twice on your page, its previous properties will be overwritten by the second declaration. That&rsquo;s why its safest to declare the structure once and then just consistently use <strong>push()</strong> for all modifications later.</p>
<p>The <strong>push()</strong>-method is what all Arrays come equipped with. Using this method adds an object to the end of the Array, creating a new index for it automatically. Thus nothing is overwritten. You can have a dozen objects with exactly the same properties in dataLayer, and you&rsquo;d get no errors. Note that GTM&rsquo;s Data Layer Variable Macro has a way of navigating around this issue (see below).</p>
<p>To push a new object into dataLayer, the following notation should be used:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">dataLayer.push({<span style="color:#a50">&#39;loggedIn&#39;</span>: <span style="color:#00a">false</span>});
</code></pre></div>
<p>This just pushed a new object into dataLayer with a single property: &lsquo;loggedIn&rsquo; with the value false. So I can easily have dataLayer with two objects, both with property &lsquo;loggedIn&rsquo; being something different. That doesn&rsquo;t matter, since they&rsquo;re in separate objects.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/06/datalayer.jpg" title="datalayer">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2014/06/datalayer.jpg#ZgotmplZ" alt="datalayer" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 419 147'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Trying to push the same property twice into the SAME object would not result in an error, either. However, only the last property would remain in the object.</p>
<p>The thing about <strong>push()</strong> is that it won&rsquo;t work if dataLayer hasn&rsquo;t been declared as an Array. That&rsquo;s why in your page template the following is a good way of prefixing the dataLayer.push() call:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
dataLayer.push(...);
</code></pre></div>
<p>The first line checks if dataLayer has already been declared. If it has, all is well, but if it hasn&rsquo;t, it is then and there declared as an Array. This basically makes it so that the push() method will almost always work. The only way it won&rsquo;t work is if dataLayer HAS been declared but as something other than an Array (pretty rare situation).</p>
<p>Note that when working in GTM (Custom HTML and Custom JavaScript), you won&rsquo;t have to add this check to your code, since the GTM container snippet will always declare dataLayer for you if you haven&rsquo;t done so explicitly in the page template.</p>
<p>Finally, the way that the Data Layer Variable Macro works is that when you give it a property whose value it must return, it starts going through the dataLayer properties one by one, starting from the newest. If it finds a property with the name you gave, it returns its value and stops traversing dataLayer. So if you have two objects in dataLayer with the property &lsquo;loggedIn&rsquo;, only <strong>the most recent property value</strong> will be returned by the Data Layer Variable Macro.</p>
<p>In layman&rsquo;s terms, this means that for Google Tag Manager, pushing an object into dataLayer with a property that already exists in dataLayer <strong>overwrites the previous property value with the new one</strong>. Of course, it doesn&rsquo;t really overwrite anything, but the Macro is only interested in the latest value.</p>
<p>There is a quirky exception to this, and that is if you push an Array into dataLayer.</p>
<p>If you then push another Array with the same name, GTM will only &lsquo;overwrite&rsquo; those Array indices that are shared by the two Arrays, but if the first Array had more indices, then those will remain for GTM to use. Allow me to demonstrate:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">dataLayer.push({<span style="color:#a50">&#39;products&#39;</span>: [<span style="color:#a50">&#39;a&#39;</span>, <span style="color:#a50">&#39;b&#39;</span>, <span style="color:#a50">&#39;c&#39;</span>, <span style="color:#a50">&#39;d&#39;</span>]});
...
dataLayer.push({<span style="color:#a50">&#39;products&#39;</span>: [<span style="color:#a50">&#39;e&#39;</span>, <span style="color:#a50">&#39;f&#39;</span>]});
</code></pre></div>
<p>In the first line, I push an Array with four members (a, b, c, d). A bit later on, I push another Array with the same name, but this time with just two members. If GTM would be consistent, the second time around the Data Layer Variable Macro would have just two members in the &lsquo;products&rsquo; Array, but right now GTM works so that it just overwrites the first two indices in the Array. Thus the Macro would actually see &lsquo;products&rsquo;: [&lsquo;e&rsquo;, &lsquo;f&rsquo;, &lsquo;c&rsquo;, &rsquo;d&rsquo;]. This is a bit buggy to me, as to be consistent the second Array push should make it so that the Macro only accesses the values in the second Array.</p>
<p>Phew, this was a lot of information, I hope you&rsquo;re still with me here.</p>

                
                  <h2 id="5-custom-html-tag">5. Custom HTML Tag</h2>
<p>A Custom HTML Tag allows you to inject HTML markup in the site. This means that if you want to run custom JavaScript in a Custom HTML Tag, you need to create the script context for the code. In HTML, you establish a script context with the <code>&lt;script&gt;</code> element:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">div</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;html_markup_here&#34;</span>&gt;This is still just normal HTML markup&lt;/<span style="color:#1e90ff;font-weight:bold">div</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
  alert(<span style="color:#a50">&#34;And this is JavaScript!&#34;</span>);
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>If you try to run JavaScript without the script block, you&rsquo;ll run into some serious validation errors.</p>
<p>Note that you don&rsquo;t need the legacy <strong>type=&quot;text/javascript&rdquo;</strong> attribute in your <code>&lt;script&gt;</code> tags, unless you&rsquo;re still using HTML4 (<em>gasp</em>) and you want your code to validate. All modern browsers can do the math and make the logical conclusion that a SCRIPT element with JavaScript code inside should be interpreted as, surprise surprise, JavaScript.</p>

                
                  <h2 id="6-custom-javascript-macro">6. Custom JavaScript Macro</h2>
<p>In Google Tag Manager, a macro is designed to return a value when it is called. That&rsquo;s why you have all those cool out-of-the-box macros out there, which each return some amazing piece of information about the site, the page, or the visitor.</p>
<p>If you haven&rsquo;t already, be sure to read <a href="https://www.simoahava.com/analytics/macro-guide-google-tag-manager/">my macro guide</a>, as it sheds more light on this topic.</p>
<p>With a Custom JavaScript Macro, it&rsquo;s function (pun intended) is also to return a value. If there&rsquo;s no return statement or if the macro isn&rsquo;t wrapped in a function (only functions can return values), you&rsquo;ll run into errors in GTM.</p>
<p>So here are the things to remember:</p>
<p><strong>1. Always wrap your Custom JavaScript macro in an anonymous function.</strong><br>
<strong>2. Always return a value (any value) with a Custom JavaScript macro</strong></p>
<p>An anonymous function is a function without a name. Why is this necessary? Well, you don&rsquo;t create a function in a macro so that you call it on a whim using its name. No, the sole reason for a JS macro&rsquo;s existence is that it&rsquo;s called and its value is resolved at the same time, using the {{macro}} syntax of GTM. This is, again, one of the ways GTM ensures that global variables are not being messed about with. If you could name your functions, you might be using a name reserved for some other library. This would potentially have nightmarish results.</p>
<p>And why return a value? Well, to reiterate, a macro&rsquo;s function is <em>to return a value</em>. When you call a JS macro, it resolves some operation right then and there with all the data available at the moment it was called. It then returns a value based on this operation. What would be the function of using the macro syntax {{macro}} in your fields if not to retrieve a value? Stop asking silly questions.</p>
<p>An example of a proper Custom JavaScript macro:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> <span style="color:#0aa">window</span>.location.href.toLowerCase();
}
</code></pre></div>
<p>Here you have an anonymous function declared on the first line, a return statement with the operation on the second line, and the closing of the function block on the third line.</p>
<p>When this macro is called, it returns the URL of the current page transformed into lower case. This is a prototypical GTM Custom JavaScript Macro. It&rsquo;s just an anonymous function which does not accept parameters. Thus its sole objective is to return a value, based on some operation on some other value that can be found in the document object model (more on this later). Remember that you can access other macros in your Custom JavaScript Macros, so you can do a lot of pretty complex stuff with Custom JavaScript macros. For example, the following macro returns the first folder in the URL path (e.g. &ldquo;simo&rdquo; in /simo/articles/analytics):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> {{url path}}.split(<span style="color:#a50">&#34;/&#34;</span>)[<span style="color:#099">1</span>];
}
</code></pre></div>
<p>A Custom JavaScript Macro is probably the most versatile tool you have available in your GTM toolbox, and you should definitely check out my other <a href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager posts</a> for creative ways to use them.</p>

                
                  <h2 id="conclusions">Conclusions</h2>
<p>Phew, that was a lot information there. I&rsquo;m going to have to split this into a two-parter, just to keep me motivated :)</p>
<p>I hope you take a look at the JavaScript resources I wrote of in the first chapter. Even if you&rsquo;re well versed in the craft of client-side programming, most of the time its good to refresh your knowledge with some &ldquo;basic stuff&rdquo;.</p>
<p>The thing with GTM is that in addition to functioning like your average JavaScript library, it comes along with certain proprietary features that require you to adapt your JavaScript skills somewhat. The purpose of this (and the following article) are just that: make you knowledgeable of what GTM requires from you and the code you create.</p>
<p><em>Here&rsquo;s the link to <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-2/">part 2 of this JavaScript guide</a>.</em></p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fix-ga-site-search-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fun-google-tag-manager-part-2/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%201%20https://www.simoahava.com/analytics/javascript-101-gtm-part-1/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fix-ga-site-search-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fun-google-tag-manager-part-2/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%201%20https://www.simoahava.com/analytics/javascript-101-gtm-part-1/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
          <i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=JavaScript%20101%20For%20GTM:%20Part%201%20https://www.simoahava.com/analytics/javascript-101-gtm-part-1/%20via%20@SimoAhava">
          <i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">
          <i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

