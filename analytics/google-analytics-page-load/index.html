

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Google Analytics And The Page Load | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2014/11/js-console.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/google-analytics-page-load/",
  "datePublished": "2014-11-19T16:18:42+00:00",
  "dateModified": "2014-11-19T16:18:42+00:00",
  "description": "An article describing how Google Analytics interacts with, and is influeced by, the page load of the web browser. The rendering process has implications for your web analytics setup.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.48 with theme Tranquilpeak 0.4.3-BETA">
    <title>Google Analytics And The Page Load | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/google-analytics-page-load/">
    
    <meta name="description" content="An article describing how Google Analytics interacts with, and is influeced by, the page load of the web browser. The rendering process has implications for your web analytics setup.">
    <meta property="og:description" content="An article describing how Google Analytics interacts with, and is influeced by, the page load of the web browser. The rendering process has implications for your web analytics setup.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Google Analytics And The Page Load">
    <meta property="og:url" content="/analytics/google-analytics-page-load/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Google Analytics And The Page Load">
    <meta name="twitter:description" content="An article describing how Google Analytics interacts with, and is influeced by, the page load of the web browser. The rendering process has implications for your web analytics setup.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2014/11/js-console.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2014/11/js-console.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Google Analytics And The Page Load
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2014-11-19T16:18:42Z">
        
  November 19, 2014

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/google-analytics-page-load/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p>If you use <a href="http://www.google.com/analytics/">Google Analytics</a>, <a href="http://tagmanager.google.com">Google Tag Manager</a>, or any JavaScript-based data collection or analytics platform, have you ever stopped to wonder how they actually work? I mean, you obviously care about getting the data in, but are you taking the machinations of these tools for granted?</p>

<p>This is something I&rsquo;ve been thinking about for a long while, because I&rsquo;m not so sure that many who work with these platforms actually understand how the browser and the web page interact.</p>

<p>That doesn&rsquo;t make sense. And it scares me a little.</p>

<p>Since the predominant paradigm for web analytics today revolves around JavaScript, it&rsquo;s important to have a sense of what the weak links in this technology are. Also, even before JavaScript kicks in, there are certain aspects of the page load process that you need to observe to get better quality data.</p>

<p>Fortunately, even the most basic understanding of these leads to elucidation: No, the tools do not cover 100 % of the visits to your site, no, &ldquo;pageviews&rdquo;, &ldquo;sessions&rdquo;, and &ldquo;users&rdquo; should not be taken literally, and no, it&rsquo;s most often not Google Tag Manager or Google Analytics that&rsquo;s at fault when tracking on your site fails. You&rsquo;ll find the real culprit by opening the JavaScript console on your darling website, but don&rsquo;t forget to close this dimension rift to the nether pits of the hell of all hells once you&rsquo;re done, lest some of the demon spawn gets through.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/js-console.png" title="JavaScript Console on the Ebay.com site">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/js-console.png#ZgotmplZ" alt="JavaScript Console on the Ebay.com site">
  
    </a>
  
  
</div>



<p>The core of this article boils down to a simple statement:</p>

<blockquote>The only way to evaluate the quality of the data you use is to understand how it was collected.</blockquote>

<p>Keeping this in mind, I want to take a look at the page load sequence in the user&rsquo;s browser, and what implications the different parts of the load process have on Google Analytics tracking.</p>

<h2 id="the-sequence-of-events-in-the-page-load">The sequence of events in the page load</h2>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/the-process.png" title="The Google Analytics process">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/the-process.png#ZgotmplZ" alt="The Google Analytics process">
  
    </a>
  
  
</div>



<p>This short essay (or long rant, however you want to see it) is split into a number of sections. Each section represents a stage in the intricate process of what takes place in the user&rsquo;s browser when they visit your website. Each part of this process has implications for how you can and should track the interactions this user has with your content.</p>

<ol>
<li><p>The Request - What happens when a user types an address into the location bar of the browser, and what are the pressure points for web tracking.</p></li>

<li><p>The Render - How the browser turns the source code into a living document.</p></li>

<li><p>The Race - How asynchronous JavaScript works, what race conditions are, and what you should watch out for.</p></li>

<li><p>The Interaction - Once the page is loaded, how are user interactions measured, and what are the biggest pitfalls here.</p></li>
</ol>

<p>As always, I wrap up with a summary.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/the-request.png" title="The Request">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/the-request.png#ZgotmplZ" alt="The Request">
  
    </a>
  
  
</div>



<p>Everything starts with the request.</p>

<p>When a user types your website address into the browser&rsquo;s location bar, the desired outcome is usually that they see a web page. In order for this to happen, the browser uses the HTTP protocol to issue a request to the machine that hides behind the address.</p>

<p>If there is a web server at that endpoint, if that endpoint has mapped the requested address to some resource, and if the request is valid (there&rsquo;s no additional authentication required, firewalls don&rsquo;t block the request, no security policies are violated etc.), the web server sends an &ldquo;OK&rdquo; response, most commonly with a <em>status code</em> 200, and the document that was mapped to the address in the response body.</p>

<p>This document is usually an HTML template file, i.e. the page source code, and the browser&rsquo;s job is to turn this document into a dynamic web page.</p>

<p>I mean, obviously, it&rsquo;s a much more intricate and complex process than this, but the key interaction here is what happens when the web server receives the request.</p>

<p>For successful collection of data to Google Analytics, there are some things here that you need to be aware of.</p>

<h3 id="1-404-resource-not-found">1) 404 - Resource not found</h3>

<p>If there is no resource mapped to the address the user requested, it means that the web server has to respond with a &ldquo;resource not found&rdquo; error. Now, at this point your web server should be configured so that if there is no resource to send to the user, a &ldquo;Page not found” template is served instead.</p>

<p><strong>You should have GA running on this page with a tag that tracks pageviews</strong>. <a href="http://www.lunametrics.com/blog/2014/08/19/404-errors-google-analytics-google-tag-manager/">404 page tracking</a> is a wonderful addition to the toolset of any savvy webmaster-slash-analyst.</p>

<p>If you haven&rsquo;t set up a template, the user might see the default error page served by your web server (they&rsquo;re usually pretty horrible), or, lacking that, the browser will cook up an error message instead (even more horrible). The key here is that if you don&rsquo;t have a custom template with the GA tracking code, you won&rsquo;t be able to track these hits in Google Analytics. For example, my <a href="http://www.gtmtools.com/">GTM Tools</a> serves the following, unhelpful, untrackable default page if no resource is found:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/bad-404-page.png" title="Bad 404 page">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/bad-404-page.png#ZgotmplZ" alt="Bad 404 page">
  
    </a>
  
  
</div>



<p>This is a bad practice. Use a custom template instead.</p>

<p>Check the <a href="http://www.lunametrics.com/blog/2014/08/19/404-errors-google-analytics-google-tag-manager/">Lunametrics post</a> if you want to see a great way of tracking 404 errors in GA and GTM!</p>

<h3 id="2-redirects">2) Redirects</h3>

<p>If you&rsquo;ve set up a redirect server-side, you must remember <strong>preserve query string parameters</strong> in the redirect! If you strip them out in the redirect, you&rsquo;ll risk losing important campaign tracking information.</p>

<p>This is essential to preserving data quality!</p>

<h3 id="3-single-page-apps">3) Single-page apps</h3>

<p>If your website is essentially a single-page app, where instead of the expected HTTP GET request, the user&rsquo;s browser sends POST calls, the rules of traditional page tracking change a little.</p>

<p>You can no longer trust the reset that occurs with every page load, since there are actually no page loads after the first one. Instead, you&rsquo;re going to have to come up with a new terminology for tracking your visitors. For some it&rsquo;s <a href="http://cutroni.com/blog/2014/02/12/advanced-content-tracking-with-universal-analytics/">scroll tracking</a>, via events or virtual pageviews, and for some it&rsquo;s tracking user interactions with the page, such as clicking on tabs or call-to-action buttons, and for some it&rsquo;s invoking GTM&rsquo;s <a href="https://www.simoahava.com/analytics/google-tag-manager-history-listener/">history listener</a>, which reacts to changes in browser state.</p>

<p>If you&rsquo;re using Google Tag Manager, an important aspect of these single-page apps is that the <a href="https://www.simoahava.com/analytics/data-layer/"><code>dataLayer</code> object</a> is not reset as it is with page refreshes. That&rsquo;s because in a web context, the painstakingly rendered web page with all its variables, objects, elements, texts, links, images, and other clutter is recreated with every page refresh. In other words, objects on a given page do not persist to other pages. With a single-page app, there is no page refresh, so there&rsquo;s no purge. The data layer is alive for the entire time the user stays on the page, meaning it&rsquo;s more than possible that anything you store into <code>dataLayer</code> and send to GA might be sent with subsequent hits as well.</p>

<p>With single-page apps, then, you need to be aware of the state of <code>dataLayer</code> at all times, and if necessary you need to emulate a page refresh by deleting keys that you don&rsquo;t want to persist:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
  <span style="color:#e6db74">&#39;key_to_be_deleted&#39;</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>
});
</code></pre></div>

<h3 id="4-don-t-be-idiot-idiosyncratic">4) Don&rsquo;t be idiot&hellip;idiosyncratic</h3>

<p>Finally, an important aspect of interacting with the web server is that many analytics platforms expect standard behavior from your server. So don&rsquo;t whip up your own custom responses if just the regular &ldquo;200 OK” will do. If you don&rsquo;t serve standard responses, it&rsquo;s possible that callbacks are not executed, hits don&rsquo;t get sent, and valuable data is lost again.</p>

<p>The key takeaway here is this:</p>

<blockquote>Adhere to best practices in template handling and server responses - your analytics tool will thank you with good data.</blockquote>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/the-render.png" title="The Render">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/the-render.png#ZgotmplZ" alt="The Render">
  
    </a>
  
  
</div>



<p>When the browser receives the source code, it does something inexcusable. It gives the website a break. You see, one of the reasons JavaScript is reviled and browser wars are raging is because errors are glossed over. Your site can have the most horrendous source code, but depending on the browser, it turns into an amazing, well-crafted, dynamic web document.</p>

<p>It&rsquo;s much like what Auto-Tune does to talentless singers. The music industry uses Auto-Tune to turn pitchy Idol dropouts into pop stars. In much the same way, the web browser turns a hideous piece of anti-code into a web page without actually telling the developer bluntly that they&rsquo;ve done a poor job.</p>

<p>Now, we can argue that Auto-Tune is a good thing, and we can argue that it&rsquo;s great that the browser helps you like this. But having a machine correct your singing is no excuse to stop trying to reach the correct pitch naturally, and having a browser fix your source code problems is no reason not to aim for good markup.</p>

<p>For analytics, this browser behavior has some implications.</p>

<p>Because every browser wants to be a bit better than the next, they have their own ways of parsing source code. Sometimes these idiosyncrasies are subtle enough to not make a dent, but sometimes they erupt into full-blown compatibility issues, polyfills, and disgruntled developers. At the heart of this tragedy is the analyst, who only wanted to know how many people leave a specific form field empty when submitting the contact form.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Classic example of browser compatibility checking
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">addEventListener</span>) {
  <span style="color:#75715e">// For real browsers
</span><span style="color:#75715e"></span>  document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#a6e22e">handleClick</span>);
} <span style="color:#66d9ef">else</span> {
  <span style="color:#75715e">// For IE8 and earlier
</span><span style="color:#75715e"></span>  document.<span style="color:#a6e22e">attachEvent</span>(<span style="color:#e6db74">&#39;onclick&#39;</span>, <span style="color:#a6e22e">handleClick</span>);
}
</code></pre></div>

<p>To combat these problems in the render process, it&rsquo;s often wise to adopt a framework. If you&rsquo;re tracking the &ldquo;traditional way&rdquo;, <a href="http://jquery.com">jQuery</a> is something you might want to take a look at. If you&rsquo;re using Google Tag Manager, well, you&rsquo;re already using a JavaScript framework. By leveraging the built-in features of GTM, such as <a href="https://www.simoahava.com/analytics/auto-event-tracking-gtm-2-0/">auto-event tracking</a> and <a href="https://support.google.com/tagmanager/answer/2574372">tag templates</a>, you&rsquo;re externalizing cross-browser woes to Google Tag Manager. It&rsquo;s the framework&rsquo;s job to take care that any features you want to use work across the wide variety of browsers and devices.</p>

<p>In some cases, even the smartest browser won&rsquo;t help you. These are called single points of failure, because they essentially disrupt the current execution context when an error occurs. If you run JavaScript such as the Universal Analytics tracking snippet in your page template, a single syntax error will break the current script context and the code will fail. Again, your browser is probably trying to be helpful and doesn&rsquo;t raise any alarms if this happens, so you&rsquo;ll need to do some debugging. Make the JavaScript console of your browser your new best friend. Use it religiously for debugging.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/js-console1.png" title="Open the JavaScript Console in Chrome">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/js-console1.png#ZgotmplZ" alt="Open the JavaScript Console in Chrome">
  
    </a>
  
  
</div>



<p>It&rsquo;s a shame if your entire tracking plan for a website fails because of a mistyped quote or a missing semicolon. Also, remember to watch out for formatted quotes. If you copy-paste from a document where quotes are formatted in some unorthodox way (such as Microsoft Word), you might run into trouble with JavaScript compilers, which expect regular, unformatted quotes in the code.</p>

<p>So the key takeaway in the render process is:</p>

<blockquote>Make sure that your [markup is valid](http://validator.w3.org/), and that your [JavaScript is flawless](http://jslint.com/). If your JavaScript is getting too complex to manage, take a look at a sustainable framework that will take some of the management overhead away.</blockquote>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/the-race.png" title="The Race">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/the-race.png#ZgotmplZ" alt="The Race">
  
    </a>
  
  
</div>



<p>JavaScript is single-threaded. This means that at any given time, only a single line of JavaScript can be executed. Thus, JavaScript is, by nature, blocking. Every line of JavaScript that is executed on the page template blocks the template until the line of code has been executed.</p>

<p>Before asynchronous JavaScript became the norm, we resorted to adding potentially risky JavaScript to the end of the document, at the very bottom. This reduced the risk of breaking down your entire web page if the JavaScript refused to agree with the browser. Also, if really large, external JS files were loaded, these calls were added to the end of the page as well, because the loading and the execution of the external file were queued in succession, meaning some severe page blocking would take place.</p>

<p>Well, today, we have asynchronous JavaScript. At the heart of asynchronous JavaScript are <em>callbacks</em>, which are functions that are executed once some action, usually a network request, is processed. So if, for example, your script performs an HTTP request, asynchronous JavaScript initiates the request, but immediately returns to the next line of code in the page template. As the request progresses, the callbacks are executed as soon as there&rsquo;s a spot open in the event queue. This way the code doesn&rsquo;t block the page load, as it&rsquo;s run &ldquo;in the background&rdquo;, only executing the callbacks once they are invoked by the original function.</p>

<p>Another place where you&rsquo;ll see asynchronous requests is when loading external JS libraries. Google Analytics and Google Tag Manager are both loaded asynchronously. This means that the request for loading the JavaScript file is sent asynchronously, and when the file is loaded and available, only then is the code within executed (and when there&rsquo;s a spot in the event queue). This way you can add these external library loads to the top of the page, ensuring that their load process begins as early as possible into the page load, but without risking them blocking your other code from running.</p>

<p>The downside of asynchronous JavaScript is that we can&rsquo;t really <strong>predict</strong> when a given script will finish executing. We&rsquo;ll know <em>when</em> it finishes thanks to the callbacks, but we can&rsquo;t pinpoint this moment in the page load sequence beforehand.</p>

<p>This behavior leads to something called race conditions. Race conditions occur when two scripts are loaded asynchronously, and the latter requires that the former complete first. An example would be event tracking in GA. You don&rsquo;t want to send an event hit before the pageview hit completes, because otherwise you&rsquo;ll end up with warped sessions, where landing page is (not set):</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/landing-page-not-set.png" title="Landing Page (not set)">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/landing-page-not-set.png#ZgotmplZ" alt="Landing Page (not set)">
  
    </a>
  
  
</div>



<p>If race conditions are at play, it doesn&rsquo;t matter that the event hit began its execution after the pageview. What matters is that the event can finish first, because we can&rsquo;t control asynchronous execution once it begins.</p>

<p>For GA and GTM, it&rsquo;s important that you recognize potential race conditions on your page. If you want to increase the odds of the pageview being sent before any subsequent hits, for example, you could set all other hits to wait at least until the DOM of the page has been loaded. This safety measure usually adds a tiny overhead to the execution of the tag that waits for DOMComplete, and it more often than not means that the pageview has had ample time to complete before any further hits are sent.</p>

<p>If it&rsquo;s not business critical data, you can even use the window load event as the hook for your other hits. The window has loaded when the page and all associated scripts have finished loading. If your code pushes data to GA after window load, it&rsquo;s almost 100 % certain that the pageview has finished executing. However, if you have a heavy page full of big, uncached images (boo!), and heaps of external JS files to load (boo boo!), it might be too long a wait for some impatient visitors. Thus any hits that wait for window load might not get sent, as the user has already navigated to another page.</p>

<p>The best way to make sure that asynchronous scripts load in sequence, and thus to avoid race conditions, is to use the callback of a successful hit as the trigger for the subsequent hits. So in your pageview, you can use the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#hitCallback">hitCallback</a> parameter to specify what happens once the tag has successfully fired. In this callback function, you can tell your other tags that it&rsquo;s ok to fire. With Google Tag Manager, <a href="https://www.simoahava.com/analytics/macro-magic-google-tag-manager/">using hitCallback</a> together with <code>dataLayer</code> makes it really easy to introduce some order into things.</p>

<p>Understanding race conditions is really important with eCommerce as well, especially if you use client-side HTTP requests to get the transaction data. It&rsquo;s all too common to see a transaction tag executing before the transaction data is available.</p>

<p>The takeaway of The Race is:</p>

<blockquote>Map out the dependencies between your tags, eradicate race conditions by using callbacks, and leverage asynchronous loading as much as possible.</blockquote>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/the-interaction.png" title="The Interaction">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/the-interaction.png#ZgotmplZ" alt="The Interaction">
  
    </a>
  
  
</div>



<p>Well all this page load stuff is marginally interesting, but it might not play a role in your idea of what web analytics is for, even though it should. But what you&rsquo;re definitely interested in is how to track interactions on the site.</p>

<p><strong>Interaction</strong> is a loaded term, because it&rsquo;s often difficult to pinpoint just what we mean by a user interaction. A click is surely an interaction, but is scroll an interaction? What about mouse movement, is that interaction? How about the shifting of the user&rsquo;s gaze to a different part of the site, surely that&rsquo;s not interaction? Well, it might be.</p>

<p>The thing is that depending on what you want to track, you might be facing a lot of problems in implementing the system that collects the data. Something as simple as a click handler can be difficult to implement if you&rsquo;re not aware of what possible conflicts there are with your other JavaScript handlers.</p>

<p>This conflict resolution covers around 75 % of the most frequently asked questions about Google Tag Manager. I&rsquo;ve written about this extensively before, so if you want in-depth details around the <em>event propagation</em> problem, take a look at this article:</p>

<p><a href="https://www.simoahava.com/analytics/dont-gtm-listeners-work/">Why Don&rsquo;t My GTM Listeners Work?</a></p>

<p>The key here is to understand how the document object model works, especially in terms of event delegation. Often it&rsquo;s most economical to add just a single listener on a page, and then just pick up events using event delegation. However, if you have conflicting script on the page, this might not work, and you have to come up with a workaround. Here&rsquo;s a simplified version of the problem:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2014/11/event-propagation.gif" title="Event propagation visualized">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2014/11/event-propagation.gif#ZgotmplZ" alt="Event propagation visualized">
  
    </a>
  
  
</div>



<p>This visualization shows how the <code>submit()</code> event starts propagating up the document tree, and once it reaches GTM&rsquo;s listeners on the <code>document</code> node the <a href="https://www.simoahava.com/analytics/auto-event-tracking-gtm-2-0/">auto-event tracking</a> kicks in. It also shows you what happens if there&rsquo;s an intruding call to <code>stopPropagation()</code> on the event object.</p>

<p>But that&rsquo;s GTM. When you&rsquo;re tracking with traditional GA, you can again use jQuery for easy, cross-browser event handling. The thing is that the more you leverage different frameworks, the more possibilities there are that things go awry.</p>

<p>With interaction tracking, it&rsquo;s so important to establish a discussion with your front-end developers. If you start injecting stuff onto the site that doesn&rsquo;t play well with existing script infrastructure, you&rsquo;ll have far bigger problems than data pollution. Your forms might not work any more, tabs which were supposed to change the content dynamically start redirecting you to completely different pages, elements flicker in and out annoyingly, and so forth.</p>

<p>So the key takeaway for interaction tracking is this:</p>

<blockquote>Only track what you think is useful to track, and always test thoroughly for conflicts</blockquote>

<h2 id="the-summary">The Summary</h2>

<p>I hate just scratching the surface in articles, but we&rsquo;re already past 3,000 words and if you made it this far you deserve a huge thank you.</p>

<p>Analytics is all-encompassing. It can permeate every single platform you use, aggregating information from a wide variety of data sources in one, centralized location. However, to get your web analytics working to the max, I strongly believe that an understanding of the page load process, even on a high level, is crucial. This article only scratched the surface, so you might want to take a look at the following resources to expand your mind:</p>

<ul>
<li><p>The Request: <a href="http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/">How Browsers Work</a></p></li>

<li><p>The Request: <a href="http://www.atlantaanalytics.com/practicing-web-analytics/how-does-google-analytics-handle-301-and-302-redirects/">Google Analytics And <sup>301</sup>&frasl;<sub>302</sub> Redirects</a></p></li>

<li><p>The Render: <a href="https://www.w3.org/community/webed/wiki/Optimizing_content_for_different_browsers:_the_RIGHT_way">Optimizing Content For Different Browsers</a></p></li>

<li><p>The Render: <a href="http://www.quirksmode.org/compatibility.html">QuirksMode: Compatibility overview</a></p></li>

<li><p>The Race: <a href="http://www.html5rocks.com/en/tutorials/async/deferred/">Asynchronous JavaScript Programming</a></p></li>

<li><p>The Race: <a href="https://www.simoahava.com/gtm-tips/hitcallback-eventcallback/">#GTMTips: hitCallback And eventCallback</a></p></li>

<li><p>The Interaction: <a href="https://www.simoahava.com/analytics/custom-event-listeners-gtm/">Custom Event Listener for GTM</a></p></li>

<li><p>The Interaction: <a href="http://www.swellpath.com/2014/08/google-tag-manager-events-using-html5-data-attributes/">Google Tag Manager Events Using HTML5 Data Attributes</a></p></li>
</ul>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/dom/">dom</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">Guide</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/fix-problems-with-gtm-listeners/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/migrate-containers-to-new-ui/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Analytics%20And%20The%20Page%20Load%20https://www.simoahava.com/analytics/google-analytics-page-load/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/fix-problems-with-gtm-listeners/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/migrate-containers-to-new-ui/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Google%20Analytics%20And%20The%20Page%20Load%20https://www.simoahava.com/analytics/google-analytics-page-load/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/google-analytics-page-load/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Google%20Analytics%20And%20The%20Page%20Load%20https://www.simoahava.com/analytics/google-analytics-page-load/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/google-analytics-page-load/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

