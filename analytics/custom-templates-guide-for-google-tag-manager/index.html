

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Custom Templates Guide For Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2019\/01\/custom-templates-google-tag-manager.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/custom-templates-guide-for-google-tag-manager\/",
  "datePublished": "2019-05-23T18:00:00\u002b03:00",
  "dateModified": "2019-05-23T18:00:00\u002b03:00",
  "description": "A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Custom Templates Guide For Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/">
    
    <meta name="description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.">
    <meta property="og:description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Custom Templates Guide For Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Custom Templates Guide For Google Tag Manager">
    <meta name="twitter:description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2019/01/custom-templates-google-tag-manager.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2019/01/custom-templates-google-tag-manager.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Custom Templates Guide For Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2019-05-23T18:00:00&#43;03:00">
        
  May 23, 2019

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <blockquote>
<p><strong>Last updated 12 August 2020</strong>: Added details about <a href="https://www.simoahava.com/analytics/server-side-tagging-google-tag-manager/">server-side tagging</a>.</p>
</blockquote>
<p>As I have finally managed to pick up my jaw from the floor, it&rsquo;s now time to tell you what&rsquo;s got me so excited. <a href="https://tagmanager.google.com/">Google Tag Manager</a> recently released a new feature called <a href="https://developers.google.com/tag-manager/templates/"><strong>Custom Templates</strong></a>. Actually, it&rsquo;s not fair to call it a <em>feature</em>. It&rsquo;s a full-blown paradigm shift in how we use Google Tag Manager. It&rsquo;s a <em>suite</em> of features designed to help brands, companies, and users create and share their own custom JavaScript and HTML setups with ease, while taking care that the code is optimized for delivery in the web browser.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/custom-templates-google-tag-manager.jpg" title="custom templates in google tag manager">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/custom-templates-google-tag-manager.jpg#ZgotmplZ" alt="custom templates in google tag manager" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2626 942'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Custom Templates</strong>, in short, are tag, variable, and Client templates that <strong>you</strong> can create and configure. In other words, if you have a cool idea for a tag (e.g. an analytics tracking tag for a vendor not natively supported by GTM), a variable (e.g. a Custom JavaScript variable that does something with a string), or a Client (e.g. a server-side endpoint for some new analytics tool), you can now turn them into reusable templates which can, in turn, be shared with other users and containers via template export and import. You can also use the <a href="https://tagmanager.google.com/gallery/">Community gallery</a> to distribute your templates.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/template-in-the-list.jpg" title="Example template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/template-in-the-list.jpg#ZgotmplZ" alt="Example template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1574 382'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Templates use a customized, sandboxed version of JavaScript, which has its own idiosyncratic vernacular that you must learn (with the help of this guide, of course). The reason for this added complexity is that with templates you can ensure that the code being executed is safe, unintrusive, and optimized.</p>
<p>Furthermore, templates you create will define certain <strong>permissions</strong> that are required for the template code to be able to run. An additional level of governance is provided by way of <strong>policies</strong> defined on the web page itself where the template code might be run. The interplay between these permissions and policies is a core feature of template security.</p>
<p>There are lots and lots of things to cover in this guide, so let&rsquo;s just get started.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#how-to-read-this-guide">How to read this guide</a></li>
    <li><a href="#custom-templates-in-a-nutshell">Custom Templates in a nutshell</a></li>
    <li><a href="#getting-started">Getting started</a>
      <ul>
        <li><a href="#tag-template-walkthrough">Tag template walkthrough</a>
          <ul>
            <li><a href="#step-1---create-and-set-the-details-of-the-tag-template">Step 1 - Create and set the details of the tag template</a></li>
            <li><a href="#step-2---create-the-ui">Step 2 - Create the UI</a></li>
            <li><a href="#step-3---add-some-code">Step 3 - Add some code</a></li>
            <li><a href="#step-4---modify-permissions">Step 4 - Modify permissions</a></li>
            <li><a href="#step-5---preview-and-test">Step 5 - Preview and test</a></li>
            <li><a href="#step-6---create-tag-and-preview">Step 6 - Create tag and preview</a></li>
            <li><a href="#step-7---youre-done">Step 7 - You&rsquo;re done!</a></li>
          </ul>
        </li>
        <li><a href="#variable-template-walkthrough">Variable template walkthrough</a>
          <ul>
            <li><a href="#step-1---create-and-set-the-details-of-the-variable-template">Step 1 - Create and set the details of the variable template</a></li>
            <li><a href="#step-2---create-the-ui-1">Step 2 - Create the UI</a></li>
            <li><a href="#step-3---add-some-code-1">Step 3 - Add some code</a></li>
            <li><a href="#step-4---modify-permissions-1">Step 4 - Modify permissions</a></li>
            <li><a href="#step-5---create-variable-add-to-tag-and-preview">Step 5 - Create variable, add to tag, and preview</a></li>
            <li><a href="#step-7---youre-done-1">Step 7 - You’re done!</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#core-concepts">Core concepts</a>
      <ul>
        <li><a href="#sandboxed-javascript">Sandboxed JavaScript</a></li>
        <li><a href="#es6-syntax">ES6+ syntax</a></li>
        <li><a href="#restrictions-to-what-type-of-data-you-can-handle">Restrictions to what type of data you can handle</a></li>
        <li><a href="#template-apis">Template APIs</a></li>
        <li><a href="#server-side-tagging">Server-side tagging</a></li>
        <li><a href="#policies">Policies</a></li>
        <li><a href="#tests">Tests</a></li>
      </ul>
    </li>
    <li><a href="#official-documentation">Official documentation</a></li>
    <li><a href="#the-editor">The editor</a>
      <ul>
        <li><a href="#info-view">Info view</a></li>
        <li><a href="#fields-editor">Fields editor</a>
          <ul>
            <li><a href="#field-configuration">Field configuration</a></li>
            <li><a href="#text-input">Text input</a></li>
            <li><a href="#drop-down-menu">Drop-down menu</a></li>
            <li><a href="#checkbox">Checkbox</a></li>
            <li><a href="#radio-buttons">Radio buttons</a></li>
            <li><a href="#simple-table">Simple table</a></li>
            <li><a href="#param-table">Param table</a></li>
            <li><a href="#group">Group</a></li>
            <li><a href="#label">Label</a></li>
            <li><a href="#utilizing-apis">Utilizing APIs</a></li>
            <li><a href="#the-data-object">The <code>data</code> object</a></li>
            <li><a href="#variable-templates-in-the-code-editor">Variable templates in the code editor</a></li>
            <li><a href="#tag-templates-in-the-code-editor">Tag templates in the code editor</a></li>
            <li><a href="#client-templates-in-the-code-editor">Client templates in the code editor</a></li>
          </ul>
        </li>
        <li><a href="#permissions">Permissions</a>
          <ul>
            <li><a href="#accesses-global-variables">Accesses Global Variables</a></li>
            <li><a href="#accesses-local-storage">Accesses Local Storage</a></li>
            <li><a href="#accesses-template-storage">Accesses Template Storage</a></li>
            <li><a href="#reads-cookie-values">Reads Cookie Value(s)</a></li>
            <li><a href="#reads-referrer-url">Reads Referrer URL</a></li>
            <li><a href="#reads-url">Reads URL</a></li>
            <li><a href="#injects-hidden-iframes">Injects Hidden Iframes</a></li>
            <li><a href="#injects-scripts">Injects Scripts</a></li>
            <li><a href="#logs-to-console">Logs To Console</a></li>
            <li><a href="#reads-data-layer">Reads Data Layer</a></li>
            <li><a href="#reads-document-character-set">Reads Document Character Set</a></li>
            <li><a href="#reads-container-data">Reads Container Data</a></li>
            <li><a href="#reads-event-metadata">Reads Event Metadata</a></li>
            <li><a href="#reads-document-title">Reads Document Title</a></li>
            <li><a href="#sends-pixels">Sends Pixels</a></li>
            <li><a href="#sets-a-cookie-value">Sets A Cookie Value</a></li>
          </ul>
        </li>
        <li><a href="#tests-1">Tests</a></li>
        <li><a href="#template-preview">Template preview</a></li>
        <li><a href="#importing-and-exporting">Importing and exporting</a></li>
        <li><a href="#advanced-settings">Advanced settings</a></li>
        <li><a href="#running-the-template-code">Running the template code</a></li>
      </ul>
    </li>
    <li><a href="#templates-in-gtms-preview-mode">Templates in GTM&rsquo;s Preview mode</a></li>
    <li><a href="#field-configuration-reference">Field configuration reference</a>
      <ul>
        <li><a href="#edit-row-dialog-title">&ldquo;Edit row&rdquo; dialog title</a></li>
        <li><a href="#new-row-button-text">&ldquo;New row&rdquo; button text</a></li>
        <li><a href="#new-row-dialog-title">&ldquo;New row&rdquo; dialog title</a></li>
        <li><a href="#not-set-option">&ldquo;Not set&rdquo; option</a></li>
        <li><a href="#allow-empty-strings">Allow empty strings</a></li>
        <li><a href="#always-in-summary">Always in summary</a></li>
        <li><a href="#clear-on-copy">Clear on copy</a></li>
        <li><a href="#default-value">Default value</a></li>
        <li><a href="#display-line-count">Display line count</a></li>
        <li><a href="#display-message-when-not-set">Display message when not set</a></li>
        <li><a href="#display-name">Display name</a></li>
        <li><a href="#enabling-conditions">Enabling conditions</a></li>
        <li><a href="#group-style">Group style</a></li>
        <li><a href="#help-text">Help text</a></li>
        <li><a href="#include-variables">Include variables</a></li>
        <li><a href="#nested-fields">Nested fields</a></li>
        <li><a href="#text-as-list">Text as list</a></li>
        <li><a href="#validation-rules">Validation rules</a></li>
        <li><a href="#value-hint">Value hint</a></li>
        <li><a href="#value-unit">Value unit</a></li>
      </ul>
    </li>
    <li><a href="#policies-reference">Policies reference</a>
      <ul>
        <li><a href="#access_globals">access_globals</a></li>
        <li><a href="#get_cookies">get_cookies</a></li>
        <li><a href="#get_referrer">get_referrer</a></li>
        <li><a href="#get_url">get_url</a></li>
        <li><a href="#inject_hidden_iframe">inject_hidden_iframe</a></li>
        <li><a href="#inject_script">inject_script</a></li>
        <li><a href="#logging">logging</a></li>
        <li><a href="#read_character_set">read_character_set</a></li>
        <li><a href="#read_data_layer">read_data_layer</a></li>
        <li><a href="#read_event_metadata">read_event_metadata</a></li>
        <li><a href="#read_title">read_title</a></li>
        <li><a href="#send_pixel">send_pixel</a></li>
        <li><a href="#set_cookies">set_cookies</a></li>
      </ul>
    </li>
    <li><a href="#final-thoughts">Final thoughts</a></li>
  </ul>
</nav></div>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="how-to-read-this-guide">How to read this guide</h2>
<p>This is a long guide. It has to be - there&rsquo;s so much about custom templates that needs to be addressed in any document whose purpose is to provide a comprehensive treatment of the subject matter.</p>
<p>However, <strong>don&rsquo;t interpret my inability to write concise prose as indicative of how complex custom templates are</strong>. I can assure you - they&rsquo;re absolutely manageable by anyone who&rsquo;s been using Google Tag Manager for a while.</p>
<p>This guide is a <strong>reference</strong>. Its purpose is to offer you documentation to support your work with custom templates.</p>
<p>Because of this, I want to suggest some different ways to approach this guide.</p>
<ul>
<li>
<p><strong>Everyone</strong> should read the chapters <a href="#custom-templates-in-a-nutshell">Custom Templates in a nutshell</a> and <a href="#core-concepts">Core concepts</a>.</p>
</li>
<li>
<p>I really recommend that <strong>everyone</strong> take a look at the two walkthroughs in the <a href="#getting-started">Getting started</a> chapter.</p>
</li>
<li>
<p>Keep the <a href="#official-documentation">Official documentation</a> handy at all times, particularly the API references for <a href="https://developers.google.com/tag-manager/templates/api">web templates</a> and for <a href="https://developers.google.com/tag-manager/serverside/api">server-side templates</a>.</p>
</li>
<li>
<p>When working with templates, the <a href="#field-editor">Fields editor</a> (with a deep-dive into <a href="#field-configuration-reference">Field configurations</a>) chapter should be very useful - same as the one on <a href="#permissions">Permissions</a>.</p>
</li>
<li>
<p>If you&rsquo;re a site admin, you might want to read through the <a href="#policies-reference">Policies reference</a> to get an idea of how you can further restrict the execution of custom code on your site.</p>
</li>
<li>
<p>If you suffer from insomnia, start from the beginning and don&rsquo;t stop until you fall asleep. Should happen by the 10,000 word mark.</p>
</li>
</ul>
<p>Be sure to check out my other guide on how to <a href="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">create a Facebook pixel template</a> - it should shed more light on how templates work. You can also check the corresponding <a href="https://youtu.be/5ESEtwq7fxc">video</a> if you prefer watching rather than reading.</p>
<p>You can also view all the custom templates I have created and/or collected in <a href="https://github.com/sahava/GoogleTagManagerTemplates">this GitHub repository</a> and in the <a href="https://www.simoahava.com/custom-templates/">Templates</a> section of this site.</p>

                
                  <h2 id="custom-templates-in-a-nutshell">Custom Templates in a nutshell</h2>
<p>Google Tag Manager&rsquo;s Custom Templates offer a way to build a user interface around the custom code you might want to run on the site using Google Tag Manager. The user interface is what you&rsquo;ve come accustomed to when using GTM&rsquo;s tags and variables. It comprises <strong>text input fields</strong>, <strong>settings</strong>, <strong>tables</strong>, <strong>labels</strong>, <strong>drop-down menus</strong>, and so forth.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/tag-template-before-after.jpg" title="Tag template before and after">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/tag-template-before-after.jpg#ZgotmplZ" alt="Tag template before and after" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2972 1078'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Obviously, the UI itself is already a huge asset. Being able to offer a user interface in lieu of a complicated code block will minimize problems arising from input errors, and will help keep the code stable.</p>
<p>However, the templates have another, less apparent (but no less impactful) function. They add layers of <strong>protection</strong> and <strong>security</strong> to the code they abstract. Templates use a <a href="#sandboxed-javascript">custom <strong>JavaScript framework</strong></a> which introduces a handful of <a href="#template-apis">APIs</a> (application programming interfaces) that you must use if you want the code to actually do anything.</p>
<p>This introduces a steep learning curve, because you can&rsquo;t just copy-paste code from <a href="https://www.stackoverflow.com/">Stack Overflow</a> any more. If you want to set a global <code>window</code> property, you need to use <a href="https://developers.google.com/tag-manager/templates/api#setinwindow">an API for that</a>. If you want to log to console, you need to use <a href="https://developers.google.com/tag-manager/templates/api#logtoconsole">an API for that</a>. If you want to check the value of a cookie, guess what, you need to use <a href="https://developers.google.com/tag-manager/templates/api#getcookievalues">an API for that</a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/api-in-use.jpg" title="API in use">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/api-in-use.jpg#ZgotmplZ" alt="API in use" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1872 410'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Basically any code that tries to access the global state of the page or run any native JavaScript functions defined on the global level requires an API call.</p>
<p>So why this added complexity? Well, for one, these APIs make sure that potentially dangerous and/or intrusive modifications to the global state are done in a controlled manner.</p>
<p>Whenever you want to use an API, you must <code>require()</code> it in the template code. And when you introduce an API like that, the template automatically generates a set of configurable <a href="#permissions">permissions</a> for that API call.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/api-permissions.jpg" title="API permissions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/api-permissions.jpg#ZgotmplZ" alt="API permissions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1932 496'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In a nutshell, templates encapsulate the logic you would otherwise introduce with custom code. By introducing APIs with <strong>permissions</strong>, the templates can be configured to work in a secure and easily managed context.</p>
<p>An added level of security is the introduction of <a href="#policies-reference"><strong>policies</strong></a>, where you as the site owner can add some code to the web page itself, which can have additional levels of control over how template permissions are resolved.</p>
<p>For example, if I have a tag configured to send hits to some endpoint, I can write a policy on the page that only allows pixel requests to one of the many endpoints configured in the tag.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
<span style="color:#00a">function</span> gtag(){dataLayer.push(arguments);}

gtag(<span style="color:#a50">&#39;policy&#39;</span>, <span style="color:#a50">&#39;send_pixel&#39;</span>, <span style="color:#00a">function</span>(container, policy, data) {
  <span style="color:#00a">if</span> (data.url !== <span style="color:#a50">&#39;https://snowplow.simoahava.com/i&#39;</span>) {
    <span style="color:#00a">throw</span>(<span style="color:#a50">&#39;Invalid pixel endpoint!&#39;</span>);
  } <span style="color:#00a">else</span> {
    <span style="color:#00a">return</span> <span style="color:#00a">true</span>;
  }
});
</code></pre></div>
<p>With that policy in place, the image request will only be executed if the endpoint URL is <code>https://snowplow.simoahava.com/i</code>. Otherwise, the tag will fail in an error, and you can see the error message in the <a href="https://www.simoahava.com/analytics/new-errors-tab-preview-mode/"><strong>Errors</strong> tab</a> of Preview mode.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/tag-errors.jpg" title="Tag errors">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/tag-errors.jpg#ZgotmplZ" alt="Tag errors" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1066 227'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>An additional perk of using templates is that you don&rsquo;t have to add the nasty <code>unsafe-eval</code> keyword to your <a href="https://www.simoahava.com/analytics/google-tag-manager-content-security-policy/">Content Security Policy</a>. Any code run through a template is compiled into JavaScript when the container is written, and thus doesn&rsquo;t require the use of <code>eval()</code>.</p>
<p>Conversely, with Custom HTML tags and Custom JavaScript variables, the code is written into a string which is then compiled with <code>eval()</code> at runtime. This is a bad practice and requires a huge compromise in security if using a Content Security Policy.</p>
<p>I hope you can see the usefulness of Custom Templates. Imagine a library of Custom Templates, where anyone can share their own work for others to download and use in their containers. Smaller brands and companies could finally get their tools and platforms out there for the masses using Google Tag Manager.</p>
<blockquote>
<p><strong>Update 2 October 2019</strong>: You no longer have to imagine such a library as it now exists. Check out the <a href="https://tagmanager.google.com/gallery/">Community Template Gallery</a> as well as my <a href="https://www.simoahava.com/analytics/introducing-tag-manager-template-gallery/">introduction</a> to it.</p>
</blockquote>

                
                  <h2 id="getting-started">Getting started</h2>
<p>Before exhausting you with all the details about custom templates (and trust me, there&rsquo;s a <strong>lot</strong> to digest in the feature), I want to start by walking you through creating a <strong>tag template</strong> and a <strong>variable template</strong>. We won&rsquo;t use all the most complex features for this, but it should serve as a nice intro to how custom templates work in Google Tag Manager.</p>
<p>Be sure to check out <a href="https://www.simoahava.com/gtm-tips/build-custom-universal-analytics-client-server-side-tagging/">this guide</a> for a walkthrough of building a Client template for <strong>server-side tagging</strong>.</p>
<p>Don&rsquo;t forget to check out my other article, which covers the creation of a <a href="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">Facebook pixel template</a>. It should provide a more comprehensive (and more overwhelming) look at how templates are created.</p>
<h3 id="tag-template-walkthrough">Tag template walkthrough</h3>
<p>In this walkthrough, we&rsquo;ll go through how to create a simple <strong>script injection tag</strong>. This is how many of the third-party vendors out there want their scripts to be loaded.</p>
<p>We&rsquo;ll use a wonderful company called <a href="https://conductrics.com/">Conductrics</a> as an example. They have developed a tool with which you can do A/B-testing and personalization, using ML-driven targeting logic, dynamic goals, server-side and client-side deployment options, and a whole host of other features to help you answer those difficult business questions you have with <strong>data</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/conductrics.jpg" title="Conductrics tag template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/conductrics.jpg#ZgotmplZ" alt="Conductrics tag template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1860 832'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Note!</strong> You can of course replace the Conductrics-specific stuff with some other vendor source URL, if you want. The steps you take in this guide would still be identical.</p>
<p>The tag template is simple, by design. Conductrics offers the option to host the required JavaScript for you, so all you need to do is add the <code>&lt;script&gt;</code> tag to the page that loads the JavaScript library from Conductrics&rsquo; server.</p>
<p>However, I&rsquo;ve added some UI sugar to make the setup slightly more interesting.</p>
<p>Basically, all templates comprise four components:</p>
<ol>
<li>
<p>The details, which determine the template name, logo, and description.</p>
</li>
<li>
<p>The user interface, which governs the fields and field configurations the template has.</p>
</li>
<li>
<p>The code editor, which makes use of whatever the user input into the fields to run the actual template code.</p>
</li>
<li>
<p>Permissions, which determine what type of code can be run by the tag.</p>
</li>
</ol>
<p>We&rsquo;ll walk through each of these steps here.</p>
<h4 id="step-1---create-and-set-the-details-of-the-tag-template">Step 1 - Create and set the details of the tag template</h4>
<p>The first thing you need to do is create a new tag template:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/create-new-tag-template.jpg" title="Create new tag template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/create-new-tag-template.jpg#ZgotmplZ" alt="Create new tag template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2484 916'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, fill in some details. For the image, I used <a href="https://dribbble.com/shots/584991--Process">the logo</a> created by Conductrics&rsquo; brand designer <a href="https://dribbble.com/shablazm/projects/58695-Conductrics">Joshua McCowen</a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/conductrics-settings.jpg" title="Conductrics settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/conductrics-settings.jpg#ZgotmplZ" alt="Conductrics settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1558 1112'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can <strong>Save</strong> the template by clicking the respective icon in the top-right corner now. You should see the logo and the template title in the preview window.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/tag-preview.jpg" title="Tag preview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/tag-preview.jpg#ZgotmplZ" alt="Tag preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1888 570'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>There! Almost done. Well, not quite.</p>
<h4 id="step-2---create-the-ui">Step 2 - Create the UI</h4>
<p>Now we need to create the bells and whistles of the tag&rsquo;s actual user interface.</p>
<p>First, click the <strong>Fields</strong> tab to open the <a href="#fields-editor">Fields editor</a>. Then, click the blue <strong>Add Field</strong> button.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/add-field-button.jpg" title="Add field button">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/add-field-button.jpg#ZgotmplZ" alt="Add field button" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 924 400'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the overlay that opens, select <strong>Text input</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/choose-text-input.jpg" title="Choose text input">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/choose-text-input.jpg#ZgotmplZ" alt="Choose text input" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1436 464'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You should see a <a href="#text-input">text input</a> field appear in the Fields editor. Rename the field to <strong>sourceUrl</strong>, and edit the <a href="#display-name">Display name</a> setting. The field name is used in the code editor, and the <strong>Display name</strong> setting is what the user sees above the field when editing the tag settings.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/rename-text-field.jpg" title="Rename the text field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/rename-text-field.jpg#ZgotmplZ" alt="Rename the text field" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1900 568'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The UI could be ready now - it&rsquo;s really the only field and the only configuration you&rsquo;d need.</p>
<p>But let&rsquo;s make it a bit more robust by adding some <strong>validation</strong>.</p>
<p>Click the <strong>cogwheel</strong> icon associated with the field to open the <a href="#field-configuration">Field configuration</a> overlay. In the overlay, make sure <strong>Display name</strong>, <strong>Help text</strong>, and <strong>Validation rules</strong> are all toggled <strong>ON</strong>.</p>
<p>Each field type has its own set of configurations you can edit to make the field more versatile.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/field-configurations.jpg" title="Field configurations">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/field-configurations.jpg#ZgotmplZ" alt="Field configurations" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2382 1390'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Close the overlay by clicking the <strong>X</strong> in the corner, or anywhere outside the overlay.</p>
<p>Next, add some <a href="#help-text">Help text</a>. Help text can be seen by hovering over the little question mark next to the Display name when editing the tag.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/add-help-text.jpg" title="Add help text">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/add-help-text.jpg#ZgotmplZ" alt="Add help text" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3624 1058'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can <strong>Save</strong> the template periodically to refresh the template preview and see the changes there.</p>
<p>Next, let&rsquo;s add some <a href="#validation-rules">Validation rules</a>. These can be used to ensure the user adds valid values to the fields.</p>
<p>Click <strong>Add rule</strong> and edit the rule to <strong>match a regular expression</strong> where the expression is <code>^https://.*</code>. Validation regular expressions look for <strong>full matches only</strong>, so you need to add leading and/or trailing <code>.*</code> to use an open-ended pattern.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/first-validation-rule.jpg" title="First validation rule">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/first-validation-rule.jpg#ZgotmplZ" alt="First validation rule" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1820 516'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, click the little action menu in the top corner of the validation rule box, and select <strong>Show advanced settings</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/show-advanced-settings.jpg" title="Show advanced settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/show-advanced-settings.jpg#ZgotmplZ" alt="Show advanced settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1326 374'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Validation rules have two advanced settings. The first is where you can provide a <strong>custom error message</strong> (which we&rsquo;ll use). The second is one where you can establish conditions for <strong>when</strong> this validation rule is active (or inactive).</p>
<p>In this case, let&rsquo;s add a descriptive error message. Set the <strong>Error message</strong> field to <code>The URL must start with &quot;https://&quot;.</code>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/error-message.jpg" title="Error message">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/error-message.jpg#ZgotmplZ" alt="Error message" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 986 362'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can now quickly <strong>test</strong> how this works. Click <strong>Save</strong> in the top right corner, then click the tag template in the preview mode to enter edit mode. Add some string to the text input field that <strong>doesn&rsquo;t</strong> start with &ldquo;https://&rdquo;, and click the <strong>Test</strong> button in the top-right corner. You should see your error message.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/error-message-shown.jpg" title="Error message shown">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/error-message-shown.jpg#ZgotmplZ" alt="Error message shown" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1868 986'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Cool, right?</p>
<p>Let&rsquo;s add <strong>two</strong> more validation rules. Make them look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/last-validation-rules.jpg" title="Last validation rules">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/last-validation-rules.jpg#ZgotmplZ" alt="Last validation rules" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1750 1306'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The first rule ensures that the script is loaded from a <code>*.conductrics.com</code> domain, and the second rule requires that the script URL has the <code>apikey</code> parameter.</p>
<p>One final thing we&rsquo;ll add to the user interface is a simple <strong>debug</strong> toggle.</p>
<p>Click the <strong>Add field</strong> button, and select <strong>Checkbox</strong> from the overlay.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/checkbox.jpg" title="Checkbox">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/checkbox.jpg#ZgotmplZ" alt="Checkbox" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1362 550'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Set the field name to <strong>debug</strong>, and set the <strong>Checkbox text</strong> field to <strong>Log debug messages to console</strong>. Feel free to save the template to see how the checkbox looks like in the wild.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/checkbox-in-preview.jpg" title="Checkbox in template preview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/checkbox-in-preview.jpg#ZgotmplZ" alt="Checkbox in template preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2852 796'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>We&rsquo;re all done with the UI, finally!</p>
<h4 id="step-3---add-some-code">Step 3 - Add some code</h4>
<p>Now, select the <strong>Code</strong> tab from the template editor. You should see some boilerplate code that will help you get started (we&rsquo;ll replace this with some other stuff soon enough).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/code-editor-template.jpg" title="Code editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/code-editor-template.jpg#ZgotmplZ" alt="Code editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1904 758'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>For <strong>tag</strong> templates, the code you write has three components you need to be aware of.</p>
<ul>
<li>
<p>The <strong>code format</strong> itself, which utilizes a special, <a href="#sandboxed-javascript">sandboxed JavaScript</a>. This sandboxed JS offers a bunch of <a href="#template-apis">template APIs</a> you can use to work with JavaScript outside the scope of the code itself (access <code>dataLayer</code>, write cookies, and so forth).</p>
</li>
<li>
<p>The <code>data</code> object, which comprises the contents of the tag fields the user might have interacted with.</p>
</li>
<li>
<p>The <code>data.gtmOnSuccess()</code> and <code>data.gtmOnFailure()</code> methods, which indicate success or failure, respectively, of the tag execution.</p>
</li>
</ul>
<p>With these three in mind, we need to do the following.</p>
<ol>
<li>
<p>We need the tag to load Conductrics&rsquo; JavaScript from their network, which means we&rsquo;ll utilize the <a href="https://developers.google.com/tag-manager/templates/api#injectscript"><code>injectScript</code> API</a> to do so.</p>
</li>
<li>
<p>We&rsquo;ll take the URL for the <code>injectScript</code> API from the text field in the tag, and if the user has chosen to write debug messages to the console, we&rsquo;ll respect that choice.</p>
</li>
<li>
<p>If the script loads fine, we&rsquo;ll signal this with <code>data.gtmOnSuccess()</code>, but if there&rsquo;s a failure (such as a <code>404</code> error), we&rsquo;ll call the <code>data.gtmOnFailure()</code> method.</p>
</li>
</ol>
<p><strong>Success</strong> and <strong>failure</strong> are relevant for <a href="#tag-templates-in-the-code-editor">Preview mode output</a> and also for <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">tag sequencing</a>.</p>
<p>Without further ado, here&rsquo;s the complete code you should replace the contents of the code editor with:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Require the necessary APIs
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> logToConsole = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);
<span style="color:#00a">const</span> injectScript = require(<span style="color:#a50">&#39;injectScript&#39;</span>);
<span style="color:#00a">const</span> queryPermission = require(<span style="color:#a50">&#39;queryPermission&#39;</span>);

<span style="color:#aaa;font-style:italic">// Get the URL the user input into the text field
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> url = data.sourceUrl;

<span style="color:#aaa;font-style:italic">// If the user chose to log debug output, initialize the logging method
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> log = data.debug ? logToConsole : (() =&gt; {});

log(<span style="color:#a50">&#39;Conductrics: Loading script from &#39;</span> + url);

<span style="color:#aaa;font-style:italic">// If the script loaded successfully, log a message and signal success
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> onSuccess = () =&gt; {
  log(<span style="color:#a50">&#39;Conductrics: Script loaded successfully.&#39;</span>);
  data.gtmOnSuccess();
};

<span style="color:#aaa;font-style:italic">// If the script fails to load, log a message and signal failure
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> onFailure = () =&gt; {
  log(<span style="color:#a50">&#39;Conductrics: Script load failed.&#39;</span>);
  data.gtmOnFailure();
};

<span style="color:#aaa;font-style:italic">// If the URL input by the user matches the permissions set for the template,
</span><span style="color:#aaa;font-style:italic">// inject the script with the onSuccess and onFailure methods as callbacks.
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">if</span> (queryPermission(<span style="color:#a50">&#39;inject_script&#39;</span>, url)) {
  injectScript(url, onSuccess, onFailure);
} <span style="color:#00a">else</span> {
  log(<span style="color:#a50">&#39;Conductrics: Script load failed due to permissions mismatch.&#39;</span>);
  data.gtmOnFailure();
}
</code></pre></div>
<p>The code comments should help you understand how the code works. Here are some key things about the code:</p>
<ul>
<li>
<p>The <strong>APIs</strong> are loaded with the <code>require()</code> method. You must use these APIs - their counterparts in browser JavaScript have been suppressed. For example, <code>console.log()</code> would not work, nor would <code>document.createElement()</code>.</p>
</li>
<li>
<p>The <code>data</code> object has keys matching the <strong>field names</strong> you edited in the field editor. Any value those fields have will be the values stored in the <code>data</code> object. Thus, if the user typed <code>hello</code> into the <code>sourceUrl</code> field, that value would be available via <code>data.sourceUrl</code>.</p>
</li>
<li>
<p>Using <code>queryPermission()</code> is a good way to ensure the user input matches the permissions set in the template. The permissions are updated <strong>automatically</strong> when you <code>require()</code> a specific API in the code editor (we&rsquo;ll get to the permissions in the next chapter).</p>
</li>
</ul>
<p>Key thing to note is that this editor is a <strong>JavaScript editor</strong>. Thus, unlike with Custom HTML tags, you <strong>should not</strong> wrap the code with <code>&lt;script&gt;</code> and <code>&lt;/script&gt;</code>.</p>
<p>Once you&rsquo;re done, click <strong>Save</strong> and move on to the next chapter.</p>
<h4 id="step-4---modify-permissions">Step 4 - Modify permissions</h4>
<p>The final thing to edit are the <strong>permissions</strong>. When you <code>require()</code> APIs, you&rsquo;ll also automatically enable their permission configurations in the <strong>Permissions</strong> tab. See the <a href="#permissions">chapter on permissions</a> for more details on how these work.</p>
<p>Anyway, since you are using the <code>logToConsole</code> and <code>injectScript</code> APIs, their permissions are now available for editing. The <code>queryPermission</code> and <code>require</code> APIs don&rsquo;t have any permissions associated with them.</p>
<p>Click to the <strong>Permissions</strong> tab and expand the two permissions you find.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/permissions-expanded.jpg" title="Permissions expanded">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/permissions-expanded.jpg#ZgotmplZ" alt="Permissions expanded" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 431'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <a href="#injects-scripts">Injects Scripts</a> permission is, surprise surprise, for the <code>injectScript</code> API. It expects URL match patterns that the value input by the user into the text field must match.</p>
<p>Add the value <code>https://*.conductrics.com/</code> into the text field.</p>
<p>This value basically means that the script URL injected in the page must be a subdomain of <code>conductrics.com</code>, and it can have any path structure (the <code>/</code> after the hostname acts as a wildcard). Thus it will match, for example:</p>
<ul>
<li>
<p><code>https://conductrics.com/tracker</code></p>
</li>
<li>
<p><code>https://de.cdn-v3.conductrics.com/ac-aBcDeFgH/v3/agent-api/js/f-aBcDeFggg/dt-b1234567?apikey=api-w123456</code></p>
</li>
</ul>
<p>The <a href="#logs-to-console">Logs to Console</a> permission should be self-explanatory. It governs how the <code>logToConsole</code> API works. You can check the <strong>Always log</strong> option, because we manage logging to console in the template code itself.</p>
<p>Right now, the permissions should look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/permission-settings-done.jpg" title="Permission settings done">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/permission-settings-done.jpg#ZgotmplZ" alt="Permission settings done" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 646 368'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Click <strong>Save</strong> to save the current template.</p>
<h4 id="step-5---preview-and-test">Step 5 - Preview and test</h4>
<p>You can now click to edit the tag in the <strong>Template Preview</strong> window. When you&rsquo;ve added some text, you can click the <strong>Test</strong> button to see what happens.</p>
<p>You can also choose to show a <strong>test page</strong> from the template menu:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/template-preview.jpg" title="Template preview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/template-preview.jpg#ZgotmplZ" alt="Template preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1095 684'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Test different things:</p>
<ul>
<li>
<p>Try with a random, non-URL string to see the warning about the missing <code>https://</code>.</p>
</li>
<li>
<p>Try with <code>https://</code> but with a hostname that doesn&rsquo;t contain <code>conductrics.com</code> to see the error for incorrect URL.</p>
</li>
<li>
<p>Try with <code>https://domain.conductrics.com/loader</code> to see the error for missing <code>apikey</code>.</p>
</li>
<li>
<p>Try with <code>https://domain.conductrics.com/loader?apikey=12345</code> to see the code pass with flying colors.</p>
</li>
<li>
<p>Try with and without the <strong>Debug</strong> checkbox checked, and see how this impacts what you see in the <strong>Console</strong>.</p>
</li>
</ul>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/console-logging.jpg" title="Console output">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/console-logging.jpg#ZgotmplZ" alt="Console output" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 956 255'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you already have a <a href="https://conductrics.com/contact/">Conductrics account</a>, you can test with a real deployment URL to see the success message in the console.</p>
<p>Finally, you can dig deep into the <code>iframe</code> of the <strong>Test page</strong> to find your script tag there.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/script-in-test-page.jpg" title="Script in the test page">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/script-in-test-page.jpg#ZgotmplZ" alt="Script in the test page" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1113 268'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Once done testing to your satisfaction, you can do one final <strong>Save</strong> and then close the template editor - you are ready to create your first tag off of this template!</p>
<h4 id="step-6---create-tag-and-preview">Step 6 - Create tag and preview</h4>
<p>In the GTM UI, go to Tags and click <strong>New</strong>. In the overlay that opens, find your new template and click it.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/create-new-tag.jpg" title="Create new tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/create-new-tag.jpg#ZgotmplZ" alt="Create new tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1017 289'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This screen should be familiar to you. The only difference to native templates in GTM is the <strong>Tag permissions</strong> bar. Click it to preview what permissions have been set for the template.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/permissions-in-the-template.jpg" title="Permissions in the template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/permissions-in-the-template.jpg#ZgotmplZ" alt="Permissions in the template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 862 324'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Then, fill in the tag fields as you would with a regular template. For testing purposes, just set it to fire on the <strong>All Pages</strong> trigger.</p>
<p>You can try with invalid URLs to see the error messages. However, to test how the tag actually works, use a correct (but ultimately invalid) URL like <code>https://domain.conductrics.com/loader?apikey=12345</code>, and the tag should look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/first-conductrics-tag.jpg" title="First Conductrics tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/first-conductrics-tag.jpg#ZgotmplZ" alt="First Conductrics tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1179 583'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Then, go the <strong>Preview mode</strong> and enter your site.</p>
<p>You should see the tag having fired, but in <strong>Failed</strong> state because the endpoint returned a <code>404</code> error.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/conductrics-failed.jpg" title="Conductrics failed">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/conductrics-failed.jpg#ZgotmplZ" alt="Conductrics failed" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 612 250'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Check out the <a href="https://kb.mailster.co/how-can-i-open-the-browsers-console/">JavaScript console</a>, too. You should see some relevant output there.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/javascript-console-output.jpg" title="JavaScript console output">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/javascript-console-output.jpg#ZgotmplZ" alt="JavaScript console output" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 627 151'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Finally, since we&rsquo;re <strong>injecting a script</strong>, you can drill into the page elements to find it in the <code>&lt;head&gt;</code> of the page.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/elements-panel.jpg" title="Elements panel">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/elements-panel.jpg#ZgotmplZ" alt="Elements panel" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 771 227'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h4 id="step-7---youre-done">Step 7 - You&rsquo;re done!</h4>
<p><strong>And that&rsquo;s it!</strong>. This was an extremely simple use case, and it might seem like a really complicated way to go about it. However, remember that you&rsquo;re providing controls for <strong>governance</strong> and <strong>responsible</strong> code injection here.</p>
<p>The use of <a href="#permissions">permissions</a>, <a href="#sandboxed-javascript">sandboxed JavaScript</a>, and, if you choose to use them, <a href="#policies-reference">policies</a> help you run a tight ship on what the custom tags can and can&rsquo;t do on the site.</p>
<p>The template itself does a simple script injection, but I hope I convinced you how powerful the UI editor can be, and we barely scratched the surface!</p>
<h3 id="variable-template-walkthrough">Variable template walkthrough</h3>
<p>Variable templates differ from tag templates in that they only have a singular purpose: to <strong>return</strong> a value. Optimally, they should <strong>not</strong> have any <em>side effects</em>, which include e.g. setting variables in the global scope, writing cookies, pushing to <code>dataLayer</code>, injecting scripts, or firing pixels.</p>
<p>In this example, we&rsquo;ll create a simple variable which is intended to work with the <a href="https://www.simoahava.com/gtm-tips/hitcallback-eventcallback/"><code>hitCallback</code></a> field of your Google Analytics tags.</p>
<p>The idea is that the variable will return a function (<code>hitCallback</code> always requires a function as its value), which when executed will write a cookie into the browser. This cookie can then be used to check if less than 30 minutes (the default expiration) have passed since the last Google Analytics hit to GA, thus giving you a <em>very rough</em> estimate of whether a GA session is currently active.</p>
<p>So yes, we&rsquo;re breaking the &ldquo;no side effects&rdquo; rule I literally <em>just</em> mentioned, but this is a bit different. It&rsquo;s not an uncontrollable side effect, which it would be if it fired every single time the variable is called. Instead, the functionality is restricted to the <code>hitCallback</code> function, which is only executed <strong>once</strong>, when the Google Analytics request has been dispatched.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-variable.jpg" title="Session cookie variable">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-variable.jpg#ZgotmplZ" alt="Session cookie variable" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1590 916'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Note, there are <a href="https://www.simoahava.com/analytics/create-and-update-google-analytics-session-timeout-cookie/">more elegant ways</a> to handle this, but for the purposes of this guide I wanted to start off with something simple.</p>
<h4 id="step-1---create-and-set-the-details-of-the-variable-template">Step 1 - Create and set the details of the variable template</h4>
<p>Browse to <strong>Templates</strong>, and click <strong>New</strong> in the corner of the <strong>Variable Templates</strong> area.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-new-template.jpg" title="New variable template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-new-template.jpg#ZgotmplZ" alt="New variable template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2548 530'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the view that opens, make sure the <strong>Info</strong> tab is selected, and add a <strong>Name</strong> and <strong>Description</strong> to the variable.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-description.jpg" title="Variable template details">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-description.jpg#ZgotmplZ" alt="Variable template details" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1140 624'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>As you can see, you can add HTML styling to the description field. The text I wrote was this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">Use this variable to write (and update) a session cookie after each Google Analytics hit by using the &lt;<span style="color:#1e90ff;font-weight:bold">code</span>&gt;hitCallback&lt;/<span style="color:#1e90ff;font-weight:bold">code</span>&gt; field in the GA tags.</code></pre></div>
<p>Once done, click <strong>Save</strong> in the top right corner and you should see the <strong>Template Preview</strong> area show the new template name.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-preview.jpg" title="Variable template preview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-preview.jpg#ZgotmplZ" alt="Variable template preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1806 414'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, let&rsquo;s create the user interface for this template!</p>
<h4 id="step-2---create-the-ui-1">Step 2 - Create the UI</h4>
<p>Click over to the <strong>Fields</strong> tab in the template editor.</p>
<p>This template will comprise three <a href="#text-input">text input</a> fields. One for the cookie&rsquo;s <strong>maximum age</strong>, one for the <strong>cookie path</strong>, and one for the <strong>cookie domain</strong>.</p>
<p>Click the <strong>Add Field</strong> button, and choose the Text Input field from the overlay.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-text-input.jpg" title="Text input fields">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-text-input.jpg#ZgotmplZ" alt="Text input fields" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3188 424'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Do this two more times, so that you end up with three text input fields.</p>
<p>Name the first field <code>maxAge</code>, the second <code>cookiePath</code>, and the third <code>cookieDomain</code>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-three-fields.jpg" title="Three text fields">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-three-fields.jpg#ZgotmplZ" alt="Three text fields" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1310 512'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Expand the first field, <code>maxAge</code>, and click the <strong>cogwheel</strong> icon to open its field configurations. Toggle on <a href="#always-in-summary"><strong>Always in summary</strong></a>, <a href="#default-value"><strong>Default value</strong></a>, and <a href="#display-name"><strong>Display name</strong></a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-max-age-configurations.jpg" title="Max Age configurations">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-max-age-configurations.jpg#ZgotmplZ" alt="Max Age configurations" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3834 894'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Edit the <code>maxAge</code> settings to be like this:n</p>
<p><strong>Display name</strong>: Maximum age in seconds<br>
<strong>Default value</strong>: 1800<br>
<strong>Always in summary</strong>: Checked</p>
<p>The <strong>Display name</strong> is what appears above the field in the editor.</p>
<p>We&rsquo;ll use a <strong>Default value</strong> of <code>1800</code> seconds (that&rsquo;s 30 minutes), so if the user doesn&rsquo;t touch the field, that&rsquo;s the value that will be used.</p>
<p><strong>Always in summary</strong> means that the field contents will show up when the variable is opened in the UI but not in edit mode. It&rsquo;s a convenience thing, not vital in any way.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-max-age-ready.jpg" title="Max age ready">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-max-age-ready.jpg#ZgotmplZ" alt="Max age ready" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1344 570'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, click the <strong>cogwheel</strong> for the <code>cookiePath</code> field, and toggle the same configurations on (<strong>Display name</strong>, <strong>Default value</strong>, and <strong>Always in summary</strong>).</p>
<p>Set them to these values:</p>
<p><strong>Display name</strong>: Cookie path<br>
<strong>Default value</strong>: /<br>
<strong>Always in summary</strong>: Checked</p>
<p>Finally, click the <strong>cogwheel</strong> for the <code>cookieDomain</code> field, and toggle the same conditions on, together with the <strong>Help text</strong> configuration.</p>
<p>Set them to these values:</p>
<p><strong>Display name</strong>: Cookie domain<br>
<strong>Help text</strong>: Set to &lsquo;auto&rsquo; to write the cookie on the highest possible domain name.<br>
<strong>Default value</strong>: auto<br>
<strong>Always in summary</strong>: Checked</p>
<p>The fields should look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-finished-fields.jpg" title="Session cookie finished fields">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-finished-fields.jpg#ZgotmplZ" alt="Session cookie finished fields" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1906 1710'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <a href="#help-text"><strong>Help text</strong></a> configuration is pretty cool. If you refresh the <strong>Template Preview</strong>, you&rsquo;ll see how there&rsquo;s a little question mark next to the <strong>Cookie domain</strong> field. By hovering over it, you&rsquo;ll see the help text.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/session-cookie-template-preview.jpg" title="Session cookie template preview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/session-cookie-template-preview.jpg#ZgotmplZ" alt="Session cookie template preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1352 872'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Now you&rsquo;re ready to add the code!</p>
<h4 id="step-3---add-some-code-1">Step 3 - Add some code</h4>
<p>Click the <strong>Code</strong> tab, and replace the contents with the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Require the necessary APIs
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> setCookie = require(<span style="color:#a50">&#39;setCookie&#39;</span>);

<span style="color:#aaa;font-style:italic">// Build the options object from user input
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> options = {
  domain: data.cookieDomain,
  <span style="color:#a50">&#39;max-age&#39;</span>: data.maxAge,
  path: data.path
};

<span style="color:#aaa;font-style:italic">// Return the hitCallback function
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">return</span> () =&gt; {
  <span style="color:#aaa;font-style:italic">// Set the cookie when the hit has been dispatched
</span><span style="color:#aaa;font-style:italic"></span>  setCookie(<span style="color:#a50">&#39;_ga_session&#39;</span>, <span style="color:#a50">&#39;true&#39;</span>, options);
};
</code></pre></div>
<p>As you can see, it&rsquo;s a <strong>very</strong> simple variable. It uses a single API, <a href="https://developers.google.com/tag-manager/templates/api#setcookie"><code>setCookie</code></a> (for obvious reasons), and it has a <code>return</code> statement at the end, which returns a function wherever the variable is called.</p>
<p>If you read the <a href="https://developers.google.com/tag-manager/templates/api#setcookie"><code>setCookie</code> specification</a>, you can see that it takes three arguments.</p>
<p><code>setCookie(name, value, options)</code></p>
<p>To make things a bit easier, we&rsquo;re building the <code>options</code> object before calling the method. The object has three properties, <code>domain</code> for the domain name, <code>max-age</code> for the maximum age, and <code>path</code> for the cookie path.</p>
<p>The <code>setCookie</code> API has a nice feature where if you set the value of <code>domain</code> to <code>'auto'</code>, it automatically finds the highest possible (i.e. shortest) domain name it can use. Thus, if the variable is called on <code>sub.domain.simoahava.com</code>, the API writes it on <code>simoahava.com</code>.</p>
<p>As you can see, there are no validations or permission checks going on here. After reading this guide, you&rsquo;ll be able to extend the UI to do the validations directly on the fields, or you can also check the field values in code, falling back to some valid values in case the user input is not perfect.</p>
<p>Once you&rsquo;ve added the code, make sure to <strong>save</strong> the template, and then click on over to the <strong>Permissions</strong> tab of the editor. You&rsquo;ll need to make sure the template has permissions to write the cookie.</p>
<h4 id="step-4---modify-permissions-1">Step 4 - Modify permissions</h4>
<p>In the <strong>Permissions</strong> tab, you should now see a permission for <a href="#sets-a-cookie-value">Sets A Cookie Value</a>. It&rsquo;s added automatically when you run <code>require('setCookie')</code> in the template code. Pretty sweet!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/sets-a-cookie-value.jpg" title="Sets a cookie value">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/sets-a-cookie-value.jpg#ZgotmplZ" alt="Sets a cookie value" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1522 466'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Expand the permission, and click the <strong>+ Add allowed cookie</strong> button. In the overlay that opens, configure the cookie as follows:</p>
<p><strong>Cookie name</strong>: _ga_session<br>
<strong>Domain</strong>: *<br>
<strong>Path</strong>: *<br>
<strong>Secure</strong>: Any<br>
<strong>Session</strong>: Any</p>
<p>Click <strong>Save</strong> in the overlay when done. This is what you should see in the permissions area:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/cookie-permissions.jpg" title="Cookie permissions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/cookie-permissions.jpg#ZgotmplZ" alt="Cookie permissions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1898 400'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You&rsquo;re done with the template! Remember to <strong>Save</strong> it one last time.</p>
<p>There&rsquo;s not much sense in previewing or testing it in the template editor itself. The variable returns a <strong>function</strong>, so the only logical place to test it is in an environment where the function is actually executed in context.</p>
<p>Thus, it&rsquo;s time to create a variable from the template and add it to a tag!</p>
<h4 id="step-5---create-variable-add-to-tag-and-preview">Step 5 - Create variable, add to tag, and preview</h4>
<p>Click to <strong>Variables</strong> in the GTM UI, and click <strong>New</strong> in the <strong>User-Defined Variables</strong> section.</p>
<p>In the variable type picker, choose your newly created template from the list.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/variable-picker.jpg" title="Variable picker">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/variable-picker.jpg#ZgotmplZ" alt="Variable picker" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1346 592'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can now configure the variable to your liking. The default settings are more than fine for most cases, though.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/hitcallback-session-cookie.jpg" title="Hitcallback session cookie">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/hitcallback-session-cookie.jpg#ZgotmplZ" alt="Hitcallback session cookie" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2094 1280'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, find your Google Analytics Page View tag (or create one if you don&rsquo;t have it), check its <strong>Enable overriding settings in this tag</strong>, and browse to <strong>More Settings</strong> &gt; <strong>Fields to Set</strong>. Click <strong>+Add Field</strong>.</p>
<p>Set the <strong>Field Name</strong> to <code>hitCallback</code>, and <strong>Value</strong> to the variable you just created.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/hitcallback-in-tag.jpg" title="Hitcallback in tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/hitcallback-in-tag.jpg#ZgotmplZ" alt="Hitcallback in tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1850 990'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Save the tag, and go to <strong>Preview mode</strong>. Then, load the page where the Page View tag will fire.</p>
<p>If all goes as planned, you should now find a new browser cookie named <code>_ga_session</code>, with an expiration set to the number of seconds you set in the <strong>Maximum age in seconds</strong> field. Easiest way to find your browser cookies is to use the developer tools of your browser.</p>
<p>In Chrome, press <strong>CMD + OPT + I</strong> (Mac) or <strong>CTRL + SHIFT + I</strong> (Win/Linux) to open the developer tools. Then, activate the <strong>Application</strong> tab, and select the <strong>Cookies</strong> option for your domain. You should see the <code>_ga_session</code> cookie with value <code>true</code>, and an expiration in the future (or in the past if you set its maximum age to <code>0</code>).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/ga-session-cookie-dev-tools.jpg" title="GA Session cookie">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/ga-session-cookie-dev-tools.jpg#ZgotmplZ" alt="GA Session cookie" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2564 616'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you see the cookie then congratulations, your variable template works as intended!</p>
<h4 id="step-7---youre-done-1">Step 7 - You’re done!</h4>
<p>The purpose of this guide was to walk you through the steps how to create a variable template.</p>
<p>Yes, we used an extremely simple example, but the idea was to get familiarized with the <em>routine</em> of template creation, rather than jump in the deep end with all the APIs, field configurations, and permissions available.</p>
<p>The main difference to tag templates is that the variable needs to <strong>return</strong> something. Whatever happens before that final <code>return</code> statement is up to you, but you might want to avoid too many side effects unless you are absolutely certain they are only invoked in a specific, predictable context (such as <code>hitCallback</code>).</p>
<p>That&rsquo;s it for the tutorial part! Now it&rsquo;s time to explore with more detail what custom templates are, how they work, and how they are such a game-changer for tag management with GTM.</p>
<p>But first, take a break. You&rsquo;ve earned it.</p>

                
                  <h2 id="core-concepts">Core concepts</h2>
<p>Welcome back!</p>
<p>Before we get to the good stuff, let me go over some of the <strong>core concepts</strong> of Custom Templates. These concepts will emerge and re-emerge in much of the discussion below, and they are fundamental to understanding what Custom Templates are and what they can do.</p>
<h3 id="sandboxed-javascript">Sandboxed JavaScript</h3>
<p>Custom Templates are written with <strong>JavaScript</strong>. If you are unfamiliar with the language but still aching to start working with templates, I recommend taking a look at some <a href="https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/#get-the-basics-right">learning materials</a> before trying your hand with the template code. Check out these (free) learning portals, too:</p>
<ul>
<li>
<p><a href="https://www.freecodecamp.org">freeCodeCamp</a> - Excellent and comprehensive JavaScript and web technology tracks that span everything from the very basics to creating stateful web services.</p>
</li>
<li>
<p><a href="https://www.codecademy.com">Codecademy</a> - Great tracks for all sorts of programming languages and disciplines offered in a nice, interactive way.</p>
</li>
</ul>
<p>A further complication is that Custom Templates don&rsquo;t actually use just any old browser JavaScript. They use a special, <a href="https://developers.google.com/tag-manager/templates/sandboxed-javascript"><strong>sandboxed</strong> version</a> of the JavaScript language.</p>
<p>Basically, any code you write in the code editor will be automatically wrapped in a function that provides a single argument named <code>data</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#00a">function</span>(data) {
  <span style="color:#aaa;font-style:italic">// Start of code editor code
</span><span style="color:#aaa;font-style:italic"></span>
  <span style="color:#00a">const</span> log = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);
  <span style="color:#00a">const</span> copyFromWindow = require(<span style="color:#a50">&#39;copyFromWindow&#39;</span>);

  <span style="color:#00a">const</span> ga = copyFromWindow(<span style="color:#a50">&#39;GoogleAnalyticsObject&#39;</span>);

  <span style="color:#00a">if</span> (<span style="color:#00a">typeof</span> ga === <span style="color:#a50">&#39;undefined&#39;</span>) {
    log(<span style="color:#a50">&#39;Google Analytics not loaded!&#39;</span>);
  }

  log(data.userInputText);

  data.gtmOnSuccess();

  <span style="color:#aaa;font-style:italic">// End of code editor code
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<p>The <code>data</code> object is really important. Each field in the template will be accessible as a property of the <code>data</code> object, and the value of that property will be the result of the user&rsquo;s interaction with the field. The <code>data</code> object also has the <code>gtmOnSuccess()</code> and <code>gtmOnFailure()</code> methods you must use to signal the tag&rsquo;s successful completion or its failure. Variable completion is signalled by a <code>return</code> statement.</p>
<p>In addition to being automatically wrapped as a function body, the set of JavaScript methods and accessors available to you is limited. Basically, you will have no access to the global <code>window</code> object. This includes things like <code>location</code>, <code>document</code> (and <code>document.cookie</code>), <code>console</code>, and any constructors (such as <code>new Date()</code>.</p>
<p>To access these global methods and properties, you&rsquo;ll need to use the <strong>template APIs</strong> exposed by the template editor.</p>
<h3 id="es6-syntax">ES6+ syntax</h3>
<p>ES6 (ECMAScript 6) is one of the most significant updates the JavaScript standard, originally released in 2015, with prominent support in all the major browsers. The code editor in GTM&rsquo;s templates supports <strong>some</strong> ES6 features. These features include:</p>
<ul>
<li>
<p><a href="https://medium.com/front-end-weekly/es6-cool-stuffs-var-let-and-const-in-depth-24512e593268"><strong><code>const</code> and <code>let</code> keywords</strong></a>. These two keywords are offered as alternatives to JavaScript&rsquo;s <code>var</code> keyword. The main difference is that <code>const</code> and <code>let</code> have <strong>block-level scope</strong>, meaning they are scoped to the context of the wrapping <code>{</code> and <code>}</code>, rather than the whole surrounding function context as with <code>var</code>. Furthermore, there&rsquo;s no <a href="https://www.w3schools.com/js/js_hoisting.asp">variable hoisting</a> - <code>const</code> and <code>let</code> variables cannot be referenced before their declaration. Finally, <code>const</code> variables cannot be reassigned.</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions"><strong>Arrow functions</strong></a>. Arrow functions are a new way to write JavaScript function expressions. It&rsquo;s syntactically more compact, so pursuers of &ldquo;elegant code&rdquo; rejoice. For example, <code>var multiplyByTwo = function(a) { return a*2; };</code> becomes <code>const multiplyByTwo = a =&gt; a*2;</code>. Unlike &ldquo;regular&rdquo; JavaScript functions, there&rsquo;s no <code>this</code> binding and no access to the <code>arguments</code> object.</p>
</li>
</ul>
<p>You are of course free to use the &ldquo;old&rdquo; style of JavaScript. In the templates&rsquo; code editor, I will try to adhere to ES6 syntax purely out of habit, but also because using <code>const</code> and <code>let</code> actually has some functional weight in the code, too.</p>
<h3 id="restrictions-to-what-type-of-data-you-can-handle">Restrictions to what type of data you can handle</h3>
<p>To prevent users from circumventing template permissions and from running code that breaks through the templates&rsquo; sandbox, Google Tag Manager has a number of suppression mechanisms built in.</p>
<ol>
<li>
<p><strong>You can&rsquo;t access <code>window</code> or <code>document</code> directly</strong>. Access to the global namespace is restricted to <a href="#template-apis">template APIs</a>. Even if you tried something clever such as returning <code>window.setTimeout</code> in a JavaScript variable, so that it&rsquo;s <em>technically</em> not in the code editor itself, the template editor automatically parses all variables and user-based input brought into the template before it is made accessible to the code editor.</p>
</li>
<li>
<p><strong>You can&rsquo;t pass non-plain objects</strong>, such as instances created with construtors, to the template code. It&rsquo;s difficult to contain security of these, because the prototype chain can be manipulated by code outside the template, making the template itself vulnerable and less secure. This basically means that things like <a href="https://www.simoahava.com/analytics/customtask-the-guide/"><code>customTask</code></a> will not be possible to do with variable templates for now, because it requires access to a constructed, non-plain <code>model</code> object to function.</p>
</li>
<li>
<p><strong>You can&rsquo;t access DOM elements</strong>. This is kind of the same as (2), because a DOM element represents a complex, non-plain object type. Nevertheless, it means that you can&rsquo;t access things like <code>{{Click Element}}</code> in template code.</p>
</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/template-restrictions.jpg" title="Template restrictions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/template-restrictions.jpg#ZgotmplZ" alt="Template restrictions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 957 351'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In time, I&rsquo;m certain the proliferation of APIs in the template will solve many of the restrictions above, but first and foremost the point of templates is to add a layer of security to prevent scripts outside the template from messing with the code within.</p>
<p>Another one of the idiosyncracies of the templates&rsquo; sandboxed JavaScript is how function expressions exposed outside the template code are encapsulated in a <strong>wrapper</strong> by GTM.</p>
<p>The purpose of this wrapper is to make sure functions set in the window or returned by the variable template can&rsquo;t be used to circumvent permissions set in the template.</p>
<p>The wrapper itself is <strong>almost always</strong> inconsequential, because it passes the parameters collected by the wrapper to the function created in or handled by the template. However, if any one of the parameters violates the restrictions listed above, the parameter is suppressed and replaced with <code>undefined</code>.</p>
<h3 id="template-apis">Template APIs</h3>
<p>The most common global properties and methods you&rsquo;ll need to use are abstracted behind custom <strong>APIs</strong>. We&rsquo;ve covered a number of API examples in the preceding chapters. For example, there&rsquo;s <code>logToConsole</code> for logging items to the JavaScript console of the browser, and there&rsquo;s <code>copyFromWindow</code> for accessing global variables defined in the <code>window</code> object.</p>
<p>Each API comes with its own configurable set of permissions. The <code>copyFromWindow</code> API, for example, requires that you define the global keys the code has access to. As soon as you type the <code>require('copyFromWindow')</code> statement and refresh the template, the <strong>Accesses Global Variables</strong> permissions will become available in the respective tab.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/copyfromwindow-permissions.jpg" title="Accesses global variables">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/copyfromwindow-permissions.jpg#ZgotmplZ" alt="Accesses global variables" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 962 304'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>As you can see, for these particular permissions you can define the keys and whether the code has read and/or write and/or execution permissions for them. You might have guessed now that <strong>Access Global Variables</strong> is not limited to just <code>copyFromWindow</code> (which is read-only), but also determines the usefulness of e.g. <code>setInWindow</code> (for writing/setting global variables) and <code>callInWindow</code> (for calling global methods).</p>
<p>The purpose of this sandboxed JavaScript is to give you a <strong>safe and secure</strong> JavaScript environment to write and run your code in. The interplay between your code and the permissions model is designed to produce code that is as conservative as possible without compromising the runtime logic of what you want to do with the code.</p>
<p>This doesn&rsquo;t mean that you can&rsquo;t cause havoc with your custom template - quite the contrary. However, the user interface guides you to make the correct choices when choosing the APIs and the permissions thereof. Hopefully the guide you are currently reading will further help you understand how to make your code run in the most efficient and responsible way possible.</p>
<h3 id="server-side-tagging">Server-side tagging</h3>
<p><a href="https://www.simoahava.com/analytics/server-side-tagging-google-tag-manager/">Server-side tagging</a> has its <a href="https://developers.google.com/tag-manager/serverside/api">own set of APIs</a>, which mainly revolve around parsing HTTP requests and compiling HTTP responses. The purpose of a Client is to read the incoming requests, launch virtual container processes for tags and triggers, and then build a response back to the source of the original request.</p>
<p>This guide is mostly focused on Custom Templates in web containers, but all the main features apply to Server-side tagging as well.</p>
<h3 id="policies">Policies</h3>
<p>The counterpart of permissions are <strong>policies</strong>. Policies give the site owner the ability to block potentially hazardous code from running. It&rsquo;s somewhat similar to Google Tag Manager&rsquo;s <a href="https://developers.google.com/tag-manager/devguide#restrict">whitelist/blacklist</a> feature, except with policies you have extremely granular access to how individual permissions are handled.</p>
<p>Policies are basically <code>dataLayer</code> commands which specify what happens when a Custom Template for which some permissions have been set tries to execute on the page.</p>
<p>If you don&rsquo;t define any policies then the tag or variable will run its course unimpeded.</p>
<p>However, you can create a policy which is invoked whenever some specific permission is accessed by the template. Let me show you an example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> getCookie = require(<span style="color:#a50">&#39;getCookieValues&#39;</span>);
<span style="color:#00a">const</span> log = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);

log(getCookie(<span style="color:#a50">&#39;_user_id&#39;</span>));
data.gtmOnSuccess();
</code></pre></div>
<p>The template code above uses the <code>getCookieValues</code> API to log the value of a cookie named <code>_user_id</code>. When you save that code, a new permission appears in the editor, and you need to whitelist the cookie names the code is allowed to access:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/whitelist-cookie-values.jpg" title="Whitelisted cookie values">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/whitelist-cookie-values.jpg#ZgotmplZ" alt="Whitelisted cookie values" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 610 178'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Now, if you didn&rsquo;t specify a policy, the code would always log the cookie value into the console when the tag runs, because the <code>_user_id</code> cookie has been whitelisted in the tag permissions.</p>
<p>However, let&rsquo;s say the page has the following code in the HTML:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
<span style="color:#00a">function</span> gtag(){dataLayer.push(arguments);}

gtag(<span style="color:#a50">&#39;policy&#39;</span>, <span style="color:#a50">&#39;get_cookies&#39;</span>, <span style="color:#00a">function</span>(container, policy, data) {
  <span style="color:#00a">if</span> (data.name === <span style="color:#a50">&#39;_user_id&#39;</span>) {
    <span style="color:#00a">throw</span>(<span style="color:#a50">&#39;You are not allowed to query _user_id on this page!&#39;</span>);
  }
  <span style="color:#00a">return</span> <span style="color:#00a">true</span>;
});
</code></pre></div>
<blockquote>
<p>Don&rsquo;t be confused by the <code>gtag()</code> command - policies use the <code>gtag()</code> method, which is essentially a helper to push the arguments into <code>dataLayer</code>. You do <strong>not</strong> need to download the gtag.js library to be able to run policies on the site template.</p>
</blockquote>
<p>Now when the tag is run and the <code>getCookie('_user_id')</code> code is executed, the policy you created will activate. This policy checks if the requested cookie was named <code>_user_id</code>, and reacts by throwing an error. Perhaps the developers have deemed it too risky to allow GTM to query the <code>_user_id</code> cookie like this.</p>
<p>You don&rsquo;t <strong>need</strong> policies to work with Google Tag Manager&rsquo;s Custom Templates. However, given how popular Custom Templates are likely to become, I do expect to see more and more policies defined, too.</p>
<p>Be sure to check out the <a href="#policy-reference">policy reference</a> at the end of this guide for more details on how individual policies should be set.</p>
<h3 id="tests">Tests</h3>
<p><strong>Tests</strong> allow you to write <em>unit tests</em> for your template code directly in the editor. The <strong>tests</strong> feature comprises a number of APIs you can use to, for example, mock the data object and write assertions against the compiled and executed template code.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/11/template-test-example.jpg" title="Tests">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/11/template-test-example.jpg#ZgotmplZ" alt="Tests" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 611 288'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>For more information about how to write and run tests with custom templates, see this guide:</p>
<p><a href="https://www.simoahava.com/analytics/writing-tests-for-custom-templates-google-tag-manager/">Writing Tests For Custom Templates In Google Tag Manager</a></p>

                
                  <h2 id="official-documentation">Official documentation</h2>
<p>When working with <strong>Custom Templates</strong>, you should have two documents at hand:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api"><strong>Custom template APIs reference</strong></a> - This document introduces the various APIs you&rsquo;ll need to use if you want your code to run beyond the boundaries of the sandbox.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/permissions"><strong>Custom template permissions reference</strong></a> - This reference lists the permissions the APIs require, and which are used to create <strong>policies</strong> with which web pages can deploy an additional layer of governance for running custom templates.</p>
</li>
</ul>
<p><a href="https://developers.google.com/tag-manager/serverside/api">**Custom template APIs for Server-side tagging</a> - This document lists the APIs available for Client and tag templates in <a href="https://www.simoahava.com/analytics/server-side-tagging-google-tag-manager/">Server-side tagging</a>.</p>
<p>Keep those documents open when working with Custom Templates. I won&rsquo;t repeat their contents in this guide, but I do refer to them where necessary.</p>

                
                  <h2 id="the-editor">The editor</h2>
<p>Let&rsquo;s jump right in! To start creating a new template, click the <strong>Templates</strong> menu option.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/templates-menu.jpg" title="Templates in the menu">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/templates-menu.jpg#ZgotmplZ" alt="Templates in the menu" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1406 968'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, click <strong>New</strong> in the right corner of the <strong>Tag Templates</strong> card.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/tag-templates-new.jpg" title="Tag templates new">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/tag-templates-new.jpg#ZgotmplZ" alt="Tag templates new" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1986 218'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>What you see now is the <strong>template</strong> editor. There are several views and menus here, so let&rsquo;s start with a quick overview.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/editor-overview.jpg" title="Editor overview">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/editor-overview.jpg#ZgotmplZ" alt="Editor overview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3838 1242'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>1</strong> - The main navigation of the editor. If you have <strong>Show advanced settings</strong> checked in the editor menu, you&rsquo;ll also see the <strong>Notes</strong> tab here.</p>
<p><strong>2</strong> - The editor view for the selected tab. If you have <strong>Show advanced settings</strong> checked in the editor menu, you might see extra options here.</p>
<p><strong>3</strong> - Template Preview shows what the template will look like when saved. If you&rsquo;ve made changes to the template, you&rsquo;ll see a <strong>Refresh</strong> link here, which will update the preview when clicked.</p>
<p><strong>4</strong> - The Console will log information about template performance when you <strong>Test</strong> the template. Additionally, any calls to the <code>logging</code> API will be output here, too.</p>
<p>If you select <strong>Show Test Page</strong> from the editor menu, you&rsquo;ll see the <strong>Test Page</strong> window between the Template Preview and Console.</p>
<p><strong>5</strong> - Click Test to execute the template code with the settings you have entered in the preview. If you&rsquo;ve chosen <strong>Show Test Page</strong> from the editor menu, then any code that modifies the page will impact what the Test Page shows.</p>
<p><strong>6</strong> - Save the template. The template cannot be saved if the code has syntax errors or invalid JavaScript. You need to fix the errors before saving. Note that the template can be saved even if you have incorrect permissions for the APIs you use.</p>
<p><strong>7</strong> - The editor menu. The editor menu has options for managing the template and for customizing the editor.</p>
<p>The editor for <strong>tag templates</strong> and <strong>variable templates</strong> is largely the same. The main difference is the absence of an icon/logo selector in the <a href="#info-view">info view</a> and how the code editor is utilized. With tags, the code editor needs <code>data.gtmOnSuccess()</code> for successful execution and <code>data.gtmOnFailure()</code> (if necessary) for a failure. Variables, on the other hand, don&rsquo;t use this. You just need a <code>return</code> statement that returns whatever the variable is supposed to return.</p>
<h3 id="info-view">Info view</h3>
<p>The <strong>Info view</strong> is where you&rsquo;ll customize what the template looks like. Verbosity is not a sin - try to be as clear and descriptive in the template name and description as possible.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/info-view.jpg" title="Info view">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/info-view.jpg#ZgotmplZ" alt="Info view" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2002 908'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <strong>Name</strong> of the template is what appears in the tag/variable selection menu as well as in the template itself when you create a new instance from it.</p>
<p>The <strong>Description</strong> will appear in the tag/variable selection menu below the template name.</p>
<p>Tag templates allow you to choose an <strong>image</strong> for the template. This image will appear in the tag selection menu and the template itself.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/tag-template-menu.jpg" title="Tag template menu">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/tag-template-menu.jpg#ZgotmplZ" alt="Tag template menu" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1382 500'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>At the bottom of the Info view is the checkbox for approving the terms of service for the <strong>Community Template Gallery</strong>. You only need to check this if you want to submit your template to the <a href="https://tagmanager.google.com/gallery/">gallery</a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/10/terms-of-service-template.jpg" title="TOS template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/10/terms-of-service-template.jpg#ZgotmplZ" alt="TOS template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1142 932'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you have <strong>Show advanced settings</strong> selected, you&rsquo;ll also see the template <strong>version</strong> as well as the <strong>contexts</strong> in which the template works.</p>
<p>You&rsquo;ll also see a <strong>Source</strong> toggle in the top of the view. By clicking the toggle, you&rsquo;ll see the JSON representation of the template info, which you can edit (if you want to change the context, for example).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/source-toggle-info.jpg" title="Source toggle for info">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/source-toggle-info.jpg#ZgotmplZ" alt="Source toggle for info" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 630'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h3 id="fields-editor">Fields editor</h3>
<p>The <strong>Fields editor</strong> is where you&rsquo;ll spend a lot of your time. You use this editor to establish what the tag or variable user interface will look like, and how individual fields interact with each other.</p>
<p>For each field you create, you need to specify (at least) a name with which you can refer to the field value in the code editor. The field name must be <strong>unique</strong>, since all fields (even those nested within other fields) will be directly accessible using the field name as a property of the <code>data</code> object. For example, to access the value of a field whose name is <code>gaTrackingId</code>, you&rsquo;d use this in the code editor:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> ua = data.gaTrackingId;
log(ua); <span style="color:#aaa;font-style:italic">// logs UA-12345-1 or whatever the user set the value of the field to.
</span></code></pre></div>
<p>Furthermore, each field has a <strong>field configuration</strong> that you&rsquo;ll use to establish how the field functions in the user interface of the template itself.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/field-editor.jpg" title="Field editor view">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/field-editor.jpg#ZgotmplZ" alt="Field editor view" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1908 564'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Below the <strong>field name</strong> are the options and settings for the field. You&rsquo;ll see more of these as you add additional <strong>configurations</strong>.</p>
<p>In the top right corner of each field row you&rsquo;ll see a <strong>trash can</strong> for deleting the field.</p>
<p>There&rsquo;s also a <strong>cogwheel</strong> which opens the <strong>field configuration</strong> options.</p>
<p>The <strong>more options</strong> menu opens options for manipulating the positioning of the field (see screenshot above), and the <strong>caret</strong> at the very right lets you collapse and expand the field in the editor.</p>
<p>If you have <strong>Show advanced settings</strong> enabled, you can toggle the <strong>Source</strong> toggle in the top corner of the view to see a JSON representation of the fields.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/source-toggle-fields.jpg" title="Source toggle for fields">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/source-toggle-fields.jpg#ZgotmplZ" alt="Source toggle for fields" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1922 592'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h4 id="field-configuration">Field configuration</h4>
<p>Whenever you add a field in the editor, you have the option of configuring field-specific rules and settings by clicking the <strong>cogwheel</strong> icon next to the field.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/field-configuration-intro.jpg" title="Field configuration">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/field-configuration-intro.jpg#ZgotmplZ" alt="Field configuration" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1904 242'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Depending on the field you opened the configuration for, you&rsquo;ll see a set of toggles that you can toggle on or off. Some toggles are on by default, again depending on the field you are configuring.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/text-input-configuration.jpg" title="Text input configuration">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/text-input-configuration.jpg#ZgotmplZ" alt="Text input configuration" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1960 890'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>As you read through the field descriptions below, I&rsquo;ve added the configuration options for each field. Furthermore, at the end of this guide there&rsquo;s a <a href="#field-configuration-reference">field configuration reference</a> which lists all the possible configuration options in more detail.</p>
<p>Note that some fields can be <strong>nested</strong>, and some fields actually include nested fields by default (e.g. the <a href="#param-table">Param table</a> field). In these cases, the nested fields are treated as their own fields with their own configurations. The only difference between an isolated and nested field is that the latter is subservient to the field configurations of its parent. For example, if the parent is disabled due to enabling conditions not validating, the nested fields will be disabled, too.</p>
<h4 id="text-input">Text input</h4>
<h5 id="description">Description</h5>
<p>The <strong>Text input</strong> field is a simple input box to which the user can write text.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/text-input-1.jpg" title="Text input field in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/text-input-1.jpg#ZgotmplZ" alt="Text input field in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1906 306'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Text input field in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/text-input-2.jpg" title="Text input field in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/text-input-2.jpg#ZgotmplZ" alt="Text input field in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 608 18'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Text input field in the UI</span>
  
</div>


<h5 id="code-editor-output">Code editor output</h5>
<p>The property <code>data.fieldName</code> will resolve to whatever the user typed in the field, or whatever a GTM variable used in the field resolves to.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// Using the example from the screenshot above
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> textFieldValue = data.textToWriteToConsole;
</code></pre></div>
<h5 id="available-field-configurations">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#allow-empty-strings">Allow empty strings</a> - Convert and unfilled field into an empty string. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-line-count">Display line count</a> - Line count of greater than 1 turns the field into a text area. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#text-as-list">Text as list</a> - When the text field is a text area (see <strong>Display line count</strong> above), store the value of the field as an array, where each item represents a row of input. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
<li><a href="#value-hint">Value hint</a> - Text shown as a placeholder help text in the field before the user starts editing it. OFF by default.</li>
<li><a href="#value-unit">Value unit</a> - Text shown next to the field. Useful to specify a format or type, for example. OFF by default.</li>
</ul>
<h4 id="drop-down-menu">Drop-down menu</h4>
<h5 id="description-1">Description</h5>
<p>The <strong>Drop-down menu</strong> field provides a menu where only <strong>a single item can be selected</strong>. It&rsquo;s often a combination of predefined items (such as <code>True</code> and <code>False</code>), and all the Google Tag Manager variables in the container.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/dropdown-menu-1.jpg" title="Drop-down menu in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/dropdown-menu-1.jpg#ZgotmplZ" alt="Drop-down menu in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1812 748'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Drop-down menu in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/drop-down-menu-2.jpg" title="Drop-down menu in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/drop-down-menu-2.jpg#ZgotmplZ" alt="Drop-down menu in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1170 496'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Drop-down menu in the UI</span>
  
</div>


<h5 id="code-editor-output-1">Code editor output</h5>
<p>The <code>data.fieldName</code> property will resolve to the value of the item selected from the drop-down menu. If the item was one of those you defined in the template editor, then what you wrote in the Value field is what the property resolves to. If the user selected a GTM variable, then the value returned by that variable is what the property resolves to.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> dropDownFieldValue = data.dropDownMenu1;
log(dropDownFieldValue); <span style="color:#aaa;font-style:italic">// logs true if an item whose Value is true is selected.
</span></code></pre></div>
<h5 id="available-field-configurations-1">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#not-set-option">&ldquo;Not set&rdquo; option</a> - Show a placeholder value in the menu before the user has selected anything. If menu is left untouched, the field returns an empty string. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#include-variables">Include variables</a> - Check this box if you want to include all GTM variables in the drop-down menu. <strong>ON by default</strong>.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
<li><a href="#value-unit">Value unit</a> - Text shown next to the field. Useful to specify a format or type, for example. OFF by default.</li>
</ul>
<h4 id="checkbox">Checkbox</h4>
<h5 id="description-2">Description</h5>
<p>The <strong>Checkbox</strong> field should be self-explanatory. The checkbox doesn&rsquo;t have a display name by default. Instead, text you type in the <strong>Checkbox text</strong> field will be shown next to the box in the UI.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/checkbox-1.jpg" title="Checkbox in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/checkbox-1.jpg#ZgotmplZ" alt="Checkbox in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1146 304'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Checkbox in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/checkbox-2.jpg" title="Checkbox in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/checkbox-2.jpg#ZgotmplZ" alt="Checkbox in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 734 208'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Checkbox in the UI</span>
  
</div>


<h5 id="code-editor-output-2">Code editor output</h5>
<p>The <code>data.fieldName</code> property resolves to <code>true</code> if the checkbox was checked and <code>false</code> if not.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> checkBoxValue = data.useDataLayer;
log(checkBoxValue); <span style="color:#aaa;font-style:italic">// true
</span></code></pre></div>
<h5 id="available-field-configurations-2">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. OFF by default.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="radio-buttons">Radio buttons</h4>
<h5 id="description-3">Description</h5>
<p>You can add one or more radio buttons into a single radio button group. The radio button group is treated as a single field. Each radio button has a name (displayed next to the button) and a value (what is returned if the button is selected). The user can only select one button from the group. You can expand <strong>advanced settings</strong> to add a help text and to add nested fields under each radio button selection.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/radio-buttons-1.jpg" title="Radio buttons in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/radio-buttons-1.jpg#ZgotmplZ" alt="Radio buttons in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1736 1158'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Radio buttons in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/radio-buttons-2.jpg" title="Radio buttons in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/radio-buttons-2.jpg#ZgotmplZ" alt="Radio buttons in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 784 390'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Radio buttons in the UI</span>
  
</div>


<h5 id="code-editor-output-3">Code editor output</h5>
<p>The <code>data.fieldName</code> property, where <code>fieldName</code> is the name of the entire radio button group, will resolve to the value of the selected radio button.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> selectedButton = data.gaEventType;
<span style="color:#00a">if</span> (selectedButton === <span style="color:#a50">&#39;pageView&#39;</span>) {
  <span style="color:#00a">const</span> gaId = data.trackingId;
  <span style="color:#aaa;font-style:italic">// Do something with gaId
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h5 id="available-field-configurations-3">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="simple-table">Simple table</h4>
<h5 id="description-4">Description</h5>
<p>With a <strong>simple table</strong>, you can define columns (either <a href="#text-input">text input</a> fields or <a href="#drop-down-menu">drop-down menus</a>), and the users can add and remove rows to and from the table as they wish.</p>
<p>You can specify that all values in a column must be unique (i.e. the user can&rsquo;t add multiple rows with the same value in such a column), and you can add things like default values and validation rules to each column, once you have selected to <strong>Show advanced settings</strong> for the column.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/simple-table-1.jpg" title="Simple table in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/simple-table-1.jpg#ZgotmplZ" alt="Simple table in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1876 1368'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Simple table in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/simple-table-2.jpg" title="Simple table in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/simple-table-2.jpg#ZgotmplZ" alt="Simple table in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1776 348'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Simple table in the UI</span>
  
</div>


<h5 id="code-editor-output-4">Code editor output</h5>
<p>The <code>data.fieldName</code> property will resolve to an array of objects, where each object represents a row the user has added in the UI. Furthermore, each row object will have key-value pairs for every column, where the key is the column name and the value is the value of the input (the selection value if a drop-down menu or the input text if a text field).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">log(data.cookieSettings); 
<span style="color:#aaa;font-style:italic">/* Logs:
</span><span style="color:#aaa;font-style:italic">[
</span><span style="color:#aaa;font-style:italic">  {&#34;cookieOption&#34;:&#34;cookieDomain&#34;,&#34;optionValue&#34;:&#34;simoahava.com&#34;},
</span><span style="color:#aaa;font-style:italic">  {&#34;cookieOption&#34;:&#34;cookieName&#34;,&#34;optionValue&#34;:&#34;myCookie&#34;}
</span><span style="color:#aaa;font-style:italic">]
</span><span style="color:#aaa;font-style:italic">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-4">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#new-row-button-text">&ldquo;New row&rdquo; button text</a> - Change the value of the &ldquo;Add row&rdquo; button text. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="param-table">Param table</h4>
<h5 id="description-5">Description</h5>
<p>A <strong>Param table</strong> is a more complicated table. Instead of being able to edit individual column values in the table itself, a param table requires you to input all the values of the row in a special overlay menu that pops up when you click to add a row. The individual columns can be any of the supported field types, and thus you can add far more complexity into the table than you could with a regular <a href="#simple-table">simple table</a> field.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/param-table-1.jpg" title="Param table in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/param-table-1.jpg#ZgotmplZ" alt="Param table in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1876 1634'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Param table in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/param-table-2.jpg" title="Param table in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/param-table-2.jpg#ZgotmplZ" alt="Param table in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1010 1864'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Param table in the UI</span>
  
</div>


<h5 id="code-editor-output-5">Code editor output</h5>
<p>Similar to the <a href="#simple-table">simple table</a>, the <code>data.fieldName</code> property resolves to an array of objects, where each object represents a row in the table. Each row object has key-value pairs for each column, and the value is whatever the column field returns. For example, the screenshot above would render as:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">log(data.userSelection);
<span style="color:#aaa;font-style:italic">/* Logs:
</span><span style="color:#aaa;font-style:italic">[
</span><span style="color:#aaa;font-style:italic">  {&#34;genderSelect&#34;: &#34;male&#34;, &#34;nameInput&#34;: &#34;Simo Ahava&#34;},
</span><span style="color:#aaa;font-style:italic">  {&#34;genderSelect&#34;: &#34;female&#34;, &#34;nameInput&#34;: &#34;Simona Ahava&#34;}
</span><span style="color:#aaa;font-style:italic">]
</span><span style="color:#aaa;font-style:italic">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-5">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#edit-row-dialog-title">&ldquo;Edit row&rdquo; dialog title</a> - You can change what the heading of the &ldquo;Edit row&rdquo; overlay is. OFF by default.</li>
<li><a href="#new-row-button-text">&ldquo;New row&rdquo; button text</a> - Change the value of the &ldquo;Add row&rdquo; button text. OFF by default.</li>
<li><a href="#new-row-dialog-title">&ldquo;New row&rdquo; dialog title</a> - You can change what the heading text is in the overlay you see when adding a new row. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="group">Group</h4>
<h5 id="description-6">Description</h5>
<p>A <strong>Group</strong> is simply a logical way to group different fields together. The main benefit is that it offers you a <strong>Group style</strong> selection.</p>
<ul>
<li>
<p><strong>Simple section</strong> - This style simply shows the nested fields in the group without any collapsing.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Open</strong> - This style shows the nested fields in a collapsible section which is open initially.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Closed</strong> - This style shows the nested fields in a collapsible section which is collapsed initially.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Open if not default</strong> - This style shows the nested fields in a collapsible section which is open if the nested field(s) don&rsquo;t have default values (i.e. the user has changed the value of the fields).</p>
</li>
</ul>
<p>A Group is useful if you want to section a set of fields separately, because you can also control the entire groups visibility with the <strong>Enabling condition</strong> field configuration.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/more-settings-1.jpg" title="Collapsible group in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/more-settings-1.jpg#ZgotmplZ" alt="Collapsible group in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1896 854'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Collapsible group in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/more-settings-2.jpg" title="Collapsible group in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/more-settings-2.jpg#ZgotmplZ" alt="Collapsible group in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1778 568'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Collapsible group in the UI</span>
  
</div>


<h5 id="code-editor-output-6">Code editor output</h5>
<p>The <strong>Group</strong> doesn&rsquo;t bring anything extra to the code editor. The nested fields are accessed directly as properties of the <code>data</code> object - the group itself is not present in the object in any way.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">log(data);
<span style="color:#aaa;font-style:italic">/* Logs:
</span><span style="color:#aaa;font-style:italic">[
</span><span style="color:#aaa;font-style:italic">  {&#34;cookieSettings&#34;: [{&#34;cookieOption&#34;: &#34;cookieDomain&#34;, &#34;optionValue&#34;: &#34;auto&#34;}]},
</span><span style="color:#aaa;font-style:italic">  {&#34;trackerName&#34;: &#34;_ga_tracker&#34;}
</span><span style="color:#aaa;font-style:italic">]
</span><span style="color:#aaa;font-style:italic">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-6">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#group-style">Group style</a> - How the group section is rendered in the GTM UI (simple vs. collapsed vs. open). <strong>ON by default</strong>.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
</ul>
<h4 id="label">Label</h4>
<h5 id="description-7">Description</h5>
<p>The <strong>Label</strong> field is extremely simple. It&rsquo;s just text that you show in the GTM UI when the instance is opened. The <strong>Display name</strong> configuration determines the text that is shown. Additionally, a Label field has only one other configuration: an <strong>Enabling condition</strong> which you can use to conditionally show the text.</p>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/label-1.jpg" title="Label in the editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/label-1.jpg#ZgotmplZ" alt="Label in the editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1844 528'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Label in the editor</span>
  
</div>





<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2019/01/label-2.jpg" title="Label in the UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/label-2.jpg#ZgotmplZ" alt="Label in the UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 308 116'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Label in the UI</span>
  
</div>


<h5 id="code-editor-output-7">Code editor output</h5>
<p>There is no way to access the label in the code editor.</p>
<h5 id="available-field-configurations-7">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
</ul>
<h4 id="utilizing-apis">Utilizing APIs</h4>
<p><strong>Template APIs</strong> are methods in the Google Tag Manager sandboxed JavaScript which let you invoke commonly used utilities of the browser. GTM restricts direct access to global methods to improve the stability and reliability of the code, and to optimize the way the code is delivered in the browser.</p>
<p>When working with the code editor, remember to always have the <a href="https://developers.google.com/tag-manager/templates/api">API reference</a> document open in your browser.</p>
<p>Because the official documentation is pretty thorough, I won&rsquo;t do an exhaustive overview of all the APIs. Instead, I&rsquo;ll point out <strong>quirks</strong> or <strong>things you should know</strong> about some of the APIs, listed below in their separate chapters.</p>
<h5 id="the-require-api">The <code>require</code> API</h5>
<p>To invoke a template API, you must first <strong>require</strong> it in the editor. If you&rsquo;ve been working with <a href="https://nodejs.org/en/">Node.js</a>, you&rsquo;ll recognize the <code>require()</code> method as a way to include JavaScript <strong>modules</strong> into your code.</p>
<p>In GTM templates, <code>require()</code> is used to gain access to template APIs, so the functionality is similar even if quite a bit more restricted, as the list of APIs you can integrate is limited.</p>
<p>To utilize an API, you simply run <code>const method = require(name);</code>, where <code>name</code> is the name of the API you want to use, and <code>method</code> is the name of the variable to which you will locally scope the API function.</p>
<p>For example, to make it possible to log to the console and to set cookies in the template code, you would need to require the respective APIs:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> log = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);
<span style="color:#00a">const</span> setCookie = require(<span style="color:#a50">&#39;setCookie&#39;</span>);
</code></pre></div>
<p>When you require an API that is governed by a set of <strong>permissions</strong>, those permissions will automatically appear in the <a href="#permissions">Permissions</a> tab of the template UI. When you use the API, you need to make sure that the permissions allow you to perform the tasks you are trying to perform.</p>
<h5 id="the-querypermission-api">The <code>queryPermission</code> API</h5>
<p>Especially if you&rsquo;ve written the template for public use, you might want to utilize the <code>queryPermission</code> API to wrap your code in a validator that only runs if the required permissions have been set.</p>
<p>For example, if you want to make sure you can actually set some cookie, you might want to use this type of syntax:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> queryPermission = require(<span style="color:#a50">&#39;queryPermission&#39;</span>);
<span style="color:#00a">const</span> setCookie = require(<span style="color:#a50">&#39;setCookie&#39;</span>);

<span style="color:#00a">const</span> options = {
  domain: <span style="color:#a50">&#39;www.simoahava.com&#39;</span>
};

<span style="color:#aaa;font-style:italic">// Check whether it&#39;s possible to write the cookie before writing it
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">if</span> (queryPermission(<span style="color:#a50">&#39;set_cookies&#39;</span>, <span style="color:#a50">&#39;_gaClientId&#39;</span>, options)) {
  setCookie(<span style="color:#a50">&#39;_gaClientId&#39;</span>, <span style="color:#a50">&#39;abc123&#39;</span>, options);
}
</code></pre></div>
<p>The <code>setCookie()</code> API code is only run if the permissions allow you to write a cookie named <code>_gaClientId</code> on the domain <code>www.simoahava.com</code>. This is a good way to avoid your tag running into errors.</p>
<h5 id="the-copyfromdatalayer-api">The <code>copyFromDataLayer</code> API</h5>
<p><a href="https://developers.google.com/tag-manager/templates/api/#copyfromdatalayer">This API</a> is relatively straightforward - it fetches the item from GTM&rsquo;s data model that you requested. For example, to fetch the current value for <code>gtm.elementUrl</code>, you&rsquo;d run:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> copyFromDataLayer = require(<span style="color:#a50">&#39;copyFromDataLayer&#39;</span>);
<span style="color:#00a">const</span> clickUrl = copyFromDataLayer(<span style="color:#a50">&#39;gtm.element&#39;</span>);
</code></pre></div>
<p>This code would fetch the value from the data model at the time that the tag was run.</p>
<p>However, there&rsquo;s a very important <strong>catch</strong> here.</p>
<p>If the template code fetching the <code>dataLayer</code> value is run <strong>asynchronously</strong> (e.g. with the <a href="https://developers.google.com/tag-manager/templates/api/#calllater"><code>callLater</code> API</a>), or if the tag built from the template is part of a <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/"><strong>tag sequence</strong></a>, the value fetched from <code>dataLayer</code> will be <strong>whatever is currently stored in the data model</strong>. In all other scenarios, the code is run synchronously, relative to the <code>dataLayer.push()</code>, so the value returned by <code>copyFromDataLayer</code> will reflect what was included in the pushed object.</p>
<p>To illustrate, consider the following code executed on the site:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer.push({
  event: <span style="color:#a50">&#39;fire&#39;</span>,
  key: <span style="color:#a50">&#39;value&#39;</span>
});

<span style="color:#0aa">window</span>.dataLayer.push({
  event: <span style="color:#a50">&#39;fire&#39;</span>,
  key: <span style="color:#a50">&#39;otherValue&#39;</span>
});
</code></pre></div>
<p>These two  <code>dataLayer.push()</code> calls are run one after the other. If you&rsquo;ve built a tag that fires on the &ldquo;fire&rdquo; event, and the template for that tag uses <code>copyFromDataLayer</code> to fetch the value for <code>key</code>, then in most cases it will always return whatever the value of <code>key</code> was during the trigger push.</p>
<p>In other words, the first time the tag fires, <code>key</code> will be set to <code>value</code>, and the second time the tag fires, <code>key</code> will return <code>otherValue</code>. This is understandable, and it&rsquo;s how Google Tag Manager has always worked.</p>
<p>However, if the template uses <code>copyFromDataLayer</code> in an asynchronous method, or if the tag is part of a sequence, then when the first tag fires, it&rsquo;s possible that <code>key</code> will actually return <code>otherValue</code>, because by the time the tag resolves that code, the second push will have happened and the values stored in GTM&rsquo;s data model will have been updated.</p>
<p>This is something to be mindful of. I hope that we get the chance to control this behavior by providing a flag that lets us choose whether to use this asynchronous behavior or to fall back to the original, synchronous process.</p>
<h5 id="the-global-variable-apis">The &ldquo;global variable&rdquo; APIs</h5>
<p>Templates offer you a handful of APIs that all interact with the global namespace (namely, the <code>window</code> object). These APIs are:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#aliasinwindow"><code>aliasInWindow</code></a> for creating a copy of a global variable in another global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#callinwindow"><code>callInWindow</code></a> for executing a global function.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#copyfromwindow"><code>copyFromWindow</code></a> for creating a local copy (a <strong>proper copy</strong>, NOT a <strong>reference</strong> to the original) of the global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createargumentsqueue"><code>createArgumentsQueue</code></a> for creating an array as well as a helper function that passes its arguments to the array.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createqueue"><code>createQueue</code></a> for creating an array as a global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#setinwindow"><code>setInWindow</code></a> for setting a global variable.</p>
</li>
</ul>
<p>These APIs have a number of permissions associated with them, so you need to make sure you make <a href="#accesses-global-variables">the necessary modifications</a> to the template permissions.</p>
<p>Another thing to keep in mind is that when you access these global variables in the context of the templates, GTM creates a <strong>local copy</strong> of each and does NOT copy objects by reference, which is the typical way of handling JavaScript objects.</p>
<p>See this example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> copy = require(<span style="color:#a50">&#39;copyFromWindow&#39;</span>)
<span style="color:#00a">const</span> obj = copy(<span style="color:#a50">&#39;someObject&#39;</span>);

obj.someProperty = <span style="color:#00a">true</span>;
</code></pre></div>
<p>This sets <code>someProperty</code> on the object to <code>true</code> <strong>only in the template code</strong>. It doesn&rsquo;t change it to <code>true</code> in the global object itself. That&rsquo;s because GTM creates a clone of the global variable rather than a reference to it.</p>
<p>Finally, GTM handles <strong>functions</strong> in a special way. When you try to run <code>setInWindow('someVariable', someFunction)</code>, where <code>someFunction</code> is a function you have created, what gets set in the global variable <code>someVariable</code> is <strong>not</strong> the actual function, but rather a wrapper created by GTM which ends up calling the function.</p>
<p>This shouldn&rsquo;t be a big deal - since the end result is always the same. Whatever you call the global variable with gets executed in the function you created.</p>
<p>However, it does mean that you won&rsquo;t be able to <strong>set individual properties to that function</strong>. Take this example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> func = str =&gt; str + <span style="color:#a50">&#34; Simo&#34;</span>;
func.loaded = <span style="color:#00a">true</span>;

setInWindow(<span style="color:#a50">&#39;someFunction&#39;</span>, func);
</code></pre></div>
<p>If you now call <code>window.someFunction('Hello');</code>, the code ends up returning <code>&quot;Hello Simo&quot;</code>, so it works. However, if you check <code>someFunction.loaded</code>, you&rsquo;ll notice it&rsquo;s undefined when it should be <code>true</code>.</p>
<h5 id="the-maketablemap-api">The <code>makeTableMap</code> API</h5>
<p>The <a href="https://developers.google.com/tag-manager/templates/api#maketablemap"><code>makeTableMap</code></a> API makes the <a href="#simple-table">simple table</a> field more manageable.</p>
<p>The simple table field itself returns an array of objects, where each object represents a <strong>row</strong> of the table and is comprised of key-value pairs. Each key-value pair corresponds to a column.</p>
<p>For example, if the simple table had two columns:</p>
<p><strong>Column 1:</strong> fieldToSetName<br>
<strong>Column 2:</strong> fieldToSetValue</p>
<p>The resulting <code>data</code> object would look like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#1e90ff;font-weight:bold">&#34;fieldToSetName&#34;</span>: <span style="color:#a50">&#34;page&#34;</span>,
    <span style="color:#1e90ff;font-weight:bold">&#34;fieldToSetValue&#34;</span>: <span style="color:#a50">&#34;/home/&#34;</span>
  },
  {
    <span style="color:#1e90ff;font-weight:bold">&#34;fieldToSetName&#34;</span>: <span style="color:#a50">&#34;userId&#34;</span>,
    <span style="color:#1e90ff;font-weight:bold">&#34;fieldToSetValue&#34;</span>: <span style="color:#a50">&#34;abc123&#34;</span>
  }
]</code></pre></div>
<p>The <code>makeTableMap</code> API turns this into a single object whose contents are mapped from the values the user input. Naturally, this means that the column you use as the &ldquo;key&rdquo; of this new map must have unique values.</p>
<p>To continue the example from above, if you run <code>makeTableMap</code> against the array above, this is the result:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> makeTableMap = require(<span style="color:#a50">&#39;makeTableMap&#39;</span>);
<span style="color:#00a">const</span> log = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);

<span style="color:#00a">const</span> data = data.properties; <span style="color:#aaa;font-style:italic">// This is the array from the example above
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> newMap = makeTableMap(data, <span style="color:#a50">&#39;fieldToSetName&#39;</span>, <span style="color:#a50">&#39;fieldToSetValue&#39;</span>);

log(newMap);
<span style="color:#aaa;font-style:italic">/* LOGS:
</span><span style="color:#aaa;font-style:italic">  {
</span><span style="color:#aaa;font-style:italic">    &#34;page&#34;: &#34;/home&#34;,
</span><span style="color:#aaa;font-style:italic">    &#34;userId&#34;: &#34;abc123&#34;
</span><span style="color:#aaa;font-style:italic">  }
</span><span style="color:#aaa;font-style:italic">*/</span>
</code></pre></div>
<h4 id="the-data-object">The <code>data</code> object</h4>
<p>If you want to access values the user has input into the template fields, you need to use the <code>data</code> object. Furthermore, to signal <strong>tag</strong> template completion (or failure), you will also need to use the <code>data</code> object in your template code.</p>
<p>Every single user input in the template fields is encoded in the <code>data</code> object as properties, where the property name matches the <strong>field name</strong> you gave in the editor.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/field-name.jpg" title="Field name">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/field-name.jpg#ZgotmplZ" alt="Field name" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 962 190'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>To access the values the user input into the <code>cookieSettings</code> field above, you would use this syntax:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> input = data.cookieSettings;
</code></pre></div>
<p>You don&rsquo;t need to <code>require()</code> any API to access the user input - the <code>data</code> object is always available for fetching the values the user has entered. Read through the <a href="#fields-editor">Fields editor</a> chapter to see how each different field type is encoded into the <code>data</code>object.</p>
<h4 id="variable-templates-in-the-code-editor">Variable templates in the code editor</h4>
<p>Variable templates have just one requirement, similar to Custom JavaScript variables in GTM: they must <strong>return</strong> a value. If you don&rsquo;t have a <code>return</code> statement in the template, the variable will always return <code>undefined</code> (not very useful).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> userInput = data.someNumber;

<span style="color:#00a">return</span> userInput * <span style="color:#099">2</span>;
</code></pre></div>
<p>The variable template above would take the value entered by user into the <code>someNumber</code> field and return it multiplied by 2.</p>
<h4 id="tag-templates-in-the-code-editor">Tag templates in the code editor</h4>
<p>With tag templates, you <strong>must</strong> invoke one of two methods in the code:</p>
<ul>
<li>
<p><code>data.gtmOnSuccess()</code> to indicate that the tag was a success.</p>
</li>
<li>
<p><code>data.gtmOnFailure()</code> to indicate that the tag execution failed.</p>
</li>
</ul>
<p>I recommend to always have <code>data.gtmOnSuccess()</code> (after all, why create a tag that doesn&rsquo;t indicate successful completion). If there is a clear point of failure, such as something you want to block a <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">tag sequence</a> with, you should also add a <code>data.gtmOnFailure()</code> call into the code.</p>
<p>Try to avoid paths in the code that do not lead to either <code>data.gtmOnSuccess()</code> or <code>data.gtmOnFailure()</code>, as the tag will be in &ldquo;Still running&rdquo; status for perpetuity.</p>
<p>Here&rsquo;s an example. Let&rsquo;s say the template&rsquo;s purpose is to write a cookie into the browser storage. If the template permissions allow the cookie to be written, <code>data.gtmOnSuccess()</code> is called after the write. If the permissions prevent this, a warning is logged into the console and <code>data.gtmOnFailure()</code> is run instead.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> log = require(<span style="color:#a50">&#39;logToConsole&#39;</span>);
<span style="color:#00a">const</span> setCookie = require(<span style="color:#a50">&#39;setCookie&#39;</span>);
<span style="color:#00a">const</span> queryPermission = require(<span style="color:#a50">&#39;queryPermission&#39;</span>);

<span style="color:#00a">if</span> (queryPermission(<span style="color:#a50">&#39;set_cookies&#39;</span>, <span style="color:#a50">&#39;_gaClientId&#39;</span>)) {
  setCookie(<span style="color:#a50">&#39;_gaClientId&#39;</span>, <span style="color:#a50">&#39;abc123&#39;</span>);
  data.gtmOnSuccess();
} <span style="color:#00a">else</span> {
  log(<span style="color:#a50">&#39;Unable to write cookie due to missing permissions!&#39;</span>);
  data.gtmOnFailure();
}
</code></pre></div>
<p>Tag success/failure/incompletion status is shown in Preview mode, too.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/firing-status.jpg" title="Firing status in debug mode">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/firing-status.jpg#ZgotmplZ" alt="Firing status in debug mode" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 823 658'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h4 id="client-templates-in-the-code-editor">Client templates in the code editor</h4>
<p>With <strong>Client</strong> templates, you need to invoke the <a href="https://developers.google.com/tag-manager/serverside/api#claimrequest"><code>claimRequest</code> API</a> when you want the Client to parse the HTTP request and not let other Clients use it any longer. For example, if you have a Client that is designed to handle requests coming to <code>/my-pixel/</code>, you&rsquo;d build a Client like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> getRequestPath = require(<span style="color:#a50">&#39;getRequestPath&#39;</span>);
<span style="color:#00a">const</span> claimRequest = require(<span style="color:#a50">&#39;claimRequest&#39;</span>);

<span style="color:#00a">if</span> (getRequestPath() === <span style="color:#a50">&#39;/my-pixel/&#39;</span>) {
  claimRequest();
}
</code></pre></div>
<p>When the Client has done its work, it must return a response back to the source of the request. This is done with the <a href="https://developers.google.com/tag-manager/serverside/api#returnresponse"><code>returnResponse</code> API</a>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">runContainer(event, () =&gt; {
  <span style="color:#aaa;font-style:italic">// onComplete callback called, return the response.
</span><span style="color:#aaa;font-style:italic"></span>  returnResponse();
});
</code></pre></div>
<p>I do recommend to read <a href="https://www.simoahava.com/gtm-tips/build-custom-universal-analytics-client-server-side-tagging/">this article</a> for an overview of how Client templates work.</p>
<h3 id="permissions">Permissions</h3>
<p>When you add one of the <strong>supported APIs</strong> using the <code>require</code> method in the code editor, the associated permissions for that API are automatically displayed in the <strong>Permissions</strong> tab.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/tag-template-permissions-tab.jpg" title="Permissions tab">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/tag-template-permissions-tab.jpg#ZgotmplZ" alt="Permissions tab" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1048 482'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Read <a href="https://developers.google.com/tag-manager/serverside/permissions">this document</a> for a comprehensive list of permissions used by <strong>Server-side tagging</strong> templates.</p>
<p>Permissions are described at length <a href="https://developers.google.com/tag-manager/templates/permissions">in the official documentation</a>. Nevertheless, in this chapter I&rsquo;ll show what the UI for each permission looks like, and what the different settings are used for.</p>
<p>Note that you can <strong>save</strong> a template with code that conflicts with a permission. It&rsquo;s not until the tag is run that an error is thrown, and this error is surfaced in the <a href="https://www.simoahava.com/analytics/new-errors-tab-preview-mode/">Errors tab</a> in Preview mode, signalling that there was a permissions conflict within the tag.</p>
<h4 id="accesses-global-variables">Accesses Global Variables</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-access-global-variables.jpg" title="Accesses global variables">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-access-global-variables.jpg#ZgotmplZ" alt="Accesses global variables" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1900 508'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Accesses Global Variables permission allows the code to <strong>Read</strong> (see what value is assigned to the variable), <strong>Write</strong> (update the value assigned to the variable), and <strong>Execute</strong> (if the variable is a function, execute it) global variables. The <strong>Key</strong> is the name of the global variable, accessed via <code>window[key]</code>.</p>
<p>Here are the APIs and the relevant permissions for them:</p>
<table>
<thead>
<tr>
<th>API example</th>
<th>Permission</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aliasInWindow('copyTo', 'copyFrom')</code></td>
<td><strong>Write</strong> on <code>copyTo</code>, <strong>Read</strong> on <code>copyFrom</code>.</td>
</tr>
<tr>
<td><code>callInWindow('someFunction')</code></td>
<td><strong>Execute</strong> on <code>someFunction</code>.</td>
</tr>
<tr>
<td><code>copyFromWindow('copyFrom')</code></td>
<td><strong>Read</strong> on <code>copyFrom</code>.</td>
</tr>
<tr>
<td><code>createArgumentsQueue('helper', 'queue')</code></td>
<td><strong>ReadWrite</strong> on <code>helper</code>, <strong>ReadWrite</strong> on <code>queue</code>.</td>
</tr>
<tr>
<td><code>createQueue('someArray')</code></td>
<td><strong>ReadWrite</strong> on <code>someArray</code>.</td>
</tr>
<tr>
<td><code>setInWindow('someVariable', 'someValue', true)</code></td>
<td><strong>ReadWrite</strong> on <code>someVariable</code> (regardless of third parameter).</td>
</tr>
</tbody>
</table>
<p>In other words, if your code needs to access any global variable using e.g. <code>setInWindow</code> or <code>copyFromWindow</code>, you need to add those variables into these permission settings, and you need to specify if the code can read, write, and/or execute the variable in question.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#access_globals"><code>access_globals</code></a>.</p>
</blockquote>
<h4 id="accesses-local-storage">Accesses Local Storage</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2020/08/permissions-access-local-storage.jpg" title="Accesses Local Storage">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2020/08/permissions-access-local-storage.jpg#ZgotmplZ" alt="Accesses Local Storage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 436'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Accesses Local Storage permission allows the code to <strong>Read</strong> (get items from <code>localStorage</code>) and <strong>Write</strong> (set items in <code>localStorage</code>) items in the browser&rsquo;s <code>localStorage</code>, by utilizing the <code>localStorage</code> template API.</p>
<p>If your code needs to access <code>localStorage</code>,  you need to specify Read and/or Write permissions for every key in <code>localStorage</code> the template needs to access.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#access_local_storage"><code>access_local_storage</code></a>.</p>
</blockquote>
<h4 id="accesses-template-storage">Accesses Template Storage</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2020/08/permissions-accesses-template-storage.jpg" title="Accesses Template Storage">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2020/08/permissions-accesses-template-storage.jpg#ZgotmplZ" alt="Accesses Template Storage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1910 188'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Accesses Template Storage permission allows the code to Read and Write to a temporary storage which exists for the current page load. It&rsquo;s useful if you need to persist information that persists across template executions.</p>
<p>For example, if you want to make sure your template doesn&rsquo;t run some code more than once per page load, you could use <code>templateStorage</code> like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> templateStorage = require(<span style="color:#a50">&#39;templateStorage&#39;</span>);
<span style="color:#00a">const</span> ids = templateStorage.getItem(<span style="color:#a50">&#39;ids&#39;</span>) || [];
<span style="color:#00a">if</span> (!ids.includes(data.id)) {
  <span style="color:#aaa;font-style:italic">// Run code
</span><span style="color:#aaa;font-style:italic"></span>  ...
  ids.push(data.id);
  templateStorage.setItem(<span style="color:#a50">&#39;ids&#39;</span>, ids);
}
</code></pre></div>
<p>The permission has no configuration - read, write, and delete operations are always permitted.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#access_template_storage"><code>access_template_storage</code></a>.</p>
</blockquote>
<h4 id="reads-cookie-values">Reads Cookie Value(s)</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-reads-cookie-values.jpg" title="Reads cookie values">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-reads-cookie-values.jpg#ZgotmplZ" alt="Reads cookie values" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 344'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Reads Cookie Value(s) permission lists all the first-party cookies the tag or variable code can access with the <code>getCookieValues</code> API. To allow the code to read from a first-party cookie, you need to list all the cookie names that can be accessed on <strong>their own line</strong> in the text box in the permission settings.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get_cookies"><code>get_cookies</code></a>.</p>
</blockquote>
<h4 id="reads-referrer-url">Reads Referrer URL</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/permissions-gets-referrer.jpg" title="Gets referrer">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/permissions-gets-referrer.jpg#ZgotmplZ" alt="Gets referrer" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1910 472'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Reads Referrer URL permission allows template code to access any or only parts of the referring page URL (from <code>document.referrer</code>. You can restrict access to any combination of its URL components. Since the permission model is the same as for the <a href="#reads-url">Reads URL</a> permission, please read the very next section for more details.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get_referrer"><code>get_referrer</code></a>.</p>
</blockquote>
<h4 id="reads-url">Reads URL</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-reads-url.jpg" title="Reads URL">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-reads-url.jpg#ZgotmplZ" alt="Reads URL" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1916 462'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Reads URL permission allows template code to access any or only parts of the current page URL. You can restrict access to any combination of the following URL components:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>protocol</td>
<td><code>http</code>, <code>https</code>, or <code>file</code></td>
</tr>
<tr>
<td>host</td>
<td><code>blog.simoahava.com</code></td>
</tr>
<tr>
<td>port</td>
<td><code>443</code></td>
</tr>
<tr>
<td>path</td>
<td><code>/analytics/articles/</code></td>
</tr>
<tr>
<td>extension</td>
<td><code>html</code></td>
</tr>
<tr>
<td>fragment</td>
<td><code>about-us</code></td>
</tr>
<tr>
<td>query</td>
<td><code>gclid=1.2.3.4</code></td>
</tr>
</tbody>
</table>
<p>After selecting <strong>query</strong>, You can specify which <strong>query keys</strong> the <code>getUrl</code> API is allowed to access, or you can leave it to its default setting which is any query keys.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get-url"><code>get_url</code></a>.</p>
</blockquote>
<h4 id="injects-hidden-iframes">Injects Hidden Iframes</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-injects-hidden-iframes.jpg" title="Injects Hidden Iframes">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-injects-hidden-iframes.jpg#ZgotmplZ" alt="Injects Hidden Iframes" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1908 344'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can list a number of URL patterns, each on its own row, that must match those in the code editor used to inject hidden iframes on the page. The <code>src</code> attribute of the iframe the editor wants to inject must match one of these parameters.</p>
<p>The URL patterns must include <code>https://</code>, a valid hostname, and a valid path. Hostnames can use asterisk to wildcard match any subdomains, and paths can use asterisk to wildcard match any characters. Path ending with a <code>/</code> is also a wildcard match for anything that follows.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*tracker.html</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/track/</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/this/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/track/superdupertracker.html</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#inject_hidden_iframe"><code>inject_hidden_iframe</code></a>.</p>
</blockquote>
<h4 id="injects-scripts">Injects Scripts</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-injects-scripts.jpg" title="Injects Scripts">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-injects-scripts.jpg#ZgotmplZ" alt="Injects Scripts" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1910 362'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can list a number of URL patterns, each on its own row, that must match those in the code editor used to inject scripts on the page. The <code>src</code> attribute of the script the editor wants to inject must match one of these patterns.</p>
<p>The URL patterns must include <code>https://</code>, a valid hostname, and a valid path. Hostnames can use asterisk to wildcard match any subdomains, and paths can use asterisk to wildcard match any characters. Path that only consists of a <code>/</code> is also a wildcard match for anything that follows.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*tracker.js</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/gtmtracker.js</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/track/superdupertracker.js</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#inject_script"><code>inject_script</code></a>.</p>
</blockquote>
<h4 id="logs-to-console">Logs To Console</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-logs-to-console.jpg" title="Logs to Console">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-logs-to-console.jpg#ZgotmplZ" alt="Logs to Console" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 370'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can choose whether the <code>logToConsole</code> API can log into the browser console only when in preview/debug mode, or whether it can log to console whenever the tag fires, regardless of debug context.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#logging"><code>logging</code></a>.</p>
</blockquote>
<h4 id="reads-data-layer">Reads Data Layer</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-reads-data-layer.jpg" title="Reads Data Layer">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-reads-data-layer.jpg#ZgotmplZ" alt="Reads Data Layer" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1910 344'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the permission configuration, add the Data Layer keys the code has access to, each on its own row.</p>
<p>You can use wildcards to allow the code access to any subproperties of the key. For example, a permission like this:</p>
<ul>
<li><code>ecommerce.*</code></li>
</ul>
<p>Will allow the code editor to read <code>ecommerce</code>, <code>ecommerce.purchase.actionField.id</code>, <code>ecommerce.purchase.products</code>, and any other key nested under <code>ecommerce</code>.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_data_layer"><code>read_data_layer</code></a>.</p>
</blockquote>
<h4 id="reads-document-character-set">Reads Document Character Set</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-reads-document-character-set.jpg" title="Reads Document Character Set">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-reads-document-character-set.jpg#ZgotmplZ" alt="Reads Document Character Set" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 194'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>An extremely simple permission for an extremely simple API. This permission governs whether or not the code editor can use the <code>readCharacterSet</code> API, which, in turn, returns the value of <code>document.characterSet</code>.</p>
<p>There are no configuration options you can pass to the permission, so it&rsquo;s always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_character_set"><code>read_character_set</code></a>.</p>
</blockquote>
<h4 id="reads-container-data">Reads Container Data</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2020/08/permissions-reads-container-data.jpg" title="Reads container data">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2020/08/permissions-reads-container-data.jpg#ZgotmplZ" alt="Reads container data" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 186'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Very simple permission (nothing to configure), which is used when the template code needs to use the <code>getContainerVersion</code> API.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_container_data"><code>read_container_data</code></a>.</p>
</blockquote>
<h4 id="reads-event-metadata">Reads Event Metadata</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/07/reads-event-metadata.jpg" title="Reads Event Metadata">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/07/reads-event-metadata.jpg#ZgotmplZ" alt="Reads Event Metadata" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 956 96'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This permission allows the code to use the <code>addEventCallback</code> API, which updates the <code>eventCallback</code> of the <code>dataLayer.push()</code> that triggered the tag created from this template. A data object of tags that fired for the <code>dataLayer</code> event is passed as an argument to the callback.</p>
<p>Take a look at <a href="https://www.simoahava.com/analytics/google-tag-manager-monitor/">this article</a> for more details on how this API works.</p>
<p>This permission doesn&rsquo;t take any configuration options, so it&rsquo;s always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_event_metadata"><code>read_event_metadata</code></a>.</p>
</blockquote>
<h4 id="reads-document-title">Reads Document Title</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-reads-document-title.jpg" title="Reads Document Title">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-reads-document-title.jpg#ZgotmplZ" alt="Reads Document Title" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1906 178'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Another really simple permission for a really simple API. This permission allows the code to use the <code>readTitle</code> API, which returns the value of <code>document.title</code>.</p>
<p>This permission doesn&rsquo;t take any configuration options, so it&rsquo;s always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_title"><code>read_title</code></a>.</p>
</blockquote>
<h4 id="sends-pixels">Sends Pixels</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-sends-pixels.jpg" title="Sends Pixels">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-sends-pixels.jpg#ZgotmplZ" alt="Sends Pixels" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1908 362'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>You can provide a list of URL patterns (each on its own row), and when using the the <code>sendPIxel</code> API, the URL the pixel is dispatched to must match one of these patterns.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*/track</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/collect</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker/track</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/collect/analytics/track</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#send_pixel"><code>send_pixel</code></a>.</p>
</blockquote>
<h4 id="sets-a-cookie-value">Sets A Cookie Value</h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/permissions-sets-a-cookie-value.jpg" title="Sets a Cookie Value">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/permissions-sets-a-cookie-value.jpg#ZgotmplZ" alt="Sets a Cookie Value" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1914 476'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>This permission lets you configure which cookies the template code is allowed to set. You can also configure the following parameters per cookie:</p>
<ul>
<li>
<p><strong>Domain</strong> - on which domain the cookie can be written on or <code>*</code> for any.</p>
</li>
<li>
<p><strong>Path</strong> - on which path the cookie can be written on or <code>*</code> for any.</p>
</li>
<li>
<p><strong>Secure</strong> - whether the cookie must be set with the <code>secure</code> flag, without the <code>secure</code> flag, or either.</p>
</li>
<li>
<p><strong>Session</strong> - whether the cookie must be a session cookie, a cookie with an expiration, or either.</p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#set_cookies"><code>set_cookies</code></a>.</p>
</blockquote>
<h3 id="tests-1">Tests</h3>
<p>For more information on writing and running <strong>tests</strong> against your template code, see <a href="#tests">this chapter</a>, and read <a href="https://www.simoahava.com/analytics/writing-tests-for-custom-templates-google-tag-manager/">this article</a>.</p>
<h3 id="template-preview">Template preview</h3>
<p>The <strong>Template Preview</strong> window is where you can see what your template user interface looks like in its current state, and you can also try filling in the inputs before <a href="#testing-the-template">testing</a> the template.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/template-preview-editor.jpg" title="Template preview editor">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/template-preview-editor.jpg#ZgotmplZ" alt="Template preview editor" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1884 714'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>When you make changes to the template, whether in the <strong>Info</strong>, <strong>Fields</strong>, <strong>Code</strong>, or <strong>Permission</strong> tabs, the <strong>Refresh</strong> icon appears. By clicking this icon, the template preview is updated to reflect the changes you have made to the template in the editor.</p>
<p>Other than that, the template preview should perform exactly as the real thing. In the <strong>summary view</strong>, i.e. before you click it for editing, the template will show you only those fields that are included in summary. You can manually toggle this with the <a href="#always-in-summary">Always in summary</a> field configuration.</p>
<p>The template preview is the perfect place to try out your template user interface before testing how the template actually runs, and finally saving it into the template library of your container.</p>
<h3 id="importing-and-exporting">Importing and exporting</h3>
<p><strong>Importing and exporting</strong> templates will almost certainly be one of the most useful things you can do with templates. By exporting your custom templates, you can create a store or library of Google Tag Manager templates for others to use. By importing templates, you can add custom templates created by others into your own template library.</p>
<p><strong>To export a template</strong>, click open the editor menu and choose <strong>Export</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/export-import-template.jpg" title="Export and import template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/export-import-template.jpg#ZgotmplZ" alt="Export and import template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1178 490'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Your browser should automatically download a file named <code>&lt;your template name&gt;.tpl</code>. The <strong>TPL</strong> suffix is a custom file format for Google Tag Manager templates. If you open the file in a text editor, you can see that it&rsquo;s a combination of JSON objects and plain text.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/template-export-file.jpg" title="Template export file">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/template-export-file.jpg#ZgotmplZ" alt="Template export file" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1710 872'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>To import a template</strong>, click open the editor menu and choose <strong>Import</strong>. When importing a template, it&rsquo;s a good idea to first <strong>create a new template</strong> which will host the imported item. Unless of course you are deliberately updating an existing template with a newer version of the import.</p>
<p>Once you&rsquo;ve chosen the file, a pop-up will warn you that importing the file will overwrite the template currently being edited.</p>
<p>Why is this significant? Well, an <strong>import completely overwrites the template to which it is imported</strong>. So if you expect some sort of &ldquo;merging&rdquo; being an option, well, at the time of writing there&rsquo;s no such feature.</p>
<h3 id="advanced-settings">Advanced settings</h3>
<p>When you select <strong>Show Advanced Settings</strong> from the editor menu, a number of changes takes place in the UI.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/show-advanced-settings-editor.jpg" title="Show advanced settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/show-advanced-settings-editor.jpg#ZgotmplZ" alt="Show advanced settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1326 374'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<ol>
<li>A <strong>Notes</strong> option becomes visible in the editor navigation. You can write anything you want into this text area, such as developer documentation, instructions for use, etc. The <strong>Notes</strong> field contents are included with the template export/import.</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/editor-notes.jpg" title="Editor Notes">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/editor-notes.jpg#ZgotmplZ" alt="Editor Notes" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1308 376'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<ol start="2">
<li>The <strong>Info</strong> tab will now show the <strong>Version</strong> (of the templating system itself) and the <strong>Container Context</strong> (whether the template is for web containers or for app containers). You can&rsquo;t change either of these values - they are set when you start creating the template. The <strong>Info</strong> tab will also show the <strong>Brand Name</strong> field.</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/version-context-info.jpg" title="Version and context info">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/version-context-info.jpg#ZgotmplZ" alt="Version and context info" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 836 306'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<ol start="3">
<li>In the <strong>Info</strong> and <strong>Fields</strong> tabs, you can directly edit the JSON source. Note that even though this lets you edit anything you want in the source, trying to change things that can&rsquo;t be changed (such as <strong>Version</strong> and <strong>Container Context</strong> from above) will result in the template issuing a warning when you try to refresh it in the preview or save it.</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/source-toggle.jpg" title="Source toggler">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/source-toggle.jpg#ZgotmplZ" alt="Source toggler" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1934 692'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h3 id="running-the-template-code">Running the template code</h3>
<p>Whenever you want to test how the template actually <strong>runs</strong>, you can click the <strong>Run code</strong> button in the Template Preview window. This executes the tag/variable template code itself, outputting any debug messages into the console.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/test-example.jpg" title="Test example">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/test-example.jpg#ZgotmplZ" alt="Test example" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1912 438'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>For <strong>tag templates</strong>, the console will tell you when the preview was last refreshed. It will also output any test logs, such as test start and completion (with elapsed time), as well as any errors.</p>
<p>If you don&rsquo;t change anything in the <a href="#code-editor">code editor</a>, the default code snippet will output the contents of the <code>data</code> object into the console.</p>
<p>Generally, the console will display any strings you write into the console using the <a href="https://developers.google.com/tag-manager/templates/api#logtoconsole"><code>logToConsole</code></a> API.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/error-in-console.jpg" title="Error in console">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/error-in-console.jpg#ZgotmplZ" alt="Error in console" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1754 580'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Furthermore, when you choose to <strong>Show test page</strong> in the editor menu, a content area will pop up which you can <strong>inspect</strong> to find any changes the tag code has made to the page on which the tag runs. This is useful if you want to check if and how your hidden iframe was added to the page, for example.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/show-test-page.jpg" title="Show test page">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/show-test-page.jpg#ZgotmplZ" alt="Show test page" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2058 820'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>To find your modifications to the test page, right-click it in your browser and choose <strong>Inspect</strong> (this may vary by browser). Start drilling down the DOM until you find an iframe with GTM&rsquo;s sandbox HTML file. The <code>&lt;body&gt;</code> of that iframe should contain any modifications your tag did to the page.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/test-page-inspect.jpg" title="Inspect test page">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/test-page-inspect.jpg#ZgotmplZ" alt="Inspect test page" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2314 582'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Variable templates</strong> differ in that they don&rsquo;t modify the underlying page (or, they SHOULDN&rsquo;T modify the underlying page). Instead, when you <strong>test</strong> the template, the console outputs what the variable will return.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/test-template-variable.jpg" title="Test variable template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/test-template-variable.jpg#ZgotmplZ" alt="Test variable template" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1916 1448'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="templates-in-gtms-preview-mode">Templates in GTM&rsquo;s Preview mode</h2>
<p>In <strong>Preview</strong> mode, tag and variable templates work just like their built-in template counterparts.</p>
<p>For <strong>tags</strong>, you&rsquo;ll see the tag <strong>name</strong> and <strong>properties</strong>.</p>
<p>Two default properties are always included:</p>
<ol>
<li>
<p><strong>Type</strong> - which is the template name, basically.</p>
</li>
<li>
<p><strong>Firing Status</strong> - which will show &ldquo;Succeeded&rdquo; if <code>data.gtmOnSuccess()</code> was reached in the tag code, &ldquo;Failure&rdquo; if <code>data.gtmOnFailure()</code> was reached in the tag code, and <code>Still running</code> if neither was reached or if the tag is, actually, still running (due to e.g. the endpoint timing out).</p>
</li>
</ol>
<p>The rest of the properties mirror the fields and <a href="#field-configuration-reference">field configurations</a> you have generated. In the example below, a <a href="#text-input">text input</a> field named <strong>Iframe URL</strong> has been populated with the value <code>https://www.gtmtools.com/</code>, and a <a href="#param-table">param table</a> field named <strong>Iframe parameters</strong> has been populated with the values you see.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/tag-template-parameters.jpg" title="Tag template parameters">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/tag-template-parameters.jpg#ZgotmplZ" alt="Tag template parameters" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1492 588'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>For <strong>variables</strong>, the output can be found in the <strong>Variables</strong> tab of Preview mode, and you can see the return value of each custom variable in exactly the same way you can see the return values for all predefined variable templates.</p>
<p>The variable template <strong>type</strong> will be the name of the custom template (&ldquo;Multiply&rdquo; in the example below).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/04/variable-template-example.jpg" title="Variable template example">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/04/variable-template-example.jpg#ZgotmplZ" alt="Variable template example" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1966 296'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <strong>Errors</strong> tab will surface any errors thrown by <a href="#policies-reference">policies</a> or if the template failed a <a href="#permissions">permission</a> check.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/tag-errors.jpg" title="Tag errors">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/tag-errors.jpg#ZgotmplZ" alt="Tag errors" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1066 227'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="field-configuration-reference">Field configuration reference</h2>
<p>This chapter lists all the <strong>Field configuration</strong> options you can configure for individual fields. Remember to check out the <a href="#fields-editor">Fields editor</a> chapter for a detailed description of the fields and the configurations available to them.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/field-configuration.jpg" title="Field configuration">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/field-configuration.jpg#ZgotmplZ" alt="Field configuration" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3178 550'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h3 id="edit-row-dialog-title">&ldquo;Edit row&rdquo; dialog title</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-edit-row.jpg" title="Edit row dialog title">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-edit-row.jpg#ZgotmplZ" alt="Edit row dialog title" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3004 662'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>&ldquo;Edit row&rdquo; dialog title</strong> is available in fields where the user adds rows to a table and can edit those rows in an overlay. Defaults to &ldquo;Edit row&rdquo;.</p>
<p><strong>How it works</strong>: The text you write into the configuration field will appear as the title of the overlay which pops out when the user <strong>edits</strong> a row they have already added to the table.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>.</p>
<h3 id="new-row-button-text">&ldquo;New row&rdquo; button text</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-new-row.jpg" title="New row button text">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-new-row.jpg#ZgotmplZ" alt="New row button text" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1964 732'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>&ldquo;New row&rdquo; button text</strong> determines the button text with which the user can add a new row to a table field.</p>
<p><strong>How it works</strong>: The text you type into the configuration field will be the text of the button below the table, which the user can use to add new rows to the table. Defaults to &ldquo;Add row&rdquo;.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>, <a href="#simple-table">Simple table</a>.</p>
<h3 id="new-row-dialog-title">&ldquo;New row&rdquo; dialog title</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-new-row-dialog.jpg" title="New row dialog title">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-new-row-dialog.jpg#ZgotmplZ" alt="New row dialog title" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1978 566'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>&ldquo;New row&rdquo; dialog title</strong> determines the text you see as the heading of the overlay that pops out when you choose to add a new row into a table. Defaults to &ldquo;New row&rdquo;.</p>
<p><strong>How it works</strong>: Type the new title into the configuration field, and it will show as the heading of the overlay the user sees when adding a new row to a table that uses overlays for data input.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>.</p>
<h3 id="not-set-option">&ldquo;Not set&rdquo; option</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-not-set-option.jpg" title="not set option">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-not-set-option.jpg#ZgotmplZ" alt="not set option" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1224 308'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Before the user chooses an item in the drop-down list, you can use the <strong>&ldquo;Not set&rdquo; option</strong> to show a placeholder value.</p>
<p><strong>How it works</strong>: The <strong>&ldquo;Not set&rdquo; option</strong> is a selectable option in the drop-down list, which also shows up if the user hasn&rsquo;t made any selection yet. If the user leaves the &ldquo;Not set&rdquo; option as the selected item, the value of the field in the code editor will be a <strong>blank string</strong>.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>.</p>
<h3 id="allow-empty-strings">Allow empty strings</h3>
<p><strong>Description</strong>: The <strong>Allow empty strings</strong> checkbox lets you determine whether or not an empty text input field shows up as an empty string when accessing the field value in the <code>data</code> object.</p>
<p><strong>How it works</strong>: If the checkbox is checked, the text input field value in the code editor will be an empty string. If unchecked or if the configuration hasn&rsquo;t been added to the field, the value will be <code>undefined</code> for empty text fields.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a></p>
<h3 id="always-in-summary">Always in summary</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-always-in-summary.jpg" title="Always in summary">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-always-in-summary.jpg#ZgotmplZ" alt="Always in summary" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1854 962'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>Always in summary</strong> configuration determines whether the field name and current value will show up in the summary view of the item.</p>
<p><strong>How it works</strong>: When the checkbox is toggled, the user will see the name (if <a href="#display-name">Display name</a> is configured) and current value of the field in the summary view if the item. The summary is view what you see when the tag or variable is not in edit mode.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="clear-on-copy">Clear on copy</h3>
<p><strong>Description</strong>: With <strong>Clear on copy</strong>, you can toggle whether or not the field will retain or clear its value if a copy is made of the tag or variable.</p>
<p><strong>How it works</strong>: If <strong>Clear on copy</strong> is checked, then when the user makes a copy of an item created with this template, the field will have its value cleared (returned to its initial state) in the copy. If <strong>Clear on copy</strong> is unchecked or missing, the value of the field from the original item will be preserved in the copy.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="default-value">Default value</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-default-value.jpg" title="Default value">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-default-value.jpg#ZgotmplZ" alt="Default value" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1356 438'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>Default value</strong> option determines what the value of the field is before the user inputs anything into the field.</p>
<p><strong>How it works</strong>: <strong>Default value</strong> represents the <em>initial</em> value of the field. It is considered a true value, meaning if the user doesn&rsquo;t delete or change it, the default value will be what the field returns in the code editor.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="display-line-count">Display line count</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-line-count.jpg" title="Line count">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-line-count.jpg#ZgotmplZ" alt="Line count" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1750 764'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Set the height of the text input area, and whether or not a multi-line value can be given.</p>
<p><strong>How it works</strong>: If <strong>Display line count</strong> is set to <code>1</code>, then only one row of data can be input into the field. Anything larger than <code>1</code>, and the height of the text area grows as a result, and the user can type on multiple rows in the text input field.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="display-message-when-not-set">Display message when not set</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-display-message-not-set.jpg" title="Display message when not set">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-display-message-not-set.jpg#ZgotmplZ" alt="Display message when not set" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1844 958'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>Display message when not set</strong> allows you to show a &ldquo;default value&rdquo; for the field when in the summary view and the field doesn&rsquo;t have a value.</p>
<p><strong>How it works</strong>: The text will show up only in the summary view when the field is not set, i.e. has no determinable value. It will not impact what the code editor returns as the field value.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="display-name">Display name</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-display-name.jpg" title="Display name">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-display-name.jpg#ZgotmplZ" alt="Display name" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1804 484'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The <strong>Display name</strong> configuration lets you set a label for the field.</p>
<p><strong>How it works</strong>: The text you input in the <strong>Display name</strong> is shown as a label for the field when both in edit mode and the summary view.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>, <a href="#label">Label</a>.</p>
<h3 id="enabling-conditions">Enabling conditions</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-enabling-conditions.jpg" title="Enabling conditions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-enabling-conditions.jpg#ZgotmplZ" alt="Enabling conditions" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2674 544'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: You can establish a dependency with <strong>Enabling conditions</strong>. The field will only be visible in the UI if the enabling condition validates.</p>
<p><strong>How it works</strong>: An <em>Enabling condition</em> is essentially a check against <strong>some other field&rsquo;s value</strong>. You can use it to check whether some checkbox is unchecked, for example (as in the screenshot above).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>, <a href="#label">Label</a>.</p>
<h3 id="group-style">Group style</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-group-style.jpg" title="Group style">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-group-style.jpg#ZgotmplZ" alt="Group style" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2592 696'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Use the <strong>Group style</strong> configuration to determine how the <a href="#group">Group</a> field works.</p>
<p><strong>How it works</strong>: The options you can choose are:</p>
<ol>
<li>
<p>Simple section: the fields are simply grouped without UI impact. This is useful if you simply want to have the field configurations for the group impact the nested fields within.</p>
</li>
<li>
<p>Collapsible section &ndash; Open: The fields are in a section that can be collapsed, and the section defaults to being open.</p>
</li>
<li>
<p>Collapsible section &ndash; Closed: The fields are in a section that can be collapsed, and the section defaults to being closed.</p>
</li>
<li>
<p>Collapsible section &ndash; Open if not default: The fields are in a section that can be collapsed, and if the fields have not been edited, the section is closed.</p>
</li>
</ol>
<p><strong>Used in</strong>: <a href="#group">Group</a>.</p>
<h3 id="help-text">Help text</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-help-text.jpg" title="Help text">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-help-text.jpg#ZgotmplZ" alt="Help text" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 3112 434'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Use <strong>Help text</strong> to show a little tooltip when hovering over the question mark icon next to the field in the UI.</p>
<p><strong>How it works</strong>: The text you type into the <strong>Help text</strong> configuration field will appear in the UI when the user hovers the mouse cursor over the little question mark icon.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>.</p>
<h3 id="include-variables">Include variables</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-include-variables.jpg" title="Include variables">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-include-variables.jpg#ZgotmplZ" alt="Include variables" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1956 458'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: When checked, <strong>Include variables</strong> will make the full list of GTM variables available for selection as the field value.</p>
<p><strong>How it works</strong>: The drop-down menu will include all the GTM variables as selectable options if this field configuration is checked.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>.</p>
<h3 id="nested-fields">Nested fields</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-nested-fields.jpg" title="Nested fields">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-nested-fields.jpg#ZgotmplZ" alt="Nested fields" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2192 680'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: When you add <strong>Nested fields</strong> to a field, those fields become dependent on the enabling condition set for the parent field. Also, visually they will be placed closer to the parent field compared to if they were regular, non-nested fields.</p>
<p><strong>How it works</strong>: Toggle <strong>Nested fields</strong> on, and you can add any available field type as a nested field of the current field. After that, if the parent field is disabled due to an invalid <a href="#enabling-conditions">Enabling condition</a>, for example, the nested fields will be disabled, too.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>.</p>
<h3 id="text-as-list">Text as list</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-text-as-list.jpg" title="Text as list">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-text-as-list.jpg#ZgotmplZ" alt="Text as list" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2468 550'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Use this with <a href="#line-count">Line count</a> to access the field value as an array of strings (where each row corresponds to an item in the array).</p>
<p><strong>How it works</strong>: When <strong>Text as list</strong> is checked, then each row in a <a href="#text-input">Text input</a> field (when Line count is also configured) will be an item in the array of the resulting <code>data</code> object. Without <strong>Text as list</strong>, a multi-line input will result in a single string, where each row is separated with the newline character (<code>\n</code>).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="validation-rules">Validation rules</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/reference-validation-rules.jpg" title="Validation rules">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/reference-validation-rules.jpg#ZgotmplZ" alt="Validation rules" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2962 790'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Use the <strong>Validation rules</strong> configuration to establish validation criteria for the field.</p>
<p><strong>How it works</strong>: When you add a <strong>Validation rule</strong> to the field, the field must pass the validation, or the user won&rsquo;t be able to save the tag or variable. The available rules are:</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>How to fail validation</th>
</tr>
</thead>
<tbody>
<tr>
<td>&hellip;cannot be empty</td>
<td>User does not input anything into the field.</td>
</tr>
<tr>
<td>&hellip;must be a string of the required length</td>
<td>User inputs a string that is less than the minimum or more than the maximum length.</td>
</tr>
<tr>
<td>&hellip;must be a number</td>
<td>User inputs a value that is not an <strong>integer</strong> number.</td>
</tr>
<tr>
<td>&hellip;must be a positive number</td>
<td>User inputs an <strong>integer</strong> number that is equal to or less than 0.</td>
</tr>
<tr>
<td>&hellip;must be a positive number or 0</td>
<td>User inputs an <strong>integer</strong> number that is less than 0.</td>
</tr>
<tr>
<td>&hellip;must be an integer between 0 and 100 (inclusive)</td>
<td>User inputs an <strong>integer</strong> number that is less than 0 or more than 100.</td>
</tr>
<tr>
<td>&hellip;must be a number between 0 and 1 (inclusive)</td>
<td>User inputs a number (integer or floating point) which is less than 0.0 or more than 1.0.</td>
</tr>
<tr>
<td>&hellip;must match a regular expression</td>
<td>User inputs a value that does not match the given <strong>regular expression</strong>. The RegEx accepts <strong>full matches only</strong>, so don&rsquo;t forget to add leading and/or trailing <code>.*</code> if you want it to be an open-ended match.</td>
</tr>
<tr>
<td>&hellip;must be a valid GA tracking ID</td>
<td>User inputs a value that does not match the GA tracking ID format (UA-11111-1).</td>
</tr>
<tr>
<td>&hellip;must be a list of the required length</td>
<td>User inputs rows into a table fewer than the minimum length or more than the maximum length. Applies also to a Text input field where <a href="#text-as-list">Text as list</a> is being used.</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>NOTE!</strong> For fields that are governed by <a href="#enabling-conditions">enabling conditions</a>, the validation rule will only apply if the field has been enabled.</p>
</blockquote>
<p>You can click the <strong>action menu</strong> for the Validation rule configuration to <strong>Show advanced settings</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/02/validation-show-advanced-settings.jpg" title="Show advanced settings">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/02/validation-show-advanced-settings.jpg#ZgotmplZ" alt="Show advanced settings" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1796 358'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The advanced settings include:</p>
<ul>
<li>
<p><strong>Error messages</strong>: You can customize the error message that is shown if the field does not pass validation.</p>
</li>
<li>
<p><strong>Enabling conditions</strong>: You can add <a href="#enabling-conditions">enabling conditions</a> to the <strong>validation rule itself</strong>, meaning <strong>if the enabling conditions do not pass</strong>, the <strong>validation rule is ignored</strong>.</p>
</li>
</ul>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="value-hint">Value hint</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/reference-value-hint.jpg" title="Value hint">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/reference-value-hint.jpg#ZgotmplZ" alt="Value hint" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2316 718'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: The text you enter here will be shown as a <em>placeholder</em> value in the field before the user has added any input.</p>
<p><strong>How it works</strong>: The text will simply be a placeholder - it will not be the value of the field if saved without any input.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="value-unit">Value unit</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/03/reference-value-unit.jpg" title="Value unit">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/03/reference-value-unit.jpg#ZgotmplZ" alt="Value unit" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2328 666'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Description</strong>: Use this to guide the users on what type of value is expected in the field.</p>
<p><strong>How it works</strong>: The text will be displayed to the right of the field, giving users indication what type of value is expected in the field. The text can be anything (i.e. isn&rsquo;t restricted to e.g. JavaScript types).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>.</p>

                
                  <h2 id="policies-reference">Policies reference</h2>
<p><strong>Policies</strong> are directives the site admin adds to the page template (or, if necessarily, dynamically with JavaScript), which dictate the type of API permissions each custom template can use.</p>
<p>They differ from <a href="#permissions">Permissions</a> in one critical detail: where permissions are built into the template, and specify a broader set of API configurations the template can run with, policies are implemented by the site where these templates are run.</p>
<p>In other words, template permissions come from the vendor, template policies come from the site owner. Both have the capability to delimit or restrict the types of templates that can run on any given page.</p>
<p>To provide a policy, you need to use some <a href="https://developers.google.com/analytics/devguides/collection/gtagjs/"><code>gtag.js</code> code</a> (note, you do <strong>not</strong> have to install the <code>gtag.js</code> snippet!) where you specify the permission requests your site will listen to.</p>
<p>For example, if you have a template that is trying to send a pixel to an endpoint whitelisted in the template&rsquo;s permissions, you can use a policy to make sure that the template can actually only send the request to one specific endpoint. See the example below.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
<span style="color:#00a">function</span> gtag(){dataLayer.push(arguments);}

gtag(<span style="color:#a50">&#39;policy&#39;</span>, <span style="color:#a50">&#39;send_pixel&#39;</span>, <span style="color:#00a">function</span>(container, policy, data) {
  <span style="color:#aaa;font-style:italic">// Only restrict the policy to one specific container by returning true
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#aaa;font-style:italic">// for all other containers
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">if</span> (container !== <span style="color:#a50">&#39;GTM-ABCDE&#39;</span>) {
    <span style="color:#00a">return</span> <span style="color:#00a">true</span>;
  }

  <span style="color:#aaa;font-style:italic">// Check if the URL of the pixel request is a specific endpoint,
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#aaa;font-style:italic">// and if it isn&#39;t throw an error and prevent the tag from working.
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">if</span> (data.url !== <span style="color:#a50">&#39;https://snowplow.simoahava.com/i&#39;</span>) {
    <span style="color:#00a">throw</span>(<span style="color:#a50">&#39;Invalid pixel endpoint!&#39;</span>);
  } <span style="color:#00a">else</span> {
    <span style="color:#00a">return</span> <span style="color:#00a">true</span>;
  }
});
</code></pre></div>
<p>Note: The policy <strong>must</strong> return <code>true</code> explicitly if you want the check to pass. The policy will always default to returning <code>false</code> and preventing the template from working.</p>
<p>You can add more than one policy to the page, each in its own <code>gtag()</code> command, or you can check against ALL permissions requests by setting the policy name to <code>all</code> as below:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.dataLayer = <span style="color:#0aa">window</span>.dataLayer || [];
<span style="color:#00a">function</span> gtag(){dataLayer.push(arguments);}

gtag(<span style="color:#a50">&#39;policy&#39;</span>, <span style="color:#a50">&#39;all&#39;</span>, <span style="color:#00a">function</span>(container, policy, data) {
  <span style="color:#aaa;font-style:italic">// Prevent sending pixels and injecting iframes
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">if</span> (policy === <span style="color:#a50">&#39;send_pixel&#39;</span> || policy === <span style="color:#a50">&#39;inject_hidden_iframe&#39;</span>) {
    <span style="color:#00a">throw</span> <span style="color:#a50">&#39;Sending pixels and injecting hidden iframes blocked!&#39;</span>;
  } <span style="color:#00a">else</span> {
    <span style="color:#00a">return</span> <span style="color:#00a">true</span>;
  }
});
</code></pre></div>
<p>Please read the <a href="https://developers.google.com/tag-manager/templates/policies">official policy documentation</a> for more details on how policies work.</p>
<p>Below are listed all the policy names and what the <code>data</code> object comprises for each.</p>
<h3 id="access_globals">access_globals</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#aliasinwindow"><code>aliasInWindow</code></a> (once for the <code>toPath</code> key and once for the <code>fromPath</code> key).</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#callinwindow"><code>callInWindow</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#copyfromwindow"><code>copyFromWindow</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createargumentsqueue"><code>createArgumentsQueue</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createqueue"><code>createQueue</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#setinwindow"><code>setInWindow</code></a></p>
</li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;key&#34;</span>: <span style="color:#a50">&#34;some_global_var&#34;</span>, <span style="color:#aaa;font-style:italic">// name of the key the permission tries to access
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#a50">&#34;read&#34;</span>: <span style="color:#00a">true</span> || <span style="color:#00a">false</span>, <span style="color:#aaa;font-style:italic">// does the key have read access
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#a50">&#34;write&#34;</span>: <span style="color:#00a">true</span> || <span style="color:#00a">false</span>, <span style="color:#aaa;font-style:italic">// does the key have write access
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#a50">&#34;execute&#34;</span>: <span style="color:#00a">true</span> || <span style="color:#00a">false</span> <span style="color:#aaa;font-style:italic">// does the key have execute access
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="get_cookies">get_cookies</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#getcookievalues"><code>getCookieValues</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;name&#34;</span>: <span style="color:#a50">&#34;some_cookie_name&#34;</span> <span style="color:#aaa;font-style:italic">// name of the cookie being accessed
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="get_referrer">get_referrer</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#getreferrerurl"><code>getReferrer</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#getreferrerqueryparameters"><code>getReferrerQueryParameters</code></a></p>
</li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;component&#34;</span>: <span style="color:#a50">&#34;query&#34;</span> <span style="color:#aaa;font-style:italic">// the component of the referrer URL being accessed
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="get_url">get_url</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#geturl"><code>getUrl</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;component&#34;</span>: <span style="color:#a50">&#34;protocol&#34;</span> <span style="color:#aaa;font-style:italic">// the URL component name being accessed
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="inject_hidden_iframe">inject_hidden_iframe</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#injecthiddeniframe"><code>injectHiddenIframe</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;url&#34;</span>: <span style="color:#a50">&#34;https://some-iframe.com/&#34;</span> <span style="color:#aaa;font-style:italic">// the URL of the iframe being injected
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="inject_script">inject_script</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#injectscript"><code>injectScript</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;url&#34;</span>: <span style="color:#a50">&#34;https://some-script.com/script.js&#34;</span> <span style="color:#aaa;font-style:italic">// the URL of the script being loaded
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="logging">logging</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#logtoconsole"><code>logToConsole</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read_character_set">read_character_set</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#readcharacterset"><code>readCharacterSet</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read_data_layer">read_data_layer</h3>
<p><strong>Triggered by APIs</strong>:<br/></p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#copyfromdatalayer"><code>copyFromDataLayer</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;key&#34;</span>: <span style="color:#a50">&#34;some.variable.name&#34;</span> <span style="color:#aaa;font-style:italic">// name of the Data Layer Variable being accessed
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="read_event_metadata">read_event_metadata</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#addeventcallback"><code>addEventCallback</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read_title">read_title</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#readtitle"><code>readTitle</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="send_pixel">send_pixel</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#sendpixel"><code>sendPixel</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;url&#34;</span>: <span style="color:#a50">&#34;https://some-endpoint.com/endpoint&#34;</span> <span style="color:#aaa;font-style:italic">// the URL of the pixel request endpoint
</span><span style="color:#aaa;font-style:italic"></span>}
</code></pre></div>
<h3 id="set_cookies">set_cookies</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#sendpixel"><code>setCookie</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{
  <span style="color:#a50">&#34;name&#34;</span>: <span style="color:#a50">&#34;some_cookie_name&#34;</span>, <span style="color:#aaa;font-style:italic">// the name of the cookie
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#a50">&#34;options&#34;</span>: {
    <span style="color:#a50">&#34;domain&#34;</span>: <span style="color:#a50">&#34;somedomain.com&#34;</span>, <span style="color:#aaa;font-style:italic">// the domain of the cookie
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#a50">&#34;path&#34;</span>: <span style="color:#a50">&#34;/some-path/&#34;</span>, <span style="color:#aaa;font-style:italic">// the path of the cookie
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#a50">&#34;max-age&#34;</span>: <span style="color:#a50">&#34;15000&#34;</span>, <span style="color:#aaa;font-style:italic">// the maximum age of the cookie (in seconds)
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#a50">&#34;expires&#34;</span>: <span style="color:#a50">&#34;Sun, 11 Aug 2019 10:00:00 GMT&#34;</span>, <span style="color:#aaa;font-style:italic">// UTC date string of the cookie&#39;s expiration
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#a50">&#34;secure&#34;</span>: <span style="color:#00a">true</span> || <span style="color:#00a">false</span>, <span style="color:#aaa;font-style:italic">// Secure cookie
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#a50">&#34;sameSite&#34;</span>: <span style="color:#00a">true</span> || <span style="color:#00a">false</span> <span style="color:#aaa;font-style:italic">// sameSite cookie
</span><span style="color:#aaa;font-style:italic"></span>  }
}
</code></pre></div>

                
                  <h2 id="final-thoughts">Final thoughts</h2>
<p>It&rsquo;s difficult to compose any sort of summary to what I consider to be the most extensive and fundamental Google Tag Manager update since the programmatic API was released almost five years ago.</p>
<p>Custom templates are, for now, a completely <strong>optional</strong> feature. No one is forcing you to use them, and you can continue as a happy GTM user without having to bother about the new <strong>Templates</strong> menu.</p>
<p>However, I have a hunch that there is a huge incentive for the GTM team to get rid of the Custom HTML tag and the Custom JavaScript variable. When talking about governance and the existing prejudices towards GTM, especially from developers, it often boils down to being able to inject <strong>any</strong> arbitrary JavaScript code on the site, using the outdated and questionable <code>eval()</code> method, no less.</p>
<p>With custom templates, many of the problems around governance are presented with a solution:</p>
<ol>
<li>
<p>The template code is compiled into JavaScript when the container is created, so <code>eval()</code> is no longer used to run the code.</p>
</li>
<li>
<p>Template-specific permissions (created by the template author) can delimit what the template does <strong>and</strong> what types of user input are valid and accepted.</p>
</li>
<li>
<p>Page-specific policies (created by the site admin) can be used to further restrict what <strong>any</strong> template can do on the site.</p>
</li>
</ol>
<p>But these are mostly how templates address <strong>negative</strong> qualities of GTM - it would be foolish to ignore their net <strong>positive</strong> effect.</p>
<p>Google Tag Manager is a UI-driven tool. Brands can now use custom templates to encapsulate their complicated JavaScript activation mechanisms under a user interface, thus minimizing the possibility of human error, and demystifying how the vendor JavaScript runs. Thus, instead of sharing a JavaScript snippet the user has to copy-paste to a Custom HTML tag, the brand can share a template export that can be added to the container directly, with all the code in the correct place.</p>
<p>I can&rsquo;t wait to see what the community comes up with, too! I&rsquo;m waiting for a library of custom templates to emerge, hopefully sanctioned by Google but moderated by the community (with brands being able to add <strong>verified</strong> templates, too).</p>
<p>So now, brave traveller. You have reached the end, though I can only assume you skipped most of the above. What do you think about custom templates? Is my hyperbolic exuberance (yet again) unwarranted?</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom-templates/">custom templates</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/guide/">guide</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tag-templates/">tag templates</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/variable-templates/">variable templates</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fetch-latest-value-data-layer-variable/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Custom%20Templates%20Guide%20For%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fetch-latest-value-data-layer-variable/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Custom%20Templates%20Guide%20For%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Custom%20Templates%20Guide%20For%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

