

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "#GTMTips: Tag Sequencing With Custom HTML Tags | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2018/07/tag-sequencing-custom-html-tags.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/",
  "datePublished": "2018-07-22T10:14:32+03:00",
  "dateModified": "2018-07-22T10:14:32+03:00",
  "description": "This guide shows you how to set up tag sequencing with Custom HTML tags when using Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.53 with theme Tranquilpeak 0.4.3-BETA">
    <title>#GTMTips: Tag Sequencing With Custom HTML Tags | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    <script src="//de.cdn-v3.conductrics.com/ac-GeQBKxGTiA/v3/agent-api/js/f-TNZdDPOknZ/dt-8BnrVvfJuB1PwktQxXXgVK2OikZ9WR?apikey=api-WDrqMnckreSqejZgDAMu" type="text/javascript"></script>

    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/tag-sequencing-custom-html-tags/">
    
    <meta name="description" content="This guide shows you how to set up tag sequencing with Custom HTML tags when using Google Tag Manager.">
    <meta property="og:description" content="This guide shows you how to set up tag sequencing with Custom HTML tags when using Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="#GTMTips: Tag Sequencing With Custom HTML Tags">
    <meta property="og:url" content="/analytics/tag-sequencing-custom-html-tags/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="#GTMTips: Tag Sequencing With Custom HTML Tags">
    <meta name="twitter:description" content="This guide shows you how to set up tag sequencing with Custom HTML tags when using Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2018/07/tag-sequencing-custom-html-tags.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2018/07/tag-sequencing-custom-html-tags.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      #GTMTips: Tag Sequencing With Custom HTML Tags
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2018-07-22T10:14:32&#43;03:00">
        
  July 22, 2018

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/gtm-tips">GTM tips</a>
    
  


       | <a href="https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p><a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">Tag sequencing</a> was introdced to <a href="https://tagmanager.google.com/">Google Tag Manager</a> in late 2015. Its main purpose was to facilitate the <em>sequential</em> firing of tags that have dependencies with each other. Due to the <a href="https://www.pluralsight.com/guides/introduction-to-asynchronous-javascript">asynchronous</a> nature of third-party libraries like Google Tag Manager, it&rsquo;s difficult to establish an order of completion with tags that compete for their chance to fire.</p>

<p>Tag sequencing changed this, as it allows you to establish <strong>setup</strong> and <strong>cleanup</strong> tags - the former firing <em>before</em> the main tag, and the latter <em>after</em>.</p>

<p>Setting up tag sequencing is relatively easy, at least once you understand how it works. However, Custom HTML tags have some exceptional behavior, as you need to utilize certain specific commands to signal the sequence once the Custom HTML tag has completed its execution. This <a href="https://www.simoahava.com/tags/gtmtips/">#GTMTips</a> article aims to guide you with setting up Custom HTML tags in a tag sequence.</p>

<h2 id="tip-83-setting-up-custom-html-tags-in-a-tag-sequence">Tip 83: Setting up Custom HTML tags in a tag sequence</h2>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/07/tag-sequencing-custom-html-tags.jpg" title="Tag Sequencing With Custom HTML Tags">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/07/tag-sequencing-custom-html-tags.jpg#ZgotmplZ" alt="Tag Sequencing With Custom HTML Tags">
  
    </a>
  
  
</div>



<h3 id="lesson-1-sequence-is-managed-with-the-success-and-failure-callbacks">Lesson 1: Sequence is managed with the success and failure callbacks</h3>

<p>The two callbacks, <code>onHtmlSuccess()</code> and <code>onHtmlFailure()</code> are what tag sequencing with Custom HTML tags really pivots around. The first is used to denote a place in the code when the code has finished running <em>successfully</em>, and execution can move to the next tag in the sequence. The second is used to signal when a <em>failure</em> happens, and here execution is also passed to the next tag in the sequence <strong>unless</strong> it has the <strong>failure toggle</strong> on:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/07/failure-sequencing.jpg" title="Failure in Custom HTML tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/07/failure-sequencing.jpg#ZgotmplZ" alt="Failure in Custom HTML tag">
  
    </a>
  
  
</div>



<p>Just to recap (but be sure to read <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">my guide</a> for a more thorough treatment), here&rsquo;s how you would set up a regular Custom HTML tag in a tag sequence, where both <em>success</em> and <em>failure</em> criteria are established.</p>

<blockquote>
<p><strong>NOTE!</strong> Remember to enable the <strong>Container ID</strong> and <strong>HTML ID</strong> <a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/#utilities">built-in variables</a> for this.</p>
</blockquote>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gtm</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">google_tag_manager</span>[{{<span style="color:#a6e22e">Container</span> <span style="color:#a6e22e">ID</span>}}]; <span style="color:#75715e">// Required
</span><span style="color:#75715e"></span>	  
  window[<span style="color:#e6db74">&#39;something&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">getSomethingElse</span>();
  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> window[<span style="color:#e6db74">&#39;something&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
    <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlSuccess</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}}); <span style="color:#75715e">// Success, move to next tag
</span><span style="color:#75715e"></span>  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlFailure</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}}); <span style="color:#75715e">// Failure, move to next tag unless it has failure toggle on
</span><span style="color:#75715e"></span>  }
})();
</code></pre></div>

<h3 id="lesson-2-the-success-and-failure-callbacks-aren-t-always-necessary">Lesson 2: The success and failure callbacks aren&rsquo;t always necessary</h3>

<p>Here&rsquo;s something I think most guides have missed: you don&rsquo;t <em>need</em> <code>onHtmlSuccess()</code> and <code>onHtmlFailure()</code> in your Custom HTML tag! The web browser executes all the code it finds in a Custom HTML tag from top-to-bottom before moving to the next item in the sequence.</p>

<p>For example, if you&rsquo;ve setup the <a href="http://www.analytics-ninja.com/blog/2017/05/guide-facebook-pixel-google-tag-manager.html">Facebook pixel</a> with Custom HTML tags, you don&rsquo;t need <code>onHtmlSuccess()</code> in the base pixel tag.</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#f92672">!</span><span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">f</span>,<span style="color:#a6e22e">b</span>,<span style="color:#a6e22e">e</span>,<span style="color:#a6e22e">v</span>,<span style="color:#a6e22e">n</span>,<span style="color:#a6e22e">t</span>,<span style="color:#a6e22e">s</span>){<span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">fbq</span>)<span style="color:#66d9ef">return</span>;<span style="color:#a6e22e">n</span><span style="color:#f92672">=</span><span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">fbq</span><span style="color:#f92672">=</span><span style="color:#66d9ef">function</span>(){<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">callMethod</span><span style="color:#f92672">?</span>
<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">callMethod</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">n</span>,<span style="color:#a6e22e">arguments</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">queue</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">arguments</span>)};<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">_fbq</span>)<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">_fbq</span><span style="color:#f92672">=</span><span style="color:#a6e22e">n</span>;
<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">push</span><span style="color:#f92672">=</span><span style="color:#a6e22e">n</span>;<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">loaded</span><span style="color:#f92672">=!</span><span style="color:#ae81ff">0</span>;<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">version</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2.0&#39;</span>;<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">queue</span><span style="color:#f92672">=</span>[];<span style="color:#a6e22e">t</span><span style="color:#f92672">=</span><span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">e</span>);<span style="color:#a6e22e">t</span>.<span style="color:#66d9ef">async</span><span style="color:#f92672">=!</span><span style="color:#ae81ff">0</span>;
<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#a6e22e">v</span>;<span style="color:#a6e22e">s</span><span style="color:#f92672">=</span><span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#a6e22e">e</span>)[<span style="color:#ae81ff">0</span>];<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">parentNode</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">t</span>,<span style="color:#a6e22e">s</span>)}(window,
document,<span style="color:#e6db74">&#39;script&#39;</span>,<span style="color:#e6db74">&#39;https://connect.facebook.net/en_US/fbevents.js&#39;</span>);
 
<span style="color:#a6e22e">fbq</span>(<span style="color:#e6db74">&#39;init&#39;</span>, {{<span style="color:#a6e22e">Facebook</span> <span style="color:#a6e22e">Pixel</span> <span style="color:#a6e22e">ID</span>}});

<span style="color:#75715e">// The following line is NOT necessary:
</span><span style="color:#75715e">// window.google_tag_manager[{{Container ID}}].onHtmlSuccess({{HTML ID}}); 
</span><span style="color:#75715e"></span></code></pre></div>
Why is the last line not necessary? Because GTM would pass execution to the next tag <em>in any case</em> when it reaches the last line of this tag. The web browser runs code synchronously - there&rsquo;s no way it will stop in the middle of this tag and start working on the next tag.</p>

<p>So the lesson is:</p>

<p><strong>If you have code that is always run from top-to-bottom before moving to the next tag, you don&rsquo;t need <code>onHtmlSuccess()</code> and <code>onHtmlFailure()</code>.</strong></p>

<p>But, and there&rsquo;s always a &ldquo;but&rdquo;, you&rsquo;ll want to check the next lesson, too.</p>

<h3 id="lesson-3-if-you-have-onhtmlfailure-you-ll-always-want-to-have-onhtmlsuccess-too">Lesson 3: If you have <code>onHtmlFailure()</code>, you&rsquo;ll always want to have <code>onHtmlSuccess()</code>, too</h3>

<p>If you use <code>onHtmlFailure()</code> to signal that at some point in the code an error is met and sequence should <em>not</em> proceed with the next tag (since you have the failure toggle on), you should also add <code>onHtmlSuccess()</code> somewhere in the code.</p>

<p>This is because when you use the failure callback, GTM will not automatically proceed to the next tag anymore when it reaches the last line of the Custom HTML tag, even if you have the failure toggle turned off. By using <code>onHtmlFailure()</code>, you are telling Google Tag Manager to wait for either the <code>onHtmlFailure()</code> or <code>onHtmlSuccess()</code> before deciding whether to move to the next tag.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gtm</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">google_tag_manager</span>[{{<span style="color:#a6e22e">Container</span> <span style="color:#a6e22e">ID</span>}}];
  
  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">true</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Worked!&#39;</span>);
  } <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlFailure</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
  }
})();
</code></pre></div>

<p>In the above example, sequence will <strong>never</strong> proceed to the next tag. You have <code>onHtmlFailure()</code> which is <em>never</em> met (because <code>true</code> is always <code>true</code>), but you don&rsquo;t have <code>onHtmlSuccess()</code> anywhere. So only this first tag is run, and the sequence is never continued.</p>

<p>This is one way it <strong>would</strong> work:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">true</span>) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Worked&#39;</span>);
  <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlSuccess</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
} <span style="color:#66d9ef">else</span> {
  <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlFailure</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
}
</code></pre></div>

<p>This would also work (though it&rsquo;s not a good pattern), if the next tag in the sequence had the failure toggle off:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">true</span>) {
  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Worked&#39;</span>);
  <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlFailure</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
} <span style="color:#66d9ef">else</span> {
  <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlFailure</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
}
</code></pre></div>

<p>And since it&rsquo;s synchronous code, you can leave both callbacks out, and the sequence will proceed normally after logging <code>Worked</code> to the console in this case, too:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">true</span>) {
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Worked&#39;</span>);
  }
})();
</code></pre></div>

<h3 id="lesson-4-the-callbacks-are-at-their-best-in-asynchronous-operations">Lesson 4: The callbacks are at their best in asynchronous operations</h3>

<p>In my view, the <em>purpose</em> of tag sequencing is to establish order when the previous tag has an asynchronous operation. In other words, you want the browser to wait for the operation to complete before telling the next tag to start firing.</p>

<p>For example, here we load the <a href="https://jquery.com">jQuery</a> library asynchronously, waiting for it to have completely loaded before moving to the next tag:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gtm</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">google_tag_manager</span>[{{<span style="color:#a6e22e">Container</span> <span style="color:#a6e22e">ID</span>}}];
  
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;script&#39;</span>);
  <span style="color:#a6e22e">el</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
  <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js&#39;</span>;
  <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, <span style="color:#66d9ef">function</span>() {
    <span style="color:#a6e22e">gtm</span>.<span style="color:#a6e22e">onHtmlSuccess</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
  });
  document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">el</span>);
})();
</code></pre></div>

<p>As you can see, <code>onHtmlSuccess()</code> is embedded in the callback of the <a href="https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><code>load</code> listener</a>, which is invoked only after the library has downloaded and the browser has executed the code within.</p>

<h2 id="summary">Summary</h2>

<p>Working with Custom HTML tags in a tag sequence has some <em>gotchas</em> you should be aware of, but there&rsquo;s really very little game-breaking. The biggest &ldquo;mistake&rdquo; I see people doing is adding the <code>onHtmlSuccess()</code> callback to the end of a synchronously executed block of code - this is not necessary <em>unless you have <code>onHtmlFailure()</code> somewhere in the code, too</em>.</p>

<p>I hope that this article has clarified how Custom HTML tags and tag sequencing work together.</p>

<p>Let me know in the comments if you have futher questions!</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/gtmtips/">gtmtips</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tag-sequencing/">tag sequencing</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom-html/">custom html</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/get-position-index-of-visible-element/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fire-trigger-when-user-about-to-leave-page/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Tag%20Sequencing%20With%20Custom%20HTML%20Tags%20https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/get-position-index-of-visible-element/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/fire-trigger-when-user-about-to-leave-page/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Tag%20Sequencing%20With%20Custom%20HTML%20Tags%20https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Tag%20Sequencing%20With%20Custom%20HTML%20Tags%20https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/tag-sequencing-custom-html-tags/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

