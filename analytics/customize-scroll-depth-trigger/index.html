

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Customize The Scroll Depth Trigger In Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2018\/03\/scroll-depth-trigger-customizations.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/customize-scroll-depth-trigger\/",
  "datePublished": "2018-03-08T09:44:33\u002b02:00",
  "dateModified": "2018-03-08T09:44:33\u002b02:00",
  "description": "Some tips and tricks on how to customize the scroll depth trigger in Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Customize The Scroll Depth Trigger In Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/customize-scroll-depth-trigger/">
    
    <meta name="description" content="Some tips and tricks on how to customize the scroll depth trigger in Google Tag Manager.">
    <meta property="og:description" content="Some tips and tricks on how to customize the scroll depth trigger in Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Customize The Scroll Depth Trigger In Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Customize The Scroll Depth Trigger In Google Tag Manager">
    <meta name="twitter:description" content="Some tips and tricks on how to customize the scroll depth trigger in Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2018/03/scroll-depth-trigger-customizations.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2018/03/scroll-depth-trigger-customizations.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Customize The Scroll Depth Trigger In Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2018-03-08T09:44:33&#43;02:00">
        
  March 8, 2018

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/customize-scroll-depth-trigger/#commento">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p><em>Last updated 9 March 2018 with some new tips.</em></p>
<p>The <a href="https://www.simoahava.com/analytics/scroll-depth-trigger-google-tag-manager/">Scroll Depth trigger</a> in <a href="https://tagmanager.google.com/">Google Tag Manager</a> has a lot going for it. Tracking how far users scroll down a given page has <a href="http://cutroni.com/blog/2014/02/12/advanced-content-tracking-with-universal-analytics/">long since</a> been recognized as an important cog in the <em>engagement tracking</em> machine, and there have been <a href="http://scrolldepth.parsnip.io/">really</a> <a href="https://www.bounteous.com/labs/recipes/scroll-tracking/">great</a> solutions for implementing scroll depth tracking for web analytics over the years.</p>
<p>With Google Tag Manager&rsquo;s native Scroll Depth trigger, it&rsquo;s tempting to think we now have a be-all end-all solution that covers all the bases. However, as with everything else in analytics, the native scroll depth trigger does require customization to provide you with relevant information about your content and the visitors interacting with it.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/scroll-depth-trigger-customizations.jpg" title="Customizing the scroll depth trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/scroll-depth-trigger-customizations.jpg#ZgotmplZ" alt="Customizing the scroll depth trigger">
  
    </a>
  
  
</div>


<p>In this article, I&rsquo;ll explore some tricks that you might find useful when customizing the scroll depth trigger.</p>
<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
  <ul>
    <li><a href="#1-variable-percentages-depending-on-page">1. Variable percentages depending on page</a></li>
    <li><a href="#2-only-fire-the-scroll-depth-trigger-on-relevant-pages">2. Only fire the scroll depth trigger on relevant pages</a>
      <ul>
        <li><a href="#21-prevent-the-scroll-depth-trigger-from-activating">2.1. Prevent the Scroll Depth trigger from activating</a></li>
      </ul>
    </li>
    <li><a href="#3-only-fire-tags-on-pages-where-thresholds-are-not-auto-collected">3. Only fire tags on pages where thresholds are not auto-collected</a></li>
    <li><a href="#4-track-scroll-percentages-of-a-specific-content-element">4. Track scroll percentages of a specific content element</a>
      <ul>
        <li><a href="#41-return-the-scroll-depth-percentage-of-element-scrolling">4.1. Return the scroll depth percentage of element scrolling</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
<h2 id="1-variable-percentages-depending-on-page">1. Variable percentages depending on page</h2>
<p>The easiest customization you can make is to track different percentages depending on the page in question. For example, on article pages in my blog I might be interested in tracking in increments of 25% of vertical depth scrolled. But on list pages and summary pages I might only be interested in knowing who scrolls down to the bottom.</p>
<p>The <strong>Vertical Scroll Depths</strong> and <strong>Horizontal Scroll Depths</strong> fields require a number or a list of numbers (comma-separated) to work. Thus you can easily use a <strong>Custom JavaScript variable</strong> to return one list of numbers for a certain condition, and a different list of numbers for some other condition.</p>
<p>For example, here&rsquo;s a Custom JavaScript variable that does what I described in the first paragraph of this chapter.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> {{Page Path}}.indexOf(<span style="color:#a50">&#39;/analytics/&#39;</span>) &gt; -<span style="color:#099">1</span> ? <span style="color:#a50">&#39;25,50,75,100&#39;</span> : <span style="color:#a50">&#39;75,100&#39;</span>;
}
</code></pre></div>
<p>This variable returns the string <code>25,50,75,100</code> if the page URL contains <code>/analytics/</code>, and <code>75,100</code> otherwise. Thus, on blog pages, it will measure scroll depth in increments of 25 percent, but on other pages only scrolling up to 75% and 100% in depth.</p>
<p>Then you can just add this variable to the trigger like so:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/get-variables-per-page-type.jpg" title="Variables per page type">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/get-variables-per-page-type.jpg#ZgotmplZ" alt="Variables per page type">
  
    </a>
  
  
</div>


<p>You don&rsquo;t <em>have</em> to use a Custom JavaScript variable. I&rsquo;m quirky in that I prefer to use it, always. But you could just as well use a <a href="https://www.simoahava.com/analytics/the-regex-table-variable-in-google-tag-manager/">RegEx Table variable</a> to achieve the same thing:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/regex-table-scroll-depths.jpg" title="Regex table for scroll depths">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/regex-table-scroll-depths.jpg#ZgotmplZ" alt="Regex table for scroll depths">
  
    </a>
  
  
</div>


<p>This is a simple customization, but it does allow you to measure relevant metrics for pages where it makes sense.</p>
<h2 id="2-only-fire-the-scroll-depth-trigger-on-relevant-pages">2. Only fire the scroll depth trigger on relevant pages</h2>
<p>This should be a no-brainer, too. It might make sense to have the scroll depth trigger fire your tags only on pages where you are genuinely interested in scroll depth tracking. For example, I&rsquo;m actually only interested in knowing how far users scroll on my blog pages and nowhere else. Thus I could make this simple modification to the trigger to delimit its firing capabilities:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/fire-only-on-relevant-pages.jpg" title="Fire scroll depth trigger only on relevant pages">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/fire-only-on-relevant-pages.jpg#ZgotmplZ" alt="Fire scroll depth trigger only on relevant pages">
  
    </a>
  
  
</div>


<p>A very simple modification but helps you collect only meaningful data.</p>
<h3 id="21-prevent-the-scroll-depth-trigger-from-activating">2.1. Prevent the Scroll Depth trigger from activating</h3>
<p>As you can see, there&rsquo;s no <a href="https://www.simoahava.com/gtm-tips/enable-fire-triggers-google-tag-manager/">&ldquo;Enable when&hellip;&quot;</a> option on the Scroll Depth trigger, similar to what you might see with a Just Links trigger, for example. Thus you might be tempted to think that there&rsquo;s no way to prevent those pesky <code>gtm.scrollDepth</code> events from populating the <code>dataLayer</code> on pages where you are not interested in tracking scroll depths.</p>
<p>However, there&rsquo;s a very easy hack to make sure the trigger doesn&rsquo;t push anything to <code>dataLayer</code>. Just set the percentage threshold to <code>101</code>. It&rsquo;s impossible to scroll to 101% length of the page, so by setting the threshold to this you&rsquo;ll deactivate the trigger, effectively.</p>
<p>Thus you could modify #2 above by putting the following Custom JavaScript variable into the <strong>Percentages</strong> field of the trigger:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> {{Page Path}}.indexOf(<span style="color:#a50">&#39;/analytics/&#39;</span>) &gt; -<span style="color:#099">1</span> ? <span style="color:#a50">&#39;25,50,75,100&#39;</span> : <span style="color:#a50">&#39;101&#39;</span>;
}
</code></pre></div>
<p>This sets the thresholds to &lsquo;25,50,75,100&rsquo; on pages where the URL contains <strong>/analytics/</strong>, and &lsquo;101&rsquo; elsewhere.</p>
<h2 id="3-only-fire-tags-on-pages-where-thresholds-are-not-auto-collected">3. Only fire tags on pages where thresholds are not auto-collected</h2>
<p>One problem with the Scroll Depth trigger is that it doesn&rsquo;t care if the page is long or short. If you have a very short page, it&rsquo;s possible that all the thresholds are met when the page is loaded, which leads to a bunch of <code>gtm.scrollDepth</code> events pushed into <code>dataLayer</code>, firing your tags even though the user never scrolled!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/automatically-fire-trigger.jpg" title="automatically fire scroll depth on short pages">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/automatically-fire-trigger.jpg#ZgotmplZ" alt="automatically fire scroll depth on short pages">
  
    </a>
  
  
</div>


<p>Luckily there&rsquo;s a nifty trick we can use to fight this. We can prevent the Scroll Depth trigger from functioning on pages where the <strong>ratio between browser viewport height and page height is too high</strong>. The <strong>browser viewport</strong> is the area of the web browser that is filled by your page. The page itself is the entire document, parts of which are likely to be invisible below the fold of the viewport.</p>
<p>The higher the ratio between the height of the visible viewport and the height of the page, the less there is to scroll. For example, if the visible viewport is 400 pixels in height, and the page height is also 400 pixels, there is nothing to scroll. The entire page will be visible in the viewport, and any vertical thresholds you have defined in the Scroll Depth trigger will auto-fire.</p>
<p>So, if you want to only fire the trigger when the user actually scrolls to 25%, 50%, 75%, and 100%, you need to make sure the ratio between the visible viewport height and the page height is <em>less than 0.25</em>. This means that less than 25% of the page is visible in the browser viewport.</p>
<p>To do this, you need to create a <strong>Custom JavaScript variable</strong> that looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#aaa;font-style:italic">// Change this to reflect the percentages or pixels you want to fire the trigger for
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">var</span> verticalScrollDepths = <span style="color:#a50">&#39;25,50,75,100&#39;</span>;
  
  <span style="color:#aaa;font-style:italic">// Change this to the MAXIMUM ratio of viewport height / page height you want the trigger to activate for
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">var</span> maximumRatio = <span style="color:#099">0.25</span>;
  
  <span style="color:#aaa;font-style:italic">// Change this to what thresholds should be tracked if the ratio is more than the maximum
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#aaa;font-style:italic">// Leave it at &#39;101&#39; if you want to prevent the trigger from functioning in this case
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">var</span> fallbackDepths = <span style="color:#a50">&#39;101&#39;</span>;
  
  <span style="color:#00a">var</span> heightOfPage = <span style="color:#0aa">Math</span>.max(<span style="color:#0aa">document</span>.body.scrollHeight, <span style="color:#0aa">document</span>.body.offsetHeight, <span style="color:#0aa">document</span>.documentElement.clientHeight, <span style="color:#0aa">document</span>.documentElement.scrollHeight, <span style="color:#0aa">document</span>.documentElement.offsetHeight);
  
  <span style="color:#00a">var</span> heightOfViewport = <span style="color:#0aa">Math</span>.max(<span style="color:#0aa">document</span>.documentElement.clientHeight, <span style="color:#0aa">window</span>.innerHeight);
  
  <span style="color:#00a">var</span> ratio = heightOfViewport / heightOfPage;
  
  <span style="color:#00a">return</span> ratio &lt; maximumRatio ? verticalScrollDepths : fallbackDepths;
}
</code></pre></div>
<p>First thing you&rsquo;ll need to do is edit the <code>verticalScrollDepths</code> variable to reflect the list of thresholds you want to track if the page passes the ratio check.</p>
<p>Then, edit the <code>maximumRatio</code> to reflect the maximum ratio (between 0 and 1) of the height of the visible viewport vs. height of the actual page. A value of <code>0.25</code> would mean that at most 25% of the page can be visible in the viewport when the page is loaded.</p>
<p>Finally, edit the <code>fallbackDepths</code> variable to give a &ldquo;default&rdquo; value for the cases when the maximum ratio is surpassed. If you want to prevent the Scroll Depth trigger from working at all when the maximum ratio is surpassed, use the value <code>101</code>, because a depth of 101% can never be tracked.</p>
<p>Then just add this to the &ldquo;Vertical Scroll Depths&rdquo; field and you should be all set.</p>
<p>Now the trigger will only fire in cases where the page is long enough to make sense for your tracking.</p>
<h2 id="4-track-scroll-percentages-of-a-specific-content-element">4. Track scroll percentages of a specific content element</h2>
<p>This is a bit trickier, but still doable with some JavaScript magic.</p>
<p>By default, the Scroll Depth trigger calculates vertical scrolling depth from the top of the page to the bottom of the page. But you might only be interested in knowing the scroll depths of a specific content element, such as the article body. For example, on my site, I don&rsquo;t really care if users scroll past the article end, through the Disqus comments, all the way to the bottom. But I do care if they scroll to the bottom of the main article body.</p>
<p>The way to make this work is to first calculate the height of the HTML element that contains the content whose scroll depths you want to track. Then, you need to check how far from the top of the page this element is. Finally, you need to tell the Scroll Depth trigger to track pixel thresholds that correspond with the desired depths of the content element, and add the distance to the top of the page to those numbers.</p>
<p>I think it&rsquo;s easier to illustrate.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/dynamic-scroll-thresholds.jpg" title="dynamically resolved scroll thresholds">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/dynamic-scroll-thresholds.jpg#ZgotmplZ" alt="dynamically resolved scroll thresholds">
  
    </a>
  
  
</div>


<p>As you can see, the total height of the element is <strong>1200 pixels</strong>. If I want to track scroll depth increments of 33%, it means that the respective marks are at 400, 800, and 1200 pixels. Since the top of the content element is exactly <strong>250 pixels</strong> from the top of the page, I need to add this number to the thresholds before I feed it into the Scroll Depth trigger, because it measures everything counting from the top of the page. Thus the final pixel depths would be <strong>650</strong>, <strong>1050</strong>, and <strong>1450</strong> pixels.</p>
<p>Now, since we don&rsquo;t want to hard-code these into the trigger, as that would lead to a horrible mess to manage (every single page would need its own trigger), we can use a <strong>Custom JavaScript variable</strong> to dynamically calculate the pixel depths.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#aaa;font-style:italic">// Change the contents of this array to reflect the percentages of scroll depth you want to track
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">var</span> verticalPercentages = [<span style="color:#099">25</span>,<span style="color:#099">50</span>,<span style="color:#099">75</span>,<span style="color:#099">100</span>];
  
  <span style="color:#aaa;font-style:italic">// Change this to fetch the element you want to track scrolling in
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">var</span> targetElement = <span style="color:#0aa">document</span>.querySelector(<span style="color:#a50">&#39;div.post-content .main-content-wrap&#39;</span>);
  
  <span style="color:#00a">var</span> elementHeight = targetElement.offsetHeight;
  
  <span style="color:#00a">var</span> totalOffsetTop = <span style="color:#099">0</span>;
  
  <span style="color:#00a">while</span> (targetElement) {
    totalOffsetTop += (targetElement.offsetTop - targetElement.scrollTop + targetElement.clientTop);
    targetElement = targetElement.offsetParent;
  }
  
  <span style="color:#00a">return</span> verticalPercentages.map(<span style="color:#00a">function</span>(percentage) {
    <span style="color:#00a">return</span> <span style="color:#0aa">parseInt</span>(elementHeight * (percentage * <span style="color:#099">0.01</span>) + totalOffsetTop);
  }).join();
}
</code></pre></div>
<p>You&rsquo;d then need to add this variable reference to the <strong>Pixel</strong> field in the Vertical Scroll Depths selection of the trigger:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2018/03/vertical-scroll-increments.jpg" title="Dynamically computed vertical scroll increments">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2018/03/vertical-scroll-increments.jpg#ZgotmplZ" alt="Dynamically computed vertical scroll increments">
  
    </a>
  
  
</div>


<p>This setup calculates dynamically the correct pixel thresholds based on the percentages you wrote in the <code>verticalPercentages</code> array. This way, 0 percent depth is the top of the content element (specified in <code>targetElement</code>), and 100 percent depth is the bottom of the content element.</p>
<p>With this workaround, you can get more meaningful measurements on pages which have lots of different content areas filling up the real estate of the document itself.</p>
<h3 id="41-return-the-scroll-depth-percentage-of-element-scrolling">4.1. Return the scroll depth percentage of element scrolling</h3>
<p>One thing missing from #4 is the option to report on the <em>percentages</em> the user scrolled down the element. Because the trigger is setup using pixel depths rather than percentages, the {{Scroll Depth Threshold}} built-in variable will always return the pixel depth the user scrolled past, rather than the respective percentage of scrolling.</p>
<p>Getting the percentage is actually a bit of a hack. The problem with the Scroll Depth trigger is that it&rsquo;s initialized fairly early in the page load, often before DOM Ready and any dynamically injected content is added to the page. This means that the thresholds of scrolling might be smaller than what the percentages <em>actually</em> would reflect.</p>
<p>This is, unfortunately, unavoidable right now. The Scroll Depth trigger has no options to delay its initialization until such a time as the content is completely loaded.</p>
<p>What this also means is that any variables you use to determine the height of the content and, subsequently, what the respective percentages actually reflect, can change from one trigger event to the next. Thus, in order to get the <em>actual</em> percentages used by the Scroll Depth trigger, we&rsquo;ll need to do something that I&rsquo;ve <a href="https://www.simoahava.com/analytics/100-google-tag-manager-learnings/#76-should-avoid-side-effects">repeatedly</a> instructed to avoid at all costs: implement a side effect in the Custom JavaScript variable.</p>
<p>Basically, we&rsquo;ll need to store the scroll thresholds in a <strong>global</strong> variable when the Custom JavaScript variable is first run. After the initial run, we&rsquo;ll always pull whatever was stored in the global variable instead of generating a new set each time the variable is invoked. This way, any triggers and tags that use the thresholds will always access the same values, even if they might be off a bit from what the content thresholds <em>actually</em> are.</p>
<p>The modification looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  
  <span style="color:#00a">if</span> (<span style="color:#00a">typeof</span> <span style="color:#0aa">window</span>._gtm_scroll_set === <span style="color:#a50">&#39;undefined&#39;</span>) {
    
    <span style="color:#aaa;font-style:italic">// Change the contents of this array to reflect the percentages of scroll depth you want to track
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> verticalPercentages = [<span style="color:#099">25</span>,<span style="color:#099">50</span>,<span style="color:#099">75</span>,<span style="color:#099">100</span>];
  
    <span style="color:#aaa;font-style:italic">// Change this to fetch the element you want to track scrolling in
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> targetElement = <span style="color:#0aa">document</span>.querySelector(<span style="color:#a50">&#39;div.post-content .main-content-wrap&#39;</span>);
  
    <span style="color:#00a">var</span> elementHeight = targetElement.offsetHeight;
  
    <span style="color:#00a">var</span> totalOffsetTop = <span style="color:#099">0</span>;
  
    <span style="color:#00a">while</span> (targetElement) {
      totalOffsetTop += (targetElement.offsetTop - targetElement.scrollTop + targetElement.clientTop);
      targetElement = targetElement.offsetParent;
    }
    
    <span style="color:#0aa">window</span>._gtm_scroll_set = {
      thresholds: verticalPercentages.map(<span style="color:#00a">function</span>(percentage) {
          <span style="color:#00a">return</span> <span style="color:#0aa">parseInt</span>(elementHeight * (percentage * <span style="color:#099">0.01</span>) + totalOffsetTop);
        }).join(),
      percentages: verticalPercentages
    };
    
  }
  
  <span style="color:#00a">return</span> <span style="color:#0aa">window</span>._gtm_scroll_set.thresholds;
}
</code></pre></div>
<p>As you can see, we populate a global variable <code>window._gtm_scroll_set</code> with an object that contains two properties:</p>
<ul>
<li>
<p><code>thresholds</code>: the array of scroll thresholds used by the Scroll Depth trigger.</p>
</li>
<li>
<p><code>percentages</code>: the array of vertical percentages you defined in the same variable.</p>
</li>
</ul>
<p>Now that we know what the thresholds are, what the percentages are, and we can trust that the same thresholds are returned whenever this Custom JavaScript variable is invoked, we can create <strong>another</strong> Custom JavaScript variable whose only job is to return which percentage the user scrolled past when the trigger fired. This is what that variable looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">if</span> (<span style="color:#00a">typeof</span> <span style="color:#0aa">window</span>._gtm_scroll_set !== <span style="color:#a50">&#39;undefined&#39;</span>) {
    
    <span style="color:#00a">var</span> percentages = <span style="color:#0aa">window</span>._gtm_scroll_set.percentages;
  
    <span style="color:#00a">var</span> thresholds = <span style="color:#0aa">window</span>._gtm_scroll_set.thresholds.split(<span style="color:#a50">&#39;,&#39;</span>).map(<span style="color:#00a">function</span>(t) {
      <span style="color:#00a">return</span> <span style="color:#0aa">parseInt</span>(t);
    });
    
    <span style="color:#00a">var</span> crossedIndex = thresholds.indexOf({{Scroll Depth Threshold}});

    <span style="color:#00a">return</span> percentages[crossedIndex];
  
  }
  <span style="color:#00a">return</span> {{Scroll Depth Threshold}};
}
</code></pre></div>
<p>This Custom JavaScript variable checks which threshold was returned by {{Scroll Depth Threshold}}, and returns the respective percentage value.</p>
<p>The order of things is thus:</p>
<ol>
<li>
<p>Use the first Custom JavaScript variable in the Scroll Depth trigger&rsquo;s Pixel Depths field.</p>
</li>
<li>
<p>Use the second Custom JavaScript variable wherever you want to get the percentage value for the scroll depth reached when the trigger fires.</p>
</li>
</ol>
<p>Note that even though I am introducing a side effect in the Custom JavaScript variable, it is mitigated by checking if the global variable has already been set. Thus the typical downside of side effects (constantly and unpredictably updating global state) is mitigated.</p>
<p>It&rsquo;s not perfect - nothing that impacts global state ever is. There&rsquo;s always the risk that some other JavaScript accesses and modifies <code>window._gtm_scroll_set</code>, which would break your setup.</p>
<h2 id="summary">Summary</h2>
<p>These four tips ranged from the really simple to the moderately complex.</p>
<p>There are many ways in which you can customize Google Tag Manager&rsquo;s default trigger. With the scroll depth trigger, these customizations are almost necessary, because the trigger itself is lacking in some critical configurations options for now.</p>
<p>For example, I would like to see the following features in the trigger:</p>
<ul>
<li>
<p>Option to establish <strong>when</strong> the trigger is initialized (e.g. after DOM Ready, with a Data Layer event, etc.).</p>
</li>
<li>
<p>Option to prevent the trigger from auto-firing if the thresholds have been crossed when the page loads.</p>
</li>
<li>
<p>Option to reset the trigger manually, which is useful especially on single-page apps.</p>
</li>
<li>
<p>Option to define a content element instead of the entire page for determining scroll depth.</p>
</li>
</ul>
<p>With the tips in this article, you can do plenty, but especially the feature where you could reset the trigger is sorely missing from the current implementation.</p>
<p>Do you have tips you want to share for Google Tag Manager&rsquo;s Scroll Depth trigger?</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/scroll-depth/">scroll depth</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/triggers/">triggers</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">javascript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/check-container-id-with-eventcallback/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/add-html-elements-page-programmatically/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Customize%20The%20Scroll%20Depth%20Trigger%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/customize-scroll-depth-trigger/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/check-container-id-with-eventcallback/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/add-html-elements-page-programmatically/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Customize%20The%20Scroll%20Depth%20Trigger%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/customize-scroll-depth-trigger/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Customize%20The%20Scroll%20Depth%20Trigger%20In%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/customize-scroll-depth-trigger/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/customize-scroll-depth-trigger/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

