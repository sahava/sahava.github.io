

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "#GTMTips: Create Facebook Pixel Custom Tag Template | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2019\/05\/create-facebook-pixel-template.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/create-facebook-pixel-custom-tag-template\/",
  "datePublished": "2019-05-23T18:05:00\x2b03:00",
  "dateModified": "2019-05-23T18:05:00\x2b03:00",
  "description": "How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>#GTMTips: Create Facebook Pixel Custom Tag Template | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/create-facebook-pixel-custom-tag-template/">
    
    <meta name="description" content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.">
    <meta property="og:description" content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="#GTMTips: Create Facebook Pixel Custom Tag Template">
    <meta property="og:url" content="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="#GTMTips: Create Facebook Pixel Custom Tag Template">
    <meta name="twitter:description" content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      #GTMTips: Create Facebook Pixel Custom Tag Template
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2019-05-23T18:05:00&#43;03:00">
        
  May 23, 2019

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/gtm-tips">GTM Tips</a>
    
  


       | <a href="https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/#commento">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>After the recent release of <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">Custom Templates</a> for <a href="https://tagmanager.google.com/">Google Tag Manager</a>, my mind has been occupied by very little else. However, I have a nagging feeling that due to how involved the feature set is, there's still a lot of demystifying that needs to take place before templates are fully embraced by the GTM user base.</p>
<p>In this article, I want to show you a concrete example of template creation. It's going to be much more ambitious than the simple <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#tag-template-walkthrough">walkthrough</a> I explored in the <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">main guide</a>. This time, we'll step through creating an actual, functional template that caters to a very specific use case: the <a href="https://developers.facebook.com/docs/facebook-pixel/implementation/">Facebook Pixel</a>.</p>
<blockquote>
<p>This article is <strong>not</strong> endorsed by Facebook or supported by them in any capacity, official or unofficial.</p>
</blockquote>
<p>We'll stop short of having a perfect representation of the Facebook pixel. However, you'll have all the tools necessary to extend the template to cover all the features you might need and to replicate it with some other third-party vendor code.</p>
<p>To sweeten the deal, I've also created <a href="https://youtu.be/5ESEtwq7fxc">a video</a> that goes through the motions, in case it's easier to follow the steps that way.</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/5ESEtwq7fxc?enablejsapi=1" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>I want to give special thanks <strong>Eric Burley</strong> from Google for walking me through some of the intricacies of template APIs.</p>
<blockquote>
<p>OK, OK, I <strong>have</strong> actually created the full, feature-ready Facebook Pixel Template for you to enjoy. You can find it in <a href="https://github.com/sahava/GoogleTagManagerTemplates">this GitHub repository</a>.</p>
</blockquote>
<h2 id="tip-99-create-a-facebook-pixel-template">Tip 99: Create a Facebook Pixel template</h2>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg" title="Create Facebook Pixel template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg#ZgotmplZ" alt="Create Facebook Pixel template">
  
    </a>
  
  
</div>


<p><strong>You can download the template export file <a href="https://gist.github.com/sahava/212fdbb6cd4d250fa97eeaa8ba693913">here</a></strong>. Read <a href="https://gist.github.com/sahava/212fdbb6cd4d250fa97eeaa8ba693913">this</a> to find out how to import it into your custom templates. You don't <strong>have</strong> to use the export file, but it might make it easier to walk through the rest of the article.</p>
<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
  <ul>
    <li><a href="#tip-99-create-a-facebook-pixel-template">Tip 99: Create a Facebook Pixel template</a>
      <ul>
        <li><a href="#what-youll-end-up-with">What you'll end up with</a></li>
        <li><a href="#step-1-add-template-information">Step 1: Add template information</a></li>
        <li><a href="#step-2-add-fields">Step 2: Add fields</a>
          <ul>
            <li><a href="#field-1-text-input-named-pixelid">Field 1: Text Input named pixelId</a></li>
            <li><a href="#field-2-drop-down-menu-named-eventname">Field 2: Drop-down Menu named eventName</a></li>
            <li><a href="#field-3-group-named-objectproperties">Field 3: Group named objectProperties</a></li>
            <li><a href="#field-4-group-named-moresettings">Field 4: Group named moreSettings</a></li>
          </ul>
        </li>
        <li><a href="#step-3-edit-code">Step 3: Edit code</a>
          <ul>
            <li><a href="#initialize-the-necessary-apis">Initialize the necessary APIs</a></li>
            <li><a href="#fetch-list-of-initialized-ids">Fetch list of initialized IDs</a></li>
            <li><a href="#utility-to-fetch-the-proper-global-fbq-method">Utility to fetch the proper global fbq method</a></li>
            <li><a href="#prepare-the-fbq-command">Prepare the fbq command</a></li>
            <li><a href="#cycle-through-all-pixel-ids-defined-in-tag-and-dispatch-the-commands">Cycle through all Pixel IDs defined in tag, and dispatch the commands</a></li>
            <li><a href="#load-the-facebook-sdk">Load the Facebook SDK</a></li>
          </ul>
        </li>
        <li><a href="#step-4-permissions">Step 4: Permissions</a></li>
        <li><a href="#test-it">Test it!</a></li>
      </ul>
    </li>
    <li><a href="#final-thoughts">Final thoughts</a></li>
  </ul>
</nav>
<h3 id="what-youll-end-up-with">What you'll end up with</h3>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/facebook-pixel-template.jpg" title="Facebook pixel template">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/facebook-pixel-template.jpg#ZgotmplZ" alt="Facebook pixel template">
  
    </a>
  
  
</div>


<p>The template has the following features:</p>
<ol>
<li>
<p>Ability to add multiple Pixel IDs, comma-separated. The tag hit will be sent to all the Pixel IDs you specify in the list.</p>
</li>
<li>
<p>Support for four events: <strong>PageView</strong>, <strong>Lead</strong>, <strong>CompleteRegistration</strong>, and <strong>Custom</strong> (the Custom event will let you specify the event name in a text field that appears).</p>
</li>
<li>
<p>Possibility to add any Object Properties to the hit.</p>
</li>
<li>
<p>You can check a box to disable the <a href="https://developers.facebook.com/docs/facebook-pixel/advanced#automatic-configuration">Automatic Configuration</a> of the pixel.</p>
</li>
</ol>
<h3 id="step-1-add-template-information">Step 1: Add template information</h3>
<p>After creating a new template, this is what the <strong>Info</strong> screen looks like. Remember to enable <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#advanced-settings"><strong>Advanced Settings</strong></a> for the editor so that you can edit the <strong>Brand Name</strong> field.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/facebook-info.jpg" title="Facebook info screen">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/facebook-info.jpg#ZgotmplZ" alt="Facebook info screen">
  
    </a>
  
  
</div>


<h3 id="step-2-add-fields">Step 2: Add fields</h3>
<p>The template will have <strong>four</strong> fields.</p>
<h4 id="field-1-text-input-named-pixelid">Field 1: Text Input named <code>pixelId</code></h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/pixelid-field.jpg" title="Pixel ID field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/pixelid-field.jpg#ZgotmplZ" alt="Pixel ID field">
  
    </a>
  
  
</div>


<p>Make sure the following <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration">field configurations</a> are enabled for the <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#text-input"><strong>Text Input</strong></a> field:</p>
<ol>
<li>
<p><strong>Always in summary</strong>: Checked</p>
</li>
<li>
<p><strong>Display name</strong>: <code>Facebook Pixel ID(s)</code></p>
</li>
<li>
<p><strong>Validation rules</strong>: (see below)</p>
</li>
<li>
<p><strong>Value hint</strong>: <code>e.g. 12345678910</code></p>
</li>
</ol>
<p>For the <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#validation-rules">validation rules</a>, add two different rules:</p>
<ol>
<li>
<p><strong>This value cannot be empty</strong>, with Error message <code>You must provide a Pixel ID</code>.</p>
</li>
<li>
<p><strong>This value must match a regular expression</strong>, with value <code>^[0-9,]+$</code>, and Error message <code>Invalid Pixel ID format</code>.</p>
</li>
</ol>
<p>You can find the Error message by clicking to show <strong>Advanced Settings</strong> for each Validation rule.</p>
<h4 id="field-2-drop-down-menu-named-eventname">Field 2: Drop-down Menu named <code>eventName</code></h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/eventname-field.jpg" title="Eventname field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/eventname-field.jpg#ZgotmplZ" alt="Eventname field">
  
    </a>
  
  
</div>


<p>Make sure the following <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration">field configurations</a> are enabled for the <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#drop-down-menu"><strong>Text Input</strong></a> field:</p>
<ol>
<li>
<p><strong>Always in summary</strong>: Checked</p>
</li>
<li>
<p><strong>Display name</strong>: <code>Event Name</code></p>
</li>
<li>
<p><strong>Nested fields</strong>: (see below)</p>
</li>
</ol>
<p>Add the following menu items:</p>
<ol>
<li>
<p>Item name: <strong>PageView</strong>, Value: <strong>PageView</strong></p>
</li>
<li>
<p>Item name: <strong>Lead</strong>, Value: <strong>Lead</strong></p>
</li>
<li>
<p>Item name: <strong>CompleteRegistration</strong>, Value: <strong>CompleteRegistration</strong></p>
</li>
<li>
<p>Item name: <strong>Custom</strong>, Value: <strong>Custom</strong></p>
</li>
</ol>
<p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <strong>Text Input</strong> field. Name the field <code>customEventName</code>, and choose the <strong>Display name</strong> and <strong>Enabling conditions</strong> field configurations for it.</p>
<ol>
<li>
<p><strong>Display name</strong>: Custom Event Name</p>
</li>
<li>
<p><strong>Enabling conditions</strong>: <code>eventName</code> equals <code>Custom</code></p>
</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/enabling-conditions.jpg" title="enabling conditions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/enabling-conditions.jpg#ZgotmplZ" alt="enabling conditions">
  
    </a>
  
  
</div>


<p>The enabling condition ensures the Custom Event Name is only shown in case &ldquo;Custom&rdquo; is chosen from the drop-down menu. Cool, huh?</p>
<h4 id="field-3-group-named-objectproperties">Field 3: Group named <code>objectProperties</code></h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/group-field.jpg" title="Group field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/group-field.jpg#ZgotmplZ" alt="Group field">
  
    </a>
  
  
</div>


<p>The default field configurations should be all you need for this Group field.</p>
<ol>
<li>
<p><strong>Group style</strong>: Collapsible section - Collapsed</p>
</li>
<li>
<p><strong>Display name</strong>: Object Properties</p>
</li>
<li>
<p><strong>Nested fields</strong>: (see below)</p>
</li>
</ol>
<p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#simple-table"><strong>Simple Table</strong></a> field. Name the field <code>propertyList</code> and make sure the <strong>&ldquo;New row&rdquo; button text</strong> field configuration is toggled on.</p>
<p>Add <strong>two</strong> columns to the table. Both should be <strong>Text field</strong> columns.</p>
<p>The first column should have the following settings:</p>
<ol>
<li>
<p><strong>Column name</strong>: <code>Property Name</code></p>
</li>
<li>
<p><strong>Internal name</strong>: <code>name</code></p>
</li>
<li>
<p><strong>Require column values to be unique</strong>: Checked (this option becomes available when you choose to show <strong>Advanced Settings</strong> for this column)</p>
</li>
</ol>
<p>The second column should have the following settings:</p>
<ol>
<li>
<p><strong>Column name</strong>: <code>Property Value</code></p>
</li>
<li>
<p><strong>Internal name</strong>: <code>value</code></p>
</li>
</ol>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/propertylist-field.jpg" title="Property List field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/propertylist-field.jpg#ZgotmplZ" alt="Property List field">
  
    </a>
  
  
</div>


<p>Finally, set the <strong>&ldquo;New row&rdquo; button text</strong> option to <code>Add property</code>, and leave the <strong>Display name</strong> setting blank.</p>
<h4 id="field-4-group-named-moresettings">Field 4: Group named <code>moreSettings</code></h4>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/moresettings-field.jpg" title="More settings field">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/moresettings-field.jpg#ZgotmplZ" alt="More settings field">
  
    </a>
  
  
</div>


<p>Set the following settings for the group:</p>
<ol>
<li>
<p><strong>Group style</strong>: Collapsible section - Collapsed</p>
</li>
<li>
<p><strong>Display name</strong>: <code>More Settings</code></p>
</li>
<li>
<p><strong>Nested fields</strong>: (see below)</p>
</li>
</ol>
<p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#checkbox"><strong>Checkbox</strong></a> field. Name the field <code>disableAutoConfig</code> and make sure the <strong>Help text</strong> field configuration is toggled on.</p>
<ol>
<li>
<p><strong>Checkbox text</strong>: <code>Disable Automatic Configuration</code></p>
</li>
<li>
<p><strong>Help text</strong>: Facebook collects some metadata (e.g. structured data) and user interactions (e.g. clicks) automatically. Check this box to disable this automatic configuration of the pixel.</p>
</li>
</ol>
<h3 id="step-3-edit-code">Step 3: Edit code</h3>
<p>Step on over to the <strong>Code editor</strong> tab, and replace the contents with the following JavaScript:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> createQueue = require(<span style="color:#a50">&#39;createQueue&#39;</span>);
<span style="color:#00a">const</span> callInWindow = require(<span style="color:#a50">&#39;callInWindow&#39;</span>);
<span style="color:#00a">const</span> aliasInWindow = require(<span style="color:#a50">&#39;aliasInWindow&#39;</span>);
<span style="color:#00a">const</span> copyFromWindow = require(<span style="color:#a50">&#39;copyFromWindow&#39;</span>);
<span style="color:#00a">const</span> setInWindow = require(<span style="color:#a50">&#39;setInWindow&#39;</span>);
<span style="color:#00a">const</span> injectScript = require(<span style="color:#a50">&#39;injectScript&#39;</span>);
<span style="color:#00a">const</span> makeTableMap = require(<span style="color:#a50">&#39;makeTableMap&#39;</span>);

<span style="color:#00a">const</span> initIds = copyFromWindow(<span style="color:#a50">&#39;_fbq_gtm_ids&#39;</span>) || [];
<span style="color:#00a">const</span> pixelIds = data.pixelId;

<span style="color:#aaa;font-style:italic">// Utility function to use either fbq.queue[]
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// (if the FB SDK hasn&#39;t loaded yet), or fbq.callMethod()
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// if the SDK has loaded.
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> getFbq = () =&gt; {
  <span style="color:#aaa;font-style:italic">// Return the existing &#39;fbq&#39; global method if available
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">const</span> fbq = copyFromWindow(<span style="color:#a50">&#39;fbq&#39;</span>);
  <span style="color:#00a">if</span> (fbq) {
    <span style="color:#00a">return</span> fbq;
  }
  
  <span style="color:#aaa;font-style:italic">// Initialize the &#39;fbq&#39; global method to either use
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#aaa;font-style:italic">// fbq.callMethod or fbq.queue)
</span><span style="color:#aaa;font-style:italic"></span>  setInWindow(<span style="color:#a50">&#39;fbq&#39;</span>, <span style="color:#00a">function</span>() {    
    <span style="color:#00a">const</span> callMethod = copyFromWindow(<span style="color:#a50">&#39;fbq.callMethod.apply&#39;</span>);
    <span style="color:#00a">if</span> (callMethod) {           
      callInWindow(<span style="color:#a50">&#39;fbq.callMethod.apply&#39;</span>, <span style="color:#00a">null</span>, arguments); 
    } <span style="color:#00a">else</span> {       
      callInWindow(<span style="color:#a50">&#39;fbq.queue.push&#39;</span>, arguments);
    }
  });
  aliasInWindow(<span style="color:#a50">&#39;_fbq&#39;</span>, <span style="color:#a50">&#39;fbq&#39;</span>);
  
  <span style="color:#aaa;font-style:italic">// Create the fbq.queue
</span><span style="color:#aaa;font-style:italic"></span>  createQueue(<span style="color:#a50">&#39;fbq.queue&#39;</span>);
    
  <span style="color:#aaa;font-style:italic">// Return the global &#39;fbq&#39; method, created above
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">return</span> copyFromWindow(<span style="color:#a50">&#39;fbq&#39;</span>);
};

<span style="color:#aaa;font-style:italic">// Get reference to the global method
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> fbq = getFbq();

<span style="color:#aaa;font-style:italic">// Build the fbq() command arguments
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">const</span> props = data.propertyList ? makeTableMap(data.propertyList, <span style="color:#a50">&#39;name&#39;</span>, <span style="color:#a50">&#39;value&#39;</span>) : {};
<span style="color:#00a">const</span> command = data.eventName !== <span style="color:#a50">&#39;Custom&#39;</span> ? <span style="color:#a50">&#39;trackSingle&#39;</span> : <span style="color:#a50">&#39;trackSingleCustom&#39;</span>;
<span style="color:#00a">const</span> eventName = data.eventName !== <span style="color:#a50">&#39;Custom&#39;</span> ? data.eventName : data.customEventName;

<span style="color:#aaa;font-style:italic">// Handle multiple, comma-separated pixel IDs,
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#aaa;font-style:italic">// and initialize each ID if not done already.
</span><span style="color:#aaa;font-style:italic"></span>pixelIds.split(<span style="color:#a50">&#39;,&#39;</span>).forEach(pixelId =&gt; {
  <span style="color:#00a">if</span> (initIds.indexOf(pixelId) === -<span style="color:#099">1</span>) {
    
    <span style="color:#aaa;font-style:italic">// If the user has chosen to disable automatic configuration
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">if</span> (data.disableAutoConfig) {
      fbq(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;autoConfig&#39;</span>, <span style="color:#00a">false</span>, pixelId);
    }

    <span style="color:#aaa;font-style:italic">// Initialize pixel and store in global array
</span><span style="color:#aaa;font-style:italic"></span>    fbq(<span style="color:#a50">&#39;init&#39;</span>, pixelId);
    initIds.push(pixelId);
    setInWindow(<span style="color:#a50">&#39;_fbq_gtm_ids&#39;</span>, initIds, <span style="color:#00a">true</span>);
    
  }
  
  <span style="color:#aaa;font-style:italic">// Call the fbq() method with the parameters defined earlier
</span><span style="color:#aaa;font-style:italic"></span>  fbq(command, pixelId, eventName, props);
});

injectScript(<span style="color:#a50">&#39;https://connect.facebook.net/en_US/fbevents.js&#39;</span>, data.gtmOnSuccess, data.gtmOnFailure, <span style="color:#a50">&#39;fbPixel&#39;</span>);
</code></pre></div>
<p>At this point, it's a good idea to take a short breather.</p>
<p>If you take a close look at the code, you'll see that it's far more complex than what the Facebook pixel snippet is. The reason for this is the <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#sandboxed-javascript">sandboxed JavaScript</a> that custom templates use. For example, the Facebook snippet creates the global <code>fbq()</code> method with something like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#0aa">window</span>.fbq = <span style="color:#00a">function</span>() {
  <span style="color:#0aa">window</span>.fbq.callMethod ? 
    <span style="color:#0aa">window</span>.fbq.callMethod.apply(<span style="color:#0aa">window</span>.fbq, arguments) :
    <span style="color:#0aa">window</span>.fbq.queue.push(arguments);
}
</code></pre></div>
<p>It's a very simple piece of code, which simply passes the arguments you provide to <code>fbq()</code> (e.g. <code>'track', 'PageView'</code>) to one of two places, depending on whether the SDK has loaded yet or not.</p>
<p>To do this in a custom template is far more complicated. You can't just set a global variable, you need to use an API for that. You can't just check if a global method exists, you need an API for that. And you can't just create the <code>queue</code> property for the <code>fbq()</code> method, you need an API for that.</p>
<p>So, let's go over block by block to understand what the code does.</p>
<h4 id="initialize-the-necessary-apis">Initialize the necessary APIs</h4>
<p>This script needs a handful of APIs, which are initialized with the <code>require()</code> API:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> createQueue = require(<span style="color:#a50">&#39;createQueue&#39;</span>);
<span style="color:#00a">const</span> callInWindow = require(<span style="color:#a50">&#39;callInWindow&#39;</span>);
<span style="color:#00a">const</span> aliasInWindow = require(<span style="color:#a50">&#39;aliasInWindow&#39;</span>);
<span style="color:#00a">const</span> copyFromWindow = require(<span style="color:#a50">&#39;copyFromWindow&#39;</span>);
<span style="color:#00a">const</span> setInWindow = require(<span style="color:#a50">&#39;setInWindow&#39;</span>);
<span style="color:#00a">const</span> injectScript = require(<span style="color:#a50">&#39;injectScript&#39;</span>);
<span style="color:#00a">const</span> makeTableMap = require(<span style="color:#a50">&#39;makeTableMap&#39;</span>);
</code></pre></div>
<p>I'll explain how they function when we encounter them in the code.</p>
<h4 id="fetch-list-of-initialized-ids">Fetch list of initialized IDs</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> initIds = copyFromWindow(<span style="color:#a50">&#39;_fbq_gtm_ids&#39;</span>) || [];
<span style="color:#00a">const</span> pixelIds = data.pixelId;
</code></pre></div>
<p>Here we fetch the list of initialized IDs (stored in a custom <code>_fbq_gtm_ids</code> global array), and we also pull in the value, input by the user, of the <code>pixelId</code> field from the template itself.</p>
<h4 id="utility-to-fetch-the-proper-global-fbq-method">Utility to fetch the proper global <code>fbq</code> method</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> getFbq = () =&gt; {
  <span style="color:#aaa;font-style:italic">// Return the existing &#39;fbq&#39; global method if available
</span><span style="color:#aaa;font-style:italic"></span>  <span style="color:#00a">const</span> fbq = copyFromWindow(<span style="color:#a50">&#39;fbq&#39;</span>);
  <span style="color:#00a">if</span> (fbq) {
    <span style="color:#00a">return</span> fbq;
  }
  ...
</code></pre></div>
<blockquote>
<p>NOTE! The <strong>arrow function</strong> is a feature of <a href="https://www.w3schools.com/js/js_es6.asp">ES6</a> supported by Custom Templates. <code>const getFbq = () =&gt; {</code> translates to <code>var getFbq = function() {</code> in the older flavor of JavaScript.</p>
</blockquote>
<p>The purpose of <code>getFbq</code> is to return a representation of the global <code>fbq</code> method, which passes the arguments to the correct place, similar to how the regular Facebook snippet works.</p>
<p>The first lines check if <code>fbq</code> has already been created globally, and returns the global method in that case.</p>
<p>In case the global method does <strong>not</strong> exist, it needs to be created.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">  ...
  setInWindow(<span style="color:#a50">&#39;fbq&#39;</span>, <span style="color:#00a">function</span>() {    
    <span style="color:#00a">const</span> callMethod = copyFromWindow(<span style="color:#a50">&#39;fbq.callMethod.apply&#39;</span>);
    <span style="color:#00a">if</span> (callMethod) {           
      callInWindow(<span style="color:#a50">&#39;fbq.callMethod.apply&#39;</span>, <span style="color:#00a">null</span>, arguments); 
    } <span style="color:#00a">else</span> {       
      callInWindow(<span style="color:#a50">&#39;fbq.queue.push&#39;</span>, arguments);
    }
  });
  aliasInWindow(<span style="color:#a50">&#39;_fbq&#39;</span>, <span style="color:#a50">&#39;fbq&#39;</span>);
  ...
</code></pre></div>
<p>Here, the global <code>fbq</code> method is initialized as a new function. This function first checks if the <code>fbq.callMethod</code> method already exists (which means the FB SDK has loaded), and if it does, it passes the arguments sent to the <code>fbq</code> method (e.g. <code>'track', 'PageView'</code>) to this built-in method.</p>
<p>If the <code>callMethod</code> method has <strong>not</strong> been created yet, then the method passes its arguments to <code>fbq.queue</code> as an array push. The queue is basically a waiting list for pixel request, queued up for the Facebook SDK as it loads over the network. Once the SDK has loaded, it processes the messages in this queue and dispatches them to Facebook.</p>
<p>The last line makes an alias of the <code>fbq</code> method in another global variable, <code>_fbq</code>. I'm not certain why this is necessary, but it is what the Facebook snippet does as well.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">  ...
  createQueue(<span style="color:#a50">&#39;fbq.queue&#39;</span>);
  
  <span style="color:#00a">return</span> copyFromWindow(<span style="color:#a50">&#39;fbq&#39;</span>);
};
</code></pre></div>
<p>The last lines of the <code>setInWindow</code> API call create the <code>fbq.queue</code> global array, before finally returning the current content of the global <code>fbq</code> variable, which is the function you created above.</p>
<h4 id="prepare-the-fbq-command">Prepare the <code>fbq</code> command</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">const</span> fbq = getFbq();

<span style="color:#00a">const</span> props = data.propertyList ? makeTableMap(data.propertyList, <span style="color:#a50">&#39;name&#39;</span>, <span style="color:#a50">&#39;value&#39;</span>) : {};
<span style="color:#00a">const</span> command = data.eventName !== <span style="color:#a50">&#39;Custom&#39;</span> ? <span style="color:#a50">&#39;trackSingle&#39;</span> : <span style="color:#a50">&#39;trackSingleCustom&#39;</span>;
<span style="color:#00a">const</span> eventName = data.eventName !== <span style="color:#a50">&#39;Custom&#39;</span> ? data.eventName : data.customEventName;
</code></pre></div>
<p>These lines first fetch the latest representation of the <code>fbq</code> global method by invoking the <code>getFbq</code> function you <em>just</em> created.</p>
<p>Next, the contents of the <code>fbq</code> command are built. The <code>makeTableMap</code> API takes your <code>propertyList</code> Simple Table field, and converts each row to a key-value pair, where the key is the first column value (e.g. <code>content_ids</code>), and the value is the second column value (e.g. <code>123456</code>). It's a really handy API for converting the template table format into what many JavaScript libraries expect.</p>
<p>The <code>command</code> variable depends on whether you're using a standard event (e.g. PageView or Lead), in which case it is set to <code>trackSingle</code>, or whether you're using the Custom event, in which case it's set to <code>trackSingleCustom</code>.</p>
<p>The <code>eventName</code> takes either the value of the drop-down menu selection if a standard event is selected, or the value of the <code>customEventName</code> text input field if a Custom event is selected.</p>
<h4 id="cycle-through-all-pixel-ids-defined-in-tag-and-dispatch-the-commands">Cycle through all Pixel IDs defined in tag, and dispatch the commands</h4>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">pixelIds.split(<span style="color:#a50">&#39;,&#39;</span>).forEach(pixelId =&gt; {
  <span style="color:#00a">if</span> (initIds.indexOf(pixelId) === -<span style="color:#099">1</span>) {
    <span style="color:#00a">if</span> (data.disableAutoConfig) {
      fbq(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;autoConfig&#39;</span>, <span style="color:#00a">false</span>, pixelId);
    }
    fbq(<span style="color:#a50">&#39;init&#39;</span>, pixelId);
    initIds.push(pixelId);
    setInWindow(<span style="color:#a50">&#39;_fbq_gtm_ids&#39;</span>, initIds, <span style="color:#00a">true</span>);
  }
  
  fbq(command, pixelId, eventName, props);
});
</code></pre></div>
<p>The whole command process is wrapped in an iterator, which loops through all the Pixel IDs the user has added to the tag. The commands are run identically for every single Pixel ID in the tag.</p>
<p>First, the code checks if the Pixel ID has already been initialized by looking at the contents of the <code>initIds</code> array you created at the very beginning of the code. You don't want to initialize any Pixel ID more than once, or you'll risk running into problems with Facebook's SDK.</p>
<p>If the pixel hasn't been initialized, then first the <code>autoConfig</code> parameter is set to <code>false</code>, if the user has checked the respective checkbox in the template.</p>
<p>Next, the <code>fbq('init', pixelId)</code> command is run, after which the Pixel ID is pushed into the array of initialized pixels.</p>
<p>Finally, the <code>fbq()</code> command is run with the parameters you created previously.</p>
<h4 id="load-the-facebook-sdk">Load the Facebook SDK</h4>
<p>The very last line in the code editor loads the Facebook SDK, and signals either <code>data.gtmOnSuccess()</code> or <code>data.gtmOnFailure</code>, depending on whether the SDK load was successful or not.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">injectScript(<span style="color:#a50">&#39;https://connect.facebook.net/en_US/fbevents.js&#39;</span>, data.gtmOnSuccess, data.gtmOnFailure, <span style="color:#a50">&#39;fbPixel&#39;</span>);
</code></pre></div>
<h3 id="step-4-permissions">Step 4: Permissions</h3>
<p>Because you use all these APIs and mess so much with the global namespace, you'll need to add some permissions if you want the template code to run.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/facebook-permissions.jpg" title="Facebook permissions">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/facebook-permissions.jpg#ZgotmplZ" alt="Facebook permissions">
  
    </a>
  
  
</div>


<p>As you can see, every single global variable you interact with, either directly (via <code>copyFromWindow</code>, <code>callInWindow</code>, etc.) or indirectly (via <code>aliasFromWindow</code>) must be specified in the Permissions list.</p>
<p>Similarly, the script injection of the SDK itself must be allowed using the appropriate permission.</p>
<h3 id="test-it">Test it!</h3>
<p>To test it, <strong>save</strong> the template, then browse to your container's tags, and create a new tag. You should see the Facebook Pixel in the tag menu.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/choose-facebook-pixel.jpg" title="Choose new pixel">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/choose-facebook-pixel.jpg#ZgotmplZ" alt="Choose new pixel">
  
    </a>
  
  
</div>


<p>Next, fill in the fields. Try a couple of different things, such as passing various object properties, using custom events, and adding more than one Pixel ID.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/test-facebook-pixel.jpg" title="test pixel">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/test-facebook-pixel.jpg#ZgotmplZ" alt="test pixel">
  
    </a>
  
  
</div>


<p>Try also creating more than one tag with the same Pixel ID, to make sure the initialization is done just once per ID.</p>
<p>Using GTM Preview mode and <a href="https://chrome.google.com/webstore/detail/facebook-pixel-helper/fdgfkebogiimcoedlicjlajpkdmockpc?hl=en">Facebook's Pixel Helper</a>, you should be able to verify that everything is working as it should.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/05/facebook-pixel-helper.jpg" title="Facebook pixel helper">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/05/facebook-pixel-helper.jpg#ZgotmplZ" alt="Facebook pixel helper">
  
    </a>
  
  
</div>


<h2 id="final-thoughts">Final thoughts</h2>
<p>I hope this article has helped demystify custom templates.</p>
<p>As you can see, working with the sandboxed JavaScript isn't just a question of copy-pasting some original code and rewriting some method calls. It calls for a different approach completely, especially when working with global variables.</p>
<p>There are some things I think custom templates should do to improve flexibility. For example, the function wrapper that GTM automatically adds whenever you create a global function is problematic, since there are use cases where you might want to be able to add properties to the global function itself. In its current format, custom templates do not permit this, so you need to use an API like <code>createQueue</code> to establish <code>fbq.queue</code> as an array.</p>
<p>It would be better if I could just run something like <code>setInWindow('fbq.queue', [])</code>, but right now, <code>setInWindow</code> only allows you to set the variable and not its individual properties.</p>
<p>Other than that, the benefit of using this over a Custom HTML tag is huge: you're minimizing the risk of code errors due to operating through the template, and you don't need the problematic <code>unsafe-eval</code> directive in your <a href="https://www.simoahava.com/analytics/google-tag-manager-content-security-policy/">Content Security Policy</a>.</p>
<p>Thanks for reading, and perhaps watching! Let me know in the comments if you have questions about how this whole thing works.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/gtmtips/">gtmtips</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom-templates/">custom templates</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tag-templates/">tag templates</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/google-cloud/create-cookie-rewrite-web-service-google-cloud/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Create%20Facebook%20Pixel%20Custom%20Tag%20Template%20https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/google-cloud/create-cookie-rewrite-web-service-google-cloud/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Create%20Facebook%20Pixel%20Custom%20Tag%20Template%20https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Create%20Facebook%20Pixel%20Custom%20Tag%20Template%20https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

