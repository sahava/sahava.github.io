

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "10 JavaScript Concepts For Web Analytics Implementation | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2016/09/10-javascript-concepts.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/",
  "datePublished": "2016-09-21T15:17:54+00:00",
  "dateModified": "2016-09-21T15:17:54+00:00",
  "description": "Ten JavaScript concepts that are important to understand when working with web analytics implementations.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.48 with theme Tranquilpeak 0.4.3-BETA">
    <title>10 JavaScript Concepts For Web Analytics Implementation | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    <script src="//de.cdn-v3.conductrics.com/ac-GeQBKxGTiA/v3/agent-api/js/f-TNZdDPOknZ/dt-8BnrVvfJuB1PwktQxXXgVK2OikZ9WR?apikey=api-WDrqMnckreSqejZgDAMu" type="text/javascript"></script>
    <script src="https://www.simoahava.com/js/ctrics-manual.js"></script>
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/10-javascript-concepts-for-web-analytics-implementation/">
    
    <meta name="description" content="Ten JavaScript concepts that are important to understand when working with web analytics implementations.">
    <meta property="og:description" content="Ten JavaScript concepts that are important to understand when working with web analytics implementations.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="10 JavaScript Concepts For Web Analytics Implementation">
    <meta property="og:url" content="/analytics/10-javascript-concepts-for-web-analytics-implementation/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="10 JavaScript Concepts For Web Analytics Implementation">
    <meta name="twitter:description" content="Ten JavaScript concepts that are important to understand when working with web analytics implementations.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2016/09/10-javascript-concepts.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2016/09/10-javascript-concepts.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      10 JavaScript Concepts For Web Analytics Implementation
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2016-09-21T15:17:54Z">
        
  September 21, 2016

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              

<p>I&rsquo;ve already written <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">extensively</a> about JavaScript in web analytics implementation. Suffice to say, understanding at least <em>the basics</em> is absolutely necessary to survive in the technical medium of the web browser.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/10-javascript-concepts.png" title="10 JavaScript Concepts for web analytics">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/10-javascript-concepts.png#ZgotmplZ" alt="10 JavaScript Concepts for web analytics">
  
    </a>
  
  
</div>



<p>This article expands on a conference talk I gave at <a href="http://london.measurecamp.org/">MeasureCamp IX, London</a> a short while ago. I&rsquo;ve always been quite single-minded about the importance of JavaScript in web analytics development, and it was a pleasure for me to get some of that off my chest. So I want to go over the ten concepts introduced in my conference talk with a little more detail, especially in the context of <a href="https://tagmanager.google.com/">Google Tag Manager</a>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/title.png" title="table of contents">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/title.png#ZgotmplZ" alt="table of contents">
  
    </a>
  
  
</div>



<h2 id="get-the-basics-right">Get the basics right</h2>

<p>JavaScript is not the quirky animation tool from two decades ago anymore - it&rsquo;s a programming language if there ever was one. It hides a lot of complexity under its seemingly simple syntax, though in the web browser much of this complexity is either abstracted or removed entirely thanks to how the client-server infrastructure of the web works.</p>

<p>To get up to speed with JavaScript, I typically recommend the following resources. <a href="https://www.codecademy.com/">Codecademy</a> especially is something you might want to devote time and effort to. It has lots of different tracks, and some that are extremely useful for web (analytics) developers.</p>

<h3 id="1-codecademy">1. Codecademy</h3>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/codecademy.png" title="codecademy">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/codecademy.png#ZgotmplZ" alt="codecademy">
  
    </a>
  
  
</div>



<p>Codecademy is an <em>amazing</em> resource. The courses are free, fully interactive, and the service keeps track of your progress as you learn new skills along the way. Codecademy has lots of tracks for web developers, but I want to highlight the following as the <em>bare minimum</em> for web analytics:</p>

<ul>
<li><p><a href="https://www.codecademy.com/learn/javascript">JavaScript</a></p></li>

<li><p><a href="https://www.codecademy.com/learn/web">HTML &amp; CSS</a></p></li>

<li><p><a href="https://www.codecademy.com/learn/jquery">jQuery</a></p></li>
</ul>

<p>I recommend making it habitual to always have a course active in Codecademy. Programming is not a skill you develop in silos - each new language and discipline you learn helps you become a better developer overall.</p>

<h3 id="2-books">2. Books</h3>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/books.png" title="Great books for learning JavaScript">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/books.png#ZgotmplZ" alt="Great books for learning JavaScript">
  
    </a>
  
  
</div>



<p>You might argue that books are not the best way to keep up-to-date with web technologies, but the following volumes have stood the test of time (with the exception of the last one which is brand new) marvellously, and even if some of the code samples might be outdated, the ideas behind the solutions remain as topical as ever.</p>

<ul>
<li><p><a href="https://www.amazon.com/Professional-JavaScript-Developers-Nicholas-Zakas/dp/1118026691">Nicholas Zakas: Professional JavaScript for Web Developers (3rd Edition)</a></p></li>

<li><p><a href="https://www.amazon.com/DOM-Enlightenment-Cody-Lindley/dp/1449342841">Cody Lindley: DOM Enlightenment</a></p></li>

<li><p><a href="https://www.amazon.com/Practical-Google-Analytics-Manager-Developers/dp/148420266X">Jonathan Weber: Practical Google Analytics and Google Tag Manager for Developers</a></p></li>
</ul>

<p>Zakas&rsquo; volume is a great, if somewhat intimidating, foray into how JavaScript and the web browser interact. Needless to say, it is a goldmine for understanding the technical stack you&rsquo;re working with when implementing web analytics solution. It&rsquo;s the book I would most recommend you to read once you have the basics of JavaScript down.</p>

<h3 id="3-sandbox">3. Sandbox</h3>

<p>The only way you can really learn something is by doing it. All creative skills, programming included, need honing. The best way to learn programming is to actively practice it. So in addition to taking courses and learning by reading, remember to also <em>create</em> stuff! A great way to do it is to deploy Google Tag Manager on your own website. If you don&rsquo;t have one, you can now create one with your new-fangled skills!</p>

<p>Play around with the <a href="http://webmasters.stackexchange.com/a/77337/66450">JavaScript Console</a> of your web browser&rsquo;s developer tools. Implement scripts in Google Tag Manager, and see how they interact with your website. Use tools like <a href="http://www.jslint.com/">JS Lint</a> to understand what issues your code might have.</p>

<p>Whatever you do, just keep coding.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/functions-and-methods.png" title="1. Functions and Methods">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/functions-and-methods.png#ZgotmplZ" alt="1. Functions and Methods">
  
    </a>
  
  
</div>



<p>In the context of Google Tag Manager, functions are arguably the most useful little things when customizing implementations. That&rsquo;s because the <a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/">Custom JavaScript Variable</a> is basically a function call that you use to resolve a value.</p>

<p>The Custom JavaScript Variable has a very deliberate syntax when using Google Tag Manager, and some of the restrictions might sound odd to you, so I want to go over them with some detail in this chapter.</p>

<h3 id="anonymous-function-with-a-return-statement">Anonymous function with a return statement</h3>

<p>The Custom JavaScript Variable requires an <strong>anonymous function</strong> with a <strong><code>return</code> statement</strong>. An anonymous function is exactly that: it&rsquo;s a function without a named identifier that you could use to refer to it. Now, you can argue that it does have a name since the Variable itself has a name, but that&rsquo;s GTM&rsquo;s proprietary way of resolving the Custom JavaScript Variable and has nothing to do with the underlying JavaScript syntax.</p>

<p>The Custom JavaScript Variable doesn&rsquo;t take any parameters, either. All values you want to process through it need to come from the internal data model of Google Tag Manager (GTM&rsquo;s &ldquo;Variables&rdquo;), need to be created on the spot (local scope), or need to be available in the global namespace (global scope).</p>

<p>Finally, all Custom JavaScript Variables need a <code>return</code> statement. They must always return some value, as they are invoked in situations where a value is required.</p>

<p>So this is the minimum viable Custom JavaScript Variable you could create.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span>;
}
</code></pre></div>

<p>When invoked with the {{Variable}} syntax, this function would return <code>undefined</code>.</p>

<h3 id="avoid-side-effects">Avoid side effects</h3>

<p>Since the Custom JavaScript Variable is a value-returning function which does not accept parameters, it should only be used for input/output operations. Thus, the purpose of the Custom JavaScript Variable is to take some value, modify it, and then return the modified value.</p>

<p>A function has side effects if it does something else except the input/output operation described in the previous paragraph. Typical side effects occur when a function is used to modify something in the global scope, or it&rsquo;s used to set some value elsewhere, or, in the context of Google Tag Manager, it&rsquo;s used to manipulate the Data Layer.</p>

<p>You should avoid side effects because Google Tag Manager can&rsquo;t guarantee that the Custom JavaScript Variable is only resolved once per activation. In fact, in Preview mode, Custom JavaScript Variables can be resolved dozens of times per <code>dataLayer.push()</code>, which can lead to a confusing experience.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// AVOID THIS:
</span><span style="color:#75715e"></span>  window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({<span style="color:#e6db74">&#39;event&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;JavaScript executed&#39;</span>});
  <span style="color:#66d9ef">return</span>;
}
</code></pre></div>

<p>The main problem with side effects is that they&rsquo;re hard to trace if problems arise. Since the Custom JavaScript Variables are resolved at arbitrary times, having them modify the global scope can be hazardous and can easily lead to unwanted race conditions.</p>

<h3 id="understand-scope-utilize-closures">Understand scope, utilize closures</h3>

<p>JavaScript in the web has two types of scope: local and global.</p>

<p><strong>Local scope</strong>, also known as function scope, is what variables are restricted to when declared within a function. When you declare a variable in a function, it will only exist for the duration of the function call (though see the part about closures below), after which the garbage collector comes and whisks it away. Locally scoped variables cannot be referred to or invoked from outside the current function context.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// These variables all have local scope
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hello</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hi, &#34;</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">myname</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Simo!&#34;</span>;
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hello</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">myname</span>;
}
</code></pre></div>

<p><strong>Global scope</strong>, on the other hand, comprises variables that are declared as properties of the <code>window</code> object. If you don&rsquo;t use the <code>var</code> keyword when declaring a variable in a function, it is automatically elevated into global scope.</p>

<p>When a variable is in global scope, you can refer to it anywhere. For example, the ubiquitous <code>document</code> property of the browser&rsquo;s Document Object Model can be used anywhere since it&rsquo;s actually a global property of the <code>window</code> object:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.document <span style="color:#f92672">===</span> document; <span style="color:#75715e">// true
</span><span style="color:#75715e"></span></code></pre></div>

<p><strong>Closures</strong> are an exception to how locally scoped variables are ephemeral and inaccessible from the outside. When you create a closure, you are actually creating a simple <em>interface</em> that lets you access the locally scoped variable from outside the function!</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">timeNow</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(); <span style="color:#75715e">// Locally scoped
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Time then was: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">timeNow</span>;
  };
}
</code></pre></div>

<p>The closure is the <code>return function() {...}</code> statement. Because the function is declared within same context, it has access to the locally scoped <code>timeNow</code> variable. And because the function is the target of the <code>return</code> statement, you can actually call this returned function in code! In the example below, the Custom JavaScript Variable we just created above is named <strong>Time Then</strong>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">timeThen</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">Time</span> <span style="color:#a6e22e">Then</span>}}();
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">timeThen</span>);
</code></pre></div>

<p>The parentheses at the end of the Custom JavaScript Variable are significant. If you simply had <code>{{Time Then}}</code>, the variable assignment would store the return value of the Custom JavaScript Variable (the closure) into the <code>timeThen</code> variable. The <code>console.log()</code> command would simply output the function description itself, and not the result. By adding the parentheses, you&rsquo;re telling the browser to actually <strong>invoke</strong> the function returned by the Custom JavaScript Variable. Since the <code>timeNow</code> is only created once (when the Custom JavaScript Variable is first resolved), the closure will always return the same date-time string.</p>

<h3 id="modify-state-when-you-are-in-control-of-resolution">Modify state when you are in control of resolution</h3>

<p>There is one exception to Custom JavaScript Variables having side effects. When you are in full control of when the function is resolved, it&rsquo;s fine to cause side effects, since you don&rsquo;t have to worry about the function resolving an unknown number of times or in unknown contexts.</p>

<p>One such example is when using a closure in a <em>callback</em>. Callbacks (more on these later) are execution milestones which take place after some other process has completed. So if you indicate the closure of a Custom JavaScript Variable as the value of a callback, you can rest assured that the function is only called once - when the main process has completed.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// Return a function to be used by hitCallback
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>() {
    <span style="color:#75715e">// It&#39;s OK to modify state here!
</span><span style="color:#75715e"></span>    window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({<span style="color:#e6db74">&#39;event&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;tagHasFired&#39;</span>});
  };
}
</code></pre></div>

<p>This process is exemplified in the <a href="https://www.simoahava.com/gtm-tips/hitcallback-eventcallback/">hitCallback</a> feature of the Google Analytics tracker. The hitCallback function is called after the request to Google Analytics has completed. Thus, you can use the closure of a Custom JavaScript Variable to perform some state-altering thing in the hitCallback field itself! This is very useful if you want to chain tags in a sequence, for example.</p>

<h3 id="further-reading">FURTHER READING</h3>

<p>Take a look at the following articles for more information on how functions work:</p>

<ul>
<li><p><a href="http://www.w3schools.com/js/js_function_closures.asp">w3schools: JavaScript Closures</a></p></li>

<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures">MDN: Closures</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/">Custom JavaScript Variable</a></p></li>

<li><p><a href="https://www.simoahava.com/gtm-tips/hitcallback-eventcallback/">#GTMtips: hitCallback And eventCallback</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/data-types.png" title="2. Data Types">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/data-types.png#ZgotmplZ" alt="2. Data Types">
  
    </a>
  
  
</div>



<p>In JavaScript, you have five value-carrying data types:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>; <span style="color:#75715e">// number
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;five&#34;</span>; <span style="color:#75715e">// string
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>; <span style="color:#75715e">// boolean
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">five</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>}; <span style="color:#75715e">// object
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">5</span>; }; <span style="color:#75715e">// function
</span><span style="color:#75715e"></span></code></pre></div>

<p>It gets slightly messier than this, since there are actually lots of different types of objects (all JavaScript data types are actually an extension of &ldquo;object&rdquo; in its fundamental sense):</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">five</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>}; <span style="color:#75715e">// Object
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>]; <span style="color:#75715e">// Array
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(); <span style="color:#75715e">// Date
</span><span style="color:#75715e"></span></code></pre></div>

<p>And finally we have some mystic pseudo-types which don&rsquo;t carry any value:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">undefined</span>; <span style="color:#75715e">// undefined
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// null
</span><span style="color:#75715e"></span></code></pre></div>

<h3 id="dynamic-type">Dynamic type</h3>

<p>Unlike some other programming languages (e.g. Java), type is <em>dynamic</em> in JavaScript. That means that you can reassign a variable with a completely different type without having to worry about type conversion.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
<span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;five&#34;</span>;
</code></pre></div>

<p>The above is possible in JavaScript, because the variable assignment itself doesn&rsquo;t coerce the assigned value to any specific type. This can be a weakness in the code, because it requires you to test for type to avoid errors.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Works because something is a number
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">somethingMultiplied</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>;

<span style="color:#75715e">// Won&#39;t work because something is suddenly a string
</span><span style="color:#75715e"></span><span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;five&#34;</span>;
<span style="color:#a6e22e">somethingMultiplied</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>; <span style="color:#75715e">// NaN: Not a Number
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// So you need to test
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;number&#39;</span>) {
  <span style="color:#a6e22e">somethingMultiplied</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>;
}
</code></pre></div>

<p>The further apart your variables are from their execution context, the messier it can get with all the type checks. So try to avoid exploiting dynamic type, and do your best to maintain type when creating and reassigning variables.</p>

<h3 id="loose-type">Loose type</h3>

<p>JavaScript also does type conversion for you when needed. This means that the following is possible:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5&#34;</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">somethingMultiplied</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">something</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>; <span style="color:#75715e">// 10
</span><span style="color:#75715e"></span></code></pre></div>

<p>In the multiplication, JavaScript expects <code>something</code> to resolve to the number type. Even though <code>something</code> is a string, JavaScript detects the number within and automatically converts the variable to a number for the multiplication statement. The variable <code>something</code> itself is not modified, but the value held by it is converted automatically to make resolving <code>somethingMultiplied</code> possible.</p>

<p>Note that there are some embarrassing exceptions. The plus operator (+) is not only used for mathematical statements but also for concatenating strings. So if you try to add a number to a string, you&rsquo;ll end up with a concatenated string rather than a number!</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5&#34;</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>; <span style="color:#75715e">// &#34;56&#34;!
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// You need to use parseInt() to manually convert to number:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> parseInt(<span style="color:#a6e22e">a</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">b</span>; <span style="color:#75715e">// 11
</span><span style="color:#75715e"></span></code></pre></div>

<h3 id="weird-stuff">Weird stuff</h3>

<p>I&rsquo;ll just leave this list here. It&rsquo;s just a handful off the odd behavior you get when working with loose and dynamic type.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">typeof</span> <span style="color:#66d9ef">NaN</span>; <span style="color:#75715e">// number
</span><span style="color:#75715e"></span><span style="color:#66d9ef">NaN</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">NaN</span>; <span style="color:#75715e">// false
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typeof</span> <span style="color:#66d9ef">NaN</span>; <span style="color:#75715e">// number
</span><span style="color:#75715e"></span>isNaN(<span style="color:#66d9ef">NaN</span>); <span style="color:#75715e">// true
</span><span style="color:#75715e"></span>isNaN(<span style="color:#66d9ef">null</span>); <span style="color:#75715e">// false
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typeof</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// object
</span><span style="color:#75715e"></span><span style="color:#66d9ef">null</span> <span style="color:#66d9ef">instanceof</span> Object; <span style="color:#75715e">// false
</span><span style="color:#75715e"></span><span style="color:#66d9ef">typeof</span> <span style="color:#66d9ef">undefined</span>; <span style="color:#75715e">// undefined
</span><span style="color:#75715e"></span><span style="color:#66d9ef">undefined</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// false
</span><span style="color:#75715e"></span><span style="color:#66d9ef">undefined</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// true
</span><span style="color:#75715e"></span>{<span style="color:#a6e22e">simo</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>} <span style="color:#f92672">===</span> {<span style="color:#a6e22e">simo</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>}; <span style="color:#75715e">// false
</span><span style="color:#75715e"></span></code></pre></div>

<h3 id="undefined-and-google-analytics">Undefined and Google Analytics</h3>

<p>Remember that the <code>undefined</code> type has a <a href="https://www.simoahava.com/gtm-tips/undefined-dimensions-wont-get-sent/">special function</a> in Google Analytics (and Google Tag Manager). If you refer to a variable which returns <code>undefined</code>, that particular setting, field, or parameter is automatically dropped from the request to Google Analytics.</p>

<p>In Google Tag Manager, <code>undefined</code> can also be used to <a href="https://www.simoahava.com/gtm-tips/remember-to-flush-unused-data-layer-variables/">purge values from the Data Layer</a>. This is extremely useful on single-page apps, where variables persist their values throughout the visit.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
  <span style="color:#a6e22e">event</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;GAEvent&#39;</span>,
  <span style="color:#a6e22e">eventData</span> <span style="color:#f92672">:</span> {
    <span style="color:#a6e22e">cat</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Category value&#39;</span>,
    <span style="color:#a6e22e">act</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Action value&#39;</span>,
    <span style="color:#a6e22e">lab</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>,
    <span style="color:#a6e22e">val</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>
  }
});
</code></pre></div>

<h3 id="further-reading-1">FURTHER READING</h3>

<p>The following articles shed more light on data types in JavaScript:</p>

<ul>
<li><p><a href="http://www.w3schools.com/js/js_datatypes.asp">w3schools: JavaScript Data Types</a></p></li>

<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures">MDN: JavaScript data types and data structures</a></p></li>

<li><p><a href="https://www.simoahava.com/gtm-tips/undefined-dimensions-wont-get-sent/">#GTMtips: Undefined dimensions won&rsquo;t get sent</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/http-requests.png" title="3. HTTP Requests">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/http-requests.png#ZgotmplZ" alt="3. HTTP Requests">
  
    </a>
  
  
</div>



<p>When looking for things that can slow down the site, slow or poorly performing HTTP requests are usually the easy culprit to blame.</p>

<p>Thanks to asynchronous loading, most HTTP requests are done in such a way that they don&rsquo;t block the page from rendering, but async itself doesn&rsquo;t guarantee a smooth ride.</p>

<p>Let&rsquo;s take Google Tag Manager as an example. This is a typical container snippet:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">w</span>,<span style="color:#a6e22e">d</span>,<span style="color:#a6e22e">s</span>,<span style="color:#a6e22e">l</span>,<span style="color:#a6e22e">i</span>){<span style="color:#a6e22e">w</span>[<span style="color:#a6e22e">l</span>]<span style="color:#f92672">=</span><span style="color:#a6e22e">w</span>[<span style="color:#a6e22e">l</span>]<span style="color:#f92672">||</span>[];<span style="color:#a6e22e">w</span>[<span style="color:#a6e22e">l</span>].<span style="color:#a6e22e">push</span>({<span style="color:#e6db74">&#39;gtm.start&#39;</span><span style="color:#f92672">:</span><span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">getTime</span>(),<span style="color:#a6e22e">event</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;gtm.js&#39;</span>});<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">f</span><span style="color:#f92672">=</span><span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#a6e22e">s</span>)[<span style="color:#ae81ff">0</span>],<span style="color:#a6e22e">j</span><span style="color:#f92672">=</span><span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">createElement</span>(<span style="color:#a6e22e">s</span>),<span style="color:#a6e22e">dl</span><span style="color:#f92672">=</span><span style="color:#a6e22e">l</span><span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;dataLayer&#39;</span><span style="color:#f92672">?</span><span style="color:#e6db74">&#39;&amp;l=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">l</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;&#39;</span>;<span style="color:#a6e22e">j</span>.<span style="color:#66d9ef">async</span><span style="color:#f92672">=</span><span style="color:#66d9ef">true</span>;<span style="color:#a6e22e">j</span>.<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;//www.googletagmanager.com/gtm.js?id=&#39;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#a6e22e">dl</span>;<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">parentNode</span>.<span style="color:#a6e22e">insertBefore</span>(<span style="color:#a6e22e">j</span>,<span style="color:#a6e22e">f</span>);})(window,document,<span style="color:#e6db74">&#39;script&#39;</span>,<span style="color:#e6db74">&#39;dataLayer&#39;</span>,<span style="color:#e6db74">&#39;GTM-W92WQQ&#39;</span>);
</code></pre></div>

<p>I&rsquo;ve gone over this code in an <a href="https://www.simoahava.com/analytics/container-snippet-gtm-secrets-revealed/">earlier article</a>, but suffice to say that the end result of all this code is this:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/gtm-element.png" title="gtm script element">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/gtm-element.png#ZgotmplZ" alt="gtm script element">
  
    </a>
  
  
</div>



<p>In other words, the minified code creates a new <code>script</code> HTML element, which instructs the browser to request for a file in Google&rsquo;s servers, and the request is done asynchronously.</p>

<p>The <code>script</code> element, then, turns into an HTTP request, since the <code>src</code> attribute in the tag signals the browser to make an HTTP request to the URL value of the attribute.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/gtm-js-get.png" title="gtm.js GET request">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/gtm-js-get.png#ZgotmplZ" alt="gtm.js GET request">
  
    </a>
  
  
</div>



<p>So just by creating the <code>script</code> tag, the browser automatically executed an HTTP request to the given endpoint, and the result of this request is the <strong>gtm.js</strong> retrieved in the browser for immediate execution.</p>

<p>There are lots of elements that can produce an HTTP request. All scripts, images, and HTML files need to be retrieved from the web server, and the main channel of data transfer is the HTTP request. The following HTML tags (with the given attributes) also invoke HTTP requests:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">usemap</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">ins</span> <span style="color:#a6e22e">cite</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">object</span> <span style="color:#a6e22e">classid</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">object</span> <span style="color:#a6e22e">codebase</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">object</span> <span style="color:#a6e22e">data</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">object</span> <span style="color:#a6e22e">usemap</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">q</span> <span style="color:#a6e22e">cite</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">audio</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">formaction</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">command</span> <span style="color:#a6e22e">icon</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">embed</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">manifest</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">formaction</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">source</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">poster</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">video</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">applet</span> <span style="color:#a6e22e">codebase</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">area</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">base</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">blockquote</span> <span style="color:#a6e22e">cite</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">body</span> <span style="color:#a6e22e">background</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">del</span> <span style="color:#a6e22e">cite</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">frame</span> <span style="color:#a6e22e">longdesc</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">frame</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span> <span style="color:#a6e22e">profile</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">longdesc</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">longdesc</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;
&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">usemap</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;url&#34;</span>&gt;</code></pre></div>

<p>Yeah. That&rsquo;s quite a bunch.</p>

<p>Note that HTTP requests can be created manually using e.g. <code>XMLHttpRequest</code> or <code>jQuery.ajax()</code>. In fact, when you send hits to Google Analytics, you&rsquo;re actually using HTTP requests created by the <strong>analytics.js</strong> library.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/collect-get-post.png" title="GET and POST in google analytics requests">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/collect-get-post.png#ZgotmplZ" alt="GET and POST in google analytics requests">
  
    </a>
  
  
</div>



<h3 id="further-reading-2">FURTHER READING</h3>

<p>Here&rsquo;s more information on HTTP requests:</p>

<ul>
<li><p><a href="http://www.w3schools.com/ajax/ajax_xmlhttprequest_create.asp">w3schools: AJAX - Create an XMLHttpRequest Object</a></p></li>

<li><p><a href="http://www.w3schools.com/tags/ref_httpmethods.asp">w3schools: HTTP Methods: GET vs. POST</a></p></li>

<li><p><a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/reference#transport">Measurement Protocol Reference: Transport</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/race-conditions.png" title="4. Race Conditions">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/race-conditions.png#ZgotmplZ" alt="4. Race Conditions">
  
    </a>
  
  
</div>



<p>The difference between <strong>asynchronous</strong> and <strong>synchronous</strong> loading is subtle but significant.</p>

<p>JavaScript in the web browser is <strong>single-threaded</strong>. That means that only one process can ever be running at a time, and thus every single line of JavaScript must be executed completely before the browser can proceed to the next line. If you make a <strong>synchronous</strong> HTTP request, it means that the browser will wait until the entire request (download, execution, render) is taken to completion before the browser proceeds to the next line of code in the page. It&rsquo;s said that synchronous operations are thus <strong>blocking</strong>.</p>

<p>To counter this potentially devastating blow to page render and user experience, asynchronous loading was introduced to make the &ldquo;expensive&rdquo; part of the process, the download, happen so that it doesn&rsquo;t block the browser.</p>

<p>So, when a request is made asynchronously, the browser initiates the download but then proceeds to the next line of code <em>while the download goes on in the background</em>. Only after the file is completely downloaded, does the browser return execution to this initial process, rendering the downloaded asset in the browser.</p>

<p>The problem with asynchronous execution is that even though you can pinpoint the exact moment when the request is initiated, as it&rsquo;s governed by the order of the lines of code in the page template, you&rsquo;ll never know the exact moment when it completes. And this can lead to something called a <strong>race condition</strong>.</p>

<p>So let&rsquo;s say I have the following two lines of code in the page template:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">async</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">async</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https//www.googletagmanager.com/gtm.js?id=GTM-XXXXX&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>The browser starts loading the jQuery library before GTM, so I might expect jQuery to available to GTM as soon as the latter has finished downloading. But that&rsquo;s not necessarily the case! The actual download of jQuery can end long <em>after</em> GTM has completed, because the jQuery library is more often than not quite a bulky thing. Also, if the CDN providing the jQuery library has latency, it might affect when jQuery becomes available.</p>

<p>So, if in Google Tag Manager I try to use jQuery, there can be a <strong>race condition</strong> where GTM expects jQuery to be available but it isn&rsquo;t.</p>

<p>To combat the race condition, we can use tools like <strong>callbacks</strong>, <strong>promises</strong> or, in GTM, <a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">Tag Sequencing</a>. You can always resort to synchronous downloading if you&rsquo;re really concerned about race conditions, but remember that this can have a detrimental impact on user experience.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!-- Synchronous request --&gt;</span>
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">async</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https//www.googletagmanager.com/gtm.js?id=GTM-XXXXX&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;

<span style="color:#75715e">&lt;!-- Callback --&gt;</span>
&lt;<span style="color:#f92672">script</span>&gt;
  (<span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;script&#39;</span>);
    <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js&#39;</span>;
    <span style="color:#a6e22e">el</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, <span style="color:#66d9ef">function</span>() {
      window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({<span style="color:#a6e22e">event</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;jQueryLoaded&#39;</span>});
    });
    document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">el</span>);
  })();
&lt;/<span style="color:#f92672">script</span>&gt;

<span style="color:#75715e">&lt;!-- Tag Sequencing --&gt;</span>
&lt;<span style="color:#f92672">script</span>&gt;
  (<span style="color:#66d9ef">function</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;script&#39;</span>);
    <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js&#39;</span>;
    <span style="color:#a6e22e">el</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;load&#39;</span>, <span style="color:#66d9ef">function</span>() {
      window[<span style="color:#e6db74">&#39;google_tag_maanger&#39;</span>][{{<span style="color:#a6e22e">Container</span> <span style="color:#a6e22e">ID</span>}}].<span style="color:#a6e22e">onHtmlSuccess</span>({{<span style="color:#a6e22e">HTML</span> <span style="color:#a6e22e">ID</span>}});
    });
    document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">el</span>);
  })();
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>It&rsquo;s better to be safe than sorry, so when working with potential race conditions, make sure to always check if the resources you are trying to use actually exist.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">jQuery</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
  <span style="color:#75715e">// Use jQuery
</span><span style="color:#75715e"></span>} <span style="color:#66d9ef">else</span> {
  <span style="color:#75715e">// Use something else
</span><span style="color:#75715e"></span>}
</code></pre></div>

<h3 id="further-reading-3">FURTHER READING</h3>

<p>Here are some useful links on race conditions, callbacks, and such.</p>

<ul>
<li><p><a href="http://callbackhell.com/">Callback Hell</a></p></li>

<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">MDN: Promise</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/understanding-tag-sequencing-in-google-tag-manager/">Understanding Tag Sequencing in Google Tag Manager</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/history-manipulation.png" title="5. History Manipulation">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/history-manipulation.png#ZgotmplZ" alt="5. History Manipulation">
  
    </a>
  
  
</div>



<p><a href="https://en.wikipedia.org/wiki/Single-page_application">Single-page web applications</a> (SPA) utilize something called the <a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API">History API</a> to provide a multi-page experience with only one initial page load in the web server. Subsequent transitions from page-to-page are commonly done using the History API, by withdrawing content from the server without initiating a page refresh, and manually creating history entries in the web browser. Common frameworks for SPAs are e.g. <a href="https://facebook.github.io/react/">React</a>, <a href="https://angularjs.org/">AngularJS</a>, and <a href="http://backbonejs.org/">Backbone.js</a>.</p>

<p>SPAs have significant implications for web analytics. For example, an SPA can suffer from the <a href="https://www.simoahava.com/gtm-tips/be-careful-with-the-tracker-name-setting/">rogue referrer</a> problem, where URL query parameters that are used for campaign settings are overwritten by a subsequent page view hit. For Google Tag Manager, the problem of persistence rears its ugly head, where variables maintain the values you set earlier, leading to these values bleeding into subsequent tags.</p>

<p>Browser history is manipulated because when content is dynamically loaded, the site needs to tell the web browser that the user has entered a new page without the benefit of the page reload doing this automatically. Otherwise you wouldn&rsquo;t be able to link to dynamic content, nor would the Back and Forward buttons of the browser find your dynamic content.</p>

<p>The two interfaces you&rsquo;ll run into most often are <code>pushState</code> and <code>replaceState</code>. The former creates a new history entry in the web browser, and the latter replaces the current entry entirely. Here are examples of how to use them:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">history</span>.<span style="color:#a6e22e">pushState</span>(
  {<span style="color:#a6e22e">pageType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;formThankYou&#39;</span>},
  <span style="color:#e6db74">&#39;Form Success&#39;</span>,
  <span style="color:#e6db74">&#39;/thank-you/&#39;</span>
);
</code></pre></div>

<p>When you run this command, the URL changes to /thank-you/ without a page reload. The first two parameters add additional information about the state. If you now click the Back button of the browser, you are taken to the URL where you called <code>pushState</code>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">history</span>.<span style="color:#a6e22e">replaceState</span>(
  {<span style="color:#a6e22e">pageType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;formThankyou&#39;</span>},
  <span style="color:#e6db74">&#39;Form Success&#39;</span>,
  <span style="color:#e6db74">&#39;/thank-you/&#39;</span>
);
</code></pre></div>

<p>When you execute this command, it actually <em>replaces</em> the current page in the browser history. In other words, when you click the browser&rsquo;s Back button, you are taken to the page you were on <em>before</em> you entered the page from where you called <code>replaceState</code>.</p>

<p>Note that if you simply add <strong>#someHash</strong> in the URL, it&rsquo;s the equivalent of calling <code>pushState</code> without the benefit of the other parameters in the interface (e.g. the state object).</p>

<p>In Google Tag Manager, you have a <strong>really</strong> useful Trigger type called the <a href="https://www.simoahava.com/analytics/google-tag-manager-history-listener/">History Change</a> Trigger. It goes off whenever one of the following History events occur:</p>

<ul>
<li><strong>pushState</strong><br /></li>
<li><strong>replaceState</strong><br /></li>
<li><strong>hashchange</strong> (when the #someHash in the URL appears/changes)<br /></li>
<li><strong>popstate</strong> (when the active history entry changes)</li>
</ul>

<p>For example, if you want to build pageviews around these history events, it&rsquo;s quite <a href="https://www.simoahava.com/gtm-tips/track-url-fragments-as-pageviews/">simple to do</a> with the History Change Trigger!</p>

<h3 id="further-reading-4">FURTHER READING</h3>

<p>For more information on the Window History API, look no further than these articles:</p>

<ul>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API">MDN: Manipulating the browser history</a></p></li>

<li><p><a href="http://www.w3schools.com/js/js_window_history.asp">w3schools: JavaScript Window History</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/google-tag-manager-history-listener/">Google Tag Manager History Listener</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/browser-storage.png" title="6. Browser Storage">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/browser-storage.png#ZgotmplZ" alt="6. Browser Storage">
  
    </a>
  
  
</div>



<p>The web page is stateless. With every page load, the <em>entire</em> page is built from scratch. All the variables, JavaScript libraries, HTML templates, CSS files and other resources are loaded again.</p>

<p>In other words, if the web browser needs to know something, <em>anything</em>, about what happened at any time in the past, you need to manually persist this information.</p>

<p>You can persist the information in the web server, and this is often quite a robust way to do it. However, because of how the web is built, you still need a way of aligning any given web browser (and thus, user) with the requests that are sent to the web server.</p>

<p>The web browser provides a number of ways to persist this information. The most common methods are browser cookies, Web Storage, and <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/webstorage.png" title="Browser storage">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/webstorage.png#ZgotmplZ" alt="Browser storage">
  
    </a>
  
  
</div>



<h3 id="browser-cookies">Browser cookies</h3>

<p>Browser cookies are useful for simple storage. The browser cookie is essentially a string stored by the web browser, and its accessible only by pages that share the same parent domain to which the cookie was written. So a cookie written on <strong>www.simoahava.com</strong> would, by default, only be available to pages on <strong>www.simoahava.com</strong>, but you could also write the cookie on <strong>simoahava.com</strong>, where it would be available to all subdomains.</p>

<p>A cookie written on <strong>simoahava.com</strong> would <em>not</em> be available for pages on <strong>derekahava.com</strong>, because they do not share the same domain.</p>

<p>Cookies also survive transitions from the http:// protocol to https://.</p>

<h3 id="web-storage">Web Storage</h3>

<p>Web Storage (or DOM Storage) encompasses both <code>localStorage</code> (no expiration) and <code>sessionStorage</code> (expires when the web browser is closed). Web Storage is much more flexible than using cookies, because the entries are stored as a hash table, and lookups can be done on a key-by-key basis. With cookies, you need to unravel the entire cookie string just to find the value want.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// TO SET
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (window[<span style="color:#e6db74">&#39;Storage&#39;</span>]) {
  <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#39;subscribe&#39;</span>, <span style="color:#e6db74">&#39;true&#39;</span>); 
  <span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">&#39;subscribe&#39;</span>, <span style="color:#e6db74">&#39;true&#39;</span>);
} <span style="color:#66d9ef">else</span> {
  <span style="color:#a6e22e">setCookie</span>(<span style="color:#e6db74">&#39;subscribe&#39;</span>, <span style="color:#e6db74">&#39;true&#39;</span>);
}

<span style="color:#75715e">// TO FETCH
</span><span style="color:#75715e"></span><span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;subscribe&#39;</span>);
<span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">&#39;subscribe&#39;</span>);
</code></pre></div>

<p>Note that Web Storage does <em>not</em> survive the transition from http:// to https://. Both protocols have their own storage.</p>

<h3 id="indexeddb">IndexedDB</h3>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a> is much more complex than the aforementioned methods, and is thus more suited for application logic on a much larger scale. For example, if you&rsquo;re using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API">Service Workers</a> to maintain offline browsing capabilities, IndexedDB is an excellent utility to maintain state while waiting for the internet connection to come back up.</p>

<p>Checkout the link to my article on persisting data in Google Tag Manager for more information (and some tips) on how to setup cookie and Web Storage persistence in GTM!</p>

<h3 id="further-reading-5">FURTHER READING</h3>

<p>Check out the following links for more information:</p>

<ul>
<li><p><a href="http://www.w3schools.com/js/js_cookies.asp">w3schools: JavaScript Cookies</a></p></li>

<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">MDN: Web Storage API</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/two-ways-to-persist-data-via-google-tag-manager/">Two Ways To Persist Data Via Google Tag Manager</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/dom-traversal-1.png" title="7. DOM traversal">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/dom-traversal-1.png#ZgotmplZ" alt="7. DOM traversal">
  
    </a>
  
  
</div>



<p>Locating elements on the page is one of the more obvious use cases for web analytics. Most commonly we want to know if some specific element was the target of a user action such as a click or form submission.</p>

<p>In Google Tag Manager, identifying an element is easy enough with CSS selectors, but what if we actually want to <em>retrieve</em> some element other than what GTM initially gave us?</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/dom-traversal.png" title="DOM traversal example">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/dom-traversal.png#ZgotmplZ" alt="DOM traversal example">
  
    </a>
  
  
</div>



<p>There are many ways to retrieve an element relative to some other with JavaScript. A very clumsy way to do it would be to build a complete element chain all between the two elements. So if you wanted to retrieve the element at the top of the DOM in the image above, you could do something like this in a Custom JavaScript Variable:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// Please don&#39;t do this:
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}}
    .<span style="color:#a6e22e">parentElement</span>
    .<span style="color:#a6e22e">parentElement</span>
    .<span style="color:#a6e22e">parentElement</span>
    .<span style="color:#a6e22e">parentElement</span>
    .<span style="color:#a6e22e">parentElement</span>;
}
</code></pre></div>

<p>But please don&rsquo;t do this. It&rsquo;s clumsy and it has multiple points of failure. You&rsquo;re basically expecting the DOM to have a certain structure without providing any redundancies or fallbacks. The longer the chain, the more sensitive it is to even minor changes to the page markup.A better way is to disregard the actual number of elements, and just climb up the DOM until you reach the very top.</p>

<p>So a more robust way of retrieving the element would be something like this:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}};
  
  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;content-sidebar-wrap&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">tagName</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;BODY&#39;</span>) {
    <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">parentElement</span>;
  }

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">tagName</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;BODY&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>;
}
</code></pre></div>

<p>This little script simply climbs up the DOM until it either reaches the element you wanted (<code>.content-sidebar-wrap</code>) or the <code>&lt;body&gt;</code> tag. If it reaches <code>&lt;body&gt;</code>, the assumption is that the element you were looking for was not found, and <code>undefined</code> is returned instead.</p>

<p>Note that this script only works for direct ancestry. If you want to find sibling elements or elements which branch from the direct path between the original element and the root of the document, you might want to leverage frameworks like jQuery to make DOM traversal code more economic.</p>

<h3 id="further-reading-6">FURTHER READING</h3>

<p>Follow these links to find more information on DOM traversal:</p>

<ul>
<li><p><a href="http://www.w3schools.com/js/js_htmldom_navigation.asp">w3schools: JavaScript HTML DOM Navigation</a></p></li>

<li><p><a href="http://domenlightenment.com">DOM Enlightenment</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/node-relationships-gtm/">Node Relationships And GTM</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/css-selectors.png" title="8. CSS Selectors">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/css-selectors.png#ZgotmplZ" alt="8. CSS Selectors">
  
    </a>
  
  
</div>



<p>When Google Tag Manager introduced the <a href="https://www.simoahava.com/analytics/matches-css-selector-operator-in-gtm-triggers/">matches CSS selector</a> Trigger operator a while ago, it eliminated a lot of complexity from validating Triggers to only fire for certain HTML element interactions. In a similar manner, the <code>querySelector</code> and <code>querySelectorAll</code> JavaScript DOM methods were just as impactful when they were introduced some years ago into the web browser API.</p>

<p>If you&rsquo;ve built websites or worked with CSS (Cascading Style Sheets) styles before, you&rsquo;ll know what selectors do. They let you select any element or group of elements on the page, and then apply a style to them. For example, the following style declaration would remove the default <em>underline</em> from all links (<code>&lt;a&gt;</code>) with class <code>internal</code>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">a</span>.<span style="color:#a6e22e">internal</span> {
    <span style="color:#66d9ef">text-decoration</span>: <span style="color:#66d9ef">none</span>;
}</code></pre></div>

<p>Because it&rsquo;s such an effective way of selecting HTML elements, it&rsquo;s not a big surprise that JavaScript introduced methods for using CSS selectors to find and retrieve HTML elements on the page:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Select every link with attribute data-gtm on the page:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gtmLinks</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;a[data-gtm]&#39;</span>);

<span style="color:#75715e">// Select the first &#39;h2&#39; element on the page, which is the direct child of &#39;section&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">firstH2</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;section &gt; h2&#39;</span>);

<span style="color:#75715e">// Select the &#39;span&#39; with class &#39;title&#39; that is a descendant of the aforementioned &#39;h2&#39;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">spanTitle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">firstH2</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;span.title&#39;</span>);
</code></pre></div>

<p>Similarly, if you already <em>have</em> an HTML element, you can use the <code>matches</code> API to check if it matches a specific CSS selector:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">isElementLink</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">el</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#39;a&#39;</span>);
}
</code></pre></div>

<p>The function above would return <code>true</code> or <code>false</code>, depending on whether the element passed as a parameter is a link or not. Note that <code>matches</code> isn&rsquo;t widely supported yet, but there&rsquo;s a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/matches#Polyfill">polyfill you can use</a> to make it work across all browsers.</p>

<p>In Google Tag Manager, the <a href="https://www.simoahava.com/analytics/matches-css-selector-operator-in-gtm-triggers/">matches CSS selector</a> is ridiculously useful. You can use it to fire your Triggers only when a specific element is the target of the interaction. For example, I could configure a Click / All Elements Trigger like the following to make it only fire when the clicked element is a specific <code>&lt;span&gt;</code> (or any of its nested descendants) on the page!</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/gtm-css.png" title="matches CSS selector in GTM">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/gtm-css.png#ZgotmplZ" alt="matches CSS selector in GTM">
  
    </a>
  
  
</div>



<p>CSS selectors shave a crazy amount of time off your JavaScript, as you don&rsquo;t have to write clumsy comparison queries using DOM traversal when trying to identify a specific element. Take a look at the further reading links below to learn more about CSS selectors!</p>

<h3 id="further-reading-7">FURTHER READING</h3>

<p>More stuff about CSS selectors:</p>

<ul>
<li><p><a href="http://www.w3schools.com/cssref/css_selectors.asp">w3schools: CSS Selectors Reference</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/matches-css-selector-operator-in-gtm-triggers/">Matches CSS Selector Operator In GTM Triggers</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/jquery.png" title="9. jQuery">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/jquery.png#ZgotmplZ" alt="9. jQuery">
  
    </a>
  
  
</div>



<p><a href="http://jquery.com/">jQuery</a> is undoubtedly the most used JavaScript library in the world, and its contributions to standardizing the web experience across browsers and devices should not and do not go unnoticed. The framework provides such a wealth of utilities that trivialize and abstract many of the woes a web developer might have when developing their site to be as accessible across the splintered browser landscape as possible.</p>

<p>In short, jQuery is a library which provides a bunch of simple APIs to perform otherwise complex tasks. For example, let&rsquo;s take the DOM traversal example from chapter 7 and rewrite it with jQuery:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Vanilla JS
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}};
  
  <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;content-sidebar-wrap&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">tagName</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;BODY&#39;</span>) {
    <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">parentElement</span>;
  }

  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">tagName</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;BODY&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>;
}

<span style="color:#75715e">// jQuery
</span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">jQuery</span>({{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}}).<span style="color:#a6e22e">closest</span>(<span style="color:#e6db74">&#39;.content-sidebar-wrap&#39;</span>)[<span style="color:#ae81ff">0</span>];
}
</code></pre></div>

<p>So a single line of jQuery abstracted the previous implementation.</p>

<p>Similarly, here&rsquo;s the difference between building a custom HTTP POST request using regular JavaScript versus using jQuery:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Vanilla JS
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v=1&amp;tid=UA-12345-1&amp;t=pageview&amp;dl=https://www.simoahava.com/&amp;cid=12345.12345&#39;</span>;

<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;POST&#39;</span>, <span style="color:#e6db74">&#39;https://www.google-analytics.com/collect&#39;</span>);
<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">setRequestHeader</span>(<span style="color:#e6db74">&#39;Content-Type&#39;</span>, <span style="color:#e6db74">&#39;application/x-www-form-urlencoded&#39;</span>);
<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">200</span>) {
    <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Yay!&#39;</span>);
  }
  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">200</span>) {
    <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Aww :(&#39;</span>);
  }
};
<span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">send</span>(encodeURI(<span style="color:#a6e22e">payload</span>));

<span style="color:#75715e">// jQuery
</span><span style="color:#75715e"></span><span style="color:#a6e22e">jQuery</span>.<span style="color:#a6e22e">post</span>(
  <span style="color:#e6db74">&#39;https://www.google-analytics.com/collect&#39;</span>,
  <span style="color:#e6db74">&#39;v=1&amp;tid=UA-12345-1&amp;t=pageview&amp;dl=https://www.simoahava.com/&amp;cid=12345.12345&#39;</span>
)
  .<span style="color:#a6e22e">done</span>(<span style="color:#66d9ef">function</span>() {
    <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Yay!&#39;</span>);
  })
  .<span style="color:#a6e22e">fail</span>(<span style="color:#66d9ef">function</span>() {
    <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Aww :(&#39;</span>);
  });
</code></pre></div>

<p>I hope you see the trend here. jQuery really makes things more elegant for both the developer as well as for anyone who wants to look at the code and quickly understand what it tries to do.</p>

<p>jQuery isn&rsquo;t all-powerful, though, and relying too much on a framework can make your code weak. My suggestion is to always understand what a given jQuery method does before using it. That way you&rsquo;ll know what the background process is, and you&rsquo;ll learn to avoid nasty surprises such as how <a href="https://www.simoahava.com/gtm-tips/fix-problems-with-gtm-listeners/">jQuery&rsquo;s <code>return false;</code> in event handlers can break GTM&rsquo;s listeners</a>!</p>

<p>Remember also to be wary of race conditions when loading jQuery.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/jquery-load.png" title="jQuery race conditions">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/jquery-load.png#ZgotmplZ" alt="jQuery race conditions">
  
    </a>
  
  
</div>



<p>If you load the library asynchronously, it might not be ready by the time you refer to it in your GTM Tags.</p>

<h3 id="further-reading-8">FURTHER READING</h3>

<p>And here&rsquo;s the scoop on jQuery:</p>

<ul>
<li><p><a href="https://api.jquery.com/">jQuery API Documentation</a></p></li>

<li><p><a href="https://www.codecademy.com/learn/jquery">Codecademy: jQuery</a></p></li>
</ul>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/data-layer.png" title="10. Data Layer">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/data-layer.png#ZgotmplZ" alt="10. Data Layer">
  
    </a>
  
  
</div>



<p>Finally, the Data Layer. If you&rsquo;ve used GTM or any tag management solution, it&rsquo;s probably you&rsquo;ve had to really put some thought into understanding how tag management solutions leverage the Data Layer to communicate with the website or other digital property.</p>

<p>It&rsquo;s not purely a JavaScript concept, so it&rsquo;s kind of a black sheep in this mix. Nevertheless, the most typical implementation of a Data Layer, when it comes to tag management solutions, is an Array-type data structure in the global namespace.</p>

<p>I&rsquo;ve written about Data Layer quite a lot on this blog, so instead of repeating what I&rsquo;ve already written far more extensively, I want to direct you to the links below and I strongly suggest you read through them to get a better idea of how the Data Layer works.</p>

<h3 id="further-reading-9">FURTHER READING</h3>

<p>Be sure to check these links out for more information on the Data Layer:</p>

<ul>
<li><p><a href="https://www.simoahava.com/analytics/data-layer/">The Data Layer</a></p></li>

<li><p><a href="https://www.simoahava.com/analytics/google-tag-manager-data-model/">Google Tag Manager&rsquo;s Data Model</a></p></li>

<li><p><a href="https://github.com/google/data-layer-helper">GitHub: google/data-layer-helper</a></p></li>
</ul>

<h2 id="summary">Summary</h2>

<p>The ten JavaScript concepts introduced in this article are, what I consider, the most useful tools that any web analyst would need to know about. Heck, I consider these vital to anyone working with the web, not just analysts!</p>

<p>The thing is, we&rsquo;re working in an extremely technical medium. The web browser is tantalizingly complex in all its machinations, and it doesn&rsquo;t really help that all web browsers act slightly differently when it comes to producing the web document into our screens.</p>

<p>When working with web analytics, we are trying to decipher the abstract signals sent by users, web servers, the browser itself, and background processes, as we do our best to align these signals with their real-world counterparts.</p>

<p>It&rsquo;s not easy!</p>

<p>Trying to deconstruct the enormously difficult concepts of &ldquo;intent&rdquo;, &ldquo;engagement&rdquo;, and &ldquo;interaction&rdquo; using a handful of JavaScript handlers seems like a fool&rsquo;s errand, but it&rsquo;s the only thing we can do when creating an implementation framework for any given web application.</p>

<p>But the more we know about JavaScript and the numerous APIs that the web browser lets us tap into, the more we can uncover about our visitors and their actions on the site.</p>

<p>I hope you found these tips useful. Do you have other JavaScript concepts that you consider are absolutely essential for anyone working with the web to acquaint themselves with?</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/education/">education</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debug-change-history-gtm/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/revamped-user-interface-in-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=10%20JavaScript%20Concepts%20For%20Web%20Analytics%20Implementation%20https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debug-change-history-gtm/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/revamped-user-interface-in-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=10%20JavaScript%20Concepts%20For%20Web%20Analytics%20Implementation%20https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=10%20JavaScript%20Concepts%20For%20Web%20Analytics%20Implementation%20https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/10-javascript-concepts-for-web-analytics-implementation/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

