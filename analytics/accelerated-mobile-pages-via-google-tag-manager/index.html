

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Accelerated Mobile Pages Via Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2016\/11\/gtm-amp-container.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/accelerated-mobile-pages-via-google-tag-manager\/",
  "datePublished": "2016-11-10T08:09:09\u002b00:00",
  "dateModified": "2016-11-10T08:09:09\u002b00:00",
  "description": "Guide on how to set up Accelerated Mobile Pages (AMP) tracking using Google Tag Manager\u0027s new AMP container.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Accelerated Mobile Pages Via Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/accelerated-mobile-pages-via-google-tag-manager/">
    
    <meta name="description" content="Guide on how to set up Accelerated Mobile Pages (AMP) tracking using Google Tag Manager&#39;s new AMP container.">
    <meta property="og:description" content="Guide on how to set up Accelerated Mobile Pages (AMP) tracking using Google Tag Manager&#39;s new AMP container.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Accelerated Mobile Pages Via Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Accelerated Mobile Pages Via Google Tag Manager">
    <meta name="twitter:description" content="Guide on how to set up Accelerated Mobile Pages (AMP) tracking using Google Tag Manager&#39;s new AMP container.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2016/11/gtm-amp-container.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2016/11/gtm-amp-container.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Accelerated Mobile Pages Via Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2016-11-10T08:09:09Z">
        
  November 10, 2016

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p><a href="https://tagmanager.google.com/">Google Tag Manager</a> recently <a href="https://analytics.googleblog.com/2016/10/google-tag-manager-giving-mobile.html">published support</a> for <a href="https://www.ampproject.org/">Accelerated Mobile Pages</a> (AMP). This support comes in the form of a new Container type in Google Tag Manager.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/gtm-amp-container.jpg" title="Google Tag Manager AMP container">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/gtm-amp-container.jpg#ZgotmplZ" alt="Google Tag Manager AMP container" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1524 606'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>When you create an AMP container in GTM, you are actually setting up an external configuration for AMP, which leverages AMP&rsquo;s own <a href="https://www.ampproject.org/docs/reference/components/amp-analytics">analytics module</a>. As befits Google Tag Manager, creating the configuration is done in the familiar Google Tag Manager user interface, and you have (almost) all the tools of regular Google Tag Manager at your disposal.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/reg-amp.jpg" title="reg-amp">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/reg-amp.jpg#ZgotmplZ" alt="reg-amp" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1646 1362'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In this article, I want to go over how AMP and GTM mesh together to provide your mobile pages with improved tracking capabilities.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[â€“hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#1-amp-overview">1. AMP Overview</a>
      <ul>
        <li>
          <ul>
            <li><a href="#creating-an-amp-site">Creating an AMP site</a></li>
            <li><a href="#amp-and-google-search">AMP and Google search</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-amp-analytics">2. AMP Analytics</a>
      <ul>
        <li>
          <ul>
            <li><a href="#add-amp-analytics-to-your-website">Add amp-analytics to your website</a></li>
            <li><a href="#load-the-json-configuration-object-as-an-external-resource">Load the JSON configuration object as an external resource</a></li>
          </ul>
        </li>
        <li><a href="#21-client-id">2.1. Client ID</a>
          <ul>
            <li><a href="#client-id-and-amp">Client ID and AMP</a></li>
            <li><a href="#hacking-to-create-a-single-unified-client-id">Hacking to create a single, unified Client ID</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-create-and-implement-gtmamp-container">3. Create and implement GTM/AMP container</a>
      <ul>
        <li>
          <ul>
            <li><a href="#deploying-the-amp-container">Deploying the AMP container</a></li>
            <li><a href="#do-not-forget-gtmurl">Do not forget <code>gtm.url</code></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-triggers">4. Triggers</a>
      <ul>
        <li><a href="#41-click">4.1. Click</a></li>
        <li><a href="#42-page-view">4.2. Page View</a></li>
        <li><a href="#43-scroll">4.3. Scroll</a></li>
        <li><a href="#44-timer">4.4. Timer</a></li>
        <li><a href="#45-visibility">4.5. Visibility</a></li>
      </ul>
    </li>
    <li><a href="#5-variables">5. Variables</a>
      <ul>
        <li><a href="#51-built-in-variables">5.1. Built-In Variables</a></li>
        <li><a href="#52-user-defined-variables">5.2. User-Defined variables</a>
          <ul>
            <li><a href="#url">URL</a></li>
            <li><a href="#amp-variable">AMP variable</a></li>
            <li><a href="#constant">Constant</a></li>
            <li><a href="#environment-name">Environment Name</a></li>
            <li><a href="#lookup-table">Lookup Table</a></li>
            <li><a href="#random-number">Random Number</a></li>
            <li><a href="#container-id">Container ID</a></li>
            <li><a href="#container-version">Container Version</a></li>
          </ul>
        </li>
        <li><a href="#53-amp-variables">5.3. AMP variables</a>
          <ul>
            <li><a href="#creating-custom-amp-variables">Creating custom AMP variables</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#6-other-google-tag-manager-quirks">6. Other Google Tag Manager quirks</a></li>
    <li><a href="#7-summary">7. Summary</a></li>
  </ul>
</nav></div>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="1-amp-overview">1. AMP Overview</h2>
<p>Accelerated Mobile Pages is an open-source project, and you can read all about it at <a href="https://www.ampproject.org/">https://www.ampproject.org/</a>. In a nutshell, it&rsquo;s a set of structural instructions for building web pages, where focus is on speed and performance, without sacrificing too much UI/UX along the way.</p>
<p>AMP is based on a number of design principles that might ring true to you if you&rsquo;ve ever pondered about website performance. Things like <a href="https://www.ampproject.org/learn/how-amp-works/#allow-only-asynchronous-scripts"><strong>asynchronous resource loading</strong></a>, <a href="https://www.ampproject.org/learn/how-amp-works/#all-css-must-be-inline-and-size-bound"><strong>inline CSS styling</strong></a>, <a href="https://www.ampproject.org/learn/how-amp-works/#font-triggering-must-be-efficient"><strong>web font optimization</strong></a> and <a href="https://www.ampproject.org/learn/how-amp-works/#load-pages-in-an-instant"><strong>optimized pre-rendering of pages</strong></a> are some of the features that AMP relies on to provide users with content super fast.</p>
<h4 id="creating-an-amp-site">Creating an AMP site</h4>
<p><a href="https://www.ampproject.org/docs/get_started/create">Creating an AMP version of your site</a> isn&rsquo;t just a plug-and-play affair. You need to rewrite the HTML, JavaScript, and CSS styles to match the AMP design principles. If you&rsquo;re using a platform like <a href="https://wordpress.org/">WordPress</a>, there are <a href="https://wordpress.org/plugins/search.php?q=accelerated+mobile+pages">plugins</a> available that do most of the configuration for you. And here&rsquo;s a great tip for AMP development work: anytime you are browsing an AMP page, you can add the URL hash <code>#development=1</code> to the URL to validate your AMP page, outputting the result of the validation into your browser&rsquo;s <a href="http://webmasters.stackexchange.com/a/77337/66450">JavaScript Console</a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/amp-validation.jpg" title="AMP validation">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/amp-validation.jpg#ZgotmplZ" alt="AMP validation" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2026 648'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<h4 id="amp-and-google-search">AMP and Google search</h4>
<p>Finally, if you&rsquo;ve setup your site with AMP pages, it&rsquo;s a good idea to follow the <a href="https://support.google.com/webmasters/answer/6340290?hl=en">Google Search Guidelines</a> for informing the search engine about your site&rsquo;s new mobile structure. Google will attempt to direct mobile searches of your site to the corresponding AMP pages, thus providing mobile visitors with fast, optimized access to your precious content.</p>
<p>If you want to see what AMP pages look like, you can visit any article on this site, and add <code>/amp/</code> to the URL (e.g. <a href="https://www.simoahava.com/amp/analytics/accelerated-mobile-pages-via-google-tag-manager/">https://www.simoahava.com/amp/analytics/accelerated-mobile-pages-via-google-tag-manager/</a>.</p>

                
                  <h2 id="2-amp-analytics">2. AMP Analytics</h2>
<p>The Google Tag Manager AMP container leverages the <a href="https://www.ampproject.org/docs/reference/components/amp-analytics">amp-analytics</a> component. This component, developed within the AMP project, provides a light-weight framework for analytics requests sent either via a number of built-in vendor templates, or to a custom endpoint of your choosing.</p>
<p>The amp-analytics framework is managed by a <strong>JSON configuration object</strong>, where you specify details of the endpoint you want to send the data to, as well as <em>variables</em> and <em>triggers</em> (sound familiar?) that govern what analytics requests are sent and when.</p>
<p>Even though the <a href="https://www.ampproject.org/docs/reference/components/amp-analytics">amp-analytics documentation</a> isn&rsquo;t particularly long or complex, there&rsquo;s still many things to consider when configuring a custom tracking scheme. That&rsquo;s why it&rsquo;s very useful to have pre-built templates for a number of analytics vendors (e.g. Google Analytics, Adobe Analytics, Snowplow Analytics).</p>
<h4 id="add-amp-analytics-to-your-website">Add amp-analytics to your website</h4>
<p>To add support for the analytics component on your site, you need to add the following line of code into the <code>&lt;head&gt;</code> of your document:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">async</span> <span style="color:#1e90ff">custom-element</span>=<span style="color:#a50">&#34;amp-analytics&#34;</span> <span style="color:#1e90ff">src</span>=<span style="color:#a50">&#34;https://cdn.ampproject.org/v0/amp-analytics-0.1.js&#34;</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>This loads the AMP analytics library, and instructs the page to look for an element named <code>&lt;amp-analytics&gt;</code>. This custom element is where you introduce the <em>JSON configuration object</em> that will eventually govern how the site is tracked.</p>
<p>Google Analytics has a great <a href="https://developers.google.com/analytics/devguides/collection/amp-analytics/">developer guide</a> for setting up the <em>JSON configuration object</em> manually. For example, to send a Page View hit to Google Analytics when the page is loaded, you&rsquo;d add the following element to the <code>&lt;body&gt;</code> of the site:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;googleanalytics&#34;</span> <span style="color:#1e90ff">id</span>=<span style="color:#a50">&#34;analytics1&#34;</span>&gt;
&lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;application/json&#34;</span>&gt;
{
  <span style="color:#a50">&#34;vars&#34;</span>: {
    <span style="color:#a50">&#34;account&#34;</span>: <span style="color:#a50">&#34;UA-XXXXX-Y&#34;</span>
  },
  <span style="color:#a50">&#34;triggers&#34;</span>: {
    <span style="color:#a50">&#34;trackPageview&#34;</span>: {
      <span style="color:#a50">&#34;on&#34;</span>: <span style="color:#a50">&#34;visible&#34;</span>,
      <span style="color:#a50">&#34;request&#34;</span>: <span style="color:#a50">&#34;pageview&#34;</span>
    }
  }
}
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>
<p>As you can see, you&rsquo;re using the custom element <code>&lt;amp-analytics&gt;</code> that you specified when adding the initial script loader to the <code>&lt;head&gt;</code> of your page. The <code>type</code> parameter of the element specifies that you are using the built-in <code>googleanalytics</code> vendor template.</p>
<p>Be sure to check out <a href="https://www.bounteous.com/insights/2015/12/08/google-analytics-using-amp/">Bounteous&rsquo; excellent guide</a> for Google Analytics and AMP integration!</p>
<h4 id="load-the-json-configuration-object-as-an-external-resource">Load the JSON configuration object as an external resource</h4>
<p>You can also load the <em>JSON configuration object</em> from an external source (as long as the request adheres to <a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-cors-requests.md">AMP CORS security guidelines</a>). For example, the Google Tag Manager &ldquo;container&rdquo; is actually a request to an external config file that you specify like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">config</span>=<span style="color:#a50">&#34;https://www.googletagmanager.com/amp.json?id=GTM-XXXXXX&amp;amp;gtm.url=SOURCE_URL&#34;</span> <span style="color:#1e90ff">data-credentials</span>=<span style="color:#a50">&#34;include&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;application/json&#34;</span>&gt;
  {
    <span style="color:#a50">&#34;vars&#34;</span>: {
      <span style="color:#a50">&#34;someCustomAmpVar&#34;</span>: <span style="color:#a50">&#34;someValue&#34;</span>
    }
  }
  &lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>
<p>This downloads a file named <code>amp.json</code>, specified by using your container ID, and the <code>data-credentials</code> attribute allows the resource request to read and write cookies as needed. The <code>&lt;script&gt;</code> block within the <code>amp-analytics</code> element can be used to use your own custom AMP variables on the page.</p>
<p><strong>Note that the external config file download will only begin if the page is visible in the viewport!</strong> For example, if you open an AMP page with a remote configuration link in a new browser window without making that window active, the configuration file download will wait until such a moment that the page becomes visible. This means that your analytics tracking will not commence until the page is visible in the browser.</p>
<p>Anyway, back to the <em>JSON configuration object</em>. It details what interactions and events are tracked to the analytics endpoint of your choosing, when they are tracked, and how. I recommend you read through the <a href="https://www.ampproject.org/docs/reference/components/amp-analytics">AMP Analytics documentation</a>, as it sheds quite a bit of light on how the GTM AMP container works, too.</p>
<p>AMP Analytics with its <em>JSON configuration object</em> is quite far removed from the dynamic execution context of JavaScript and the Document Object Model. However, you should respect the fact that all compromises are done in favor of improved performance. I hope some of the AMP Analytics methodology would rub off on the bloated, performance-killing, dynamic mess that &ldquo;modern&rdquo;, JavaScript-based web analytics so often is.</p>
<h3 id="21-client-id">2.1. Client ID</h3>
<p>Before we move on to how the GTM AMP container works, we need to talk about Client ID. You can skip this chapter if all you want to do is get Google Tag Manager up and running on your AMP site.</p>
<p>Google Analytics uses the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookies-user-id">Client ID</a> parameter to align hits with the users who sent the hits. This ID is stored in a first-party cookie named <code>_ga</code>. Thus, every time you visit a website running Google Analytics, this cookie is used to make sure all the hits you send are tied together with your previous visits.</p>
<p>First-party cookies can only be written on the domain you are currently on. Consequently, if you want to travel from one domain to another and still maintain all your hits under the same Client ID, you will need to <a href="https://support.google.com/analytics/answer/1034342?hl=en">somehow</a> pass your cookie value from one domain to another without violating the restriction outlined in the first sentence of this paragraph.</p>
<h4 id="client-id-and-amp">Client ID and AMP</h4>
<p>With AMP, things are slightly more difficult. AMP Analytics does not use the <code>_ga</code> cookie by default, even though you can <a href="https://www.ampproject.org/docs/guides/analytics/analytics_basics#user-identification">set it up</a> so that AMP falls back to <code>_ga</code> if one is found. But even if you do set it up to use <code>_ga</code>, what if the user browses the AMP page via Google search or the AMP CDN? Both cache your content in an external domain (<strong><a href="http://www.google.com">www.google.com</a></strong> and <strong>cdn.ampproject.org</strong>, respectively), which means that they will not be able to access any cookies written on your domain. Also, AMP&rsquo;s default <a href="https://www.ampproject.org/docs/guides/analytics/analytics_basics#user-identification">Client ID syntax</a> is vastly different from the one used by Google Analytics.</p>
<p>This all means that even if you did manage to use your existing <code>_ga</code> cookie as the Client ID in AMP pages on your site, it&rsquo;s not enough. You see, if the user lands on your AMP page via Google search, which is probably the most typical use case, they&rsquo;ll actually visit a cached version of your page on <strong><a href="http://www.google.com">www.google.com</a></strong>. This means that no <code>_ga</code> cookie is found, and AMP defaults back to a random, unique ID.</p>
<h4 id="hacking-to-create-a-single-unified-client-id">Hacking to create a single, unified Client ID</h4>
<p>There are workarounds, and thanks to some brainstorming with the inimitable Dan Wilkerson from Bounteous (who already wrote an <a href="https://www.bounteous.com/insights/2015/12/08/google-analytics-using-amp/">excellent guide for Google Analytics and AMP</a>), here&rsquo;s one suggestion that I&rsquo;ll probably expand in a later article.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/http-process.jpg" title="HTTP Process with custom API">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/http-process.jpg#ZgotmplZ" alt="HTTP Process with custom API" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1678 1192'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Here&rsquo;s how this particular solution works:</p>
<ol>
<li>
<p>Instead of fetching the GTM container directly, the request is sent to a custom HTTP endpoint you need to set up on your website&rsquo;s domain.</p>
</li>
<li>
<p>This API serves a cached version of the GTM container, or fetches the most recent version if the cache has expired.</p>
</li>
<li>
<p>Instead of using the default, random Client ID which AMP Analytics uses, Client ID is retrieved from the <code>_ga</code> cookie written on the domain of the REST API, i.e. your website.</p>
</li>
<li>
<p>If no cookie is found, a new one is created.</p>
</li>
<li>
<p>The <code>_ga</code> value is returned in the <code>Set-Cookie</code> HTTP Response Header, so that the cookie will be written on the domain which originated the request (e.g. <a href="http://www.google.com">www.google.com</a> or cdn.ampproject.org).</p>
</li>
<li>
<p>The HTTP Response also contains the <em>JSON configuration object</em> (with the new Client ID) used by the site to set AMP Analytics up.</p>
</li>
</ol>
<p>In other words, you&rsquo;re creating a proxy on your web server, which relays requests for the Google Tag Manager container, while modifying the container so that it includes (or creates) the Client ID used by Google Analytics.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/modified-set-cookie.jpg" title="Modified Set-Cookie Header">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/modified-set-cookie.jpg#ZgotmplZ" alt="Modified Set-Cookie Header" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2112 90'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>It&rsquo;s convoluted, yes, and there might be easier ways to handle this, but for now it lets you stitch together AMP traffic with other on-site traffic, such as desktop visits to non-AMP pages. For some publishers, and especially for ecommerce sites, this is vital.</p>

                
                  <h2 id="3-create-and-implement-gtmamp-container">3. Create and implement GTM/AMP container</h2>
<p>As mentioned earlier, the Google Tag Manager AMP container is essentially a remote <em>JSON configuration object</em> that AMP Analytics uses for tracking interactions on your page.</p>
<p>Also, there is no <code>dataLayer</code>. Any custom variables you want to pass from the page to the <em>JSON configuration object</em> need to be included in the <code>&lt;script&gt;</code> block within the <code>amp-analytics</code> element:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">config</span>=<span style="color:#a50">&#34;https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&amp;amp;gtm.url=SOURCE_URL&#34;</span> <span style="color:#1e90ff">data-credentials</span>=<span style="color:#a50">&#34;include&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;application/json&#34;</span>&gt;
  {
    <span style="color:#a50">&#34;vars&#34;</span>: {
      <span style="color:#a50">&#34;gaTrackingId&#34;</span>: <span style="color:#a50">&#34;UA-12345-1&#34;</span>
    }
  }
  &lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/customamp-variable.jpg" title="Custom AMP Variable">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/customamp-variable.jpg#ZgotmplZ" alt="Custom AMP Variable" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 676 406'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The benefit of using Google Tag Manager is that you can use the trusted user interface to configure your AMP container just as you&rsquo;d configure your web container. All the supported vendor templates are available as tags, so creating a request for your endpoint is quite simple.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/gtm-templates-1.jpg" title="Google Tag Manager tag templates">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/gtm-templates-1.jpg#ZgotmplZ" alt="Google Tag Manager tag templates" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1236 751'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Once you&rsquo;re done configuring, you need to hit the PUBLISH button, and the AMP Analytics <em>JSON configuration object</em> will be updated automatically for all web visitors.</p>
<p>AMP containers are a new selection option in the container creation dialog:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/create-amp.jpg" title="Create AMP Container">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/create-amp.jpg#ZgotmplZ" alt="Create AMP Container" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1502 544'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Once you&rsquo;ve created the container, you might want to click the PUBLISH button, and publish a base container version. It&rsquo;s OK that you&rsquo;re not serving any tags yet; you just need to publish the container once to make sure it doesn&rsquo;t respond with a 404 when accessed by your site.</p>
<p>Now that you&rsquo;ve created your AMP container, you need to deploy it.</p>
<h4 id="deploying-the-amp-container">Deploying the AMP container</h4>
<p>AMP Analytics consists of two parts: the amp-analytics JavaScript library and the <em>JSON configuration object</em>. To deploy AMP Analytics via Google Tag Manager, you will need to implement both in your page templates.</p>
<p>First, the library. In AMP, it&rsquo;s actually called an <a href="https://github.com/ampproject/amphtml/blob/master/extensions/README.md">Extended Component</a> of the AMP HTML schema. For AMP Analytics to work, you <strong>must</strong> deploy the following in the <code>&lt;head&gt;</code> of your website:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">async</span> <span style="color:#1e90ff">custom-element</span>=<span style="color:#a50">&#34;amp-analytics&#34;</span> <span style="color:#1e90ff">src</span>=<span style="color:#a50">&#34;https://cdn.ampproject.org/v0/amp-analytics-0.1.js&#34;</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>This loads the AMP Analytics library asynchronously. As you can see, you are also foreshadowing the existence of a custom AMP HTML element named <code>amp-analytics</code>.</p>
<p>The next thing you need to do is tell the page where to load the remote <em>JSON configuration object</em> from. If you recall, this is your Google Tag Manager AMP container, so you <strong>must</strong> add the following code into the <strong><body></strong> of your website:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">config</span>=<span style="color:#a50">&#34;https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&amp;amp;gtm.url=SOURCE_URL&#34;</span> <span style="color:#1e90ff">data-credentials</span>=<span style="color:#a50">&#34;include&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;application/json&#34;</span>&gt;
  {
    <span style="color:#a50">&#34;vars&#34;</span>: {
      <span style="color:#a50">&#34;someAmpVariable&#34;</span>: <span style="color:#a50">&#34;someValue&#34;</span>
    }
  }
  &lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>
<p>This is the custom <code>amp-analytics</code> element we were just talking about. The value of the <code>config</code> attribute is a reference to your GTM container, and the <code>data-credentials=&quot;include&quot;</code> part is important, as it gives permission for the downloaded configuration to read and write cookies on your domain. You can pass custom AMP variables to the <em>JSON configuration object</em> by using the embedded <code>&lt;script&gt;</code> block as shown.</p>
<p>Note that if you went ahead and implemented the Client ID hack I introduced earlier (if even possible from my crazy complicated description), you&rsquo;d need to replace the reference to Google Tag Manager&rsquo;s servers with your own custom endpoint, e.g.:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">config</span>=<span style="color:#a50">&#34;https://www.simoahava.com/wp-json/amp-gtm/amp.json?id=GTM-5BH2HM&amp;amp;gtm.url=SOURCE_URL&#34;</span> <span style="color:#1e90ff">data-credentials</span>=<span style="color:#a50">&#34;include&#34;</span>&gt;&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>
<h4 id="do-not-forget-gtmurl">Do not forget <code>gtm.url</code></h4>
<p>The <code>&amp;gtm.url</code> parameter is important. By adding <strong>SOURCE_URL</strong> as its value, you are instructing AMP to resolve a <a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#source-url">platform variable</a> as the value of the <code>gtm.url</code> parameter. This particular platform variable is automatically substituted with the URL of the website from which the request was made. If the page is served from a known proxy, such as the AMP Cache, it will still resolve to the actual URL of the website whose content is being served.</p>
<p>This parameter is significant, as it provides a <em>source URL</em> for the GTM container, which you can then utilize the enable triggers only on certain pages of your site.</p>
<p>Once you&rsquo;ve done these steps, you are ready start configuring your tracking! On the surface and in the UI, things might seem all too familiar. You&rsquo;ll create your tags just as you used to, filling the fields as before, so it&rsquo;s as if nothing&rsquo;s changed.</p>
<p>By the way, if this is all new to you, remember to check out these excellent <a href="https://www.simoahava.com/gtm-tips/gtmtips-10-blogs-10-articles-10-people-follow/">GTM learning resources</a>.</p>
<p>There are lots of differences compared to GTM for the web, however. For one, there really is no <code>dataLayer</code> anymore, since AMP doesn&rsquo;t let you run arbitrary JavaScript. This severely delimits what you can do with triggers and variables.</p>
<p>On that note, most of the triggers and variables that are available to you are either completely new or behave differently from before. Also, the way the container is built and validated server-side has changed dramatically.</p>
<p>The following sections of this guide will take a closer look at all these changes.</p>

                
                  <h2 id="4-triggers">4. Triggers</h2>
<p>To understand how AMP triggers work, you must unlearn most of what you know about <a href="https://www.simoahava.com/analytics/trigger-guide-google-tag-manager/">Google Tag Manager&rsquo;s triggers</a>.</p>
<p>In ye olde Google Tag Manager, triggers are dynamic conditions that react to <code>dataLayer.push()</code> commands. If the <code>dataLayer.push()</code> had a specific key-value structure, the trigger would &ldquo;fire&rdquo;, executing any tag to which it was attached.</p>
<p>This meant that the GTM container contained all the tags that had any trigger attached to them.</p>
<p>In the AMP GTM container, the <em>JSON configuration object</em> only includes those tag requests whose triggers pass a <strong>server-side validation</strong> check! In other words, you can forget any triggers whose enabling conditions depend on a dynamic value. No more &ldquo;Data Layer variable equals this&rdquo; or &ldquo;Custom JavaScript variable returns that&rdquo;. The only Built-In variables you can check against in a trigger enabling condition are:</p>
<ul>
<li>
<p>Container ID</p>
</li>
<li>
<p>Container Version</p>
</li>
<li>
<p>Environment Name</p>
</li>
<li>
<p>Page Hostname</p>
</li>
<li>
<p>Page Path</p>
</li>
<li>
<p>Page URL</p>
</li>
<li>
<p>Random Number</p>
</li>
</ul>
<p>The User-defined types (in addition to e.g. Random Number and Container Version, which are also variable types) you can utilize are <strong>URL</strong> (as long as it uses Page URL as the source), <strong>Constant</strong> and <strong>Lookup Table</strong>.</p>
<p>Why just these? Because all of these (and only these) can be resolved <strong>server-side</strong> by Google when the HTTP request for the <em>JSON configuration object</em> comes in. In other words, you can only use variables whose value is known by Google when the request for the <em>JSON configuration object</em> is received. This rules out all AMP variables, for example, as they are resolved in the browser.</p>
<p>Because validation is done <em>server-side</em>, GTM does not have access to the URL of the page that made the request automatically. You need to explicitly add this information into the container snippet!</p>
<p>Let me show you an example. Say you create a trigger like this in your AMP container:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/trigger-example.jpg" title="Page Hostname trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/trigger-example.jpg#ZgotmplZ" alt="Page Hostname trigger" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1778 554'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Any tag that has this trigger attached to it will be added to the <em>JSON configuration object</em> if the HTTP Request for the AMP configuration has the current domain in the <code>gtm.url</code> parameter. If you remember, you need to add this parameter to the container request, and set its value to <strong>SOURCE_URL</strong>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/gtm-url.jpg" title="gtm.url parameter in the request">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/gtm-url.jpg#ZgotmplZ" alt="gtm.url parameter in the request" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2288 92'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <strong>SOURCE_URL</strong> AMP variable is resolved to the actual URL of the page when the request for the container JSON is made. Without this parameter, server-side validation against the Page Hostname, Page Path, and Page URL variables will not most likely not work as you expect them to.</p>
<p>If at least one trigger that you have added to the tag passes server-side validation, the end result is something like this in the <em>JSON configuration object</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;5&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
  <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
  <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
    <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.pageview&#34;</span>
  },
  <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;visible&#34;</span>
}</code></pre></div>
<p>This simply means that on the initial page load, this trigger should fire request number &ldquo;2&rdquo;, which is the Page View tag turned into a request to GA. As you can see, there&rsquo;s nothing about trigger conditions in this JSON block.</p>
<p>In fact, all the five (at the time of writing) available trigger types have the same binary setting:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/all-pages-some-pages.jpg" title="All Pages / Some Pages">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/all-pages-some-pages.jpg#ZgotmplZ" alt="All Pages / Some Pages" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 472 144'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If the trigger does not pass server-side validation, the tag is dropped from the <em>JSON configuration object</em>, and there&rsquo;s no way to dynamically alter page conditions to fire it in the browser.</p>
<p>I&rsquo;ve spent quite a bit of time with this change in the basic functionality of GTM triggers, but deservedly so. Server-side validation is a huge difference to how GTM used to work. Again, this ensures that AMP pages are lightning-fast, as the <em>JSON configuration object</em> is basically just a few lines of code. That&rsquo;s light-weight compared to the complexity of a &ldquo;regular&rdquo; GTM container.</p>
<p>Now, let&rsquo;s take a look at the available triggers themselves.</p>
<h3 id="41-click">4.1. Click</h3>
<p>The Click trigger in the AMP container is pretty much the same thing as the <strong>All Elements</strong> trigger in regular Google Tag Manager. In other words, the target of the click (if valid) is the element that is captured. The <strong>Just Links</strong> trigger, on the other hand, does not exist in the AMP container, and you need to configure link capturing yourself.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/click-trigger.jpg" title="Click Trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/click-trigger.jpg#ZgotmplZ" alt="Click Trigger" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 668 544'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The Click trigger has just one setting: <strong>CSS Selector</strong>. With this setting, you specify which clicks you want to listen to. If you want a quick refresher on CSS Selectors, read <a href="https://www.simoahava.com/analytics/matches-css-selector-operator-in-gtm-triggers/">my article</a> on the topic, or check out this excellent <a href="http://www.w3schools.com/cssref/css_selectors.asp">CSS Selectors Reference</a>.</p>
<p>To help you get going, here are some useful CSS Selectors for you:</p>
<p><strong>Outbound Link Clicks</strong><br>
<code>a:not([href*=&quot;mydomain.com&quot;]), a:not([href*=&quot;mydomain.com&quot;]) *</code></p>
<p><strong>Mailto: Link Clicks</strong><br>
<code>a[href^=&quot;mailto:&quot;], a[href^=&quot;mailto:&quot;] *</code></p>
<p><strong>Tel: Link Clicks</strong><br>
<code>a[href^=&quot;tel:&quot;], a[href^=&quot;tel:&quot;] *</code></p>
<p>When you add a tag that fires on a click to a container, this is what the ensuing JSON looks like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;triggers&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;11&#34;</span>: {
        <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;selector&#34;</span>: <span style="color:#a50">&#34;:not(*)${gtm_css_2_0}&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.click&#34;</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;click&#34;</span>
    }
}<span style="color:#f00;background-color:#faa">,</span>
<span style="color:#a50">&#34;vars&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;gtm_css_2_0&#34;</span>: <span style="color:#a50">&#34;,a:not([href*=\&#34;simoahava.com\&#34;]), a:not([href*=\&#34;simoahava.com\&#34;]) *&#34;</span>
}</code></pre></div>
<p>The selector is included in the trigger JSON with the following syntax: <code>:not(*)${gtm_css_2_0}</code>. The part in the curly brackets is an <a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md">AMP variable substitution</a>, which refers to a key in the <code>&quot;vars&quot;</code> object further down the JSON. So, if you replace <code>${gtm_css_2_0}</code> with the value of <code>vars.gtm_css_2_0</code>, you get the following string:</p>
<p><code>:not(*),a:not([href*=&quot;simoahava.com&quot;]), a:not([href*=&quot;simoahava.com&quot;]) *</code></p>
<p>The first selector, <code>:not(*)</code>, clears the selector chain, matching no element on the page. After that, the selectors you specified for the trigger are included. The amp-analytics code then listens for clicks on the page, matching them against the selector, and fires the respective request if the clicked element matches the selectors you have defined for each request.</p>
<h3 id="42-page-view">4.2. Page View</h3>
<p>The Page View trigger is very simple. If you have <strong>All Page Views</strong> selected, or the <strong>Some Page Views</strong> condition matches the value retrieved from the <code>gtm.url</code> parameter of the incoming HTTP Request, then any tags attached with the Page View trigger will be included in the <em>JSON configuration object</em>. The Page View trigger has no &ldquo;DOM Ready&rdquo; or &ldquo;Window Loaded&rdquo; differentiation any more - it will fire as soon as possible (see below).</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/page-view-trigger-simoahava-com.jpg" title="Page View Trigger only fires on simoahava.com">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/page-view-trigger-simoahava-com.jpg#ZgotmplZ" alt="Page View Trigger only fires on simoahava.com" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1756 554'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>When the trigger passes server-side validation, it is added to the <em>JSON configuration object</em> like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;triggers&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;5&#34;</span>: {
        <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.pageview&#34;</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;visible&#34;</span>
    }
}</code></pre></div>
<p>The <code>&quot;on&quot;: &quot;visible&quot;</code> is quite literal - if the page is visible in the current browser window, the trigger will fire as soon as the AMP analytics JavaScript has loaded. Otherwise, the trigger will wait until such a moment as the page <em>becomes</em> visible. Some time ago, I wrote a <a href="https://www.simoahava.com/analytics/use-page-visibility-api-google-tag-manager/">custom visibility trigger setup</a> for regular Google Tag Manager, so I&rsquo;m <strong>very</strong> happy to see it on by default in AMP containers.</p>
<p>There&rsquo;s more on the Visibility trigger below.</p>
<h3 id="43-scroll">4.3. Scroll</h3>
<p>The Scroll trigger is a very useful little tool. It lets you trigger tag requests on certain <em>scroll</em> thresholds, which are represented by percentage of vertical or horizontal scrolling. The percentage is calculated from the maximum available height or width of the page, respectively.</p>
<p>Scroll tracking has been instrumental in content engagement measurement over the years, so it&rsquo;s a welcome addition to the default trigger set in amp-analytics, and Google Tag Manager by extension.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/scroll-trigger.jpg" title="AMP Scroll Trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/scroll-trigger.jpg#ZgotmplZ" alt="AMP Scroll Trigger" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 682 698'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>It&rsquo;s very simple to set up. A single Scroll trigger can handle all the thresholds that you indicate with a comma-separated list of percentages. For example, to fire the Scroll trigger for each 25% increment of vertical scrolling, you would add <strong>25, 50, 75, 100</strong> into the respective field. This will naturally work for both mobile and desktop browsing.</p>
<p>When you add a scroll trigger, it looks like this in the <em>JSON configuration object</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;triggers&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;3&#34;</span>: {
        <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;scrollSpec&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;verticalBoundaries&#34;</span>: [<span style="color:#099">25</span>, <span style="color:#099">50</span>, <span style="color:#099">75</span>, <span style="color:#099">100</span>],
            <span style="color:#1e90ff;font-weight:bold">&#34;horizontalBoundaries&#34;</span>: [<span style="color:#099">100</span>]
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.scroll&#34;</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;scroll&#34;</span>
    }
}</code></pre></div>
<p>The problem with the Scroll trigger is that there are no dynamic variables in the AMP GTM container that you can use to detect which increment triggered the tag. So if you have a single Scroll tracker for 25%, 50%, 75%, and 100%, your tag will trigger four times on the page, but you can&rsquo;t simply use a variable to tell you directly <em>which increment</em> it was that triggered the tag.</p>
<p>Now, AMP knows how far you scrolled by calculating a bunch of document and event properties. Each threshold in your Scroll trigger is checked against the following calculation:</p>
<p><strong>(scrollTop + viewportHeight) / scrollHeight</strong></p>
<p>Coincidentally, all of these are available as AMP variables. Here, <strong>scrollTop</strong> is the number of pixels the top of your viewport is from the top of the document, <strong>viewportHeight</strong> is the height of the current viewport in pixels, and <strong>scrollHeight</strong> is the height of the entire document in pixels.</p>
<p>So the calculation checks how far from the top of the page the current viewport <em>bottom</em>, i.e. the very bottom edge of the content page you see in your browser window, is. If it hits 25%, the tag is triggered, and then again at 50%, 75% and 100%.</p>
<p>If in your analytics solution you want to know which of these thresholds was crossed, here are some solutions:</p>
<ul>
<li>
<p>Create a separate tag and trigger for each threshold. So if you want to track 25%, 50%, 75%, and 100%, you would end up with four triggers (one per threshold), and four tags. In each of the tags, you can now tell precisely which threshold was crossed.</p>
</li>
<li>
<p>Use just a single trigger, but send the <strong>scrollTop</strong>, <strong>viewportHeight</strong> and <strong>scrollHeight</strong> as Custom Dimensions (Google Analytics example), and then do the calculations in a spreadsheet or something else where you export the data to.</p>
</li>
</ul>
<p>There&rsquo;s a nifty AMP variable named <code>counter</code>, which lets you create a counter which increments each time the variable is resolved. This would be the solution for tracking the thresholds, but unfortunately it isn&rsquo;t supported in the GTM AMP container (yet).</p>
<h3 id="44-timer">4.4. Timer</h3>
<p>The Timer trigger is something you might be intuitively familiar with if you&rsquo;ve ever worked with Google Tag Manager. When the container is loaded, any Timer triggers in the <em>JSON configuration object</em> are initiated. The firing pattern is determined by the settings you input into the trigger:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/timer-trigger.jpg" title="Timer Trigger in AMP">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/timer-trigger.jpg#ZgotmplZ" alt="Timer Trigger in AMP" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 840 768'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Interval</strong> is the number of seconds that needs to pass before the trigger is fired.</p>
<p><strong>Limit</strong> is the maximum amount of time that the trigger loops.</p>
<p><strong>Fire Immediately When Triggered</strong> when checked fires the request once as soon as the container is loaded.</p>
<p>The Interval and Limit can be quite confusing. First of all, if you want the Timer to have an unlimited amount of activations, just leave the Limit field empty. Otherwise, you should use a multiple of Interval in the Limit field, so that you can specify how many times the trigger goes off.</p>
<p>For example, if you&rsquo;ve set the Interval to 10 seconds, and you want the trigger to fire six times, you would set the Limit to 60.</p>
<p>The Fire Immediately When Triggered setting governs whether or not the first iteration of the trigger should fire as soon as the container is downloaded (checked), or whether the trigger should wait for one interval before firing (unchecked).</p>
<p>Note that the same caveat about visibility that applied to the Page View trigger is relevant here, too. The Timer trigger will only fire a request <strong>if the page is visible</strong>. However, the timer will <em>not pause</em> while the page is not visible. Thus, all the timer hits that should have fired within the limitations of the Interval and Limit settings, but were deferred due to the page not being visible, will be fired the moment the page becomes visible again.</p>
<p>When you create a Timer trigger, it will look like this in the <em>JSON configuration object</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;triggers&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;3&#34;</span>: {
        <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;timerSpec&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;interval&#34;</span>: <span style="color:#099">10</span>,
            <span style="color:#1e90ff;font-weight:bold">&#34;maxTimerLength&#34;</span>: <span style="color:#099">20</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.timer&#34;</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;timer&#34;</span>
    }
}</code></pre></div>
<p>If you left the &ldquo;Fire Immediately When Triggered&rdquo; unchecked, under <code>&quot;maxTimerLength&quot;: 20</code> you would have the setting <code>&quot;immediate&quot;: false</code>.</p>
<h3 id="45-visibility">4.5. Visibility</h3>
<p>Now here&rsquo;s an interesting trigger! The Visibility trigger lets you fire a tag when a specific element has been <em>visible</em> in the browser window a set amount of time. Heck, you can even define that a certain minimum <em>amount of the element</em> has to be visible for the trigger to fire. That&rsquo;s really useful for ad impression tracking!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/visibility-trigger.jpg" title="Visibility AMP Trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/visibility-trigger.jpg#ZgotmplZ" alt="Visibility AMP Trigger" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 862 1124'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p><strong>Element ID</strong> is the unique identifier of the element. It&rsquo;s required, so you can&rsquo;t track the visibility of an element without an ID attribute.</p>
<p><strong>Minimum Percent Visible</strong> is the minimum amount of the element that needs to be visible in the browser viewport for the trigger to be valid for firing. If you leave this out, it means that the trigger will fire even if the element is not in the viewport! Kind of defeats the purpose, so try to remember to have at least <strong>1</strong> in this field.</p>
<p><strong>Maximum Percent Visible</strong> is the maximum amount of the element that can be visible in the browser viewport. So if you set <strong>10</strong> as the Minimum Percent Visible and <strong>50</strong> as the Maximum Percent Visible, the trigger will only fire when you have between 10 and 50 percent of the element in the viewport.</p>
<p><strong>Minimum Continuous Time</strong> is the minimum amount of time in one stretch that the element must be visible in the viewport (in milliseconds). So if you have <strong>2000</strong> in this field, it means that the element must be in the viewport for 2 seconds without interruption for this condition to pass.</p>
<p><strong>Minimum Total Time</strong> is the minimum <em>total</em> time that the element needs to be visible in the viewport. If you have <strong>2000</strong> in this field, it&rsquo;s enough to have the element visible for a total of 2 seconds, but it doesn&rsquo;t have to be continuous. The user can reveal the element for 500 milliseconds a time, and after four such times the Minimum Total Time of 2000 has been reached.</p>
<p>All of these conditions stack. So, let&rsquo;s say you have a trigger that looks like the one in the screenshot above. What it translates to is this:</p>
<p>An element with ID <strong>AMP_2</strong> must have at least <strong>10 percent</strong> of its total area in the browser viewport for at least <strong>5 seconds altogether</strong>. Also, the trigger will only fire if the element is in the viewport <em>without interruption</em> for at least <strong>1 second</strong>.</p>
<p>When you publish a trigger like this, it will translate into the following JSON:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;triggers&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;3&#34;</span>: {
        <span style="color:#1e90ff;font-weight:bold">&#34;request&#34;</span>: <span style="color:#a50">&#34;2&#34;</span>,
        <span style="color:#1e90ff;font-weight:bold">&#34;visibilitySpec&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;selector&#34;</span>: <span style="color:#a50">&#34;#AMP_2&#34;</span>,
            <span style="color:#1e90ff;font-weight:bold">&#34;visiblePercentageMin&#34;</span>: <span style="color:#099">10</span>,
            <span style="color:#1e90ff;font-weight:bold">&#34;continuousTimeMin&#34;</span>: <span style="color:#099">1000</span>,
            <span style="color:#1e90ff;font-weight:bold">&#34;totalTimeMin&#34;</span>: <span style="color:#099">5000</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;vars&#34;</span>: {
            <span style="color:#1e90ff;font-weight:bold">&#34;gtm.event&#34;</span>: <span style="color:#a50">&#34;gtm.visible&#34;</span>
        },
        <span style="color:#1e90ff;font-weight:bold">&#34;on&#34;</span>: <span style="color:#a50">&#34;visible&#34;</span>
    }
}</code></pre></div>
<p>I hope that support for other CSS selectors than just IDs would become available for selecting the element. I guess the reasoning is that such a complex trigger would be difficult to maintain consistently if it matched multiple elements on the page.</p>

                
                  <h2 id="5-variables">5. Variables</h2>
<p>AMP Analytics supports two types of variables: <strong>platform</strong> and <strong>page-defined</strong> variables. Platform variables are default variables that do not need to be specified in the <em>JSON configuration object</em>. They are automatically resolved based on information available in the Document Object Model.</p>
<p>Page-defined variables are added to the <em>JSON configuration object</em>. They can be defined in multiple places, such as a remote configuration file, top-level of an embedded configuration object, trigger-specific configuration, or even in special <a href="https://github.com/ampproject/amphtml/blob/master/extensions/amp-analytics/analytics-vars.md#variables-as-data-attribute">data attributes configured in elements themselves</a>. There is an order of priority in variables which share the same name, and they are resolved in the following order of importance:</p>
<p>Remote configuration file &gt; element level data attributes &gt; triggers &gt; top-level of configuration object &gt; platform.</p>
<p>So if you had <code>&amp;cid=${clientId(some-cid-cookie)}</code> in your request to Google Analytics (platform variable), and also <code>&quot;vars&quot;: {&quot;clientId&quot;: &quot;12345&quot;}</code> in the root of the <code>amp-analytics</code> configuration object, you&rsquo;d end up with <code>&amp;cid=12345</code> in the actual request, since the configuration object trumps platform variables in priority.</p>
<p>All variables are resolved when the request to any given endpoint is compiled, so they might well have different values for each request.</p>
<p>In the AMP Google Tag Manager container, you can create variable references to these AMP Analytics variables using the <strong>AMP variable</strong> type. However, there are other variables at your disposal, too, and we&rsquo;ll take a look at these as well in this chapter.</p>
<h3 id="51-built-in-variables">5.1. Built-In Variables</h3>
<p>The Built-In variables in the GTM container are variables that you do not need to manually create. To enable them, you need to go to <strong>Variables</strong> in the container, and under the &ldquo;Built-In Variables&rdquo; heading click the large red <strong>CONFIGURE</strong> button to enable / disable any variables. It&rsquo;s weird that the Built-In variables aren&rsquo;t all enabled by default, since there&rsquo;s no harm in having them all available. In regular GTM, enabling Built-In variables meant some extra clutter in the Google Tag Manager library, but here they are only available in the UI to make it easier to configure your tags.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/built-in-variables.jpg" title="GTM Built-In Variables">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/built-in-variables.jpg#ZgotmplZ" alt="GTM Built-In Variables" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1556 1076'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Here are all the Built-In variables with a short description of each.</p>
<ul>
<li>
<p><strong>Total Engaged Time</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#total-engaged-time">AMP variable</a>): The total time the page has been visible in the viewport in seconds.</p>
</li>
<li>
<p><strong>Scroll Width</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#scroll-width">AMP variable</a>): Total width of the page in pixels.</p>
</li>
<li>
<p><strong>Scroll Top</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#scroll-top">AMP variable</a>): Number of pixels between the top of the viewport and the top of the page.</p>
</li>
<li>
<p><strong>Scroll Left</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#scroll-left">AMP variable</a>): Number of pixels between the left edge of the viewport and the left edge of the page.</p>
</li>
<li>
<p><strong>Scroll Height</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#scroll-height">AMP variable</a>): Total height of the page in pixels.</p>
</li>
<li>
<p><strong>Screen Width</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#screen-width">AMP variable</a>): Total width of the screen. Does not take into account stuff like widgets, scroll bars, etc.</p>
</li>
<li>
<p><strong>Screen Height</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#screen-height">AMP variable</a>): Total height of the screen. Does not take into account stuff like bookmark and address bars.</p>
</li>
<li>
<p><strong>Random Number</strong>: Generates a random number between 0 and 2147483647. Note that this number is generated server-side by GTM. Once the <em>JSON configuration object</em> is downloaded, any references to this variable will have the same generated number.</p>
</li>
<li>
<p><strong>Page View ID</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#page-view-id">AMP variable</a>): Random number that is unique per user, URL, and day. Each refresh of a page sets a new random number.</p>
</li>
<li>
<p><strong>Page URL</strong>: This is the URL passed to GTM with the <code>gtm.url=SOURCE_URL</code> query parameter in the GTM container snippet. This, Page Path, and Page Hostname are the only variables you can use in GTM to delimit tags from triggering only on certain pages.</p>
</li>
<li>
<p><strong>Page Path</strong>: Returns the path (e.g. /analytics/accelerated-mobile-pages-via-google-tag-manager/) of the URL in the <code>gtm.url</code> query parameter of the GTM container request.</p>
</li>
<li>
<p><strong>Page Load Time</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#page-load-time">AMP variable</a>): This is the entire load time of the page in milliseconds. It is calculated from the moment the previous page started its unload to the moment the current page has fully loaded. If there is no previous page, the timer starts from the moment when the HTTP request for the page content was ready to dispatch.</p>
</li>
<li>
<p><strong>Page Hostname</strong>: Returns the hostname (e.g. <a href="http://www.simoahava.com">www.simoahava.com</a>) of the URL in the <code>gtm.url</code> query parameter of the GTM container request.</p>
</li>
<li>
<p><strong>Page Download Time</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#page-download-time">AMP variable</a>): Time in milliseconds from the moment the request for the page content was dispatched to the moment the last byte of the document was downloaded from the web server.</p>
</li>
<li>
<p><strong>Environment Name</strong>: The name of the custom created <a href="https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">GTM Environment</a> (if any) that the current GTM <em>JSON configuration object</em> is downloaded from. Yes, Environments work in the AMP container, too.</p>
</li>
<li>
<p><strong>Document Title</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#title">AMP variable</a>): Title of the current document.</p>
</li>
<li>
<p><strong>Document Referrer</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#document-referrer">AMP variable</a>): The URL of the page the user navigated from. This variable will resolve to an empty string if no referrer information is available.</p>
</li>
<li>
<p><strong>Container Version</strong>: The version number of the container that received the request. If you are in Preview mode, it returns QUICK_PREVIEW.</p>
</li>
<li>
<p><strong>Container ID</strong>: Returns your GTM Container ID (GTM-XXXXX).</p>
</li>
<li>
<p><strong>Client Timezone</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#timezone">AMP variable</a>): Returns the timezone offset in <em>minutes</em> from UTC based on client&rsquo;s system time. For example, if you are in New York City, Client Timezone would return <strong>300</strong>, because New York is 5 hours behind UTC. In Helsinki, which is two hours ahead of UTC, Client Timezone would return <strong>-120</strong>.</p>
</li>
<li>
<p><strong>Client Timestamp</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#timestamp">AMP variable</a>): Returns the number of <strong>seconds</strong> that have passed since Jan 1, 1970 (epoch time).</p>
</li>
<li>
<p><strong>Canonical URL</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#canonical-url">AMP variable</a>): Returns the full canonical URL of the page. Typically this should be the URL without <code>/amp/</code> or any other AMP parameter.</p>
</li>
<li>
<p><strong>Canonical Path</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#canonical-path">AMP variable</a>): Returns just the pathname of the canonical URL of the page.</p>
</li>
<li>
<p><strong>Canonical Host</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#canonical-host">AMP variable</a>): Returns the complete host of the canonical URL of the page (e.g. <code>http://www.mydomain.com:9000</code>).</p>
</li>
<li>
<p><strong>Browser Language</strong> (<a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#browser-language">AMP variable</a>): Returns the language of the browser UI, e.g. <code>en-us</code> or <code>fi</code>.</p>
</li>
<li>
<p><strong>AMP Event</strong> (AMP variable): Returns the name of the event that triggered the tag. GTM automatically adds event names like <strong>gtm.click</strong> (Click trigger) and <strong>gtm.pageview</strong> (Page View) to this variable.</p>
</li>
</ul>
<p>Once you&rsquo;ve enabled these variables, you can refer to them in your tags, triggers, and variables by using the <strong>{{Variable Name}}</strong> syntax.</p>
<h3 id="52-user-defined-variables">5.2. User-Defined variables</h3>
<p>In addition to Built-In variables, you can also create variables of your own. These can be added in the variables page of your container, under the heading &ldquo;User-Defined variables&rdquo;.</p>
<p>Remember that you can reference any GTM variable with the <strong>{{Variable Name}}</strong> syntax.</p>
<p>At the time of writing, here are the variable types you can configure.</p>
<h4 id="url">URL</h4>
<p><a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/">URL variables exist</a> in regular Google Tag Manager, too. However, in AMP, the URL variable can only be used to provide data about the URL included in the container HTTP request. If you remember, this URL is resolved in the <code>gtm.url=SOURCE_URL</code> parameter of the request. There are already Built-In variables for Page Hostname, Page URL, and Page Path, so the component types that you could configure variables for are Protocol (e.g. http or https), Port, and Query (e.g. ?test=true).</p>
<h4 id="amp-variable">AMP variable</h4>
<p>Jump to the next section to read more about AMP variables.</p>
<h4 id="constant">Constant</h4>
<p>This should be familiar from regular Google Tag Manager. A Constant variable can be set to any string value you wish, and any time this variable is referenced, the string you input into the field will be returned.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/constant-variable.jpg" title="GA Tracking ID as Constant Variable">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/constant-variable.jpg#ZgotmplZ" alt="GA Tracking ID as Constant Variable" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 674 408'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>A typical use case would be to set your Google Analytics tracking ID as a Constant String variable.</p>
<h4 id="environment-name">Environment Name</h4>
<p>This isn&rsquo;t particularly useful, as there already is a Built-In variable for this. It returns the name of the <a href="https://www.simoahava.com/analytics/better-qa-with-google-tag-manager-environments/">Google Tag Manager Environment</a> where the <em>JSON configuration object</em> is loaded from.</p>
<h4 id="lookup-table">Lookup Table</h4>
<p>The Lookup Table variable is a staple from <a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/">regular Google Tag Manager</a>. It&rsquo;s very useful, as it lets you do value transformations with dynamic input variables.</p>
<p>However, in AMP GTM it&rsquo;s not that useful anymore. The Lookup Table must resolve server-side, because AMP doesn&rsquo;t support the type of dynamic calculation that a Lookup Table would require if resolved in the client. Thus, the only types of input variables you can use are those which have a value within the Google Tag Manager container. This is, unfortunately, a very short list:</p>
<ul>
<li>
<p>Container ID</p>
</li>
<li>
<p>Container Version</p>
</li>
<li>
<p>Environment Name</p>
</li>
<li>
<p>Page Hostname</p>
</li>
<li>
<p>Page Path</p>
</li>
<li>
<p>Page URL</p>
</li>
<li>
<p>Random Number</p>
</li>
</ul>
<p>One use case would be to send Preview hits to another tracking endpoint. For that, the Lookup Table would look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/lookup-preview-to-different-ga.jpg" title="Lookup Table for GTM Preview Mode">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/lookup-preview-to-different-ga.jpg#ZgotmplZ" alt="Lookup Table for GTM Preview Mode" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1430 870'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>If you add this variable to the Tracking ID field of your Google Analytics tag, it will return &ldquo;UA-12345-2&rdquo; if Google Tag Manager is in Preview mode, and &ldquo;UA-12345-1&rdquo; otherwise.</p>
<h4 id="random-number">Random Number</h4>
<p>Redundant. There already is a Built-In variable for this. It returns a random number between 0 and 2147483647.</p>
<h4 id="container-id">Container ID</h4>
<p>Redundant. There already is a Built-In variable for this. It returns the ID of the GTM container (GTM-XXXXX).</p>
<h4 id="container-version">Container Version</h4>
<p>Redundant. There already is a Built-In variable for this. It returns the version of the published GTM container, or QUICK_PREVIEW if in Preview mode.</p>
<h3 id="53-amp-variables">5.3. AMP variables</h3>
<p>I&rsquo;ve already mentioned AMP variables here and there. They are built into the AMP Analytics framework, and comprise two types of variables: platform variables and page-defined variables. Platform variables are sort of &ldquo;built-in&rdquo; variables for AMP, in that you don&rsquo;t need to manually specify them in the <em>JSON configuration object</em>. Page-defined variables, on the other hand, need to be included in the <em>JSON configuration object</em> itself.</p>
<p>To refer to AMP variables, you need to use the syntax <code>${variableName}</code>. Naturally, Google Tag Manager does this for you when you create a user-defined variable of type AMP variable.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/amp-backgroundstate.jpg" title="AMP Variable for backgroundState">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/amp-backgroundstate.jpg#ZgotmplZ" alt="AMP Variable for backgroundState" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 606 544'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>When you add an AMP variable to your Google Tag Manager tag, it becomes part of the request when the JSON is downloaded.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/amp-in-tag.jpg" title="AMP Variable in GA Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/amp-in-tag.jpg#ZgotmplZ" alt="AMP Variable in GA Tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1554 1000'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>An AMP variable added like this to a Custom Dimension field in a GA tag would look like this in the <em>JSON configuration object</em>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#a50">&#34;requests&#34;</span><span style="color:#f00;background-color:#faa">:</span> {
    <span style="color:#1e90ff;font-weight:bold">&#34;4&#34;</span>: <span style="color:#a50">&#34;https://www.google-analytics.com/r/collect?...&amp;cd1=${backgroundState}&#34;</span>
}</code></pre></div>
<p>As you can see, the variable name is still in the request itself, meaning that it isn&rsquo;t resolved when the <em>JSON configuration object</em> is downloaded. Only once the actual request dispatches will the AMP variable be resolved, which means, in turn, that its value is generated dynamically.</p>
<p>Most of the useful AMP variables are already available as Built-In variables in GTM. In fact, I find it curious that Built-In variables don&rsquo;t simply include all the pre-defined AMP variables, as that would cut down time required to configure the container.</p>
<h4 id="creating-custom-amp-variables">Creating custom AMP variables</h4>
<p>If you want to create your own AMP variables, you can. It&rsquo;s sort of similar to working with <code>dataLayer</code>, in the sense that you are passing semantic information from the page to Google Tag Manager. However, the difference is that you won&rsquo;t be able to utilize these Variables <em>within GTM itself</em>. So you can&rsquo;t create trigger conditions based on AMP variables, nor can you use Lookup Tables with AMP variables as the input variable.</p>
<p>To create custom AMP variables, you include them like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">amp-analytics</span> <span style="color:#1e90ff">config</span>=<span style="color:#a50">&#34;https://www.googletagmanager.com/amp.json?id=GTM-XXXXXX&amp;gtm.url=SOURCE_URL&#34;</span> <span style="color:#1e90ff">data-credentials</span>=<span style="color:#a50">&#34;include&#34;</span>&gt;
  &lt;<span style="color:#1e90ff;font-weight:bold">script</span> <span style="color:#1e90ff">type</span>=<span style="color:#a50">&#34;application/json&#34;</span>&gt;
  {
    <span style="color:#a50">&#34;vars&#34;</span>: {
      <span style="color:#a50">&#34;someAmpVar&#34;</span>: <span style="color:#a50">&#34;someValue&#34;</span>,
      <span style="color:#a50">&#34;someOtherAmpVar&#34;</span>: <span style="color:#a50">&#34;someValue&#34;</span>
    }
  }
  &lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
&lt;/<span style="color:#1e90ff;font-weight:bold">amp-analytics</span>&gt;</code></pre></div>
<p>So you include them in the <code>&quot;vars&quot;</code> block as key-value pairs. Once you&rsquo;ve done this, you can create AMP variables for these keys, and then include the custom AMP variables in tag fields.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/amp-var.jpg" title="custom AMP var">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/amp-var.jpg#ZgotmplZ" alt="custom AMP var" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2228 778'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The thing to remember about AMP variables and GTM is that AMP variables are resolved in the client when the requests are dispatched. Thus you can&rsquo;t use them in any operations within GTM that would require server-side validation. The most notable cases are trigger enabling conditions and the Lookup Table variable.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/11/validate-error.jpg" title="AMP Validation error">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/11/validate-error.jpg#ZgotmplZ" alt="AMP Validation error" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 538 552'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>There&rsquo;s a great reference guide for all the available AMP variables in the GitHub project itself: <a href="https://github.com/ampproject/amphtml/blob/master/spec/amp-var-substitutions.md#amp-html-url-variable-substitutions">AMP HTML URL Variable Substitutions</a>. Read through that document, and create User-Defined variables for any AMP variables that don&rsquo;t already exist as Built-In variables.</p>

                
                  <h2 id="6-other-google-tag-manager-quirks">6. Other Google Tag Manager quirks</h2>
<p>Google Tag Manager is pretty smooth with AMP. The fact that it compiles the configuration object for you is a huge plus, and the ease of creating a tracking schema for your AMP pages is very much in line with how &ldquo;regular&rdquo; Google Tag Manager works, too.</p>
<p>There are some hiccups, though. Most notably, server-side validation can be a difficult thing to come to terms with. GTM needs to build a configuration object dynamically, but because the object is built within Google&rsquo;s servers, it doesn&rsquo;t have any access to the variables that would exist on your page. Thus the only dynamic variables it has access to need to be passed in the URL request for the container, <code>gtm.url</code> being the most notable one.</p>
<p>Google Tag Manager for AMP does not support the <strong>Debug mode</strong> we&rsquo;re used to with regular Google Tag Manager. The debug panel would require that the AMP page supported the type of JavaScript that is very performance-killing.</p>
<p>However, GTM <em>does</em> work in <strong>Preview Mode</strong>. So when you enter Preview Mode in Google Tag Manager, once you reload the site with the same web browser you entered Preview Mode in, the container that is downloaded from Google Tag Manager will actually be the one you are previewing and not the one that is published.</p>
<p>This is very useful, even though I know you&rsquo;ll miss having the excellent Debug panel at your disposal.</p>
<p>Because Preview Mode doesn&rsquo;t have any verbose logging or anything like that, you should get familiar with <a href="https://www.simoahava.com/gtm-tips/debugging-tag-execution-properly/">other debug tools</a> at your disposal.</p>

                
                  <h2 id="7-summary">7. Summary</h2>
<p>I&rsquo;m a big fan of Google Tag Manager&rsquo;s AMP container. It&rsquo;s not just because I&rsquo;m such a fanboy (I am), nor because I&rsquo;m typically devoid of a critical voice when it comes to GTM (I am this, too). The reason I really like it is because it does what GTM has always done best: it abstracts a somewhat complex operation of compiling the <em>JSON configuration object</em>, and lets you create it using GTM&rsquo;s UI, knowing full-well that whatever you create will be syntactically valid for AMP.</p>
<p>That&rsquo;s the modus operandi for GTM, and it&rsquo;s refreshing to see how it&rsquo;s still respected by the development team. On top of that, AMP introduces a number of triggers and variables that I really hope will make their way into regular GTM, too. The scroll and visibility triggers alone would be really useful in regular Google Tag Manager.</p>
<p>Most of my issues with the AMP container have to do with AMP rather than with GTM. Managing a single Client ID across your website and the available AMP proxies is a pain, and I really hope that AMP introduces some methods to facilitate extending a single Client ID (e.g. <code>_ga</code>) across your website and the various proxies AMP might be served through.</p>
<p>I foresee some great applications for AMP through GTM, and I also look forward to some feature leakage to regular Google Tag Manager, too.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/accelerated-mobile-pages/">accelerated mobile pages</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/amp/">amp</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/mobile/">mobile</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-analytics-client-id-amp-pages/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/fix-rogue-referral-problem-single-page-sites/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Accelerated%20Mobile%20Pages%20Via%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-websockets="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-analytics-client-id-amp-pages/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/fix-rogue-referral-problem-single-page-sites/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Accelerated%20Mobile%20Pages%20Via%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Accelerated%20Mobile%20Pages%20Via%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/accelerated-mobile-pages-via-google-tag-manager/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

