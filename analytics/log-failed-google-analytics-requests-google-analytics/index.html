

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Log Failed Google Analytics Requests In Google Analytics | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2016\/12\/debug-duplicator.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/log-failed-google-analytics-requests-google-analytics\/",
  "datePublished": "2016-12-07T13:27:57\u002b00:00",
  "dateModified": "2016-12-07T13:27:57\u002b00:00",
  "description": "You can use Google Analytics to collect information on other Google Analytics requests that failed to send correctly, for whatever reason.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Log Failed Google Analytics Requests In Google Analytics | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/log-failed-google-analytics-requests-google-analytics/">
    
    <meta name="description" content="You can use Google Analytics to collect information on other Google Analytics requests that failed to send correctly, for whatever reason.">
    <meta property="og:description" content="You can use Google Analytics to collect information on other Google Analytics requests that failed to send correctly, for whatever reason.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Log Failed Google Analytics Requests In Google Analytics">
    <meta property="og:url" content="https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Log Failed Google Analytics Requests In Google Analytics">
    <meta name="twitter:description" content="You can use Google Analytics to collect information on other Google Analytics requests that failed to send correctly, for whatever reason.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2016/12/debug-duplicator.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2016/12/debug-duplicator.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Log Failed Google Analytics Requests In Google Analytics
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2016-12-07T13:27:57Z">
        
  December 7, 2016

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/#commento">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <blockquote>
<p><strong>READ THIS (26 Aug 2019)!!</strong> Unfortunately, the update I made in 2016 contained code that was incomplete and broken. I nevert noticed this until it was pointed out to me almost three years later. At this point, I don&rsquo;t have a working backup of the solution, so unless some internet archive / cache service manages to surface the code, this article is basically lost.</p>
</blockquote>
<p><em>UPDATE 20 December 2016: I made some fixes to the solution - be sure to grab the latest code snippet from below!</em></p>
<p>Having worked in all sorts of <a href="https://analytics.google.com/">Google Analytics</a> projects over the years, I&rsquo;ve found myself more and more interested in the technical underpinnings of digital analytics rather than the actual analytical work. We all play to our respective strengths, I guess. For example, there are still many purely <em>technical / technological</em> mysteries surrounding Google Analytics, because much of the data processing is done server-side.</p>
<p>One of these mysteries is a proper feedback loop for request quality. When you send a request to Google Analytics such as a Page View hit, you can verify that it works in multiple ways:</p>
<ul>
<li>
<p><a href="https://tagmanager.google.com/">Google Tag Manager</a> Debug mode</p>
</li>
<li>
<p><a href="https://chrome.google.com/webstore/detail/google-analytics-debugger/jnkmfdileelhofjcijamephohjechhna">Google Analytics Debugger</a></p>
</li>
<li>
<p>Google Analytics Real Time reports</p>
</li>
<li>
<p><a href="https://chrome.google.com/webstore/detail/tag-assistant-by-google/kejbdjndbnbjgmefkgdddjlbokphdefk">Google Tag Assistant</a> recordings</p>
</li>
<li>
<p>Web browser&rsquo;s own developer tools</p>
</li>
</ul>
<p>I&rsquo;ve covered much of Google Analytics debugging in <a href="https://www.simoahava.com/gtm-tips/debugging-tag-execution-properly/">this article</a>.</p>
<p>However, no matter how successful your own tests are, one thing is missing: a solid, reliable way of collecting data from all failed requests from your site visitors. Google Analytics doesn&rsquo;t automatically log problems with data collection, even if <a href="https://support.google.com/analytics/answer/6006306?hl=en">Analytics notifications</a> do reveal some issues.</p>
<p>This can, and should, lead to healthy doubt concerning the veracity of your data set - is it a representative sample of all hits sent from your digital property, or is some business critical information (such as Ecommerce) being dropped more than average?</p>
<p>In this article, I want to show a simple way of logging all failed requests in Google Analytics as new events. The solution builds on <a href="http://www.seerinteractive.com/about/team/stephen-harris/">Stephen Harris</a>&rsquo; awesome <a href="https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">GA Spy</a>, and the technical approach is encapsulated in a single Custom HTML Tag in <a href="https://tagmanager.google.com/">Google Tag Manager</a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/debug-duplicator.jpg" title="debug-duplicator">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/debug-duplicator.jpg#ZgotmplZ" alt="debug-duplicator">
  
    </a>
  
  
</div>


<p>Read on, my friend!</p>
<h2 id="the-solution">The solution</h2>
<p>Here&rsquo;s how it works.</p>
<ol>
<li>
<p>GA Spy to processes every single call to the <code>ga()</code> global function.</p>
</li>
<li>
<p>For each call with the <code>send</code> command, send the hit payload to <code>https://www.google-analytics.com/debug/collect</code> (<a href="https://www.simoahava.com/analytics/google-analytics-endpoint-debugger/">read more about the <code>/debug/</code> endpoint</a>).</p>
</li>
<li>
<p>Don&rsquo;t forget to send the regular hit to Google Analytics.</p>
</li>
<li>
<p>If the <code>/debug/</code> returns a failed request, push the error message and the failed hit payload into <code>dataLayer</code>.</p>
</li>
</ol>
<p>In a nutshell, for every hit sent to Google Analytics, you&rsquo;re also sending the same hit to the GA debug endpoint. This endpoint returns information on whether or not the request was a success, and if it wasn&rsquo;t, what was wrong with it.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#1e90ff;font-weight:bold">&#34;hitParsingResult&#34;</span>: [ {
    <span style="color:#1e90ff;font-weight:bold">&#34;valid&#34;</span>: <span style="color:#00a">false</span>,
    <span style="color:#1e90ff;font-weight:bold">&#34;parserMessage&#34;</span>: [ {
      <span style="color:#1e90ff;font-weight:bold">&#34;messageType&#34;</span>: <span style="color:#a50">&#34;WARN&#34;</span>,
      <span style="color:#1e90ff;font-weight:bold">&#34;description&#34;</span>: <span style="color:#a50">&#34;The value provided for parameter &#39;ev&#39; is invalid. Please see http://goo.gl/a8d4RP#ev for details.&#34;</span>,
      <span style="color:#1e90ff;font-weight:bold">&#34;messageCode&#34;</span>: <span style="color:#a50">&#34;VALUE_INVALID&#34;</span>,
      <span style="color:#1e90ff;font-weight:bold">&#34;parameter&#34;</span>: <span style="color:#a50">&#34;ev&#34;</span>
    } ],
    <span style="color:#1e90ff;font-weight:bold">&#34;hit&#34;</span>: <span style="color:#a50">&#34;...&#34;</span>
  } ],
  <span style="color:#1e90ff;font-weight:bold">&#34;parserMessage&#34;</span>: [ {
    <span style="color:#1e90ff;font-weight:bold">&#34;messageType&#34;</span>: <span style="color:#a50">&#34;INFO&#34;</span>,
    <span style="color:#1e90ff;font-weight:bold">&#34;description&#34;</span>: <span style="color:#a50">&#34;Found 1 hit in the request.&#34;</span>
  } ]
}</code></pre></div>
<p>From <code>dataLayer</code>, I&rsquo;m actually sending this information to Google Analytics via GTM. This way you&rsquo;ll end up with a report that looks like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/error-messages.jpg" title="Google Analytics error messages">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/error-messages.jpg#ZgotmplZ" alt="Google Analytics error messages">
  
    </a>
  
  
</div>


<p>Heck, you can even click one of the error messages to drill down to the actual payloads. For example, if I choose <strong>&lsquo;ea&rsquo;</strong> error, I can see the payloads and verify that indeed, there&rsquo;s no Event Action parameter with these hits.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/error-messages-details.jpg" title="Error message details">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/error-messages-details.jpg#ZgotmplZ" alt="Error message details">
  
    </a>
  
  
</div>


<p>I can then go to GTM, find the offending tag, and fix it to always send some value in Event Action.</p>
<p>Due to the abstraction of <code>dataLayer</code>, you don&rsquo;t have to log this information in Google Analytics. In fact, you might not <em>want</em> to, since you might already have some sort of logging rig setup in your development process. Thanks to Google Tag Manager, you can push the data to any endpoint that supports JavaScript-generated data transfer (e.g. HTTP requests).</p>
<p>However, I&rsquo;ve elected to send the information to Google Analytics. Doing so, I can align these validation errors with all the other hits that this particular user has sent to GA, and I can thus potentially identify bigger issues that these validation errors might only be a symptom of. For example, it&rsquo;s possible that an Ecommerce tag only fails if the user has followed a specific funnel on the site. By sending the validation error to Google Analytics, I can see if it occurred during one of these broken funnels, giving me more information to fix it in the end.</p>
<h2 id="how-to-do-it">How to do it</h2>
<p>You basically need a <strong>Custom HTML Tag</strong> that fires on the <strong>All Pages</strong> trigger, with a higher <a href="https://support.google.com/tagmanager/answer/2772421?hl=en">Tag Priority</a> than any of your Google Analytics tags that might also fire on this event.</p>
<p>It&rsquo;s important that this code starts its execution before your Google Analytics tags have a chance to start up. This code overwrites the <code>ga()</code> method, and any tag that has already fired will not be debugged with this solution.</p>
<p>You&rsquo;ll first need the actual code for GA Spy, and you can download the latest version from <a href="https://github.com/smhmic/ga-spy/blob/master/ga-spy.js">Stephen&rsquo;s repository</a>. You need to copy-paste the JavaScript into a Custom HTML Tag, and then add the custom listener below it. Here&rsquo;s the full example, where I&rsquo;ve minified the GA Spy code to make it more compact. Scroll down past the GA Spy part to find the actual magic.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#1e90ff;font-weight:bold">script</span>&gt;
<span style="color:#aaa;font-style:italic">/* Minified GA Spy starts */</span>
<span style="color:#0aa">window</span>.gaSpy=<span style="color:#0aa">window</span>.gaSpy||<span style="color:#00a">function</span>(b){<span style="color:#00a">var</span> j,k,c=<span style="color:#00a">function</span>(a){<span style="color:#00a">if</span>(b=<span style="color:#00a">null</span>,a.debugLogPrefix=a.debugLogPrefix||<span style="color:#a50">&#34;gaSpy&#34;</span>,!a.callback||<span style="color:#a50">&#34;function&#34;</span>!=<span style="color:#00a">typeof</span> a.callback)<span style="color:#00a">throw</span> <span style="color:#00a">new</span> <span style="color:#0aa">Error</span>(<span style="color:#a50">&#34;[&#34;</span>+a.debugLogPrefix+<span style="color:#a50">&#34;] Aborting; No listener callback provided.&#34;</span>);<span style="color:#00a">return</span> a.gaObjName=a.gaObjName||<span style="color:#0aa">window</span>.GoogleAnalyticsObject||<span style="color:#a50">&#34;ga&#34;</span>,a.debug=!!a.debug,a}(<span style="color:#a50">&#34;function&#34;</span>==<span style="color:#00a">typeof</span> b?{callback:b}:b),d=c.gaObjName,e=<span style="color:#0aa">window</span>[d],f=<span style="color:#0aa">window</span>.console&amp;&amp;c.debug;?<span style="color:#00a">function</span>(){<span style="color:#00a">var</span> a=[].slice.call(arguments);a.unshift(<span style="color:#a50">&#34;[&#34;</span>+c.debugLogPrefix+<span style="color:#a50">&#34;]&#34;</span>),console.log.apply(console,a)}:<span style="color:#00a">function</span>(){},g=<span style="color:#00a">function</span>(a){<span style="color:#00a">var</span> b,d={args:a,the:{}},e=d.the;<span style="color:#00a">return</span> c.debug&amp;&amp;<span style="color:#00a">function</span>;(b,c){<span style="color:#00a">for</span>(b=<span style="color:#a50">&#34;Intercepted: ga(&#34;</span>,c=<span style="color:#099">0</span>;c1?b[<span style="color:#099">0</span>]:<span style="color:#a50">&#34;t0&#34;</span>,e.command=b.length&gt;<span style="color:#099">1</span>?b[<span style="color:#099">1</span>]:b[<span style="color:#099">0</span>],b=b[b.length-<span style="color:#099">1</span>].split(<span style="color:#a50">&#34;:&#34;</span>),e.pluginName=b.length&gt;<span style="color:#099">1</span>?b[<span style="color:#099">0</span>]:<span style="color:#00a">void</span> <span style="color:#099">0</span>,e.pluginMethodName=b.length&gt;<span style="color:#099">1</span>?b[<span style="color:#099">1</span>]:<span style="color:#00a">void</span> <span style="color:#099">0</span>,<span style="color:#a50">&#34;require&#34;</span>===e.command||<span style="color:#a50">&#34;provide&#34;</span>===e.command?(e.pluginName=a[<span style="color:#099">1</span>],<span style="color:#a50">&#34;provide&#34;</span>===e.command&amp;&amp;(e.pluginConstructor=a[<span style="color:#099">2</span>])):(<span style="color:#a50">&#34;send&#34;</span>===e.command&amp;&amp;(e.hitType=a[a.length-<span style="color:#099">1</span>]&amp;&amp;a;[a.length-<span style="color:#099">1</span>].hitType||a[<span style="color:#099">1</span>]),<span style="color:#a50">&#34;object&#34;</span>==<span style="color:#00a">typeof</span> a[a.length-<span style="color:#099">1</span>]&amp;&amp;(e.trackerName=a[a.length-<span style="color:#099">1</span>].name||e.trackerName))),f(<span style="color:#a50">&#34;Run listener callback&#34;</span>,e),!<span style="color:#099">1</span>!==c.callback(d)},h=<span style="color:#00a">function</span>(){<span style="color:#00a">var</span> a=[].slice.call(arguments);<span style="color:#00a">if</span>(c.debug){<span style="color:#00a">if</span>(!g(a))<span style="color:#00a">return</span> f(<span style="color:#a50">&#34;Command blocked.&#34;</span>)}<span style="color:#00a">else</span> <span style="color:#00a">try</span>{<span style="color:#00a">if</span>(!g(a))<span style="color:#00a">return</span>}<span style="color:#00a">catch</span>(a){}<span style="color:#00a">return</span> f(<span style="color:#a50">&#34;Command allowed:&#34;</span>,a),h._gaOrig.apply(h._gaOrig,a)},i=<span style="color:#00a">function</span>(){<span style="color:#00a">var</span> a,b=h._gaOrig=<span style="color:#0aa">window</span>[d];f(<span style="color:#a50">&#34;Hijack&#34;</span>,b._gaOrig?<span style="color:#a50">&#34;(already hijacked)&#34;</span>:<span style="color:#a50">&#34;&#34;</span>),<span style="color:#0aa">window</span>[d]=h;<span style="color:#00a">for</span>(a <span style="color:#00a">in</span> b)b.hasOwnProperty(a)&amp;&amp;(<span style="color:#0aa">window</span>[d][a]=b[a])};<span style="color:#00a">if</span>(f(<span style="color:#a50">&#34;Config:&#34;</span>,c),e||(f(<span style="color:#a50">&#34;Instantiate GA command queue&#34;</span>),e=<span style="color:#0aa">window</span>[d]=<span style="color:#00a">function</span>(){(<span style="color:#0aa">window</span>[d].q=<span style="color:#0aa">window</span>[d].q||[]).push(arguments)},e.l=<span style="color:#099">1</span>*<span style="color:#00a">new</span> <span style="color:#0aa">Date</span>),e.getAll)f(<span style="color:#a50">&#34;GA already loaded; cannot see previous commands&#34;</span>),i();<span style="color:#00a">else</span>{<span style="color:#00a">if</span>(!e.l)<span style="color:#00a">throw</span> <span style="color:#00a">new</span> <span style="color:#0aa">Error</span>(<span style="color:#a50">&#34;[&#34;</span>+c.debugLogPrefix+<span style="color:#a50">&#34;] Aborting; `&#34;</span>+d+<span style="color:#a50">&#34;` not the GA object.&#34;</span>);<span style="color:#00a">if</span>(f(<span style="color:#a50">&#34;Command queue instantiated, but library not yet loaded&#34;</span>),e.q&amp;&amp;e.q.length;){<span style="color:#00a">for</span>(f(<span style="color:#a50">&#34;Applying listener to&#34;</span>,e.q.length,<span style="color:#a50">&#34; queued commands&#34;</span>),j=[],k=<span style="color:#099">0</span>;k -<span style="color:#099">1</span>; })[<span style="color:#099">0</span>]
                               .description;
      <span style="color:#00a">var</span> errorHit = data.hitParsingResult[<span style="color:#099">0</span>].hit;
      <span style="color:#0aa">window</span>.dataLayer.push({
        event: <span style="color:#a50">&#39;gaValidationError&#39;</span>,
        gaValidationError: {
          description: errorDescription,
          hit: errorHit
        }
      });
    };
    
    <span style="color:#aaa;font-style:italic">// If a &#39;send&#39; command is registered, start the process
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">if</span> (<span style="color:#00a">typeof</span> ga === <span style="color:#a50">&#39;function&#39;</span> &amp;&amp; trackerName &amp;&amp; gaCommand === <span style="color:#a50">&#39;send&#39;</span>) {
      ga(<span style="color:#00a">function</span>() {
        tracker = ga.getByName(trackerName);
        <span style="color:#00a">if</span> (!tracker.get(<span style="color:#a50">&#39;debugDone&#39;</span>)) {
          originalSendTask = tracker.get(<span style="color:#a50">&#39;sendHitTask&#39;</span>);
          tracker.set(<span style="color:#a50">&#39;sendHitTask&#39;</span>, buildDebugHit);
        }
      });
    }
  } <span style="color:#00a">catch</span>(e) {
    <span style="color:#aaa;font-style:italic">// Error handling
</span><span style="color:#aaa;font-style:italic"></span>  }
});
&lt;/<span style="color:#1e90ff;font-weight:bold">script</span>&gt;</code></pre></div>
<p>This solution uses <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">Universal Analytics Tasks API</a> to copy the hit payload sent to Google Analytics, and to send it then to the debugger endpoint.</p>
<p>Since you&rsquo;re actually &ldquo;hijacking&rdquo; Google Analytics here, it&rsquo;s very important that <strong>you test this thoroughly</strong>. To see if it works, you should see a POST request to /debug/collect for each actual hit to /collect. You can find this in the Network debugger of your browser&rsquo;s developer tools. Here&rsquo;s what the output looks like in Chrome:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/network-debugger.jpg" title="Network debugger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/network-debugger.jpg#ZgotmplZ" alt="Network debugger">
  
    </a>
  
  
</div>


<p>Again, remember to test it.</p>
<h4 id="send-the-information-to-google-analytics">Send the information to Google Analytics</h4>
<p>To send the validation error hits to Google Analytics, you&rsquo;ll need a <strong>Universal Analytics tag</strong>, two <strong>Data Layer variables</strong> and a <strong>Custom Event trigger</strong>.</p>
<p>The <strong>Data Layer variables</strong> should point to variable names <code>gaValidationError.description</code> and <code>gaValidationError.hit</code>. They might thus look something like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/data-layer-variables.jpg" title="Data Layer Variables">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/data-layer-variables.jpg#ZgotmplZ" alt="Data Layer Variables">
  
    </a>
  
  
</div>


<p>Next, the <strong>Custom Event Trigger</strong> is a simple affair, and looks like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/custom-event-trigger.jpg" title="Custom Event Trigger">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/custom-event-trigger.jpg#ZgotmplZ" alt="Custom Event Trigger">
  
    </a>
  
  
</div>


<p>Finally, the <strong>Universal Analytics tag</strong> is your run-of-the-mill Event tag, with just one important modification. You need to set a custom <strong>Fields to set</strong> field to:</p>
<p><strong>Field name:</strong> debugDone<br>
<strong>Value:</strong> true</p>
<p>Don&rsquo;t bother looking it up in the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference">supported field reference for analytics.js</a>, it&rsquo;s not there. It&rsquo;s a custom field I created only for this solution. It prevents two things: 1) Calls to the debug endpoint from multiplying when the same tracker is used, and 2) calls to the debug endpoint for the validation error events.</p>
<p>Here&rsquo;s what the Event tag might look like:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/12/event-tag.jpg" title="Universal Analytics Event Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2016/12/event-tag.jpg#ZgotmplZ" alt="Universal Analytics Event Tag">
  
    </a>
  
  
</div>


<p>This particular tag will send each validation error as a <a href="https://support.google.com/analytics/answer/1033068#NonInteractionEvents"><em>non-interaction event</em></a> to Google Analytics, with the error description as the Event Action and the broken hit payload as the Event Label.</p>
<h2 id="summary">Summary</h2>
<p>This solution relies on the awesomeness of <a href="https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">GA Spy</a>. The script basically hijacks the GA global method, and copies all commands to the debug endpoint.</p>
<p>What this solution does is give you yet another tool for validating your Google Analytics setup. When working with complex Google Tag Manager setups, it might be difficult to keep tabs on all the variables you are using. This might lead to problems in your tags, when a required field ends up with a blank value just because a variable didn&rsquo;t resolve in an expected way. This solution lets you find these cases with ease, giving you a clear path to fixing them before they become a real data quality problem.</p>
<p>It would be pretty neat to have the <code>/debug/</code> interface as a tool you could install locally. That way you wouldn&rsquo;t need to do the trip to Google Analytics servers, and instead validate the hits in your own web server. On the other hand, the logic isn&rsquo;t probably that complex, so having it as a dedicated JavaScript library would be great as well. In any case, the endpoint debugger is a really smooth tool, especially when combined with GA Spy as illustrated in this article.</p>
<p>Another thing that would make this whole thing easier was if the original request to <code>/collect</code> simply returned the debug payload automatically. That way you could just look at the responses to the GA requests without having to do the extra trip to <code>/debug/</code>. I understand this doesn&rsquo;t exist because of latency and how most hits to GA are still done with a GET request. Still, Google could at least make it a configurable setting in the GA request.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/debug/">debug</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/ga-spy/">ga spy</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/change-management-workspaces/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-analytics-client-id-amp-pages/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Log%20Failed%20Google%20Analytics%20Requests%20In%20Google%20Analytics%20https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/change-management-workspaces/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/google-analytics-client-id-amp-pages/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Log%20Failed%20Google%20Analytics%20Requests%20In%20Google%20Analytics%20https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Log%20Failed%20Google%20Analytics%20Requests%20In%20Google%20Analytics%20https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/log-failed-google-analytics-requests-google-analytics/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

