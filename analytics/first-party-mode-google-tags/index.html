

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "First-Party Mode For Google Tags | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2024\/07\/first-party-mode-diagram.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/first-party-mode-google-tags\/",
  "datePublished": "2024-07-22T07:00:00\u002b01:00",
  "dateModified": "2024-07-22T07:00:00\u002b01:00",
  "description": "A quick walkthrough of Google\u0027s First-Party Mode for Google Tags.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>First-Party Mode For Google Tags | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/first-party-mode-google-tags/">
    
    <meta name="description" content="A quick walkthrough of Google&#39;s First-Party Mode for Google Tags.">
    <meta property="og:description" content="A quick walkthrough of Google&#39;s First-Party Mode for Google Tags.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="First-Party Mode For Google Tags">
    <meta property="og:url" content="https://www.simoahava.com/analytics/first-party-mode-google-tags/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="First-Party Mode For Google Tags">
    <meta name="twitter:description" content="A quick walkthrough of Google&#39;s First-Party Mode for Google Tags.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
	  <meta property="og:image" content="https://www.simoahava.com/images/2024/07/first-party-mode-google-tags.jpg">
      <meta name="twitter:image" content="https://www.simoahava.com/images/2024/07/first-party-mode-google-tags.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" loading="lazy" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://masto.measure.chat/@SimoAhava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
    <div class="figure nocaption">
      <img class="cover" src="https://www.simoahava.com/images/2024/07/first-party-mode-google-tags.jpg" width="750" height="422" alt="First-Party Mode For Google Tags">
    </div>
  
  

    <h1>
      First-Party Mode For Google Tags
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2024-07-22T07:00:00&#43;01:00">
        
  July 22, 2024

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/first-party-mode-google-tags/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <p>Google <a href="https://developers.google.com/tag-platform/tag-manager/first-party/setup-guide.md">has released</a> a new feature, <strong>First-Party Mode</strong> (FPM), into public beta.</p>



<div style="aspect-ratio: 3016 / 1344;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/first-party-mode-diagram.jpg" title="First-party mode">
  
    <img class="fig-img" height="1344" width="3016" loading="lazy" src="https://www.simoahava.com/images/2024/07/first-party-mode-diagram.jpg#ZgotmplZ" alt="First-party mode">
  
    </a>
  
  
</div>


<p><a href="https://developers.google.com/tag-platform/tag-manager/first-party/setup-guide.md"><em>Image source</em></a></p>
<p>First-Party Mode seeks to make it easier to wrap Google&rsquo;s measurement and advertising technologies in a first-party, <em>same-origin</em> context.</p>
<p>This means that the user&rsquo;s browser, when visiting a website running FPM, would no longer communicate directly with Google&rsquo;s domains when fetching measurement libraries such as <strong>Google Tag</strong> or <strong>Google Tag Manager</strong>.</p>
<p>Instead, the requests would be sent to a <strong>subfolder</strong> of the website itself. A server process would then take these requests, forward them to Google&rsquo;s servers, and finally return the response (typically a JavaScript file) back to the web browser.</p>
<p>This would also apply to analytics and advertising pings.</p>
<p>Here&rsquo;s the distinction:</p>
<ol>
<li><strong>Regular setup (cross-site)</strong>: User navigates to <code>https://www.simoahava.com/</code>; requests are sent to <code>https://www.googletagmanager.com/</code>.</li>
<li><strong>First-party serving (same-site, cross-origin)</strong> with subdomain: User navigates to <code>https://www.simoahava.com/</code>; requests are sent to <code>https://sst.simoahava.com/</code>.</li>
<li><strong>First-Party Mode (same-site, same-origin)</strong> with subfolder: User navigates to <code>https://www.simoahava.com/</code>; requests are sent to <code>https://www.simoahava.com/metrics/</code>.</li>
</ol>
<p>With First-Party Mode services, (3) above, the browser only ever communicates with the domain of the website. Read on to understand why this can be significant.</p>
<p>This article is an overview of First-Party Mode, as well as a discussion starter on the (relative) benefits and (potential) risks involved.</p>
<p>If you want to jump over the technical stuff and go straight to my thoughts on the matter, follow <a href="#whats-the-point">this link</a>.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#how-does-it-work">How does it work?</a>
      <ul>
        <li><a href="#server-side-google-tag-manager">Server-side Google Tag Manager</a></li>
        <li><a href="#how-to-set-it-up">How to set it up</a></li>
      </ul>
    </li>
    <li><a href="#so-whats-the-point">So, what&rsquo;s the point?</a>
      <ul>
        <li><a href="#additional-layer-of-control">Additional layer of control</a></li>
        <li><a href="#circumvent-ad-blockers">Circumvent ad blockers</a></li>
        <li><a href="#webkits-first-party-cookie-expiration">WebKit&rsquo;s first-party cookie expiration</a></li>
        <li><a href="#content-security-policy">Content Security Policy</a></li>
      </ul>
    </li>
    <li><a href="#frequently-raised-comments">Frequently raised comments</a>
      <ul>
        <li><a href="#same-site-vs-same-origin">Same-site vs. same-origin</a></li>
        <li><a href="#this-has-been-done-before">This has been done before</a></li>
        <li><a href="#cat-and-mouse-game">Cat and mouse game</a></li>
        <li><a href="#ad-blocker-heuristics">Ad blocker heuristics</a></li>
        <li><a href="#legal-and-regulatory-context">Legal and regulatory context</a></li>
      </ul>
    </li>
    <li><a href="#my-summary-review-of-first-party-mode">My summary review of First-Party Mode</a></li>
  </ul>
</nav></div>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="how-does-it-work">How does it work?</h2>
<p>With First-Party Mode, the website reserves a <strong>subfolder</strong> like <code>/metrics</code> that is <em>not used for any other purpose</em> (this is important!).</p>
<p>For FPM to work, the website infrastructure itself should support rerouting specific requests and modifying their request headers.</p>
<p>This infrastructure could comprise a <a href="https://cloud.google.com/load-balancing/docs/application-load-balancer">load balancer</a>, a <a href="https://cloud.google.com/cdn?hl=en">CDN</a>, an <a href="https://developers.cloudflare.com/rules/origin-rules/">edge service</a>, or a <a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">proxy server</a>, for example.</p>



<div style="aspect-ratio: 1946 / 340;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/routing-rules.jpg" title="Routing rules">
  
    <img class="fig-img" height="340" width="1946" loading="lazy" src="https://www.simoahava.com/images/2024/07/routing-rules.jpg#ZgotmplZ" alt="Routing rules">
  
    </a>
  
  
</div>


<p>This technology is then configured to route requests collected at a specific path (e.g. <code>/metrics</code>) to a Google host reserved for the tagging container of the website.</p>
<p>Google receives the request, processes it, and finally returns a response back to the browser using the same channel.</p>
<h3 id="server-side-google-tag-manager">Server-side Google Tag Manager</h3>
<p>If you&rsquo;ve been using <a href="https://www.simoahava.com/analytics/server-side-tagging-google-tag-manager/">server-side Google Tag Manager</a>, you&rsquo;ll know that you have already had the capability to do something like this.</p>
<p>Loading <a href="https://developers.google.com/tag-platform/tag-manager/server-side/dependency-serving">Google dependencies</a> from your own server is baked into the application, and if you&rsquo;ve deployed with a <a href="https://developers.google.com/tag-platform/tag-manager/server-side/custom-domain?option=same-origin">same-origin setup</a>, you already have &ldquo;first-party mode&rdquo; in use.</p>



<div style="aspect-ratio: 1764 / 502;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/gtm-client.jpg" title="GTM client">
  
    <img class="fig-img" height="502" width="1764" loading="lazy" src="https://www.simoahava.com/images/2024/07/gtm-client.jpg#ZgotmplZ" alt="GTM client">
  
    </a>
  
  
</div>


<p>However, server-side GTM is a fully-fledged <strong>application service</strong> that is designed to do powerful data pipeline tasks. It&rsquo;s not necessarily best suited for transporting potentially large scripts and files. That&rsquo;s what a dedicated content distribution network (CDN) service is for.</p>
<p>You can actually <strong>combine</strong> First-Party Mode and server-side Google Tag Manager. Set up FPM for library requests, and use the <a href="https://developers.google.com/tag-platform/tag-manager/server-side/send-data?option=gtag#1_send_data_from_a_website_to_your_server-side_container_"><code>server_container_url</code> field in Google Tag</a> to collect analytics and measurement pings to server-side GTM.</p>



<div style="aspect-ratio: 1920 / 1080;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/s-gtm-setup.jpg" title="SGTM setup">
  
    <img class="fig-img" height="1080" width="1920" loading="lazy" src="https://www.simoahava.com/images/2024/07/s-gtm-setup.jpg#ZgotmplZ" alt="SGTM setup">
  
    </a>
  
  
</div>


<p>It&rsquo;s a pretty smooth setup. If you configure the Google Tag Manager <strong>web container</strong> to load through FPM, then any subsequent Google Tag library loads (Google Analytics 4, Google Ads, for example), will <strong>automatically</strong> load through FPM, too.</p>
<h3 id="how-to-set-it-up">How to set it up</h3>
<p>Google has detailed instructions for setting up FPM using <a href="https://developers.google.com/tag-platform/tag-manager/first-party/setup-guide#google-cloud">Google Cloud load balancing</a> or <a href="https://developers.google.com/tag-platform/tag-manager/first-party/setup-guide#cloudflare">Cloudflare</a>.</p>
<blockquote>
<p><strong>Note!</strong> If you want to use Cloudflare, you need an expensive <strong>Enterprise</strong> subscription to manage this setup.</p>
</blockquote>
<p>Remember that the main requirement is that your <strong>website domain</strong> points to this service, too.</p>
<p>It&rsquo;s not enough to set up a load balancer <em>just</em> for First-Party Mode. All of your website traffic needs to flow through this entry point – the routing rules then redirect the subfolder traffic to the Google host.</p>
<p>If your site uses some other CDN or load balancer than Google Cloud or Cloudflare, you can follow the steps outlined in <a href="https://developers.google.com/tag-platform/tag-manager/first-party/setup-guide#other">the documentation</a>.</p>
<ol>
<li>You need to add an origin or backend to your setup that points to <code>&lt;tag id&gt;.fps.goog</code>.</li>
<li>For requests to this backend, override the <code>Host</code> header to be equal to <code>&lt;tag id&gt;.fps.goog</code>. Allow all cookies and query strings to be forwarded (this is usually the default).</li>
<li>Add a route rule that forwards <code>/metrics</code> traffic to this backend.</li>
<li>Configure this route rule to have the highest priority.</li>
<li><strong>Important!</strong> Update your tag snippet(s) to load the respective library from <code>https://www.yoursite.com/metrics/</code> rather than from Google&rsquo;s domain.</li>
</ol>
<p>To test the setup, browse to <code>https://www.yoursite.com/metrics/healthy</code>. If the page shows the text <code>ok</code>, it means that First-Party Mode is working.</p>



<div style="aspect-ratio: 1016 / 242;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/healthy-response.jpg" title="Healthy response">
  
    <img class="fig-img" height="242" width="1016" loading="lazy" src="https://www.simoahava.com/images/2024/07/healthy-response.jpg#ZgotmplZ" alt="Healthy response">
  
    </a>
  
  
</div>



                
                  <h2 id="so-whats-the-point">So, what&rsquo;s the point?</h2>
<p>Advertisers, businesses, data companies, brokers, publishers, and hobby websites alike are facing data loss and quality degradation like never before.</p>
<p><a href="https://content-security-policy.com/">Content Security Policies</a>, <a href="https://www.cookiestatus.com/">browser tracking protections</a>, and ad (and content) blockers all target <em>third-party</em> services in an attempt to squash the data collection free-for-all that&rsquo;s been rampant over the past decades.</p>
<p>This is why First-Party Mode (and similar technologies) might sound tempting.</p>
<h3 id="additional-layer-of-control">Additional layer of control</h3>
<p>First of all, routing traffic through an upstream service point that <strong>you control</strong> is potentially a huge net positive for your compliance and data validation practices.</p>
<p>This is <em>my</em> main justification for <strong>server-side tagging</strong> – it gives you an incredible amount of control to prevent data-hungry vendors from leeching data from the user without restriction.</p>
<p>FPM gives control, too, but not to this extent. Many CDNs and Load Balancers allow you to remove information from the forwarded request, such as the <a href="https://developers.cloudflare.com/rules/transform/managed-transforms/reference/#remove-visitor-ip-headers">user&rsquo;s original IP address</a>.</p>
<p>Dropping the user&rsquo;s IP address is particularly important if using Google&rsquo;s <a href="https://support.google.com/google-ads/answer/10000067">Advanced Consent Mode</a>, as the IP address is considered personal data in the European Union.</p>



<div style="aspect-ratio: 2042 / 520;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/cloudflare-transform.jpg" title="Cloudflare transform">
  
    <img class="fig-img" height="520" width="2042" loading="lazy" src="https://www.simoahava.com/images/2024/07/cloudflare-transform.jpg#ZgotmplZ" alt="Cloudflare transform">
  
    </a>
  
  
</div>


<p>But that&rsquo;s about it – they don&rsquo;t let you selectively strip personal data from the request, and doing conditional blocking when the request lacks consent signals might be difficult to do.</p>
<p>So while FPM does give you <em>some</em> control, it&rsquo;s not the same as a fully-fledged application service like server-side Google Tag Manager.</p>
<p>There&rsquo;s also a <strong>big risk</strong> involved with forwarding <em>all</em> cookies to the Google host. There&rsquo;s a <em>lot</em> of information stored in browser cookies that a third party should not have access to, ranging from the innocuous but privacy-sensitive (e.g. vendor IDs) to data security risks (e.g. incorrectly stored authentication tokens).</p>
<blockquote>
<p>I received word from Google that they already have internal filters in place, automatically dropping non-Google cookies from the data that is processed. They are working on making this more transparent to users and audit trails.</p>
</blockquote>
<h3 id="circumvent-ad-blockers">Circumvent ad blockers</h3>
<p>First-Party Mode addresses the &ldquo;problem&rdquo; (<a href="#ad-blocker-heuristics">see below</a> why I put this word in quotes) of <strong>data loss</strong> due to <strong>ad blockers</strong>. Many ad blockers still rely on blocklists that have <strong>domain-matching</strong> patterns as their main heuristic.</p>
<p>Google&rsquo;s domains are <em>invariably</em> in these blocklists, as they are so deeply entrenched in the world of advertising technologies.</p>
<p>Since the browser no longer communicates with Google&rsquo;s domains directly, ad blockers have a tougher time blocking these requests.</p>
<p><em>However</em>, ad blockers aren&rsquo;t stupid. Some lists evolve at a glacial pace, but others are quicker to make a note of <em>domain masking</em> as a blocker workaround.</p>
<p>For example, <a href="https://easylist.to/">EasyPrivacy</a> looks at paths (<em>/gtm.js</em>) and even query parameters (<em>.js?id=GTM-</em>) to determine blockable requests.</p>



<div style="aspect-ratio: 862 / 284;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/easyprivacy.jpg" title="EasyPrivacy">
  
    <img class="fig-img" height="284" width="862" loading="lazy" src="https://www.simoahava.com/images/2024/07/easyprivacy.jpg#ZgotmplZ" alt="EasyPrivacy">
  
    </a>
  
  
</div>


<p>In this case, just switching the domain from <code>https://www.googletagmanager.com/</code> to <code>https://www.yoursite.com/</code> isn&rsquo;t enough, because the request <em>path</em> and <em>query string</em> is still matched by the blocklist.</p>
<p>Unless your first-party serving completely obfuscates the request path and query parameters so that they no longer resemble the original, ad blockers <em>will</em> catch up sooner rather than later.</p>
<h3 id="webkits-first-party-cookie-expiration">WebKit&rsquo;s first-party cookie expiration</h3>
<p>Another &ldquo;benefit&rdquo; that FPM introduces is a lifeline for <em>first-party cookies</em> whose expiration the WebKit browser engine <a href="https://webkit.org/tracking-prevention/#intelligent-tracking-prevention-itp">has tried to cap</a>. WebKit runs the Safari browser and (still) many iOS and iPadOS browser apps.</p>



<div style="aspect-ratio: 1562 / 418;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/webkit-protections.jpg" title="WebKit tracking preventions">
  
    <img class="fig-img" height="418" width="1562" loading="lazy" src="https://www.simoahava.com/images/2024/07/webkit-protections.jpg#ZgotmplZ" alt="WebKit tracking preventions">
  
    </a>
  
  
</div>


<p>With First-Party Mode, the tracking requests share the <strong>exact same domain</strong> as the website itself. They are, in fact, <strong>same-origin</strong> requests relative to the website. This means that WebKit&rsquo;s tracking protections <em>do not apply</em>, as they require at least a <em>whiff</em> of third-party in the request chain.</p>
<p>FPM moves the logic of data transfer (between the user and Google) from the browser to the web server, and web browsers do not have visibility to what goes on in the server.</p>
<h3 id="content-security-policy">Content Security Policy</h3>
<p>Yet another benefit of First-Party Mode: by communicating with the website instead of with Google&rsquo;s domains, the Content Security Policy (CSP) of the website can be made stricter.</p>
<p>This is because origins like <code>https://www.googletagmanager.com</code> can now be added to the CSP, as the browser no longer needs to send data to them.</p>
<p>While a stricter CSP is definitely a good thing, this benefit can be considered largely superficial.</p>
<p>Even though the browser no longer communicates with Google&rsquo;s services directly, it still ends up loading them – just via the website&rsquo;s domain rather than Google&rsquo;s CDN. So while <a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">cross-site scripting (XSS)</a> risks are mitigated, the issue of loading unreliable content is largely left unaddressed.</p>
<p>This means that if the purpose of the CSP is to prevent potentially harmful scripts from being loaded in the browser, FPM doesn&rsquo;t really change this risk profile at all. The scripts are still loaded, just through a more obscure pathway than before.</p>

                
                  <h2 id="frequently-raised-comments">Frequently raised comments</h2>
<p>Many discussions around First-Party Mode revolve around misunderstandings and knee-jerk reactions. I&rsquo;m often guilty of these, too.</p>
<p>Here&rsquo;s my attempt to address some of these comments that have been <a href="https://www.linkedin.com/posts/simoahava_google-has-released-first-party-mode-into-activity-7219234622721671169-sUFz">circulating online</a>.</p>
<h3 id="same-site-vs-same-origin">Same-site vs. same-origin</h3>
<p>A <strong>subdomain</strong> setup such as that often used with server-side Google Tag Manager is much easier to configure than a <strong>subfolder</strong> setup.</p>
<p>This is because a subdomain can be mapped with just DNS – the website itself can use a completely different technology stack.</p>
<p>A <em>subfolder</em> needs the website itself to be running through the same service that does the routing. You can&rsquo;t configure DNS for a subfolder – the &ldquo;D&rdquo; in DNS stands for &ldquo;Domain&rdquo;.</p>
<p>A subdomain is <em>same-site</em> and <em>cross-origin</em>. A subfolder is <em>same-site</em> and <em>same-origin</em>. This is the main distinction.</p>
<h3 id="this-has-been-done-before">This has been done before</h3>
<p>This is not new technology. Reverse proxies have existed for ages, and the aforementioned <strong>server-side Google Tag Manager</strong> has supported first-party serving for years.</p>
<p>Similarly, it&rsquo;s been trivial to configure transparent request forwarding with <a href="https://developers.cloudflare.com/workers/">Cloudflare Workers</a>.</p>
<p>First-Party Mode wasn&rsquo;t introduced as a <strong>novelty</strong> or a <strong>game-changing technology paradigm</strong>. Google released FPM to make it <strong>easier</strong> to configure first-party serving without having to invest in more complicated (and expensive) tech like server-side Google Tag Manager.</p>
<p>Google&rsquo;s goal is to level the playing field for all their customers, not just those who have the resources to build complicated machinery for data pipelines.</p>
<p>Even though FPM is out of reach for many of Google&rsquo;s customers due to lack of access to the kind of technology that request routing requires, it&rsquo;s likely that they will add even more support for different hosting and CMS systems in the future.</p>
<h3 id="cat-and-mouse-game">Cat and mouse game</h3>
<p>Using FPM to get longer cookie lifetimes in WebKit browsers is, for lack of a better expression, <strong>totally lame</strong>. It&rsquo;s boring. It&rsquo;s unreliable. It lacks vision. It&rsquo;s a waste of time and money. It can even be downright risky.</p>
<p>Why unreliable? Well, WebKit has been known to make <a href="https://webkit.org/blog/8613/intelligent-tracking-prevention-2-1/">bold moves</a>. If WebKit notices that a significant number of sites are circumventing their CNAME cloaking mitigation with a same-origin workaround, they&rsquo;ll do something about this.</p>
<p>However, <em>what</em> they can do about it remains unclear. As it&rsquo;s same-origin, the browser can&rsquo;t distinguish between tracking requests and &ldquo;normal&rdquo; website requests, at least on the DNS level.</p>
<p>WebKit would need to start doing pattern matching against a list of known tracking patterns, perhaps using <a href="https://www.simoahava.com/privacy/intelligent-tracking-prevention-ios-14-ipados-14-safari-14/">Tracker Radar</a> as they already do in private browsing mode.</p>



<div style="aspect-ratio: 1190 / 854;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2024/07/privacy-report.jpg" title="Privacy report in Safari">
  
    <img class="fig-img" height="854" width="1190" loading="lazy" src="https://www.simoahava.com/images/2024/07/privacy-report.jpg#ZgotmplZ" alt="Privacy report in Safari">
  
    </a>
  
  
</div>


<p>But this would be trivial to circumvent by encoding the path and query string patterns and decoding them before the request is routed.</p>
<p>If I had to place my bets on a <em>bold</em> move, I&rsquo;d imagine WebKit would shift towards capping <strong>all</strong> first-party storage access <strong>without exception</strong>. This would certainly prevent workarounds.</p>
<p>Or perhaps as a compromise they&rsquo;ll revitalize the discussion around the <a href="https://github.com/privacycg/is-logged-in">isLoggedIn API</a>, allowing <em>some</em> first-party storage access, if it can be proved that the user is logged in to the website.</p>
<h3 id="ad-blocker-heuristics">Ad blocker heuristics</h3>
<p>If using FPM to circumvent WebKit&rsquo;s protections is lame, then using first-party setups to circumvent ad blockers is even more so. It&rsquo;s also ethically questionable.</p>
<p><strong>Users have the right to block whatever resources they like</strong>. It&rsquo;s their browser. It&rsquo;s their agency. Some users might use ad blockers to prevent data harvesting, some might use them for data security, and some might use blockers to enjoy a faster browsing experience. It&rsquo;s their right, and you can never know what the user&rsquo;s motivation for using a blocker was.</p>
<blockquote>
<p>If you want to start a debate with me about an advertising-fuelled open web being at risk, then take it elsewhere. Recalibrate your argument to be about the <strong>broken state of ad tech</strong> rather than about users taking back control.</p>
</blockquote>
<p>There&rsquo;s also a tangible risk with a same-origin setup. Ad blockers might flag your <strong>website domain</strong> as a tracking domain if it&rsquo;s prominent enough and if it clearly and visibly circumvents ad blockers with a same-origin workaround.</p>
<p>It wouldn&rsquo;t be nice to have your website blocked globally.</p>
<h3 id="legal-and-regulatory-context">Legal and regulatory context</h3>
<p>From a legal or regulatory point-of-view, at least in the European Union, FPM doesn&rsquo;t really change anything.</p>
<p>You <em>still</em> need a legal basis to process the user&rsquo;s personal data (GDPR). You <em>still</em> need consent to access storage on the user&rsquo;s device (ePrivacy Directive).</p>
<p>First-Party Mode is about organizing the technology stack of the website to act as an upstream router for marketing signals. Vendors still end up receiving the same data they would receive without FPM in use. The compliance requirements, the applicable legal frameworks, the responsibilities of involved parties – they all remain the same.</p>

                
                  <h2 id="my-summary-review-of-first-party-mode">My summary review of First-Party Mode</h2>
<p>First-Party Mode is quite obviously a first step in a more comprehensive collection pipeline overhaul that Google is planning. What the next steps are remains uncertain, but it&rsquo;s clear this isn&rsquo;t the last we&rsquo;ll hear about FPM.</p>
<p>In its current shape, it&rsquo;s still out of reach for many of Google&rsquo;s customers. Same as a <a href="https://developers.google.com/tag-platform/tag-manager/server-side/custom-domain?option=same-origin">same-origin setup for server-side Google Tag Manager</a>, it requires a certain type of website infrastructure to already be in place.</p>
<p>Not all websites are hosted on (or behind) a service that allows you to create additional routing and origin rules.</p>
<p>As such, it&rsquo;s an interesting proposition by Google. It&rsquo;s also quite a bit of work (and potentially expensive) for just a few benefits.</p>
<p>Circumventing ad blockers and getting longer cookie lifetimes on WebKit&rsquo;s browsers isn&rsquo;t worth the investment <em>in my opinion</em>.</p>
<p>This is also one of the reasons I&rsquo;m a strong proponent of a <em>subdomain</em> setup over a <em>subfolder</em> setup for server-side GTM. It&rsquo;s just common sense to separate the volatile and potentially risky marketing data flow from the website&rsquo;s network routes.</p>
<p>So there has to be more to this. What&rsquo;s Google&rsquo;s big plan with FPM? What&rsquo;s so special about it that incentivizes Google to push their customers to it instead of towards server-side Google Tag Manager?</p>
<p>Will Google soon offer a setup similar to <a href="https://developers.facebook.com/docs/marketing-api/conversions-api/guides/gateway/">Meta&rsquo;s Conversions API Gateway</a>, where they&rsquo;ll allow customers to make use of first-party serving at scale and at low cost?</p>
<p>Time will tell.</p>
<p>Right now, if your website infrastructure supports the type of routing that First-Party Mode requires, maybe it&rsquo;s worth giving it a spin. Perhaps you&rsquo;ll recover enough data to make it worth the investment.</p>
<p>If your website is hosted in a way that does <em>not</em> support a same-origin setup for your marketing data, I&rsquo;m not sure if you should migrate given that the benefits of First-Party Mode are as few as they seem to be.</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics-4/">google analytics 4</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/server-side/">server-side</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtmtips/automatic-page-view-hits-to-sgtm-after-consent-granted/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=First-Party%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/first-party-mode-google-tags/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtmtips/automatic-page-view-hits-to-sgtm-after-consent-granted/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=First-Party%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/first-party-mode-google-tags/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
          <i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=First-Party%20Mode%20For%20Google%20Tags%20https://www.simoahava.com/analytics/first-party-mode-google-tags/%20via%20@SimoAhava">
          <i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/first-party-mode-google-tags/">
          <i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

