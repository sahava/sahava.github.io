

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Track Core Web Vitals In GA4 With Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2021\/01\/vitals-recommendations.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/track-core-web-vitals-in-ga4-with-google-tag-manager\/",
  "datePublished": "2021-01-26T07:00:00\u002b02:00",
  "dateModified": "2021-01-26T07:00:00\u002b02:00",
  "description": "A guide for measuring Core Web Vitals (LCP, FID, and CLS) in Google Analytics 4 using Google Tag Manager and a custom template from the template gallery.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Track Core Web Vitals In GA4 With Google Tag Manager | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article', environment:  null });
    </script>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
    
    <meta name="description" content="A guide for measuring Core Web Vitals (LCP, FID, and CLS) in Google Analytics 4 using Google Tag Manager and a custom template from the template gallery.">
    <meta property="og:description" content="A guide for measuring Core Web Vitals (LCP, FID, and CLS) in Google Analytics 4 using Google Tag Manager and a custom template from the template gallery.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Track Core Web Vitals In GA4 With Google Tag Manager">
    <meta property="og:url" content="https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Track Core Web Vitals In GA4 With Google Tag Manager">
    <meta name="twitter:description" content="A guide for measuring Core Web Vitals (LCP, FID, and CLS) in Google Analytics 4 using Google Tag Manager and a custom template from the template gallery.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
	  <meta property="og:image" content="https://www.simoahava.com/images/2021/01/track-core-web-vitals-in-ga4-with-google-tag-manager.jpg">
      <meta name="twitter:image" content="https://www.simoahava.com/images/2021/01/track-core-web-vitals-in-ga4-with-google-tag-manager.jpg">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="_progress"></div>
    
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
    <div class="figure nocaption">
      <img class="cover" src="https://www.simoahava.com/images/2021/01/track-core-web-vitals-in-ga4-with-google-tag-manager.jpg">
    </div>
  
  

    <h1>
      Track Core Web Vitals In GA4 With Google Tag Manager
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2021-01-26T07:00:00&#43;02:00">
        
  January 26, 2021

      </time>
      
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


      | <a href="https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                
  	        <blockquote>
<p><strong>Updated 26 May 2021</strong>: Added details about the new <strong>Namespace Objects</strong> option in the template.</p>
</blockquote>
<p><strong>Core Web Vitals</strong> is described on the dedicated <a href="https://web.dev/vitals/">web.dev resource</a> as (emphasis mine):</p>
<blockquote>
<p>&ldquo;Core Web Vitals are the subset of Web Vitals that apply to all pages, <strong>should be measured by all site owners</strong>, and will be surfaced across all Google tools.&rdquo;</p>
</blockquote>



<div class="figure " >
  
    <a href="https://www.simoahava.com/images/2021/01/vitals-recommendations.jpg" title="Recommended Core Web Vitals thresholds - from https://web.dev/vitals/">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/vitals-recommendations.jpg#ZgotmplZ" alt="Recommended Core Web Vitals thresholds - from https://web.dev/vitals/" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1560 514'%3E%3C/svg%3E">
  
    </a>
  
   
    <span class="caption">Recommended Core Web Vitals thresholds - from https://web.dev/vitals/</span>
  
</div>


<p>The <strong>Core</strong> Web Vitals measurement as suggested by Google are:</p>
<ul>
<li><a href="https://web.dev/lcp/">Largest Contentful Paint</a> (LCP), which measures the time it took to load the largest image or text block in the viewport. This should optimally be below <strong>2500 milliseconds</strong>.</li>
<li><a href="https://web.dev/fid/">First Input Delay</a> (FID), which measures the time it took for the browser to react to user interaction (e.g. click or tap). This should optimally be below <strong>100 milliseconds</strong>.</li>
<li><a href="https://web.dev/cls/">Cumulative Layout Shift</a> (CLS), which measures the extent of <em>unexpected</em> shifts in layout during the lifetime of the page. This should optimally have a score of <strong>less than 0.1</strong>.</li>
</ul>
<p>Tracking Core Web Vitals has already been explored quite thoroughly in articles such as <a href="https://www.tagmanageritalia.it/advanced-guide-how-to-track-core-web-vitals-with-google-tag-manager/">this TagManagerItalia piece</a>, but I wanted to contribute to the discussion with something unique.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[–hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#get-the-template">Get the template</a></li>
    <li><a href="#test-it">Test it</a></li>
    <li><a href="#the-datalayer-object">The dataLayer object</a></li>
    <li><a href="#create-the-google-tag-manager-trigger-and-variables">Create the Google Tag Manager trigger and variables</a>
      <ul>
        <li><a href="#the-custom-event-trigger">The Custom Event trigger</a></li>
        <li><a href="#the-data-layer-variables">The Data Layer variables</a></li>
      </ul>
    </li>
    <li><a href="#send-the-data-to-universal-analytics">Send the data to Universal Analytics</a></li>
    <li><a href="#send-the-data-to-google-analytics-4">Send the data to Google Analytics 4</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
<p>In this article, I&rsquo;ll show you how to use a <a href="https://www.simoahava.com/custom-templates/core-web-vitals/">new custom template</a> to set up the Core Web Vitals tracking without having to use Custom HTML tags. I&rsquo;ll also show how to use this template&rsquo;s output to send the data to <a href="https://www.simoahava.com/analytics/implementation-guide-events-google-analytics-4/">Google Analytics 4</a>.</p>
<blockquote>
<p>Huge thanks to <a href="https://web.dev/authors/philipwalton/">Philip Walton</a> of Google for clarifying many of the things in this article. Philip is the author behind the Web Vitals content on <a href="https://web.dev/vitals/">web.dev</a> among other things, so do yourself a favor and subscribe to his content on <a href="https://www.twitter.com/philwalton/">Twitter</a>, <a href="https://github.com/philipwalton">GitHub</a>, and on his <a href="https://philipwalton.com/">blog</a>.</p>
</blockquote>

                <span class="simmer">
  <span class="close">X</span>
  <p>
    <span class="fa fa-md fa-bell"></span>
    <strong>The Simmer Newsletter</strong>
  </p>
  <p>
    Subscribe to the <a href="https://www.simoahava.com/newsletter/">Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!
  </p>
  </span>

                
                  <h2 id="get-the-template">Get the template</h2>
<p>To load the template, go to the Google Tag Manager UI, and click the <strong>Templates</strong> navigation.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/templates-gtm-ui.jpg" title="Templates GTM UI">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/templates-gtm-ui.jpg#ZgotmplZ" alt="Templates GTM UI" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1254 812'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Next, click the <strong>Search Gallery</strong> button in the <strong>Tag Templates</strong> area.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/search-gallery.jpg" title="search gallery">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/search-gallery.jpg#ZgotmplZ" alt="search gallery" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2016 168'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>In the overlay, search for the template titled <code>Core Web Vitals</code>, select it, and click the <strong>Add to workspace</strong> button, following any prompts to get the job done.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/add-to-workspace.jpg" title="Add To Workspace">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/add-to-workspace.jpg#ZgotmplZ" alt="Add To Workspace" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1584 1182'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Once the template has been added to your workspace, you can open the <strong>Tags</strong> view from the navigation and click to create a new tag.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/new-tag.jpg" title="New Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/new-tag.jpg#ZgotmplZ" alt="New Tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2512 494'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Choose the new <strong>Core Web Vitals</strong> custom template for the tag.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/core-web-vitals-tag-type.jpg" title="tag type">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/core-web-vitals-tag-type.jpg#ZgotmplZ" alt="tag type" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1572 556'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The only configuration in the tag is the <strong>Namespace Objects</strong> setting, which is <strong>off</strong> by default. If you check the box, then the object pushed into <code>dataLayer</code> will store each measurement <em>type</em> (LCP, CLS, FID) in its own namespace under the <code>webVitalsMeasurement</code> top-level Data Layer key. See below for an example.</p>
<p>Add the <strong>All Pages</strong> trigger to it. If you only want it to work on certain pages, use a Page View trigger with a suitable trigger condition instead.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/05/core-web-vitals-tag-example.jpg" title="All Pages Trigger with tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/05/core-web-vitals-tag-example.jpg#ZgotmplZ" alt="All Pages Trigger with tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1870 1242'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Save the tag when ready.</p>

                
                  <h2 id="test-it">Test it</h2>
<p>Next, go to <a href="https://www.simoahava.com/analytics/new-preview-mode-google-tag-manager/">preview mode</a> by clicking the Preview button in the user interface.</p>
<p>Once browsing your site in preview mode, reload the page <strong>and wait for it to completely load</strong> (some Core Web Vitals do not function if the page loads in the background). Click around a bit for good measure.</p>
<blockquote>
<p>In fact, if you want to collect FID there <em>must</em> be a user interaction registered on the page. Interacting with the page will also have the effect of finalizing the LCP report, as the resolving of the largest element in the viewport stops as soon as a user interaction is received.</p>
</blockquote>
<p>When you switch to the preview mode tab, you should ideally see <strong>three</strong> <code>coreWebVitals</code> events in the list. Sometimes you&rsquo;ll only see two, for example if <strong>FID</strong> didn&rsquo;t register. Sometimes you&rsquo;ll see more than three, for example if the metrics are re-evaluated before a user interaction is received or the tab/browser is backgrounded.</p>
<blockquote>
<p>The best way to ensure all three core web vitals are reported is to allow the page to load completely in the foreground, click around a bit, and then change the tab to Preview mode.</p>
</blockquote>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/preview-mode-output.jpg" title="Preview mode output">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/preview-mode-output.jpg#ZgotmplZ" alt="Preview mode output" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1084 886'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Select one of the events and expand the <strong>API Call</strong> view. You should see something like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/api-call-view.jpg" title="API call view">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/api-call-view.jpg#ZgotmplZ" alt="API call view" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 854 568'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="the-datalayer-object">The dataLayer object</h2>
<p>This is what the <code>dataLayer</code> object contains:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Sample value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event</code></td>
<td><code>'coreWebVitals'</code></td>
<td>The event name – always <code>coreWebVitals</code>.</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.name</code></td>
<td><code>'FID'</code></td>
<td>One of <code>LCP</code>, <code>FID</code>, <code>CLS</code>.</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.id</code></td>
<td><code>'v1-123123123-234234234'</code></td>
<td>A unique ID per measurement per page. Can be used to associate multiple CLS measurements with a single page load.</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.value</code></td>
<td><code>123.55</code></td>
<td>Value in milliseconds (for <code>LCP</code> and <code>FID</code>), or the <strong>score</strong> for CLS.</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.delta</code></td>
<td><code>17.77</code></td>
<td>Delta to the previous measurement on the same page (relevant for CLS).</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.valueRounded</code></td>
<td><code>124</code></td>
<td>Value rounded to the nearest integer. CLS score is first multiplied by 1000 to get a meaningful number.</td>
</tr>
<tr>
<td><code>webVitalsMeasurement.deltaRounded</code></td>
<td><code>18</code></td>
<td>Delta rounded to the nearest integer. CLS score is first multiplied by 1000 to get a meaningful number.</td>
</tr>
</tbody>
</table>
<p>If you have <strong>Namespace Objects</strong> selected, the measurement keys themselves (<code>name</code>, <code>id</code>, <code>value</code>, etc.) will be nested under the measurement name. So instead of <code>webVitalsMeasurement.id</code>, the key path would be <code>webVitalsMeasurement.FID.id</code>, if the measurement was for First Input Delay.</p>
<blockquote>
<p>One use case for checking <strong>Namespace Objects</strong> is if you want to send all CWV measurements with a single event. If you don&rsquo;t have Namespace Objects checked, each CWV measurement will overwrite the previous measurement in the Data Layer, meaning you&rsquo;ll only ever be able to access the most recent measurement, regardless of type.</p>
</blockquote>

                
                  <h2 id="create-the-google-tag-manager-trigger-and-variables">Create the Google Tag Manager trigger and variables</h2>
<p>To use these values in Google Tag Manager, you&rsquo;ll first need to create a <strong>Custom Event trigger</strong> and one <strong>Data Layer variable</strong> for each of the <code>webVitalsMeasurement</code> keys you want to measure.</p>
<h3 id="the-custom-event-trigger">The Custom Event trigger</h3>
<p>The Custom Event trigger should look like this:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/event-corewebvitals.jpg" title="Event - corewebvitals">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/event-corewebvitals.jpg#ZgotmplZ" alt="Event - corewebvitals" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2662 930'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Make sure you set <code>coreWebVitals</code> as the value of the <strong>Event Name</strong> field.</p>
<h3 id="the-data-layer-variables">The Data Layer variables</h3>
<p>Next, create these <strong>six</strong> Data Layer variables, using the image below as a model.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/dlv-webvitalsmeasurement-name.jpg" title="DLV - webVitalsMeasurement.name">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/dlv-webvitalsmeasurement-name.jpg#ZgotmplZ" alt="DLV - webVitalsMeasurement.name" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1724 1064'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<table>
<thead>
<tr>
<th>Variable name</th>
<th>Data Layer Variable Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLV - webVitalsMeasurement.name</td>
<td><code>webVitalsMeasurement.name</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.id</td>
<td><code>webVitalsMeasurement.id</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.value</td>
<td><code>webVitalsMeasurement.value</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.delta</td>
<td><code>webVitalsMeasurement.delta</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.valueRounded</td>
<td><code>webVitalsMeasurement.valueRounded</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.deltaRounded</td>
<td><code>webVitalsMeasurement.deltaRounded</code></td>
</tr>
</tbody>
</table>
<p>Remember, if you have <strong>Namespace Objects</strong> selected, the variable names are different. Here&rsquo;s what you&rsquo;d need to create for FID, for example:</p>
<table>
<thead>
<tr>
<th>Variable name</th>
<th>Data Layer Variable Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>DLV - webVitalsMeasurement.FID.name</td>
<td><code>webVitalsMeasurement.FID.name</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.FID.id</td>
<td><code>webVitalsMeasurement.FID.id</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.FID.value</td>
<td><code>webVitalsMeasurement.FID.value</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.FID.delta</td>
<td><code>webVitalsMeasurement.FID.delta</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.FID.valueRounded</td>
<td><code>webVitalsMeasurement.FID.valueRounded</code></td>
</tr>
<tr>
<td>DLV - webVitalsMeasurement.FID.deltaRounded</td>
<td><code>webVitalsMeasurement.FID.deltaRounded</code></td>
</tr>
</tbody>
</table>

                
                  <h2 id="send-the-data-to-universal-analytics">Send the data to Universal Analytics</h2>
<p>To send the data to Universal Analytics, I recommend you follow this excellent guide on Tag Manager Italia: <a href="https://www.tagmanageritalia.it/advanced-guide-how-to-track-core-web-vitals-with-google-tag-manager/">How To Track Core Web Vitals With Google Tag Manager</a>.</p>
<p><strong>NOTE!</strong> One thing you&rsquo;ll need to do is set the <code>transport</code> field in your Universal Analytics tag to <code>beacon</code>:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/set-transport-beacon.jpg" title="Transport Beacon">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/set-transport-beacon.jpg#ZgotmplZ" alt="Transport Beacon" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1782 874'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>The <code>beacon</code> field ensures that the tag uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API">Beacon API</a>. The Beacon API is designed to &ldquo;protect&rdquo; asynchronous requests so that they complete even if the page has unloaded in the process. This is important for some of the Core Web Vitals measurements, which might not report a value until the user is about to leave the page.</p>
<blockquote>
<p>Note that GA4 does <em>not</em> require you to explicitly set anything for the hits to be sent with the Beacon API. It defaults to using <code>navigator.sendBeacon()</code> in all request.</p>
</blockquote>
<p>One other thing to keep in mind is that Universal Analytics <strong>only accepts integers</strong> into <em>Event value</em> and <em>Custom Metric</em> fields. For this reason, you&rsquo;ll need to use the <strong>DLV - webVitalsMeasurement.valueRounded</strong> and <strong>DLV - webVitalsMeasurement.deltaRounded</strong> variables instead of the raw values.</p>

                
                  <h2 id="send-the-data-to-google-analytics-4">Send the data to Google Analytics 4</h2>
<p>To send the data to Google Analytics 4, you&rsquo;ll need to use an <strong>Event tag</strong>, so go ahead and create one.</p>
<p>How you set the event name and properties is completely up to you, but this is how I built my event tag:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/ga4-event-tag.jpg" title="GA4 Event Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/ga4-event-tag.jpg#ZgotmplZ" alt="GA4 Event Tag" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2528 1478'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>I set the <strong>Event Name</strong> to the metric name that is collected (<code>LCP</code>, <code>FID</code>, or <code>CLS</code>). Remember that GA4 is moving to a more <em>semantic</em> approach in event naming, where the event name should reflect <em>what happened</em> rather than a generic label such as what Event Category used to be in Universal Analytics.</p>
<p>I chose to send the four &ldquo;raw&rdquo; parameters only, as GA4 can process floating-point values where Universal Analytics couldn&rsquo;t. The four parameter names I chose are:</p>
<ul>
<li><code>web_vitals_measurement_name</code> for the metric name.</li>
<li><code>web_vitals_measurement_id</code> for the metric ID.</li>
<li><code>web_vitals_measurement_value</code> for the <em>raw</em> metric value.</li>
<li><code>value</code> for the <em>raw</em> metric delta.</li>
</ul>
<blockquote>
<p>I&rsquo;m setting <code>value</code> to the metric <strong>delta</strong> because <code>value</code> is a recommended parameter for the main value of the event. I opted to use <code>delta</code> simply because it makes sense for CLS measurement. If the metric <strong>value</strong> was sent as the event <code>value</code> instead, then an aggregate of CLS would report inflated values as it would sum the totals rather than the deltas.</p>
</blockquote>
<p>Make sure the tag fires on the <strong>Custom Event trigger</strong> you created <a href="#the-custom-event-trigger">before</a>.</p>
<p>Once you&rsquo;ve saved the tag, you can test the setup again. Reset preview mode by clicking the Preview button, and load a page on the site. You should see your GA4 tag being fired, and if you open its contents you should see valid values being sent to GA4.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/values-sent-to-ga4.jpg" title="Values sent to GA4">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/values-sent-to-ga4.jpg#ZgotmplZ" alt="Values sent to GA4" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1862 1320'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Remember that GA4 can be debugged in its own preview mode interface by clicking the respective measurement ID in the top bar of the preview mode interface. Here you can select one of the events, such as <code>CLS</code>, to see exactly what was sent to GA4 in the HTTP request!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/preview-mode-ga4.jpg" title="Preview Mode GA4">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/preview-mode-ga4.jpg#ZgotmplZ" alt="Preview Mode GA4" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4318 1656'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Don&rsquo;t forget to check <a href="https://ken-williams.com/guide/installation/validating-google-analytics-4-with-debug-mode/"><strong>DebugView</strong></a> in the Google Analytics 4 interface as well!</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/debug-mode-output.jpg" title="Debug mode output">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/debug-mode-output.jpg#ZgotmplZ" alt="Debug mode output" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2592 1908'%3E%3C/svg%3E">
  
    </a>
  
  
</div>


<p>Finally, there&rsquo;s nothing as satisfying as watching the data flow into <a href="https://support.google.com/analytics/answer/9823238?hl=en"><strong>Google BigQuery</strong></a>.</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2021/01/bigquery-results.jpg" title="BigQuery results">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2021/01/bigquery-results.jpg#ZgotmplZ" alt="BigQuery results" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2042 1086'%3E%3C/svg%3E">
  
    </a>
  
  
</div>



                
                  <h2 id="summary">Summary</h2>
<p>I hope this article has been useful to you!</p>
<p>I particularly hope that the custom template introduced here will help you deploy Core Web Vitals tracking, as you can avoid working with pesky Custom HTML tags.</p>
<p>The template always fetches the <em>latest</em> version of the <code>web-vitals</code> library, which means that if a breaking change is introduced the template will break as well. I don&rsquo;t think this is very realistic, but even if it does happen, I&rsquo;ll be sure to fix the template as soon as this problem emerges.</p>
<p>Tracking Core Web Vitals makes a lot of sense, especially in Google Analytics 4 with its more liberal quotas and value type restrictions. Being on top of things when it comes to site performance is just so very important in this day and age, and everything starts with good data.</p>
<p>Please let me know in the comments if you have questions about this solution!</p>

                
              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/core-web-vitals/">core web vitals</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/custom-templates/">custom templates</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics-4/">google analytics 4</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/ga4/">ga4</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/personal/simmer-is-live/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtmtips/write-client-id-other-gtag-fields-datalayer/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Track%20Core%20Web%20Vitals%20In%20GA4%20With%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/personal/simmer-is-live/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtmtips/write-client-id-other-gtag-fields-datalayer/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Track%20Core%20Web%20Vitals%20In%20GA4%20With%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Track%20Core%20Web%20Vitals%20In%20GA4%20With%20Google%20Tag%20Manager%20https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/track-core-web-vitals-in-ga4-with-google-tag-manager/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

