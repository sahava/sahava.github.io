

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "#GTMTips: Trigger Javascript Function Without Using A Custom HTML Tag | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2019\/01\/trigger-javascript-using-customtask.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/analytics\/trigger-javascript-without-using-custom-html-tag\/",
  "datePublished": "2019-01-17T19:39:15\x2b02:00",
  "dateModified": "2019-01-17T19:39:15\x2b02:00",
  "description": "Use customTask and a dummy Universal Analytics tag in Google Tag Manager to trigger JavaScript code without having to use a Custom HTML tag.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>#GTMTips: Trigger Javascript Function Without Using A Custom HTML Tag | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/trigger-javascript-without-using-custom-html-tag/">
    
    <meta name="description" content="Use customTask and a dummy Universal Analytics tag in Google Tag Manager to trigger JavaScript code without having to use a Custom HTML tag.">
    <meta property="og:description" content="Use customTask and a dummy Universal Analytics tag in Google Tag Manager to trigger JavaScript code without having to use a Custom HTML tag.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="#GTMTips: Trigger Javascript Function Without Using A Custom HTML Tag">
    <meta property="og:url" content="https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="#GTMTips: Trigger Javascript Function Without Using A Custom HTML Tag">
    <meta name="twitter:description" content="Use customTask and a dummy Universal Analytics tag in Google Tag Manager to trigger JavaScript code without having to use a Custom HTML tag.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2019/01/trigger-javascript-using-customtask.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2019/01/trigger-javascript-using-customtask.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      #GTMTips: Trigger Javascript Function Without Using A Custom HTML Tag
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2019-01-17T19:39:15&#43;02:00">
        
  January 17, 2019

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/gtm-tips">GTM tips</a>
    
  


       | <a href="https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>The <strong>Custom HTML tag</strong> in <a href="https://tagmanager.google.com/">Google Tag Manager</a> is splendid. It's your go-to tool when you need to run arbitrary JavaScript on the webpage. Some might even use it to actually add HTML elements to the page, but I'm willing to bet running JavaScript is its most common use.</p>
<p>However, there's a downside to Custom HTML tags, which is only made more apparent on single-page apps which do not clear the full page when transitioning from one state to another. Custom HTML tags are <strong>injected to the end of <code>&lt;body&gt;</code></strong>, which means you might end up with a <strong>lot</strong> of clutter in your Document Object Model.</p>
<p>In this article, I'll show you a pretty neat trick. We'll use <a href="https://www.simoahava.com/analytics/customtask-the-guide/"><code>customTask</code></a> to run a &ldquo;dummy&rdquo; Universal Analytics tag, whose only purpose is to execute your JavaScript code when the tag is triggered. This way, nothing is injected into the DOM, and the only overhead you'll run is the initial effort of creating the Google Analytics tracker.</p>
<h2 id="tip-94-trigger-custom-javascript-without-using-a-custom-html-tag">Tip 94: Trigger custom JavaScript without using a Custom HTML tag</h2>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/trigger-javascript-using-customtask.jpg" title="Trigger JavaScript without a Custom HTML tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/trigger-javascript-using-customtask.jpg#ZgotmplZ" alt="Trigger JavaScript without a Custom HTML tag">
  
    </a>
  
  
</div>


<p>The way it works is fairly simple if you understand how <a href="https://www.simoahava.com/analytics/customtask-the-guide/"><code>customTask</code></a> works. This is what a sample function might look like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">return</span> <span style="color:#00a">function</span>(model) {
    <span style="color:#aaa;font-style:italic">// Prevent task queue from being run
</span><span style="color:#aaa;font-style:italic"></span>    model.data.keys.forEach(<span style="color:#00a">function</span>(key) {
      model.set(key, <span style="color:#00a">null</span>);
    });

    <span style="color:#aaa;font-style:italic">// The code you want to execute
</span><span style="color:#aaa;font-style:italic"></span>    <span style="color:#00a">var</span> xhr = <span style="color:#00a">new</span> XMLHttpRequest();
    xhr.open(<span style="color:#a50">&#39;POST&#39;</span>, <span style="color:#a50">&#39;/endpoint&#39;</span>, <span style="color:#00a">true</span>);
    xhr.setRequestHeader(<span style="color:#a50">&#39;Content-Type&#39;</span>, <span style="color:#a50">&#39;application/json&#39;</span>);
    xhr.send(JSON.stringify({<span style="color:#a50">&#39;key&#39;</span>: <span style="color:#a50">&#39;abc12345&#39;</span>}));
  }
}
</code></pre></div>
<p>The first few lines of the closure simply prevent the tag from doing anything. They <code>null</code> every single value stored in the model object, including all the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">tasks</a>. This way once the <code>customTask</code> finishes, the hit builder will no longer do anything else (such as build and send the hit). That's why I call it a &ldquo;dummy&rdquo; tag.</p>
<p>After <code>// The code you want to execute</code> is where you'll add the JavaScript you want to run. In this example, I'm firing a simple HTTP POST request to an endpoint on my server.</p>
<p>The tag itself can be any Universal Analytics tag. All it needs is the Tracking ID (can be anything you want since the hit will never be dispatched) and the <code>customTask</code> in its field, like so:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/dummy-tag.jpg" title="Dummy Universal Analytics tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/dummy-tag.jpg#ZgotmplZ" alt="Dummy Universal Analytics tag">
  
    </a>
  
  
</div>


<p>As you can see, the tag is extremely simple. Its only purpose is to execute the JavaScript in the <code>customTask</code> variable.</p>
<p>The other critical thing is the <strong>trigger</strong>. Use the trigger to establish when the JavaScript should be executed. In the example above, when the <code>nonIdle</code> event is pushed into <code>dataLayer</code>, the tag will run the code within <strong>{{JS - function - Increase counter}}</strong>.</p>
<p>To <strong>summarize</strong>, this method seeks to address the following malady:</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2019/01/dom-full.jpg" title="DOM full of Custom HTML tags">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2019/01/dom-full.jpg#ZgotmplZ" alt="DOM full of Custom HTML tags">
  
    </a>
  
  
</div>


<p>Aside from looking hideous, every single element dynamically inserted into the DOM forces a <strong>reflow</strong> of the page, which becomes cumulatively more and more expensive the more elements are being added.</p>
<p>By avoiding DOM injection, the JavaScript function is run within the bowels of Google Tag Manager's container (where it's compiled into a function) and analytics.js (which builds the hit).</p>
<p>This way, you've essentially created a <strong>JavaScript Function Tag</strong>, whose only purpose is to trigger the execution of JavaScript code.</p>
<p><code>customTask</code> strikes again! Do you think you'll have uses for a hack like this? Let me know in the comments.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">google tag manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/gtmtips/">gtmtips</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">javascript</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/customtask/">customtask</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/true-view-impressions-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/product-scoped-custom-dimensions-in-firebase/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Trigger%20Javascript%20Function%20Without%20Using%20A%20Custom%20HTML%20Tag%20https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/true-view-impressions-google-tag-manager/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/product-scoped-custom-dimensions-in-firebase/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Trigger%20Javascript%20Function%20Without%20Using%20A%20Custom%20HTML%20Tag%20https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Trigger%20Javascript%20Function%20Without%20Using%20A%20Custom%20HTML%20Tag%20https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/trigger-javascript-without-using-custom-html-tag/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

