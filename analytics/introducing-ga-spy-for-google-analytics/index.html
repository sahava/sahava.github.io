

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "Introducing GA Spy For Google Analytics | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2016/09/stephen-harris.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/",
  "datePublished": "2016-10-12T10:16:11+00:00",
  "dateModified": "2016-10-12T10:16:11+00:00",
  "description": "Introducing the GA Spy tool built by Stephen Harris. It lets you hijack the Google Analytics global function so that you can insert and execute custom code in the hit build process.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.48 with theme Tranquilpeak 0.4.3-BETA">
    <title>Introducing GA Spy For Google Analytics | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PZ7GMV9');</script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/analytics/introducing-ga-spy-for-google-analytics/">
    
    <meta name="description" content="Introducing the GA Spy tool built by Stephen Harris. It lets you hijack the Google Analytics global function so that you can insert and execute custom code in the hit build process.">
    <meta property="og:description" content="Introducing the GA Spy tool built by Stephen Harris. It lets you hijack the Google Analytics global function so that you can insert and execute custom code in the hit build process.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Introducing GA Spy For Google Analytics">
    <meta property="og:url" content="/analytics/introducing-ga-spy-for-google-analytics/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Introducing GA Spy For Google Analytics">
    <meta name="twitter:description" content="Introducing the GA Spy tool built by Stephen Harris. It lets you hijack the Google Analytics global function so that you can insert and execute custom code in the hit build process.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2016/09/stephen-harris.png">  
      <meta property="og:image" content="https://www.simoahava.com/images/2016/09/stephen-harris.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      Introducing GA Spy For Google Analytics
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2016-10-12T10:16:11Z">
        
  October 12, 2016

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/analytics">Analytics</a>
    
  


       | <a href="https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/09/stephen-harris.png" title="Stephen Harris (c) Seer Interactive">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/09/stephen-harris.png#ZgotmplZ" alt="Stephen Harris (c) Seer Interactive">
  
    </a>
  
  
</div>



<p>_This is a guest post by <a href="http://www.seerinteractive.com/about/team/stephen-harris/?utm_source=simoahava.com&amp;utm_medium=referral&amp;utm_campaign=ana-tech">Stephen Harris</a> from <a href="http://www.seerinteractive.com/?utm_source=simoahava.com&amp;utm_medium=referral&amp;utm_campaign=ana-tech">Seer Interactive</a>
. He was kind enough to share his awesome solution in this blog, so I&rsquo;m very grateful indeed for his contribution._</p>

<p>If <a href="https://tagmanager.google.com/">Google Tag Manager</a> is loaded as the primary instrument for tracking on a webpage (as it should be), then all webpage tracking could and should be configurable via GTM. But we don&rsquo;t always control the circumstances, and it&rsquo;s not uncommon to face hardcoded <a href="https://analytics.google.com">Google Analytics</a> tracking outside of GTM.</p>

<p>Perhaps GA tracking cannot be removed from the website source code quickly enough. Maybe the website is on a publishing schedule that doesn&rsquo;t suit measurement needs, or maybe the folks responsible for the website don&rsquo;t have sufficient resources. Whatever the reason, you got a &ldquo;no&rdquo; when you <del>requested</del> insisted on removal. (You <em>did</em> insist on removal, didn&rsquo;t you?)</p>

<p>Or what about when there are hardcoded GA commands in a platform or plugin? It could be screwing with your data. But chances are it&rsquo;s not doing anything at all (because it&rsquo;s tracking to the nonexistent default GA tracker) and there seems to be no way to get it to work through GTM.</p>

<p>And even when all tracking runs through Google Tag Manager, some things can be difficult (or impossible) to implement using the tag templates (such as adding <a href="https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">GA plugins</a>, or defining Universal Analytics tracker field defaults).</p>

<p>Here&rsquo;s a solution.</p>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#1-spying-on-ga">1. Spying On GA</a>
<ul>
<li><a href="#1-1-spy-code-101">1.1. Spy Code 101</a></li>
<li><a href="#1-2-a-good-spy-starts-with-research">1.2. A Good Spy Starts With Research</a></li>
<li><a href="#1-3-spy-moves">1.3. Spy Moves</a></li>
<li><a href="#1-4-time-to-spy">1.4. Time To Spy</a></li>
</ul></li>
<li><a href="#2-reliability-and-caveats">2. Reliability And Caveats</a>
<ul>
<li><a href="#2-1-uncommon-behavior-for-a-common-library">2.1. Uncommon Behavior For A Common Library</a></li>
<li><a href="#2-2-cannot-intercept-hardcoded-pageviews-from-ga">2.2. Cannot Intercept Hardcoded Pageviews From GA</a></li>
<li><a href="#2-3-incomplete">2.3. Incomplete</a></li>
<li><a href="#2-4-more-code">2.4. More Code!</a></li>
</ul></li>
<li><a href="#3-usage">3. Usage</a>
<ul>
<li><a href="#3-1-placement">3.1. Placement</a></li>
<li><a href="#3-2-your-listener">3.2. Your Listener</a></li>
<li><a href="#3-3-listening-from-gtm">3.3. Listening From GTM</a></li>
</ul></li>
<li><a href="#4-examples">4. Examples</a>
<ul>
<li><a href="#4-1-log-ga-commands">4.1. Log GA Commands</a></li>
<li><a href="#4-2-access-hardcoded-ga-command-data-via-gtm">4.2. Access Hardcoded GA Command Data Via GTM</a></li>
</ul></li>
<li><a href="#5-next-steps">5. Next Steps</a></li>
<li><a href="#6-feedback">6. Feedback</a></li>
<li><a href="#7-summary-by-simo">7. Summary (by Simo)</a></li>
</ul></li>
</ul>
</nav>

<h2 id="1-spying-on-ga">1. Spying On GA</h2>

<p>You can grab the code <a href="https://github.com/smhmic/ga-spy/blob/master/ga-spy.js">on GitHub</a>. Copy-paste it either into a Custom HTML Tag in Google Tag Manager, or load it in the page template proper.</p>

<p>It&rsquo;s called <strong>GA Spy</strong> because it can silently hijack and control all tracking that relies on Google&rsquo;s Universal Analytics library (<strong>analytics.js</strong>). Effectively, this is a Google Analytics listener that does karate.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/10/ga-spy_diagram.png" title="GA Spy Operation">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/10/ga-spy_diagram.png#ZgotmplZ" alt="GA Spy Operation">
  
    </a>
  
  
</div>



<p>To put this in layman&rsquo;s terms, the script listens for interactions with the <code>ga()</code> interface, returning the arguments passed to the function for you to process for whatever purpose you want. For example, you can automatically copy all calls to <code>ga('send'...)</code> to <code>dataLayer.push()</code> syntax, allowing you to fluently replicate hardcoded Universal Analytics tracking in Google Tag Manager.</p>

<p>This blog post is written assuming the hardcoded tracking is for Universal Analytics, but there is a version of the <a href="https://github.com/smhmic/ga-spy/blob/master/ga-spy-async.js">script for the async GA library</a> (ga.js), to which the same core concepts apply.</p>

<ul>
<li><p><a href="https://github.com/smhmic/ga-spy/blob/master/ga-spy.js">Source code for ga-spy.js</a></p></li>

<li><p><a href="https://github.com/smhmic/ga-spy/blob/master/ga-spy-async.js">Source code for ga-spy_async.js</a></p></li>

<li><p><a href="https://github.com/smhmic/ga-spy/blob/master/README.md">README</a></p></li>
</ul>

<h3 id="1-1-spy-code-101">1.1. Spy Code 101</h3>

<p>Let&rsquo;s walk through the script logic. Before implementing, it&rsquo;s important to get a basic idea of what this script actually does. Once you understand the basics, you&rsquo;ll also understand why <strong>this should be considered a temporary solution</strong>. Indeed, you should document the use of this solution, so that when the hardcoded Universal Analytics code is eventually removed from the site, you won&rsquo;t be left hanging dry with methods that don&rsquo;t really do anything.</p>

<p>This section also explains this script&rsquo;s biggest caveat: <strong>GA Spy</strong> is not guaranteed to intercept (or even detect) tracking that fires while the page is loading (e.g. the standard GA snippet) if the hack is deployed via GTM. Capturing these requests requires that you deploy the script on the page template itself, which unfortunately might detract from the usefulness for those without developer resources handy.</p>

<p>For a more technical breakdown, check out the <a href="https://github.com/smhmic/ga-spy/blob/master/README.md">README</a>.</p>

<h3 id="1-2-a-good-spy-starts-with-research">1.2. A Good Spy Starts With Research</h3>

<p>Let&rsquo;s start with an overview of how the Universal Analytics tracker works on the page.</p>

<p>Many GA users are familiar with the JavaScript namespace <code>ga</code>. It&rsquo;s the global object for tracking with the Universal Analytics library (analytics.js). When the browser loads the page, this object is actually processed twice. First, it&rsquo;s created by the <a href="https://www.thyngster.com/how-does-the-universal-analytics-snippet-work/">Universal Analytics snippet</a>, and it <em>queues</em> all commands to <code>ga()</code> while waiting for the library to load. Then, once the library has loaded, the namespace is converted to a full interface which processes each command as it is executed.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/10/ga-spy_diagram-ga-lib.png" title="How the GA Library works">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/10/ga-spy_diagram-ga-lib.png#ZgotmplZ" alt="How the GA Library works">
  
    </a>
  
  
</div>



<p>So the standard Universal Analytics snippet instantiates <code>ga</code> as a tiny function that saves all the arguments you pass to it as an Array in <code>ga.q</code>. This is called the <em>command queue</em>. It&rsquo;s created by the second line of the GA install snippet function, shown here (beautified with more readable variable names):</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window[<span style="color:#a6e22e">gaObjName</span>] <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">gaObjName</span>] <span style="color:#f92672">||</span> <span style="color:#66d9ef">function</span>() {
  ( window[<span style="color:#a6e22e">gaObjName</span>].<span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> window[<span style="color:#a6e22e">gaObjName</span>].<span style="color:#a6e22e">q</span> <span style="color:#f92672">||</span> [] ).<span style="color:#a6e22e">push</span>( <span style="color:#a6e22e">arguments</span> )
},
<span style="color:#a6e22e">ga</span>.<span style="color:#a6e22e">l</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">new</span> Date();
</code></pre></div>

<p>Aside: Notice any similarities to the <a href="https://www.simoahava.com/gtm-tips/datalayer-declaration-vs-push/">recommended format</a> for data layer pushes?</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">( window.<span style="color:#a6e22e">dataLayer</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">dataLayer</span> <span style="color:#f92672">||</span> [] ).<span style="color:#a6e22e">push</span>( { } )
</code></pre></div>

<p>Once this queue is established, the snippet creates a <em>script loader</em>, which starts an asynchronous request to download the <strong>analytics.js</strong> library from Google&rsquo;s servers.</p>

<p>Once analytics.js loads, it will run the commands in the command queue and replace the queue function <code>ga</code> with much more robust object, which we call the <code>ga</code> object or function. Once this happens, <code>ga</code> stops keeping track of previously called commands, and will run commands as soon as they are called.</p>

<h3 id="1-3-spy-moves">1.3. Spy Moves</h3>

<p>The core of this script is the <code>hijack</code> function. What it does is simple: it saves a private reference to the global <code>ga</code> object, then updates the global reference (<code>window.ga</code> or simply <code>ga</code>) to point to a custom function, which we&rsquo;ll call our &ldquo;proxy&rdquo; function. Note that if you&rsquo;ve chosen to rename the global function as something other than <code>ga</code>, it will still work nicely with <strong>GA Spy</strong>.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">hijack</span>(){
  <span style="color:#75715e">// The current global GA object (could be GA command queue or loaded GA object).
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gaOrig</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">ga</span>;
  <span style="color:#75715e">// Replace global GA object with a proxy.
</span><span style="color:#75715e"></span>  window.<span style="color:#a6e22e">ga</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">proxy</span>;
  <span style="color:#75715e">// Maintain references to GA&#39;s public interface.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span>( <span style="color:#a6e22e">k</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">gaOrig</span> )
     <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">gaOrig</span>.<span style="color:#a6e22e">hasOwnProperty</span>( <span style="color:#a6e22e">k</span> ) )
        <span style="color:#a6e22e">proxy</span>[<span style="color:#a6e22e">k</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">gaOrig</span>[<span style="color:#a6e22e">k</span>];
}
</code></pre></div>

<p>The <code>proxy</code> function mimics the data members and methods of the original <code>ga</code> function. Thus it behaves like the original, which we accomplish by passing its arguments back to the <code>ga</code> function (and returning the result). But, only if we so choose. We can reject the message, simply by not sending the message to the original <code>ga</code> function, and thus intercept and block the hardcoded GA from running its requests altogether.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">proxy</span>(){
  <span style="color:#75715e">// Grab all arguments as an array.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">args</span> <span style="color:#f92672">=</span> [].<span style="color:#a6e22e">slice</span>.<span style="color:#a6e22e">call</span>( <span style="color:#a6e22e">arguments</span> );
  <span style="color:#75715e">// Unless processArgs() returns false ...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">processArgs</span>( <span style="color:#a6e22e">args</span> ) )
     <span style="color:#75715e">// ... pass through to original GA object.
</span><span style="color:#75715e"></span>     <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">gaOrig</span>.<span style="color:#a6e22e">apply</span>( <span style="color:#a6e22e">gaOrig</span>, <span style="color:#a6e22e">args</span> );
};
</code></pre></div>

<p>The <code>processArgs</code> function simply delegates the processing and filtering of all commands to you (via the custom listener function).</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processArgs</span>( <span style="color:#a6e22e">a</span> ){
  <span style="color:#75715e">// Call listener, return false only if listener returns false.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">listener</span>( <span style="color:#a6e22e">a</span> ) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">false</span>;
}
</code></pre></div>

<h3 id="1-4-time-to-spy">1.4. Time To Spy</h3>

<p>As soon as <strong>GA Spy</strong> is run, it will instantiate the command queue if it doesn&rsquo;t already exist, just as the Universal Analytics snippet would. Both in this script and in the Universal Analytics snippet, we&rsquo;re careful not to blindly set a new variable and lose any previous data.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span> window[<span style="color:#a6e22e">gaObjName</span>] ){ <span style="color:#75715e">// If global object doesn&#39;t exist ...
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">ga</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(){
    <span style="color:#66d9ef">if</span>( <span style="color:#f92672">!</span> window[<span style="color:#a6e22e">gaObjName</span>].<span style="color:#a6e22e">q</span> )
      window[<span style="color:#a6e22e">gaObjName</span>].<span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> [];
      window[<span style="color:#a6e22e">gaObjName</span>].<span style="color:#a6e22e">q</span>.<span style="color:#a6e22e">push</span>( <span style="color:#a6e22e">arguments</span> );
  };
  <span style="color:#a6e22e">ga</span>.<span style="color:#a6e22e">l</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">new</span> Date();
  window[<span style="color:#a6e22e">gaObjName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">ga</span>;
}
</code></pre></div>

<p>Note: the above code does the exact same thing as the second line of the GA install snippet function, shown beautified under A Good Spy Starts With Research above.</p>

<p>Then, regardless of whether it already existed or was just initiated, <strong>GA Spy</strong> hijacks <code>ga</code>.</p>

<p>If <code>ga</code> is found to be the fully-formed Universal Analytics tracking method, then analytics.js has already loaded and we will be tapped into all subsequent calls to <code>ga</code> until the page is unloaded. Job done. Since the global <code>ga</code> object does not keep track of previously run <code>ga()</code> commands, we cannot access the information passed in those commands. It&rsquo;d be useful if we could access the command history, but we still would not be able to block those hits, since JavaScript does not support time reversal (not gonna work: <code>setTimeout( hijack, -5 )</code>).</p>

<p>However, if <strong>GA Spy</strong> finds the <em>command queue</em> instantiated in <code>ga</code>, then we know that if/when analytics.js loads, it will replace the hijacked command queue (our <code>proxy</code>) with the actual Universal Analytics tracking method. We can easily hijack it again, but timing is important. We want the global <code>ga</code> object to be in existence for as short a period as possible to avoid missing any commands before we manage to hijack it.</p>

<p>Any function in the command queue will be executed as soon as the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/command-queue-reference#ready-callback"><code>ga</code> object is ready</a>. So we add the <code>hijack</code> function, thereby setting a trap the <code>ga</code> object will trigger immediately upon loading, and put our <code>proxy</code> in its place before the <code>ga</code> object is even available to other scripts.</p>

<p>The only other thing we need to do is run the stack of existing commands through the listener, and when it returns false just filter that command out of the queue.</p>

<h2 id="2-reliability-and-caveats">2. Reliability And Caveats</h2>

<p>This should be an extremely reliable solution. In fact, the method of listening by &ldquo;hijacking&rdquo; a function is used by a number of Google libraries, including GTM&rsquo;s own <a href="https://www.simoahava.com/analytics/google-tag-manager-data-model/">Data Layer</a> and <a href="https://github.com/googleanalytics/autotrack/blob/911e9f7b7a0d1fe73e00c464c05d57825efbba1b/lib/plugins/page-visibility-tracker.js#L148-L164">Autotrack</a>. Note that it&rsquo;s possible <strong>GA Spy</strong> can be broken by an update to analytics.js, but the <code>ga</code> interface <strong>GA Spy</strong> relies on is wholly defined in the standard Universal Analytics install snippet, so breakage due to unannounced library updates is highly unlikely.</p>

<p>Nevertheless, there are some important caveats to note before using this.</p>

<h3 id="2-1-uncommon-behavior-for-a-common-library">2.1. Uncommon Behavior For A Common Library</h3>

<p>Whenever this is used to modify or block a <code>ga</code> command, I would consider this a &ldquo;hacky&rdquo; solution. Although the code is sound, such usage modifies the typical behavior of the global <code>ga()</code> function, making it work differently than it works on 99% of other websites. This can impede troubleshooting and confuse those who are new to Google Analytics or JavaScript.</p>

<p><em>Tip: You can tell that you&rsquo;re dealing with hijacked GA by checking for the presence of the property <code>_gaOrig</code> in the global Google Analytics object. By default it would be: <code>window.ga._gaOrig</code>.</em></p>

<p>In some cases, hijacking the GA function is necessitated by third-party vendors that require their JavaScript to be implemented with a hardcoded GA tracker.</p>

<p>In other cases, such as when completing a migration from hardcoded Google Analytics to Google Tag Manager, this treatment should be acceptable only as a short-term solution.</p>

<h3 id="2-2-cannot-intercept-hardcoded-pageviews-from-ga">2.2. Cannot Intercept Hardcoded Pageviews From GA</h3>

<p>If <strong>GA Spy</strong> runs before analytics.js loads, you will be able to access and block 100% of the commands queued to analytics.js. But if <strong>GA Spy</strong> runs after, then it has zero insight into what hits (if any) were previously fired. So if you want to intercept all hardcoded commands, <strong>GA Spy</strong> needs to be deployed directly on the page. However, for many purposes, this is not necessary at all.</p>

<p>Unfortunately, in some cases where deploying on-page is necessary, the inability to make on-page changes is the very problem that prompted the need for <strong>GA Spy</strong> in the first place, making this solution a catch-22. For GTM migrations, one way to mitigate this is to request to have <strong>GA Spy</strong> placed on the page at the same time that GTM is added.</p>

<p>Note, if synchronous loading of Google Tag Manager is ever supported, hardcoding <strong>GA Spy</strong> will no longer be required, but still recommended, because loading anything synchronously in the <code>&lt;head&gt;</code> will degrade page loading speed.</p>

<h3 id="2-3-incomplete">2.3. Incomplete</h3>

<p>Currently, <strong>GA Spy</strong> only intercepts GA commands that are called upon the global <code>ga</code> object, but there are other ways to send commands to analytics.js. Many GA plugins and some custom implementations call commands directly upon the tracker object (i.e. <code>ga.getAll()[0].send('event')</code>). Support for intercepting these commands <a href="https://github.com/smhmic/ga-spy/issues/2">may be added in the future</a>.</p>

<p>Another limitation is that <strong>GA Spy</strong> can process only the values passed to GA commands. It doesn&rsquo;t provide access to the default values for all the fields that are populated by analytics.js.</p>

<p>One effect of these two facts is that <strong>GA Spy</strong> will not pick up hit modifications (or extra hits) done by GA plugins (and other implementations using the Tasks API). This is by design and no support for this planned. (If you see a need for this, describe the use case and upvote this enhancement <a href="https://github.com/smhmic/ga-spy/issues/7">here</a>.)</p>

<h3 id="2-4-more-code">2.4. More Code!</h3>

<p>As a developer I have many protests against the following statement, but I can&rsquo;t deny it&rsquo;s essential truth: <code>code is bad</code>. Meaning, no matter how good the code, <a href="https://blog.codinghorror.com/the-best-code-is-no-code-at-all/">no code is better</a>. Code leads to bugs which lead to more code, which leads to more bugs. Even bullet-proof code requires some degree of maintenance. Perhaps the biggest issue is that a code-based solution imposes a higher skill barrier on managing and customizing the solution. As a general rule, we should avoid custom code whenever there is a sound alternative.</p>

<h2 id="3-usage">3. Usage</h2>

<h3 id="3-1-placement">3.1. Placement</h3>

<p>If you need to intercept GA commands that run upon page load or shortly thereafter (such as the tracker creation or <code>'pageview'</code> in the base GA install snippet), then you&rsquo;ll need deploy <strong>GA Spy</strong> in an inline script tag or external script (with no <code>async</code> or <code>defer</code> attributes) above the first GA command (usually in the base GA snippet).</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">html</span>&gt;
  &lt;<span style="color:#f92672">head</span>&gt;
  ...
    // GA Spy:
    &lt;<span style="color:#f92672">script</span>&gt;
      ;window.<span style="color:#a6e22e">gaSpy</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">gaSpy</span>...
    &lt;/<span style="color:#f92672">script</span>&gt;

    // Universal Analytics snippet:
    &lt;<span style="color:#f92672">script</span>&gt;
      (<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">i</span>,<span style="color:#a6e22e">s</span>,<span style="color:#a6e22e">o</span>,<span style="color:#a6e22e">g</span>,<span style="color:#a6e22e">r</span>,<span style="color:#a6e22e">a</span>,<span style="color:#a6e22e">m</span>)...
    &lt;/<span style="color:#f92672">script</span>&gt;
  ...
  &lt;/<span style="color:#f92672">head</span>&gt;</code></pre></div>

<p>If the commands you need to intercept are triggered by user action, then this is not an issue and you can deploy <strong>GA Spy</strong> using GTM.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/10/gaspy-gtm.png" title="GA Spy in Custom HTML">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/10/gaspy-gtm.png#ZgotmplZ" alt="GA Spy in Custom HTML">
  
    </a>
  
  
</div>



<h3 id="3-2-your-listener">3.2. Your Listener</h3>

<p>This script will not <em>do</em> anything on its own. You need to implement all actions in your custom <code>listener</code> callback function. You can do things like:</p>

<ol>
<li><p>Access and modify the arguments sent to <code>ga()</code>.</p></li>

<li><p>Access information about the command scope (tracker name, hit type, etc.)</p></li>

<li><p>Block the hit by returning <code>false</code> (returning merely &ldquo;falsy&rdquo; values like <code>0</code> or <code>undefined</code> will not block the hit).</p></li>

<li><p>And everything else you can do in JavaScript :)</p></li>
</ol>

<p>In many cases, we&rsquo;ll want to push the hit values onto the <code>dataLayer</code> so they can be accessed in GTM.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#a6e22e">gaSpy</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">obj</span>) {
    
    <span style="color:#75715e">// Do something with the arguments to ga():
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">args</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">args</span>;

    <span style="color:#75715e">// Do something with details about the tracker itself:
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">details</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">the</span>;

  });
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>

<p>Naturally, any calls to <code>gaSpy()</code> need to be timed so that they take place <em>after</em> you&rsquo;ve loaded the <strong>GA Spy</strong> code itself.</p>

<p>See the <a href="https://github.com/smhmic/ga-spy/blob/master/README.md#configuration">README file</a> for more details on what data is passed to the callback function, as well as additional <strong>GA Spy</strong> configuration options.</p>

<h3 id="3-3-listening-from-gtm">3.3. Listening From GTM</h3>

<p>If using <strong>GA Spy</strong> in GTM, the listener should typically ignore all commands from GTM. Failure to do this could result in blocking GTM hits or in an infinite loop. We can do this by checking the tracker name. GTM uses tracker names starting with &ldquo;gtm&rdquo; followed by the timestamp of when the tracker was created.</p>

<p>However, this method will not work when callbacks are passed in place of a GA command. GTM does not appear to use these currently, but we cannot do much with a them anyway, so as a precaution any listener should ignore callbacks too.</p>

<p>Use the this code at the top of your callback function to avoid issues:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">gaSpy</span>( <span style="color:#66d9ef">function</span>( <span style="color:#a6e22e">ev</span> ){
  <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">ev</span>.<span style="color:#a6e22e">the</span>.<span style="color:#a6e22e">callback</span> )
    <span style="color:#66d9ef">return</span>;
  <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">ev</span>.<span style="color:#a6e22e">the</span>.<span style="color:#a6e22e">trackerName</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ev</span>.<span style="color:#a6e22e">the</span>.<span style="color:#a6e22e">trackerName</span>.<span style="color:#a6e22e">substr</span>( <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span> ) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;gtm&#39;</span> ) 
    <span style="color:#66d9ef">return</span>;
  <span style="color:#75715e">// Your code here
</span><span style="color:#75715e"></span>});
</code></pre></div>

<p>This is not foolproof, but it&rsquo;ll work unless hardcoded tracking is using a tracker name starting with &ldquo;gtm&rdquo; (or if the tracker names in GTM are customized, which is probably done as an alternative to this solution). For example, this method will not work for Wistia&rsquo;s built-in tracking, because Wistia&rsquo;s code (erroneously) sends hits through every named tracker on the page.</p>

<h2 id="4-examples">4. Examples</h2>

<h3 id="4-1-log-ga-commands">4.1. Log GA Commands</h3>

<p>Logging GA commands is a useful way to easily see what commands are being picked up by <strong>GA Spy</strong>, letting you see which things <strong>GA Spy</strong> can block and/or latch on to in order to execute custom behavior. Compared with browser extensions and the verbose analytics_debug.js, <strong>GA Spy</strong> logging can be very minimalistic. You could even log using only emojis if you wanted! And it has the advantage of working even when the hit does not fire (such as when using GA opt-out or tracking blockers).</p>

<p>This listener callback will print <code>ga()</code> arguments exactly as they are given:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">gaSpy</span>( <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">gaSpy_cb_</span>( <span style="color:#a6e22e">ev</span> ){
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">debug</span>.<span style="color:#a6e22e">apply</span>( <span style="color:#a6e22e">console</span>, <span style="color:#a6e22e">ev</span>.<span style="color:#a6e22e">args</span> )
});
</code></pre></div>

<p>Or check out <a href="https://github.com/smhmic/ga-spy/blob/master/examples/ga-spy-log.js">one of the examples on GitHub</a> for something a bit more robust:</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/10/ga-spy-log.png" title="Console logging GA requests">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/10/ga-spy-log.png#ZgotmplZ" alt="Console logging GA requests">
  
    </a>
  
  
</div>



<p>Since this is all one script, you could turn this into a bookmarklet. This could also block all hits, so it serves as a &lsquo;test mode&rsquo; bookmarklet, which both logs and prevents any hits from being fired.</p>

<h3 id="4-2-access-hardcoded-ga-command-data-via-gtm">4.2. Access Hardcoded GA Command Data Via GTM</h3>

<p>If you know exactly what you&rsquo;re looking for, you can simply look for that format and send it to <code>dataLayer</code>. Remember to define an <a href="https://www.simoahava.com/gtm-tips/add-the-event-key-to-datalayer-pushes/">event name</a> in the <code>dataLayer.push()</code>, so you can create a GTM trigger based on the event. Here&rsquo;s an example that clocks hardcoded events from the social sharing plugin ShareThis and forwards them to GTM:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">gaSpy</span>( <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">gaSpy_cb_</span>( <span style="color:#a6e22e">ev</span> ){
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ev</span>.<span style="color:#a6e22e">args</span>;
  <span style="color:#66d9ef">if</span>( <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;send&#34;</span> 
   <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;event&#34;</span> 
   <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ShareThis&#34;</span> ){
    <span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
      <span style="color:#e6db74">&#39;event&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;spy.ga.socialPlugin&#39;</span>,
      <span style="color:#e6db74">&#39;spy.ga.socialPlugin&#39;</span> <span style="color:#f92672">:</span> {
        <span style="color:#e6db74">&#39;network&#39;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">3</span>],
        <span style="color:#e6db74">&#39;url&#39;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">4</span>]
      }
    });
  }
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
});
</code></pre></div>

<p><a href="https://github.com/smhmic/ga-spy/blob/master/examples/ga-spy-datalayer.gtm.tag.html">Here&rsquo;s a more robust example</a> that sends all non-GTM commands to <code>dataLayer</code>.</p>




<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2016/10/ga-spy-datalayer.png" title="GA Spy dataLayer">
  
    <img class="fig-img" src="https://www.simoahava.com/images/2016/10/ga-spy-datalayer.png#ZgotmplZ" alt="GA Spy dataLayer">
  
    </a>
  
  
</div>



<p>Most of the code necessary for this simply normalizes the command arguments (since GA commands have a flexible format for defining field values). It also handles data scope (different trackers, plugins) and also wipes hit-only fields after the relevant GTM event.</p>

<h2 id="5-next-steps">5. Next Steps</h2>

<p>Even though this is a reliable and relatively simple method for working with hardcoded GA tracking, hopefully this was not your first choice. Even though this fixes real data issues and helps consolidate your implementation in GTM, it&rsquo;s an awkward way of doing so. You can get the same result with a much simpler configuration: no hardcoded tracking, and no spying! Don&rsquo;t be satisfied with getting tracking working; <strong>pursue a clean implementation</strong>. Even if it will take a while, plan to have the hardcoded tracking removed.</p>

<p>Your script is making your Universal Analytics code work differently than it would work on virtually every other website, confusing troubleshooters and learners. So, even if you believe hardcoded tracking removal is imminent, be sure to <strong>note your use of GA Spy (prominently) in your tracking documentation</strong>.</p>

<p>If you are using <strong>GA Spy</strong> to deal with code from a third party platform or plugin, contact the developers. Let them know their script is not compatible with GTM. (Actually, you should do that before implementing <strong>GA Spy</strong>; they might be responsive and fix their code quickly!)</p>

<h2 id="6-feedback">6. Feedback</h2>

<p>This method was designed to be flexible and was tested with various setups, but that&rsquo;s not to say it&rsquo;s bulletproof. On the contrary, I&rsquo;m eager to discover bugs, incompatibilities with browser plugins, and similar issues. Naturally, I admit it&rsquo;d be nicer to find out there are none :)</p>

<p>Please post any problems or suggestions as a <a href="https://github.com/smhmic/ga-spy/issues/new">new issue on GitHub</a> if it has not <a href="https://github.com/smhmic/ga-spy/issues">already been added</a>. Be sure to upvote fixes and enhancements you want to see implemented (by clicking the little thumbs-up icon)!</p>

<h2 id="7-summary-by-simo">7. Summary (by Simo)</h2>

<p>This is some top-notch JavaScript right here! What Stephen has built is a swiss-army knife that lets you take full control over how <strong>analytics.js</strong> functions as a tracking interface on your website. Even though translating the hardcoded <code>ga()</code> calls to <code>dataLayer.push()</code> commands is the obvious choice, there are lots of use cases for this library, and you can check some of the examples out <a href="https://gist.github.com/smhmic/492213ea74bb47c5878b#file-examples-spygoogleanalytics-js">here</a>.</p>

<p>One of the things this enables is what we&rsquo;ve been waiting for so long with Google Tag Manager: the ability to intercept and modify the payload sent by GTM&rsquo;s Tags to Google Analytics. There&rsquo;s no way to add your own <a href="https://www.simoahava.com/analytics/universal-analytics-plugins-explained/">custom plugins</a>, for example, but this library with its <code>hijack</code> function lets you modify the tracker object between its creation and when the data is dispatched. It&rsquo;s not entirely trivial, but I might just have an article in the pipeline showing some cool uses cases for this particular library, so stay tuned!</p>

<p>In any case, thank you so much to Stephen for sharing this incredible resource with the community. If you have implementation trouble with the library or any other type of feedback to share, please sound off in the comments. And please respect Stephen&rsquo;s wishes when he requested any actual bugs and issues to be contributed to the <a href="https://github.com/smhmic/ga-spy/issues">issue tracker</a> in GitHub.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/tracker/">tracker</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/universal-analytics/">universal analytics</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/restrict-custom-html-tag-scope/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debug-change-history-gtm/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Introducing%20GA%20Spy%20For%20Google%20Analytics%20https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/restrict-custom-html-tag-scope/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/debug-change-history-gtm/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Introducing%20GA%20Spy%20For%20Google%20Analytics%20https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Introducing%20GA%20Spy%20For%20Google%20Analytics%20https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/analytics/introducing-ga-spy-for-google-analytics/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

