

  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Consent Mode (Google tags) - Custom Tag Template | Simo Ahava's blog</title>
    

    
    
    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/custom-templates/consent-mode/">
    
    <meta name="description" content="This is a template for deploying Google tags&rsquo; Consent Mode functionality. It lets you deploy Consent Mode with both the &ldquo;default&rdquo; and &ldquo;update&rdquo; commands.">
    <meta property="og:description" content="This is a template for deploying Google tags&rsquo; Consent Mode functionality. It lets you deploy Consent Mode with both the &ldquo;default&rdquo; and &ldquo;update&rdquo; commands.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Consent Mode (Google tags) - Custom Tag Template">
    <meta property="og:url" content="https://www.simoahava.com/custom-templates/consent-mode/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Consent Mode (Google tags) - Custom Tag Template">
    <meta name="twitter:description" content="This is a template for deploying Google tags&rsquo; Consent Mode functionality. It lets you deploy Consent Mode with both the &ldquo;default&rdquo; and &ldquo;update&rdquo; commands.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2023/12/consent-mode-template.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2023/12/consent-mode-template.jpg">
    


    

      
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="blog">
      <header id="header" data-behavior="1">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="1">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" loading="lazy" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener ">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://masto.measure.chat/@SimoAhava" target="_blank" rel="noopener me">
    
      <i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
      
      <span class="sidebar-button-desc">Mastodon</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="1"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      Consent Mode (Google tags) - Custom Tag Template
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2023-12-01T07:01:00&#43;03:00">
	Latest release: 
  December 1, 2023

      </time>
      
      

      | <a href="https://www.simoahava.com/custom-templates/consent-mode/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                <p><strong>IMPORTANT! The template update in December 2023 is a BREAKING change. Read more below.</strong></p>



<div style="aspect-ratio: 1800 / 1246;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2023/12/consent-mode-template.jpg" title="Consent Mode template">
  
    <img class="fig-img" height="1246" width="1800" loading="lazy" src="https://www.simoahava.com/images/2023/12/consent-mode-template.jpg#ZgotmplZ" alt="Consent Mode template">
  
    </a>
  
  
</div>


<p>The <strong>Consent Mode (Google tags)</strong> <a href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">custom tag template</a> is a tag template for <a href="https://tagmanager.google.com/">Google Tag Manager&rsquo;s</a> <a href="https://tagmanager.google.com/gallery/">community template gallery</a>.</p>
<table>
<thead>
<tr>
<th>Resource</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developers.google.com/gtagjs/devguide/consent">Vendor documentation</a></td>
</tr>
<tr>
<td><a href="https://www.simoahava.com/analytics/consent-mode-google-tags/">Blog post</a></td>
</tr>
<tr>
<td><a href="https://tagmanager.google.com/gallery/#/owners/gtm-templates-simo-ahava/templates/consent-mode">Gallery entry</a></td>
</tr>
<tr>
<td><a href="https://github.com/gtm-templates-simo-ahava/consent-mode">GitHub repo</a></td>
</tr>
</tbody>
</table>



<div style="aspect-ratio: 1356 / 1880;" class="figure nocaption">
  
    <a href="https://www.simoahava.com/images/2023/12/consent-mode-permissions.jpg" title="Consent mode permissions">
  
    <img class="fig-img" height="1880" width="1356" loading="lazy" src="https://www.simoahava.com/images/2023/12/consent-mode-permissions.jpg#ZgotmplZ" alt="Consent mode permissions">
  
    </a>
  
  
</div>


<h2 id="december-2023-update">December 2023 update</h2>
<p>In the template update of December 2023, many <strong>breaking changes</strong> were introduced. For this reason, if you update to the latest version of the template, <strong>you will need to reconfigure all of the tags created with this template</strong>.</p>
<p>The template no longer uses a table for different <code>default</code> states. Instead, you can only configure one set of default states per tag. If you want to configure different defaults for some other region, you will need to create additional tags for each additional region configuration.</p>
<p>The <code>update</code> tag looks the same, but the underlying fields have also been changed. You will need to reconfigure <code>update</code> tags too.</p>
<h2 id="description">Description</h2>
<p>This tag lets you deploy the <a href="https://developers.google.com/tag-platform/security/guides/consent">Consent Mode</a> functionality offered by Google for controlling how data is accessed and collected by Google&rsquo;s tags and pixels.</p>
<p>The template is also compatible with GTM&rsquo;s <a href="https://www.simoahava.com/analytics/consent-settings-google-tag-manager/">consent features</a>.</p>
<h2 id="instructions">Instructions</h2>
<p>The template lets you choose whether to send a <code>default</code> command (which sets the default state of consent on the page) or an <code>update</code> command (which updates the consent state after it has been determined by, for example, user input with a consent management system).</p>
<p>Please read the official <a href="https://developers.google.com/tag-platform/security/guides/consent">vendor documentation</a> for more information about consent states and the different options.</p>
<h3 id="the-default-command">The default command</h3>
<p>The purpose of the <code>default</code> command is to establish default values for consent signals on a page. Typically you would choose a default like <code>denied</code> for all states, but you might also populate the states from data available on the page or in cookies, for example.</p>
<p>If you use variables, make sure they return the string value <code>granted</code> when consent is granted and <code>denied</code> when consent has been denied.</p>
<p>You can also choose the <code>wait_for_update</code> timeout. This timeout determines how long Google&rsquo;s tags wait for a possible <code>update</code> command, if the user&rsquo;s consent choices are resolved asynchronously. When the <code>default</code> tag fires, any Google tags that would fire otherwise will wait for the timeout duration to allow for a possible <code>update</code> command to update the consent states.</p>
<p>Similarly, when you select <code>default</code>, you can choose the <strong>region</strong> to which the consent states apply. If you set it to <code>all</code>, it means that the consent states apply to visitors from all geographical regions. If you set it to a comma-separated list of region codes such as <code>FI, DE</code>, the consent states will only apply to visitors from those regions (Finland and Germany per the example).</p>
<blockquote>
<p>You can have more than one tag with the <code>default</code> command firing on the page. For example, you might have one tag with <code>all</code> regions and one with <code>FI</code> region, using different settings for visitors from Finland.</p>
</blockquote>
<p>You should use the <strong>Consent Initialization</strong> trigger type to fire the <code>default</code> command. That way no other tags will fire before consent state has been established.</p>
<h3 id="the-update-command">The update command</h3>
<p>You can create another tag with this template, this time with the <code>update</code> command.</p>
<p>In this case, set the different consent states to match what the user has consented to. If you use variables, make sure they return the string value <code>granted</code> when consent is granted and <code>denied</code> when consent has been denied.</p>
<h3 id="important-note-about-the-push-datalayer-event-option">Important note about the &ldquo;Push dataLayer Event&rdquo; option</h3>
<p>If you are running multiple <code>default</code> commands on the page with different region settings, do note that the <code>dataLayer</code> event will be set to what the most recent <code>default</code> command included, <em>even if the command didn&rsquo;t apply to the user due to their geographical region</em>.</p>
<p>This is an unfortunate outcome of how the Consent APIs currently worked, and I haven&rsquo;t figured out a workaround for this.</p>
<h3 id="release-notes">Release notes</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Changeset</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 December 2023</td>
<td>Complete overhaul of the template.</td>
</tr>
<tr>
<td>1 June 2021</td>
<td>Add compatibility with GTM&rsquo;s new consent features.</td>
</tr>
<tr>
<td>17 October 2020</td>
<td>Initial release.</td>
</tr>
</tbody>
</table>

              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/custom-templates/core-web-vitals/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/custom-templates/consent-mode/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20%28Google%20tags%29%20-%20Custom%20Tag%20Template%20https://www.simoahava.com/custom-templates/consent-mode/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/custom-templates/consent-mode/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2023 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/custom-templates/core-web-vitals/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/custom-templates/consent-mode/">
              <i class="fa fa-brands fa-facebook"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20%28Google%20tags%29%20-%20Custom%20Tag%20Template%20https://www.simoahava.com/custom-templates/consent-mode/%20via%20@SimoAhava">
              <i class="fa fa-brands fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/custom-templates/consent-mode/">
              <i class="fa fa-brands fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa-regular fa-comments"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="1">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/custom-templates/consent-mode/">
          <i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=Consent%20Mode%20%28Google%20tags%29%20-%20Custom%20Tag%20Template%20https://www.simoahava.com/custom-templates/consent-mode/%20via%20@SimoAhava">
          <i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/custom-templates/consent-mode/">
          <i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

