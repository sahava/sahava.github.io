<!doctype html><html lang=en-us><head><meta name=google-site-verification content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"#GTMTips: Add A Load Listener To Script Elements | Simo Ahava's blog","image":"https:\/\/www.simoahava.com\/images\/2017\/12\/add-load-listener-to-script-elements.jpg","editor":"Simo Ahava","publisher":{"@type":"Organization","name":"Simo Ahava's blog","logo":{"@type":"ImageObject","url":"https:\/\/www.simoahava.com\/images\/simo.png","height":"393","width":"407"}},"url":"https:\/\/www.simoahava.com\/gtm-tips\/add-load-listener-script-elements\/","datePublished":"2017-12-12T11:21:51\u002b02:00","dateModified":"2017-12-12T11:21:51\u002b02:00","description":"Use Google Tag Manager to add load listeners to your asynchronously loading script elements. The load listener will inform GTM once the script has completely loaded, helping you avoid race conditions.","author":{"@type":"Person","name":"Simo Ahava"}}</script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>#GTMTips: Add A Load Listener To Script Elements | Simo Ahava's blog</title>
<script>window.dataLayer=window.dataLayer||[],window.dataLayer.push({pageType:"article",environment:null})</script><script>(function(e,t,n,s){window[n]=window[n]||[],window[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=e.getElementsByTagName(t)[0],o=e.createElement(t),a=n!="dataLayer"?"&l="+n:"";o.async=!0,o.src="https://sgtm.simoahava.com/gtm.js?id="+s+a,i.parentNode.insertBefore(o,i)})(document,"script","dataLayer","GTM-PZ7GMV9")</script><meta name=author content="Simo Ahava"><meta name=keywords content><link rel=icon href=https://www.simoahava.com/images/favicon.ico><link rel=amphtml href=https://www.simoahava.com/amp/gtm-tips/add-load-listener-script-elements/><meta name=description content="Use Google Tag Manager to add load listeners to your asynchronously loading script elements. The load listener will inform GTM once the script has completely loaded, helping you avoid race conditions."><meta property="og:description" content="Use Google Tag Manager to add load listeners to your asynchronously loading script elements. The load listener will inform GTM once the script has completely loaded, helping you avoid race conditions."><meta property="og:type" content="blog"><meta property="og:title" content="#GTMTips: Add A Load Listener To Script Elements"><meta property="og:url" content="https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><meta property="og:site_name" content="Simo Ahava's blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="#GTMTips: Add A Load Listener To Script Elements"><meta name=twitter:description content="Use Google Tag Manager to add load listeners to your asynchronously loading script elements. The load listener will inform GTM once the script has completely loaded, helping you avoid race conditions."><meta name=twitter:creator content="@SimoAhava"><meta name=twitter:image content="https://www.simoahava.com/images/2017/12/add-load-listener-to-script-elements.jpg"><meta property="og:image" content="https://www.simoahava.com/images/2017/12/add-load-listener-to-script-elements.jpg"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/css/style.css></head><body><div id=_progress></div><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=/>Simo Ahava's blog</a></div></header><nav id=sidebar data-behavior=4><div class=sidebar-container><div class=sidebar-profile><a href=/><img class=sidebar-profile-picture loading=lazy src=https://www.simoahava.com/images/simo.png alt="Author's picture"></a><h4 class=sidebar-profile-name>Simo Ahava</h4><h5 class=sidebar-profile-bio>Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/><i class="sidebar-button-icon fa fa-lg fa-home"></i>
<span class=sidebar-button-desc>Home</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/categories/><i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
<span class=sidebar-button-desc>Categories</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags/><i class="sidebar-button-icon fa fa-lg fa-tags"></i>
<span class=sidebar-button-desc>Tags</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/categories/gtm-tips/><i class="sidebar-button-icon fa fa-lg fa-magic"></i>
<span class=sidebar-button-desc>GTM Tips</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/about-simo-ahava/><i class="sidebar-button-icon fa fa-lg fa-question"></i>
<span class=sidebar-button-desc>About</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/index.xml><i class="sidebar-button-icon fa fa-lg fa-rss"></i>
<span class=sidebar-button-desc>RSS</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/tools/><i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
<span class=sidebar-button-desc>Tools</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/blog-statistics/><i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
<span class=sidebar-button-desc>Blog statistics</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/sahava target=_blank rel=noopener><i class="sidebar-button-icon fa fa-lg fa-brands fa-github"></i>
<span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/upcoming-talks/><i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
<span class=sidebar-button-desc>Upcoming talks</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/custom-templates/><i class="sidebar-button-icon fa fa-lg fa-tags"></i>
<span class=sidebar-button-desc>Templates</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/newsletter/><i class="sidebar-button-icon fa fa-lg fa-bell"></i>
<span class=sidebar-button-desc>Newsletter</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://masto.measure.chat/@SimoAhava target=_blank rel="noopener me"><i class="sidebar-button-icon fa fa-lg fa-brands fa-mastodon"></i>
<span class=sidebar-button-desc>Mastodon</span></a></li></ul><ul class=sidebar-buttons></ul></div></nav><div id=main data-behavior=4 class=hasCoverMetaIn><article class=post><form id=search action=/search/><input name=q type=text class="form-control input--xlarge" placeholder="Search blog..." autocomplete=off></form><div class="post-header main-content-wrap text-left"><h1>#GTMTips: Add A Load Listener To Script Elements</h1><div class="postShorten-meta post-meta"><time datetime=2017-12-12T11:21:51+02:00>December 12, 2017
</time><span>in</span>
<a class=category-link href=/categories/gtm-tips>GTM tips</a>
| <a href=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/#commento><comentario-count path=/gtm-tips/add-load-listener-script-elements/ placeholder=... error-text="N/A " zero-text="0 " prefix suffix=" "></comentario-count>Comments</a></div></div><div class="post-content markdown"><div class=main-content-wrap><p>One of the challenges in working with <a href=https://tagmanager.google.com/>Google Tag Manager</a> (or any JavaScript-based platform for that matter) is what to do with <a href=/analytics/google-analytics-page-load/>race conditions</a>. A <strong>race condition</strong> emerges when you have two resources competing for execution in the browser, and there is a degree of unpredictability to which &ldquo;wins&rdquo; the race.</p><p>A prime example is working with <a href=https://www.jquery.com/>jQuery</a>. It&rsquo;s one of the most popular JavaScript libraries out there, and websites utilize it for a multitude of things, many useful for Google Tag Manager, too. For example, jQuery trivializes <a href=http://api.jquery.com/jquery.ajax/>asynchronous HTTP requests</a> and <a href=https://api.jquery.com/category/traversing/>DOM traversal</a>, both of which can cause headaches to GTM users.</p><p>However, since jQuery is often, and should often be, downloaded asynchronously, there&rsquo;s the risk that <strong>jQuery hasn&rsquo;t loaded yet when GTM starts executing your tags</strong>. Thus we need some mechanism to let Google Tag Manager know when an asynchronously downloaded or requested resource has become available.</p><span class=simmer><span class=close>X</span><p><span class="fa fa-md fa-bell"></span>
<strong>The Simmer Newsletter</strong></p><p>Subscribe to the <a href=/newsletter/>Simmer newsletter</a> to get the latest news and content from Simo Ahava into your email inbox!</p></span><h2 id=tip-66-add-a-load-listener-to-script-elements>Tip 66: Add a load listener to script elements</h2><div style=aspect-ratio:960/540 class="figure nocaption"><a href=/images/2017/12/add-load-listener-to-script-elements.jpg title="Add a load listener to script elements on the page"><img class=fig-img height=540 width=960 loading=lazy src=/images/2017/12/add-load-listener-to-script-elements.jpg#ZgotmplZ alt="Add a load listener to script elements on the page"></a></div><p>There are two ways you can go about this. The first one is to use a <strong>Custom HTML tag</strong>, and then fire a <code>dataLayer.push()</code> once the resource has completely loaded. The second way is to use <a href=/analytics/understanding-tag-sequencing-in-google-tag-manager/>tag sequencing</a>, and tell GTM that the setup tag (where you load the script) has completed by using the internal <code>onHtmlSuccess()</code> method. But I&rsquo;m getting ahead of myself.</p><h3 id=datalayerpush-in-the-load-listener-callback><code>dataLayer.push()</code> in the load listener callback</h3><p>The first method is to create a <strong>Custom HTML tag</strong> that fires as early as possible. So you&rsquo;d want to add the <strong>All Pages</strong> trigger to it, so that it fires as soon as the GTM container has loaded.</p><p>At this point it&rsquo;s important that you <strong>do not</strong> load the script by simply adding the <code>&lt;script src="url_to_jquery" async="true"></code> into the Custom HTML tag. Instead, we&rsquo;ll introduce some extra control by using JavaScript to create the element, add the listener to it, and inject it manually to the page. You could use the <code>onload</code> attribute directly in the element, but the risk here is that you overwrite any existing <code>onload</code> attribute. By using JavaScript DOM manipulation methods, you won&rsquo;t mess with any pre-existing listeners.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#1e90ff;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span>  (<span style=color:#00a>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#00a>var</span> el = <span style=color:#0aa>document</span>.createElement(<span style=color:#a50>&#39;script&#39;</span>);
</span></span><span style=display:flex><span>	el.src = <span style=color:#a50>&#39;https://code.jquery.com/jquery-3.2.1.js&#39;</span>;
</span></span><span style=display:flex><span>	el.<span style=color:#00a>async</span> = <span style=color:#a50>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>	el.addEventListener(<span style=color:#a50>&#39;load&#39;</span>, <span style=color:#00a>function</span>() {
</span></span><span style=display:flex><span>	  <span style=color:#0aa>window</span>.dataLayer.push({
</span></span><span style=display:flex><span>	    event: <span style=color:#a50>&#39;jQueryLoaded&#39;</span>
</span></span><span style=display:flex><span>	  });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#0aa>document</span>.head.appendChild(el);
</span></span><span style=display:flex><span>  })();
</span></span><span style=display:flex><span>&lt;/<span style=color:#1e90ff;font-weight:700>script</span>&gt;</span></span></code></pre></div><p>When this Custom HTML tag is run by GTM, the browser creates an asynchronous request to download the <code>jquery-3.2.1.js</code> from the CDN (Content Distribution Network). Once this asynchronous process is over, a <code>dataLayer.push({event: 'jQueryLoaded'})</code> fires, and you can then build a <strong>Custom Event trigger</strong> for this event name to fire any tags that are dependent on jQuery having loaded.</p><h3 id=using-tag-sequencing>Using Tag Sequencing</h3><p>If you only have a single tag that needs the asynchronously downloaded resource, a fairly elegant way to do this would be with <a href=/analytics/understanding-tag-sequencing-in-google-tag-manager/>tag sequencing</a>. With tag sequencing, you would create a <strong>Custom HTML tag</strong> for this code, and add it as the <strong>Setup tag</strong> in the sequence. The logic is that the asynchronous request is executed in the Setup tag, and once it&rsquo;s complete, the main tag can fire with confidence that the resource it is dependent on has completely loaded.</p><p>This is what the Custom HTML tag for the Setup tag would look like:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#1e90ff;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span>  (<span style=color:#00a>function</span>() {
</span></span><span style=display:flex><span>    <span style=color:#00a>var</span> el = <span style=color:#0aa>document</span>.createElement(<span style=color:#a50>&#39;script&#39;</span>);
</span></span><span style=display:flex><span>	el.src = <span style=color:#a50>&#39;https://code.jquery.com/jquery-3.2.1.js&#39;</span>;
</span></span><span style=display:flex><span>	el.<span style=color:#00a>async</span> = <span style=color:#a50>&#39;true&#39;</span>;
</span></span><span style=display:flex><span>	el.addEventListener(<span style=color:#a50>&#39;load&#39;</span>, <span style=color:#00a>function</span>() {
</span></span><span style=display:flex><span>	  <span style=color:#0aa>window</span>.google_tag_manager[{{Container ID}}].onHtmlSuccess({{HTML ID}});
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#0aa>document</span>.head.appendChild(el);
</span></span><span style=display:flex><span>  })();
</span></span><span style=display:flex><span>&lt;/<span style=color:#1e90ff;font-weight:700>script</span>&gt;</span></span></code></pre></div><p>Note that for this to work, you must enable the <a href=/analytics/variable-guide-google-tag-manager/#built-in-variables>Built-in variables</a> <strong>Container ID</strong> and <strong>HTML ID</strong>.</p><p>The mysterious <code>window.google_tag_manager[].onHtmlSuccess()</code> method is an internal function you need to use in tag sequencing if you want GTM to wait for some code (e.g. asynchronous callbacks) to execute before moving from the setup tag to the main tag. If you didn&rsquo;t have this piece of code here, GTM would simply jump straight to the main tag after executing the last line of the setup tag, and in that case it&rsquo;s very possible that jQuery hasn&rsquo;t completely downloaded yet.</p><h2 id=summary>Summary</h2><p>These two methods can be used to get the best of both worlds: asynchronous requests WITH predictability. Race conditions can be brutal and difficult to identify. It&rsquo;s only once you start logging JavaScript errors that you might notice an increase in error messages like <code>jQuery is not defined</code>. This is a signal that you might be trying to use a resource before it has completely loaded. Using a <code>load</code> listener is a handy way to combat this.</p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">TAGGED IN</span><br><a class="tag tag--primary tag--small" href=/tags/googletagmanager/>googletagmanager</a>
<a class="tag tag--primary tag--small" href=/tags/gtmtips/>gtmtips</a>
<a class="tag tag--primary tag--small" href=/tags/javascript/>javascript</a>
<a class="tag tag--primary tag--small" href=/tags/event-listener/>event listener</a>
<a class="tag tag--primary tag--small" href=/tags/race-condition/>race condition</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default" href=/analytics/add-clientid-to-custom-dimension-gtag-js/><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=/analytics/send-event-custom-dimension-google-optimize-experiment-running/><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-facebook"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Add%20A%20Load%20Listener%20To%20Script%20Elements%20https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/%20via%20@SimoAhava"><i class="fa fa-brands fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-linkedin"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#commento><i class="fa-regular fa-comments"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#><i class="fa fa-search"></i></a></li></ul></div><a name=commento></a><comentario-comments></comentario-comments></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2026 Simo Ahava. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default" href=/analytics/add-clientid-to-custom-dimension-gtag-js/><i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml">NEXT</span></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=/analytics/send-event-custom-dimension-google-optimize-experiment-running/><span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fa fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-facebook"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Add%20A%20Load%20Listener%20To%20Script%20Elements%20https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/%20via%20@SimoAhava"><i class="fa fa-brands fa-twitter"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-linkedin"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#commento><i class="fa-regular fa-comments"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#><i class="fa fa-search"></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fa fa-close"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-facebook"></i><span>Share on Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Add%20A%20Load%20Listener%20To%20Script%20Elements%20https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/%20via%20@SimoAhava"><i class="fa fa-brands fa-twitter"></i><span>Share on Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/add-load-listener-script-elements/"><i class="fa fa-brands fa-linkedin"></i><span>Share on LinkedIn</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-remove"></i></div><img id=about-card-picture src=https://www.simoahava.com/images/simo.png alt="Author's picture"><h4 id=about-card-name>Simo Ahava</h4><div id=about-card-bio>Husband | Father | Analytics developer<br>simo (at) simoahava.com</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Senior Data Advocate at Reaktor</div><div id=about-card-location><i class="fa fa-map-marker"></i><br>Finland</div></div></div><div id=cover style=background-image:url(https://www.simoahava.com/images/maisema.jpg)></div><script defer src=https://comentario.simoahava.com/comentario.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=/js/script.js></script><script>!function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),n=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");e&&(n&&(e.style.display="none"),t&&t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"}))}()</script></body></html>