

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "#GTMTips: 10 Useful Custom JavaScript Tricks | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2017\/01\/10-useful-custom-javascript-tricks.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/gtm-tips\/10-useful-custom-javascript-tricks\/",
  "datePublished": "2017-01-18T11:34:13\x2b00:00",
  "dateModified": "2017-01-18T11:34:13\x2b00:00",
  "description": "Introducing 10 useful Custom JavasScript tricks for Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.61.0 with theme Tranquilpeak 0.4.3-BETA">
    <title>#GTMTips: 10 Useful Custom JavaScript Tricks | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <script src="//simoahava.disqus.com/count.js" id="dsq-count-scr" async></script>
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/gtm-tips/10-useful-custom-javascript-tricks/">
    
    <meta name="description" content="Introducing 10 useful Custom JavasScript tricks for Google Tag Manager.">
    <meta property="og:description" content="Introducing 10 useful Custom JavasScript tricks for Google Tag Manager.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="#GTMTips: 10 Useful Custom JavaScript Tricks">
    <meta property="og:url" content="/gtm-tips/10-useful-custom-javascript-tricks/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="#GTMTips: 10 Useful Custom JavaScript Tricks">
    <meta name="twitter:description" content="Introducing 10 useful Custom JavasScript tricks for Google Tag Manager.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2017/01/10-useful-custom-javascript-tricks.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2017/01/10-useful-custom-javascript-tricks.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      #GTMTips: 10 Useful Custom JavaScript Tricks
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2017-01-18T11:34:13Z">
        
  January 18, 2017

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/gtm-tips">GTM tips</a>
    
  


       | <a href="https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/#disqus_thread">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>I recently published a <a href="https://www.simoahava.com/categories/gtm-tips/">#GTMTips</a> guide called <a href="https://www.simoahava.com/gtm-tips/10-useful-css-selectors/">10 Useful CSS Selectors</a>, and it was very well received. Inspired by the feedback, here's the next instalment. This time, we're going over some useful JavaScript tips and tricks that you can use to make your <a href="https://tagmanager.google.com/">Google Tag Manager</a> deployment even more efficient. <a href="https://www.simoahava.com/tags/javascript/">I've written <strong>a lot</strong> about JavaScript in this blog</a>, and I intend to keep on doing so in the future. As always, if JavaScript is somewhat of a mystery to you, I strongly recommend you take the <a href="https://www.codecademy.com/learn/javascript">Codecademy (free) course on JS</a>, and take a look at the other available web technology tracks while you're there!</p>
<h2 id="tip-54-10-useful-custom-javascript-tricks">Tip 54: 10 Useful Custom JavaScript Tricks</h2>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2017/01/10-useful-custom-javascript-tricks.jpg" title="10 Useful Custom JavaScript Tricks">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2017/01/10-useful-custom-javascript-tricks.jpg#ZgotmplZ" alt="10 Useful Custom JavaScript Tricks">
  
    </a>
  
  
</div>


<p>You can deploy these tricks in Custom HTML Tags or Custom JavaScript Variables, since they are the only contexts within Google Tag Manager where you can execute arbitrary JavaScript. Note that some of the tricks are just code snippets, so you will need to understand enough of how <a href="https://www.simoahava.com/analytics/javascript-101-gtm-part-1/">Google Tag Manager and JavaScript mesh together</a> to be able to deploy them successfully.</p>
<p>Before adding any of these to your deployments, remember to use <a href="http://caniuse.com/">caniuse.com</a> to check for browser compatibility, and the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference">MDN JavaScript Reference</a> to find alternative ways (AKA polyfills) for writing the unsupported methods.</p>
<h2 id="1-string-methods">1. String methods</h2>
<p>String methods are utilities that you can use to modify any given string. Here are some of the most useful ones, in my opinion.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Use .trim() to strip leading and trailing whitespace from a string.
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;   Oh no! Leading AND trailing whitespace!!   &#34;</span>.<span style="color:#a6e22e">trim</span>();
<span style="color:#75715e">// Result: &#34;Oh no! Leading AND trailing whitespace!!&#34; 
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Use .replace() to replace characters or regular expressions with something else.
</span><span style="color:#75715e"></span><span style="color:#75715e">// .replace() without a regular expression replaces the first instance.
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;Food&#34;</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;o&#39;</span>, <span style="color:#e6db74">&#39;e&#39;</span>);
<span style="color:#75715e">// Result: &#34;Feod&#34;
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;Food&#34;</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/o/g</span>, <span style="color:#e6db74">&#39;e&#39;</span>);
<span style="color:#75715e">// Result: &#34;Feed&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Use .toUpperCase() and .toLowerCase() to change the case of the entire string
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;MixED CaSe String&#34;</span>.<span style="color:#a6e22e">toLowerCase</span>();
<span style="color:#75715e">// Result: &#34;mixed case string&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Use .substring() to return only part of the string.
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;?some-query-key=some-query-value&#34;</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">1</span>);
<span style="color:#75715e">// Returns: &#34;some-query-key=some-query-value&#34;
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;id: 12345-12345&#34;</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">9</span>);
<span style="color:#75715e">// Returns: &#34;12345&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Use .split() to split the string into its constituents
</span><span style="color:#75715e"></span><span style="color:#e6db74">&#34;get the second word of this sentence&#34;</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39; &#39;</span>)[<span style="color:#ae81ff">1</span>];
<span style="color:#75715e">// Returns &#34;the&#34;
</span></code></pre></div>
<p>Naturally, you can combine these in inventive ways. For example, to capitalize the first letter of any string you could do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;capitalize the first letter of this string, please!&#34;</span>;
<span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/^./</span>, <span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">substring</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">toUpperCase</span>());
</code></pre></div>
<p>Here we first identify the first letter of the string using a regular expression, after which we replace it with the first letter of the string that has been converted to upper case.</p>
<h2 id="2-array-methods">2. Array methods</h2>
<p>Array methods are really powerful in any programming language. Mastering methods such as <code>filter()</code> and <code>forEach()</code> is critical if you want to make your JavaScript more compact and often more readable.</p>
<h3 id="filter">filter()</h3>
<p><code>filter()</code> goes through each element in the Array, and returns a new Array for every element that passes the check you provide in the callback. Here's the syntax:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">someArray</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">eachItem</span>) { 
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">eachItem</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">someCondition</span>; 
});
</code></pre></div>
<p>So <code>eachItem</code> is the variable where the iterator stores each member of the Array as it is processed. If the callback returns <code>true</code>, it means that the item is added to the returned, new Array. If it returns <code>false</code>, it's dropped.</p>
<p>Here's an example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">window.<span style="color:#a6e22e">dataLayer</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">dataLayer</span> <span style="color:#f92672">||</span> [];
window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">push</span>({
  <span style="color:#e6db74">&#39;event&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;addMe!&#39;</span>
},{
  <span style="color:#e6db74">&#39;event&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;doNotAddMe!&#39;</span>
});

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newArray</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">dataLayer</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">event</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;addMe!&#39;</span>;
});
<span style="color:#75715e">// Returns: [{&#39;event&#39; : &#39;addMe!&#39;}]
</span></code></pre></div>
<p>The iterator checks every single item for the property <code>event</code>, and returns <code>true</code> if that property has value <code>addMe!</code>. Thus the returned array only has those elements that have the key-value pair <code>&quot;event&quot; : &quot;addMe!&quot;</code>.</p>
<h3 id="foreach">forEach()</h3>
<p>Remember the clumsy for-loop for iterating over an Array? Yuck! Instead, you can use the <code>forEach()</code> iterator.</p>
<p><code>forEach()</code> receives each item in the array one-by-one, and you can then do whatever you wish with this item. The syntax is very simple and intuitive, and thus should be preferred over the confusing for-loop.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;I&#34;</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">true</span>, <span style="color:#e6db74">&#34;love&#34;</span>, [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>], {<span style="color:#a6e22e">chocolate</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;too&#39;</span>}, <span style="color:#e6db74">&#34;you&#34;</span>];
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">newArray</span> <span style="color:#f92672">=</span> [];

<span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;string&#39;</span>) {
    <span style="color:#a6e22e">newArray</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">item</span>);
  }
});

<span style="color:#a6e22e">newArray</span>.<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34; &#34;</span>);
<span style="color:#75715e">// Result: &#34;I love you&#34;
</span></code></pre></div>
<p>As you can see, it's more readable than a for-loop, as you don't have to access the original array in the iterator.</p>
<h3 id="map">map()</h3>
<p>The <code>map()</code> iterates over each member in the array, again, but this time the code in the callback is executed against each member of the array, and a new array is returned with the results. Here's how to set it up:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">map</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">doSomething</span>(<span style="color:#a6e22e">item</span>);
});
</code></pre></div>
<p>In other words, you are <em>mapping</em> each element in the array against the result of the callback function. Here's are some examples:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>];
<span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">map</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>;
});
<span style="color:#75715e">// Result: [2,4,6,8,10]
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;  please     &#34;</span>, <span style="color:#e6db74">&#34;  trim&#34;</span>, <span style="color:#e6db74">&#34;     us  &#34;</span>];
<span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">map</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">item</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">trim</span>();
});
<span style="color:#75715e">// Result: [&#34;please&#34;, &#34;trim&#34;, &#34;us&#34;];
</span></code></pre></div>
<h3 id="reduce">reduce()</h3>
<p>The <code>reduce()</code> method is often the most complex one, but it actually has a very simple principle: You provide the function with an accumulator, and each member of the array is then operated against this accumulator. You can also provide an initial value to the accumulator. Here's what the basic structure looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">reduce</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">accumulator</span>, <span style="color:#a6e22e">item</span>) {
  <span style="color:#a6e22e">accumulator</span>.<span style="color:#a6e22e">doSomethingWith</span>(<span style="color:#a6e22e">item</span>);
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulator</span>;
}, <span style="color:#a6e22e">initialValue</span>);
</code></pre></div>
<p>This time, it's definitely easiest to learn via examples:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Example: calculate the sum of all even numbers in the array
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">17</span>,<span style="color:#ae81ff">21</span>,<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">30</span>];
<span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">reduce</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">accumulator</span>, <span style="color:#a6e22e">item</span>) { 
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">item</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) { 
    <span style="color:#a6e22e">accumulator</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">item</span>; 
  }
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulator</span>; 
}, <span style="color:#ae81ff">0</span>);
<span style="color:#75715e">// Returns: 52
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Example, concatenate a string of all product IDs in array
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">array</span> <span style="color:#f92672">=</span> [{
  <span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;firstId&#34;</span>,
  <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;T-shirts&#34;</span>
},{
  <span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;secondId&#34;</span>,
  <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Pants&#34;</span>
},{
  <span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;thirdId&#34;</span>,
  <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;shoes&#34;</span>
}];
<span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">reduce</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">accumulator</span>, <span style="color:#a6e22e">item</span>) {
  <span style="color:#a6e22e">accumulator</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">id</span>);
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulator</span>;
}, []).<span style="color:#a6e22e">join</span>();
<span style="color:#75715e">// Returns: &#34;firstId,secondId,thirdId&#34;
</span></code></pre></div>
<h2 id="3-ternary-operator">3. Ternary operator</h2>
<p>The ternary operator is just a very simple shorthand for running conditional checks in JavaScript. Here's an example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// BEFORE:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">something</span>) {
  <span style="color:#a6e22e">somethingElse</span>();
} <span style="color:#66d9ef">else</span> {
  <span style="color:#a6e22e">somethingDifferent</span>();
}

<span style="color:#75715e">// AFTER:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">something</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">somethingElse</span>() <span style="color:#f92672">:</span> <span style="color:#a6e22e">somethingDifferent</span>();
</code></pre></div>
<p>The ternary operator is thus used to combine an if-statement into a simple expression. First you provide an expression that evaluates to a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy">truthy</a> or <a href="https://developer.mozilla.org/en-US/docs/Glossary/Falsy">falsy</a> value, such as <code>me.name() === &quot;Simo&quot;</code>. Then you type the question mark, after which you write an expression that is executed if the first item evaluates to a <em>truthy</em> value. Finally, you type the colon <code>:</code>, after which you type the expression that is executed if the first item evaluates to a <em>falsy</em> value.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// BEFORE:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#findThisId&#39;</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span>) {
  <span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#findThisId&#39;</span>);
} <span style="color:#66d9ef">else</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Not found!&#34;</span>;
}

<span style="color:#75715e">// AFTER:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#findThisId&#39;</span>) <span style="color:#f92672">?</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#findThisId&#39;</span>) <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Not found!&#34;</span>;

<span style="color:#75715e">// EVEN BETTER:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#findThisId&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;Not found!&#34;</span>;
</code></pre></div>
<p>As you can see, sometimes there are even more efficient ways to process JavaScript statements than the ternary operator. Especially when working with simple binary checks (if value exists, return it), it might be better to just use basic <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators">logical operators</a> instead of complex statements or expressions.</p>
<h2 id="4-return-click-urlindexofpage-hostname---1">4. return {{Click URL}}.indexOf({{Page Hostname}}) &gt; -1</h2>
<p>This is very Google Tag Managerish. It's a simple Custom JavaScript Variable that returns <code>true</code> if the clicked element URL contains the current page hostname, and <code>false</code> otherwise. In other words, it returns <code>true</code> if the clicked link is internal, and <code>false</code> if it takes the user away from the website.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">URL</span>}}.<span style="color:#a6e22e">indexOf</span>({{<span style="color:#a6e22e">Page</span> <span style="color:#a6e22e">Hostname</span>}}) <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
}
</code></pre></div>
<h2 id="5-return-click-urlsplitpop">5. return {{Click URL}}.split('/').pop()</h2>
<p>Again, a simple Custom JavaScript Variable. This is especially useful when tracking <a href="https://www.simoahava.com/gtm-tips/track-file-downloads-in-gtm-v2/">file downloads</a>, as it returns the actual filename of the downloaded item. It does this by returning whatever is in the clicked URL after the last &lsquo;/'.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#75715e">// Example: https://www.simoahava.com/downloads/download_me.pdf
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">URL</span>}}.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;/&#39;</span>).<span style="color:#a6e22e">pop</span>();
  <span style="color:#75715e">// Returns: download_me.pdf
</span><span style="color:#75715e"></span>}
</code></pre></div>
<h2 id="6-create-a-random-unique-guid">6. Create a random, unique GUID</h2>
<p>Every now and then it's useful to create a random ID in GTM. For example, if you want to measure <a href="https://www.simoahava.com/analytics/improve-data-collection-with-four-custom-dimensions/">session IDs</a>, or if you want to assign a unique identifier to each page hit, you can achieve this with the following Custom JavaScript Variable.</p>
<p>The variable creates a GUID string (&ldquo;Globally Unique Identifier&rdquo;), and even though uniqueness isn't guaranteed, it's still very likely. There's only a microscopically small chance of collision.</p>
<p>This solution is gratefully adapted from <a href="http://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript/2117523#2117523">this StackOverflow post</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#39;</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[xy]/g</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">c</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">random</span>()<span style="color:#f92672">*</span><span style="color:#ae81ff">16</span><span style="color:#f92672">|</span><span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;x&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">r</span> <span style="color:#f92672">:</span> (<span style="color:#a6e22e">r</span><span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0x3</span><span style="color:#f92672">|</span><span style="color:#ae81ff">0x8</span>);
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">toString</span>(<span style="color:#ae81ff">16</span>);
  });
}
</code></pre></div>
<h2 id="7-return-an-iso-formatted-timestamp">7. Return an ISO-formatted timestamp</h2>
<p>This is one of my favorite solutions, as it lets you convert the current client time to a proper, readable timestamp. In addition, it has the timezone offset included, so you'll know just how much the users&rsquo; local times differ from your own timezone. I send this to Google Analytics with <a href="https://www.simoahava.com/analytics/improve-data-collection-with-four-custom-dimensions/">every single hit</a>, so that I can create a timeline of events when analyzing the data.</p>
<p>This solution is gratefully adapted from <a href="http://stackoverflow.com/a/17415677">this StackOverflow post</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">now</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tzo</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getTimezoneOffset</span>();
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dif</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tzo</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;+&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;-&#39;</span>;
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">pad</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">num</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">norm</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">abs</span>(Math.<span style="color:#a6e22e">floor</span>(<span style="color:#a6e22e">num</span>));     
    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">norm</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">norm</span>;
  };
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getFullYear</span>() 
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getMonth</span>()<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getDate</span>())
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;T&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getHours</span>())
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getMinutes</span>()) 
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getSeconds</span>())
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">now</span>.<span style="color:#a6e22e">getMilliseconds</span>())
    <span style="color:#f92672">+</span> <span style="color:#a6e22e">dif</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">tzo</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">60</span>) 
    <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;:&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pad</span>(<span style="color:#a6e22e">tzo</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">60</span>);
  <span style="color:#75715e">// Returns, for example: 2017-01-18T11:58:32.977+02:00
</span><span style="color:#75715e"></span>}
</code></pre></div>
<h2 id="8-matches-polyfill">8. .matches() polyfill</h2>
<p>When working with the Document Object Model (DOM), being able to identify elements is crucial. We already have a bunch of wonderful <a href="https://www.simoahava.com/gtm-tips/10-useful-css-selectors/">CSS selectors</a> at our disposal, but now we just need a method we can use to check if any given element matches one of these selectors.</p>
<p>Well, there's the <code>Element.matches(someSelector)</code> method that you can use, but it doesn't have <a href="http://caniuse.com/#search=matches">stellar browser support, even with prefixes</a>. With this solution, you can always use <code>.matches()</code> without having to worry about browser support. This trick is called a <strong>polyfill</strong>, as it patches lack of feature support with a workaround using JavaScript that is universally supported.</p>
<p>First, here's how the method works in general:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// Check if the parent of the clicked element has ID #testMe
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}};
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">parentElement</span>.<span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#39;#testMe&#39;</span>));
<span style="color:#75715e">// RESULT: true or false, depending on if the parent element matches the selector.
</span></code></pre></div>
<p>To implement <a href="https://developer.mozilla.org/en/docs/Web/API/Element/matches#Polyfill">the polyfill</a>, either ask your developers to add it to the site JavaScript as early as possible in the page load sequence, or use Google Tag Manager.</p>
<p>In Google Tag Manager, you'll need a Custom HTML Tag that fires as early as possible in the container load sequence (i.e. All Pages trigger with a high tag priority).</p>
<p>Here's the code you need to add to the Custom HTML Tag. It's gratefully adapted from <a href="https://developer.mozilla.org/en/docs/Web/API/Element/matches#Polyfill">this MDN reference page</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">matches</span>) {
    <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">matches</span> <span style="color:#f92672">=</span> 
      <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">matchesSelector</span> <span style="color:#f92672">||</span> 
      <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">mozMatchesSelector</span> <span style="color:#f92672">||</span>
      <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">msMatchesSelector</span> <span style="color:#f92672">||</span> 
      <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">oMatchesSelector</span> <span style="color:#f92672">||</span> 
      <span style="color:#a6e22e">Element</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">webkitMatchesSelector</span> <span style="color:#f92672">||</span>
      <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">s</span>) {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">matches</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">this</span>.document <span style="color:#f92672">||</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">ownerDocument</span>).<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#a6e22e">s</span>),
            <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">matches</span>.<span style="color:#a6e22e">length</span>;
        <span style="color:#66d9ef">while</span> (<span style="color:#f92672">--</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">matches</span>.<span style="color:#a6e22e">item</span>(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">this</span>) {}
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;            
      };
  }
&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>
<p>The polyfill modifies the actual prototype of the <code>Element</code> object, which all HTML and DOM elements inherit from. After modifying the prototype, you can use the <code>matches()</code> method with confidence in all your GTM and site JavaScript.</p>
<h2 id="9-dom-traversal">9. DOM traversal</h2>
<p>Sometimes it's necessary to climb up (or down) the Document Object Model. For example, if you're using a <a href="https://support.google.com/tagmanager/answer/6106961?hl=en#Click">Click / All Elements trigger</a>, it always targets the actual element that was clicked. But that's not always necessarily the element you want to track! Say you have an HTML structure like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;takemeaway.html&#34;</span>&gt;
  &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;clickMe&#34;</span>&gt;
    &lt;<span style="color:#f92672">span</span>&gt;Click Me!&lt;/<span style="color:#f92672">span</span>&gt;
  &lt;/<span style="color:#f92672">button</span>&gt;
&lt;/<span style="color:#f92672">a</span>&gt;</code></pre></div>
<p>Now, if you use a Click / All Elements trigger, the element that is captured in the click is the <code>&lt;span/&gt;</code>. But I'm guessing you actually want to use the <code>&lt;a href=&quot;takemeaway.html&quot;&gt;</code> element, since you're more interested in knowing what happens <em>after</em> the click. So, you can use this Custom JavaScript Variable to return the nearest link above the clicked element in the DOM tree:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> {{<span style="color:#a6e22e">Click</span> <span style="color:#a6e22e">Element</span>}};
  <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#39;body&#39;</span>)) {
    <span style="color:#a6e22e">el</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">parentElement</span>;
  }
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">el</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">undefined</span>;
}
</code></pre></div>
<p>NOTE! This relies on the <code>matches()</code> method, so don't forget to implement the polyfill from above, first!</p>
<p>This Custom JavaScript Variable climbs up the DOM until it reaches the first link element it finds (<code>'a'</code>), after which it returns this element. If it doesn't find a link, it returns <code>undefined</code> instead.</p>
<h2 id="10-set-browser-cookies-with-ease">10. Set browser cookies with ease</h2>
<p>Cookies are a great, if somewhat outdated, way of <a href="https://www.simoahava.com/analytics/two-ways-to-persist-data-via-google-tag-manager/">storing information in the browser</a>. Since Google Tag Manager operates in the context of a web page, it is essentially stateless. Thus any information you want to persist from one page to another must be stored either in the server or the browser itself. The latter is far easier to do, and with browser cookies it's just a question of adding a couple of lines of code to your GTM deployment.</p>
<p>First, you need a Custom JavaScript Variable. You can name it <strong>{{Set Cookie}}</strong>, for example.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">function</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">ms</span>, <span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">domain</span>) {
    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">value</span>) {
      <span style="color:#66d9ef">return</span>;
    }
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cpath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;; path=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">path</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cdomain</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">domain</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#39;; domain=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">domain</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">expires</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ms</span>) {
      <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date();
      <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">setTime</span>(<span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">getTime</span>() <span style="color:#f92672">+</span> <span style="color:#a6e22e">ms</span>);
      <span style="color:#a6e22e">expires</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;; expires=&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">toUTCString</span>();
    }
    document.<span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">expires</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cpath</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">cdomain</span>;
  }
}
</code></pre></div>
<p>This Custom JavaScript Variable returns a function that takes five parameters:</p>
<ul>
<li>
<p><strong>name</strong> (required): the name of the cookie (string)</p>
</li>
<li>
<p><strong>value</strong> (required): the value of the cookie (string)</p>
</li>
<li>
<p><strong>ms</strong>: expiration time of the cookie in milliseconds. If unset, defaults to a Session cookie (expires when the browser is closed).</p>
</li>
<li>
<p><strong>path</strong>: the path of the cookie. If unset, defaults to the current page path.</p>
</li>
<li>
<p><strong>domain</strong>: the domain of the cookie. If unset, defaults to the current domain.</p>
</li>
</ul>
<p>To use the cookie, you invoke it with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">{{<span style="color:#a6e22e">Set</span> <span style="color:#a6e22e">Cookie</span>}}(<span style="color:#e6db74">&#39;test&#39;</span>, <span style="color:#e6db74">&#39;true&#39;</span>, <span style="color:#ae81ff">10000</span>, <span style="color:#e6db74">&#39;/&#39;</span>, <span style="color:#e6db74">&#39;simoahava.com&#39;</span>);
</code></pre></div>
<p>The code above, when run in GTM, sets a cookie with name <code>&quot;test&quot;</code>, value <code>&quot;true&quot;</code>, expiration time of ten seconds, and it's set on the root of the <code>simoahava.com</code> domain.</p>
<p>With this helper, setting cookies is a breeze. Remember that you can then use the handy <a href="https://www.simoahava.com/analytics/variable-guide-google-tag-manager/">1st Party Cookie</a> variable in GTM to retrieve values from set cookies.</p>
<h2 id="summary">Summary</h2>
<p>Here I listed 10 JavaScript tricks that I use (almost) all the time. There's plenty more to JavaScript, but with these methods you can get started on making your clunky Google Tag Manager deployment a thing of the past.</p>
<p>Do you have any favorite methods, tips, or tricks you want to share? Please do so in the comments below.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/gtmtips/">gtmtips</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/javascript/">JavaScript</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/automated-tests-for-google-tag-managers-datalayer/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/10-useful-css-selectors/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%2010%20Useful%20Custom%20JavaScript%20Tricks%20https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <span id="disqus"></span>
<div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/automated-tests-for-google-tag-managers-datalayer/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/10-useful-css-selectors/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%2010%20Useful%20Custom%20JavaScript%20Tricks%20https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%2010%20Useful%20Custom%20JavaScript%20Tricks%20https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/10-useful-custom-javascript-tricks/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




  
    
      <script>
        





        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'simoahava';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

