

  
    
  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />


<script type="application/ld+json">
{
  "@context": "http://schema.org", 
  "@type": "BlogPosting",
  "headline": "#GTMTips: Implement Referral Exclusions Via GTM | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2015\/07\/exclude-referrals-gtm.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/gtm-tips\/implement-referral-exclusions-via-gtm\/",
  "datePublished": "2015-07-17T11:46:56\x2b00:00",
  "dateModified": "2015-07-17T11:46:56\x2b00:00",
  "description": "Manage and update your referral exclusion list using Google Tag Manager. This is much more flexible than using the Google Analytics user interface.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>#GTMTips: Implement Referral Exclusions Via GTM | Simo Ahava's blog</title>
    
    <script>
      window.dataLayer=window.dataLayer||[];window.dataLayer.push({pageType: 'article'});
    </script>
    

    

    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://www.googletagmanager.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/gtm-tips/implement-referral-exclusions-via-gtm/">
    
    <meta name="description" content="Manage and update your referral exclusion list using Google Tag Manager. This is much more flexible than using the Google Analytics user interface.">
    <meta property="og:description" content="Manage and update your referral exclusion list using Google Tag Manager. This is much more flexible than using the Google Analytics user interface.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="#GTMTips: Implement Referral Exclusions Via GTM">
    <meta property="og:url" content="https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="#GTMTips: Implement Referral Exclusions Via GTM">
    <meta name="twitter:description" content="Manage and update your referral exclusion list using Google Tag Manager. This is much more flexible than using the Google Analytics user interface.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    

    
      <meta name="twitter:image" content="https://www.simoahava.com/images/2015/07/exclude-referrals-gtm.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2015/07/exclude-referrals-gtm.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          
          
            <div class="post-header main-content-wrap text-left">

  

    <h1>
      #GTMTips: Implement Referral Exclusions Via GTM
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2015-07-17T11:46:56Z">
        
  July 17, 2015

      </time>
    
      
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.simoahava.com/categories/gtm-tips">GTM tips</a>
    
  


       | <a href="https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/#commento">Comments</a>
  </div>


</div>

          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>Maintaining the list of <a href="https://support.google.com/analytics/answer/2795830?hl=en">Referral Exclusions</a> in <a href="https://analytics.google.com">Google Analytics</a> admin is a <strong>pain</strong>. Especially if you have a webstore, the number of referral sources you need to exclude to avoid sessions being split can grow really fast. Also, it's not like the list is has the most intuitive UI. Instead of a handy text area where you could just copy-paste stuff, you're left with a horrible line-by-line list, and there's no way of copying lists across properties or anything useful like that.</p>
<p>So, in this tip, I'll show you how you can modify the data at its source (the website), so that it becomes easier to manage the list of referrals you want to exclude.</p>
<h2 id="tip-27-exclude-referrals-with-a-custom-javascript-variable">Tip 27: Exclude referrals with a Custom JavaScript Variable</h2>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/07/exclude-referrals-gtm.jpg" title="Exclude referrals in GTM">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/07/exclude-referrals-gtm.jpg#ZgotmplZ" alt="Exclude referrals in GTM">
  
    </a>
  
  
</div>


<p>First, let's get one thing straight. The referral exclude list <strong>excludes</strong> referral traffic, it doesn't <strong>block</strong> it. &lsquo;Exclude&rsquo; here means that traffic that comes in from a referral you've excluded gets converted into the <strong>Direct / (none)</strong> source/medium bucket. If you know your Google Analytics, you know that GA attributes all hits to the <em>last non-direct acquisition source</em>. In plain English this means that all hits that have no referral information get attributed to whatever non-direct source you previously had active. If you don't have a previous campaign, or if the <a href="https://support.google.com/analytics/answer/2795871?hl=en">Campaign Timeout</a> setting has expired, then it gets attributed to <strong>Direct / (none)</strong>.</p>
<p>That means also that <strong>Referral Exclusion Lists should not be used to fight <a href="https://www.simoahava.com/analytics/spam-filter-insertion-tool/">referral spam</a></strong>. So many people have recommended this method, and all these people are thus guilty of giving horrible, horrible advice.</p>
<p>Now that we've got that cleared, let's get on with the solution. For this to work, you need to create a new <strong>Custom JavaScript Variable</strong>. Give it a descriptive name such as <strong>{{JS - Exclude Referrals}}</strong>. Copy-paste the following code within:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">function</span>() {
  <span style="color:#00a">var</span> referrals = [
    <span style="color:#a50">&#39;referrer1.com&#39;</span>,
    <span style="color:#a50">&#39;referrer2.com&#39;</span>,
    <span style="color:#a50">&#39;referrer3.com&#39;</span>,
    <span style="color:#a50">&#39;referrer4.com&#39;</span>
  ];
  <span style="color:#00a">var</span> hname = <span style="color:#00a">new</span> <span style="color:#0aa">RegExp</span>(<span style="color:#a50">&#39;https?://([^/:]+)&#39;</span>).exec({{Referrer}});
  <span style="color:#00a">if</span> (hname) { 
    <span style="color:#00a">for</span> (<span style="color:#00a">var</span> i = referrals.length; i--;) {
      <span style="color:#00a">if</span> (<span style="color:#00a">new</span> <span style="color:#0aa">RegExp</span>(referrals[i] + <span style="color:#a50">&#39;$&#39;</span>).test(hname[<span style="color:#099">1</span>])) {
        <span style="color:#00a">return</span> <span style="color:#00a">null</span>;
      }
    }
  }
  <span style="color:#00a">return</span> {{Referrer}};
}
</code></pre></div>
<p>The only thing you need to edit is the <code>referrals</code> Array. Each referral source you want to exclude is on its own row, enclosed in single quotes, and all lines end with a comma except the last one. That's the syntax.</p>
<p>The list gets turned into a <em>regular expression</em>, against which the referrer of the page (i.e. the URL of the page that brought the visitor to the current page) is tested. The regular expression is <strong>open on the left, and closed on the right</strong>, meaning that an entry such as <strong>simoahava.co</strong> will match the following:</p>
<ul>
<li>
<p>simoahava.co</p>
</li>
<li>
<p><a href="http://www.simoahava.co">www.simoahava.co</a></p>
</li>
<li>
<p>super.genious.simoahava.co</p>
</li>
</ul>
<p>But not the following:</p>
<ul>
<li>
<p>simoahava.com</p>
</li>
<li>
<p><a href="http://www.simoahava.co.uk">www.simoahava.co.uk</a></p>
</li>
<li>
<p><a href="http://www.google.fi">www.google.fi</a></p>
</li>
</ul>
<p>I hope you get the drift. If you're handy with regular expressions, feel free to modify the strings in the <code>referrals</code> Array. For example, to <em>only</em> exclude <strong>simoahava.com</strong> but not, for example <strong>store.simoahava.com</strong>, you'd create the entry like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#00a">var</span> referrals = [
  <span style="color:#a50">&#39;^simoahava.com&#39;</span>
];
</code></pre></div>
<p>The <code>$</code> which closes the expression at the end is added automatically to each line later in the script.</p>
<p>So, the script tests each entry you've added into the <code>referrals</code> Array against the hostname of the current referrer, and if there is a match, <em>null</em> is returned. This means that any GA Tag that uses this Variable will not send the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#referrer">Document Referrer</a> key with the payload, which is what GA uses to establish referral traffic.</p>
<p>To add this to your Google Analytics Tag, browse to <strong>More Settings</strong> -&gt; <strong>Fields to Set</strong>, and add the following details:</p>
<p><strong>Field Name</strong>: referrer<br>
<strong>Value</strong>: {{JS - Exclude Referrals}}</p>



<div class="figure nocaption" >
  
    <a href="https://www.simoahava.com/images/2015/07/ga-tag-referrer.jpg" title="Add referral exclusion to GA Tag">
  
    <img class="fig-img lazy" data-src="https://www.simoahava.com/images/2015/07/ga-tag-referrer.jpg#ZgotmplZ" alt="Add referral exclusion to GA Tag">
  
    </a>
  
  
</div>


<p>Like so.</p>
<p><strong>Note!</strong> Try this at your own risk. Remember to test the solution carefully before going ahead with a full-scale implementation. Referrer information is crucial in Google Analytics, as it can make or break your traffic attribution reports.</p>

              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-analytics/">google analytics</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/google-tag-manager/">Google Tag Manager</a>

  <a class="tag tag--primary tag--small" href="https://www.simoahava.com/tags/gtmtips/">gtmtips</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/access-array-members-in-the-data-layer/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/folders-and-syntax-highlighting-in-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Implement%20Referral%20Exclusions%20Via%20GTM%20https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://cdn.commento.io/js/commento.js"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/gtm-tips/access-array-members-in-the-data-layer/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/analytics/folders-and-syntax-highlighting-in-google-tag-manager/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Implement%20Referral%20Exclusions%20Via%20GTM%20https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%23GTMTips:%20Implement%20Referral%20Exclusions%20Via%20GTM%20https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/gtm-tips/implement-referral-exclusions-via-gtm/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://cdn.commento.io/js/count.js"></script>


    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>

    
  </body>
</html>

