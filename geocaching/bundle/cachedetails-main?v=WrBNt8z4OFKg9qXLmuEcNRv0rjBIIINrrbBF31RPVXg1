function extractHostname(n){var t=document.createElement("a");return t.href=n,t.hostname}function isGeocachingDomain(n){return n=="www.geocaching.com"||n=="geocaching.com"||n=="www.groundspeak.com"||n=="support.groundspeak.com"||n=="wiki.groundspeak.com"||n=="groundspeak.com"||n=="www.waymarking.com"||n=="waymarking.com"||n=="coord.info"?!0:!1}function createROT13array(){for(var n=0,i=[],t="abcdefghijklmnopqrstuvwxyz",r=t.length,n=0;n<r;n++)i[t.charAt(n)]=t.charAt((n+13)%26);for(n=0;n<r;n++)i[t.charAt(n).toUpperCase()]=t.charAt((n+13)%26).toUpperCase();return i}function convertROT13String(n){var t=0,r=n.length,i="";for(rot13array||(rot13array=createROT13array()),t=0;t<r;t++)i+=convertROT13Char(n.charAt(t));return i}function convertROT13Char(n){return n>="A"&&n<="Z"||n>="a"&&n<="z"?rot13array[n]:n}function convertROTStringWithBrackets(n){var i="",r="",u=!0,t=0,o=n.length,f=!1,s,e;for(rot13array||(rot13array=createROT13array()),t=0;t<o;t++){if(i=n.charAt(t),t<o-4&&n.toLowerCase().substr(t,4)=="<br/>"){r+="<br>";t+=3;continue}if(t<o-3&&n.toLowerCase().substr(t,4)=="<br>"){r+="<br>";t+=3;continue}i!="["||f?i=="]"&&f?f=!1:i=="<"&&u?u=!1:i!=">"||u?i==" "||(i=="&"?(s=/\&[^;]*\;/,e=s.exec(n.substr(t,n.length-t))[0],e&&(r+=e,t+=e.length-1,i="")):u&&!f&&(i=convertROT13Char(i))):u=!0:f=!0;r+=i}return r}function resizeObject(n){$(n).each(function(){$(this).outerWidth()>MAX_WIDTH&&(ResizeFlag=!0,$(this).removeAttr("width"),$(this).css("width",MAX_WIDTH+"px"),$(this).removeAttr("height"),$(this).css("height","inherit"),AddImageResize($(this)))})}function AddImageResize(n){if($(n).is("img")){$(n).on("click",function(){$.fancybox({href:this.src,titleShow:!1})});$(n).addClass("Pointer")}}function removeSizing(n){$(n).each(function(){$(this).removeAttr("width");$(this).css("width","inherit")})}function getTableWidth(n,t){var i,r;return $(n).hasClass("InsideTable")&&(i=$(n).closest("td"),i.length>0)?(r=i.css("padding-left").replace("px","")*2,i.outerWidth()-r):t}function scaleObject(n){$(n).each(function(){var n=MAX_WIDTH,i,r,t;n=getTableWidth($(this),n);i=$(this).width();r=$(this).height();i>n&&(t=r*n/i,t||(t="inherit"),$(this).width(n),$(this).height(t),$(this).css("width",n),$(this).css("height",t),AddImageResize($(this)))})}function ResizeTableContent(){ResizeFlag&&(removeSizing(".UserSuppliedContent td"),$(".UserSuppliedContent table").css("table-layout","fixed"),scaleObject(".UserSuppliedContent img"),$(".UserSuppliedContent table").css("table-layout","auto"))}function setHiddenCoordState(n){return n?($(window.GpxWptListControl.waypointTableSelector).find("tr").show(),$(".js-waypoints-show").hide(),$(".js-waypoints-hide").show(),$.cookie(hiddenLinkCookieName,"true")):($(window.GpxWptListControl.waypointTableSelector).find("tr[ishidden='true']").each(function(){$(this).hide().next("tr").hide()}),$(".js-waypoints-hide").hide(),$(".js-waypoints-show").show(),$.cookie(hiddenLinkCookieName,"false")),!1}function showFavoriteScore(){$.ajax({type:"POST",cache:!1,url:"/datastore/favorites.svc/score?u="+userToken,success:function(n){gotScore=!0;var t=0;n&&(t=n);t>100&&(t=100);$(".favorite-score").html((t<1?"<1":t)+"%"+$("#loc_favPointsScoreDesc").html())}})}var rot13array,MAX_WIDTH=670,ResizeFlag=!1,hiddenLinkCookieName,checkflag;$(function(){$(".UserSuppliedContent table").each(function(){$(this).css("border-spacing",$(this).attr("cellSpacing")+"px")});$(".UserSuppliedContent table td").each(function(){$(this).css("padding",$(this).parents("table").attr("cellPadding")+"px");$(this).children().css("max-width",MAX_WIDTH)});resizeObject(".UserSuppliedContent table, .UserSuppliedContent img,  .UserSuppliedContent div");$(".UserSuppliedContent td img").addClass("InsideTable");ResizeTableContent()});$(window).on("load",function(){ResizeFlag=!1;resizeObject(".UserSuppliedContent table, .UserSuppliedContent img");ResizeTableContent()});$("a.CoordInfoLink").qtip({content:{text:function(){var n=$('<input type="text" />').css("width","230px");return n.val($("a.CoordInfoLink").attr("href")),n}},position:{my:"top right",at:"bottom right",adjust:{x:8}},show:{event:"click"},hide:{event:"unfocus"},style:{classes:"qtip-light qtip-light-sm",def:!1,tip:{height:12,width:24,mimic:"top center",offset:16}},events:{visible:function(n,t){$(t.elements.tooltip).find("input").trigger("focus").trigger("select")}}}).on("click",function(n){n.preventDefault()});hiddenLinkCookieName="hiddenlinks";checkflag=!1;$(function(){if(window.GpxWptListControl){var n=$.cookie(hiddenLinkCookieName);$(".js-btn-checkall").on("click",function(n){n.preventDefault();checkflag=checkflag==!1?!0:!1;var t=document.getElementsByTagName("input");for(i=0;i<t.length;i++)t[i].type=="checkbox"&&(t[i].checked=checkflag)});$(".js-waypoints-show").on("click",function(n){n.preventDefault();setHiddenCoordState(!0)});$(".js-waypoints-hide").on("click",function(n){n.preventDefault();setHiddenCoordState(!1)});window.isReviewing||(n==null||n=="false"?setHiddenCoordState(!1):setHiddenCoordState(!0))}});var canUpdateFavoriteStatus=!0,gotScore=!1,favDropDown=$(".favorite-dropdown"),favContainer=$(".favorite-container");$(document).bind("mouseup",function(n){var t=$(n.target);t.parents().hasClass("favorite-dropdown")||t.parents().hasClass("FavoriteWidget")||favDropDown.hide(1,function(){favContainer.addClass("favorite-container");favContainer.removeClass("favorite-container-open")})});$("#uxFavContainerLink").on("click",function(){$(favDropDown).is(":visible")?favDropDown.hide(1,function(){favContainer.addClass("favorite-container");favContainer.removeClass("favorite-container-open")}):(gotScore||showFavoriteScore(),favContainer.addClass("favorite-container-open"),favContainer.removeClass("favorite-container"),favDropDown.show(1))});$("#add_to_favorites").on("click",function(){var n,t;if(canUpdateFavoriteStatus)return canUpdateFavoriteStatus=!1,n=parseInt($(".favorite-value").text()),n++,$(".favorite-value").text(n),t=parseInt($(".favorite-rank").text()),t--,$(".favorite-rank").text(t),$("#pnlNonfavoriteCache").fadeOut("fast",function(){$("#pnlFavoriteCache").fadeIn("fast")}),$.ajax({type:"POST",cache:!1,url:"/datastore/favorites.svc/update?u="+userToken+"&f=true",success:function(){canUpdateFavoriteStatus=!0;gotScore=!1;showFavoriteScore()}}),!1});$("#remove_from_favorites").on("click",function(){var n,t;if(canUpdateFavoriteStatus)return canUpdateFavoriteStatus=!1,n=parseInt($(".favorite-value").text()),n--,$(".favorite-value").text(n),t=parseInt($(".favorite-rank").text()),t++,$(".favorite-rank").text(t),$("#pnlFavoriteCache").fadeOut("fast",function(){$("#pnlNonfavoriteCache").fadeIn("fast")}),$.ajax({type:"POST",cache:!1,url:"/datastore/favorites.svc/update?u="+userToken+"&f=false",success:function(){canUpdateFavoriteStatus=!0;gotScore=!1;showFavoriteScore()}}),!1});(function(){var n=$("#viewCacheNote"),r=$("#editCacheNote"),t=$("#cacheNoteText"),u=$(".js-pcn-cancel"),f=$(".js-pcn-submit"),i=$(".js-pcn-status");n.text().length===0&&(n.data("default",!0),n.text(window.resources.cacheNoteDefaultText));n.on("click",function(){n.data("default")||t.val(n.text());n.hide();r.show()});u.on("click",function(){t.val(n.data("default")?"":n.text());r.hide();n.show()});f.on("click",function(){var u=t.val();i.text(window.resources.cacheNoteSaving).show();$.ajax({type:"POST",url:"/seek/cache_details.aspx/SetUserCacheNote",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify({dto:{et:u,ut:userToken}}),success:function(u){var f=JSON.parse(u.d),e;f.success===!0?(f.note.length>0?n.text(f.note).data("default",!1):(t.val(""),n.text(window.resources.cacheNoteDefaultText).data("default",!0)),e="/app/ui-icons/sprites/cache-types.svg#icon-"+f.badge,$("#activityBadge").find("use").attr("xlink:href",e),i.hide(),r.hide(),n.show()):i.text(window.resources.cacheNoteError).addClass("validation-error").show()},error:function(){i.text(window.resources.cacheNoteError).addClass("validation-error").show()}})})})();$("#pcn_help").qtip({position:{my:"top center",at:"bottom center"},show:{event:"click"},hide:{event:"click unfocus"},style:{classes:"qtip-dark",def:!1,tip:{width:24,height:12,offset:12}}});$(function(){function h(){u||(u=!0,$.ajax({url:"/seek/geocache.logbook",dataType:"json",data:{tkn:userToken,idx:r,num:o,sortOrder:$("#sortOrder").val()},success:function(n){s.hide();c(n);u=!1},error:function(n){n.value==="1"&&window.location.reload()}}))}function c(t){var i,u;e=t.pageInfo.totalPages;i=$(document.createElement("TBODY"));$("#tmpl_CacheLogRow").tmpl(t.data,{includeAvatars:includeAvatars}).appendTo(i);i.find("a.tb_images").each(function(){var n=$(this);n.fancybox({type:"image",titlePosition:"inside",padding:10,titleFormat:function(){return n.data("title")}})});u=i.children();n.append(u);f&&appendUpvotesToLogs($.map(t.data,function(n){return n.LogID}));$.each(u,function(){var n=$(this).find(".upvotes button");n.on("click",function(){return upvoteLog($(this))})});r=t.pageInfo.idx+1;o=t.pageInfo.size}var f=window.serverParameters["user:info"].isLoggedIn,u=!1,e=1,o=10,r=1,s=$("#pnlLazyLoad"),n=$("#cache_logs_table"),t,l,i;if(window.initialLogs&&(t=!1,l=n.offset().top,c(initialLogs),f)){$(window).on("scroll",function(){t&&(window.clearTimeout(t),t=!1);var n=function(){var n=$(".log-row:last-child");if(n.length!==0){var t=window.pageYOffset,i=t+window.innerHeight,r=n.offset().top,u=r+n.height();return u<i}};e<r||n()&&(s.show(),t=window.setTimeout(h,500))});i=!1;$(window).on("scroll",function(){i&&(window.clearTimeout(i),i=!1);i=window.setTimeout(function(){$(this).scrollTop()<l?$("#topScroll").fadeOut():$("#topScroll").fadeIn()},250)});$("#sortOrder").on("change",function(){n.css("min-height",n.height());n.html("");r=1;h();n.css("min-height","0");ga("send","event","Geocache Log Upvotes","Sort order changed",$(this).find("option:selected").data("name"))})}})