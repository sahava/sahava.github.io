

  


  





  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="google-site-verification" content="xQwWI2KUfP9LbFKhw2CVLFtrMY6Czrla7L3PD2aBolA" />



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>customTask Builder | Simo Ahava's blog</title>
    

    
    
    <script src="https://www.simoahava.com/x-js/lazyload.iife.min.js"></script>

    

    
    <script>
      (function(S,i,m,o){
        window[m]=window[m]||[];
        window[m].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
        var f=S.getElementsByTagName(i)[0],j=S.createElement(i),dl=m!='dataLayer'?'&l='+m:'';
        j.async=true;
        j.src='https://sgtm.simoahava.com/gtm.js?id='+o+dl;
        f.parentNode.insertBefore(j,f);
      })(document,'script','dataLayer','GTM-PZ7GMV9');
    </script>
    
    <meta name="author" content="Simo Ahava">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.simoahava.com/images/favicon.ico">
    
    <link rel="amphtml" href="https://www.simoahava.com/amp/tools/customtask-builder/">
    
    <meta name="description" content="You can use the customTask Builder tool to create a customTask script. customTask is a method of the Google Analytics library, which lets you run JavaScript code when the hit request to Google Analytics is being built.
 Click here to jump directly to the tool.
 This is very useful for a number of reasons, and I recommend you read customTask - The Guide before doing anything with the tool.">
    <meta property="og:description" content="You can use the customTask Builder tool to create a customTask script. customTask is a method of the Google Analytics library, which lets you run JavaScript code when the hit request to Google Analytics is being built.
 Click here to jump directly to the tool.
 This is very useful for a number of reasons, and I recommend you read customTask - The Guide before doing anything with the tool.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="customTask Builder">
    <meta property="og:url" content="https://www.simoahava.com/tools/customtask-builder/">
    <meta property="og:site_name" content="Simo Ahava&#39;s blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="customTask Builder">
    <meta name="twitter:description" content="You can use the customTask Builder tool to create a customTask script. customTask is a method of the Google Analytics library, which lets you run JavaScript code when the hit request to Google Analytics is being built.
 Click here to jump directly to the tool.
 This is very useful for a number of reasons, and I recommend you read customTask - The Guide before doing anything with the tool.">
    
      <meta name="twitter:creator" content="@SimoAhava">
      
    

    
    

    
      <meta property="og:image" content="https://www.simoahava.com/images/simo.png">
    


    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    
    
    
    <link rel="stylesheet" href="https://www.simoahava.com/css/style.css" />
    
    

    
      
    
    
  </head>

  <body>
    
    <div id="blog">
      <header id="header" data-behavior="1">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.simoahava.com/">Simo Ahava&#39;s blog</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="1">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.simoahava.com/">
          <img class="sidebar-profile-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Simo Ahava</h4>
        
          <h5 class="sidebar-profile-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tags/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/categories/gtm-tips/">
    
      <i class="sidebar-button-icon fa fa-lg fa-magic"></i>
      
      <span class="sidebar-button-desc">GTM Tips</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/about-simo-ahava/">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/tools/">
    
      <i class="sidebar-button-icon fa fa-lg fa-wrench"></i>
      
      <span class="sidebar-button-desc">Tools</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/blog-statistics/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bar-chart"></i>
      
      <span class="sidebar-button-desc">Blog statistics</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/sahava" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/upcoming-talks/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bullhorn"></i>
      
      <span class="sidebar-button-desc">Upcoming talks</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/custom-templates/">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Templates</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.simoahava.com/newsletter/">
    
      <i class="sidebar-button-icon fa fa-lg fa-bell"></i>
      
      <span class="sidebar-button-desc">Newsletter</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="1"
        class="
               hasCoverMetaIn
               ">
        <article class="post">
	  <form id="search" action="https://www.simoahava.com/search/">
  <input name="q" type="text" class="form-control input--xlarge" placeholder="Search blog..." autocomplete="off">
  </form>

          <div class="post-header main-content-wrap text-left">
  
  

    <h1>
      customTask Builder
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2018-08-15T07:26:32Z">
        
  August 15, 2018

      </time>
      
      

      | <a href="https://www.simoahava.com/tools/customtask-builder/#commento">Comments</a>
      
  </div>


</div>

          <div class="post-content markdown">
            <div class="main-content-wrap">
	      
                <p>You can use the <strong>customTask Builder</strong> tool to create a <code>customTask</code> script. <code>customTask</code> is a method of the <a href="https://analytics.google.com/">Google Analytics</a> library, which lets you run JavaScript code when the hit request to Google Analytics is being built.</p>
<blockquote>
<p>Click <a href="#the-customtask-builder-tool">here</a> to jump directly to the tool.</p>
</blockquote>
<p>This is very useful for a number of reasons, and I recommend you read <a href="https://www.simoahava.com/analytics/customtask-the-guide/"><code>customTask</code> - The Guide</a> before doing anything with the tool.</p>
<p>The tool automatically builds the necessary JavaScript, avoiding any potential conflicts that the overlapping methods might introduce otherwise.</p>
<p>When you add individual features to the script by selecting items in the table, you&rsquo;ll see how the final script is modified accordingly.</p>
<p>When you are satisfied with the result, select all the text within the white code box. You can also click the <strong>Copy to clipboard</strong> button to automatically copy the code to your clipboard.</p>
<div id="toc-container"><h1 id="table-of-contents">Table of Contents</h1> <input type="checkbox" id="show"><label for="show" id="showbtn"><h1 id="table-of-contents-mobile">Table of Contents</h1><span class="show">&nbsp;[+show]</span><span class="hide">&nbsp;[â€“hide]</span></label><nav id="TableOfContents">
  <ul>
    <li><a href="#general-deployment-instructions">General deployment instructions</a></li>
    <li><a href="#deployment-with-google-tag-manager">Deployment with Google Tag Manager</a></li>
    <li><a href="#deployment-with-analyticsjs">Deployment with analytics.js</a></li>
    <li><a href="#the-customtask-builder-tool">The customTask Builder tool</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
<h2 id="general-deployment-instructions">General deployment instructions</h2>
<p>Upon adding individual items to the script, you&rsquo;ll notice that the first lines of the script contain default values that you&rsquo;ll need to modify. For example, when adding the <strong>Client ID as a Custom Dimension</strong> item, you&rsquo;ll see these lines added to the code:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// clientIdIndex: The Custom Dimension index to where you want to send the visitor&#39;s Client ID.
</span><span style="color:#aaa;font-style:italic">// https://bit.ly/2Ms0ZcC  
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">var</span> clientIdIndex = <span style="color:#099">1</span>;
</code></pre></div>
<p>The value <code>1</code> is just a default value - you&rsquo;ll need to change this to the Custom Dimension index you have created in Google Analytics for this specific purpose.</p>
<p>Thus after copy-pasting the code into place, make sure you edit all the default values with the actual values you want to configure the items with. Otherwise you will run into severe data quality issues.</p>
<h2 id="deployment-with-google-tag-manager">Deployment with Google Tag Manager</h2>
<p>If you are using Google Tag Manager, you need to copy-paste the code into a <strong>Custom JavaScript variable</strong>. If you use the &ldquo;Copy to clipboard (for GTM)&rdquo; button, you don&rsquo;t have to modify the JavaScript as instructed below.</p>
<p>If, for some reason, you refuse to use the &ldquo;Copy to clipboard (for GTM)&rdquo; button, after copy-pasting the contents to the Custom JavaScript variable, you&rsquo;ll need to modify the first line by removing the <code>var _customTask = </code> part like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#aaa;font-style:italic">// OLD, CHANGE THIS:
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">var</span> _customTask = <span style="color:#00a">function</span>() {

<span style="color:#aaa;font-style:italic">// NEW, TO THIS:
</span><span style="color:#aaa;font-style:italic"></span><span style="color:#00a">function</span>() {
</code></pre></div>
<p>The second change you need to do is <strong>remove the semi-colon at the very end of the code block</strong>. In other words, remove the very last character of the entire code block, which should be a semi-colon <code>;</code>.</p>
<p>Once you&rsquo;re done modifying the default values, save the variable with the name <strong>{{customTask}}</strong> or something similar and descriptive.</p>
<p>Then, in your <a href="https://www.simoahava.com/analytics/google-analytics-settings-variable-in-gtm/">Google Analytics Settings variable</a>, go to <strong>Fields to set</strong>, and add a new field:</p>
<p><strong>Field name</strong>: customTask<br>
<strong>Value</strong>: {{customTask}}</p>
<p>If you&rsquo;re not using a Google Analytics Settings variable, you need to click <strong>Enable overriding settings in this tag</strong> in all the Google Analytics tags where you want to add this <code>customTask</code> as a field, and make the same change directly to the tag itself.</p>
<h2 id="deployment-with-analyticsjs">Deployment with analytics.js</h2>
<p>With the regular (legacy) Universal Analytics library, you first need to make sure the variable is written into memory, so in the site JavaScript (or page template), make sure the code in the code box below is executed before any Google Analytics commands are run.</p>
<p>Then, when you want to invoke this <code>customTask</code> in your trackers, find where you are creating the tracker and make the following change:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">ga(<span style="color:#a50">&#39;create&#39;</span>, <span style="color:#a50">&#39;UA-12345-1&#39;</span>);

ga(<span style="color:#a50">&#39;set&#39;</span>, <span style="color:#a50">&#39;customTask&#39;</span>, _customTask()); <span style="color:#aaa;font-style:italic">// &lt;-- Add this right after creating the tracker
</span><span style="color:#aaa;font-style:italic"></span>
ga(<span style="color:#a50">&#39;send&#39;</span>, <span style="color:#a50">&#39;pageview&#39;</span>);
</code></pre></div>
<h2 id="the-customtask-builder-tool">The customTask Builder tool</h2>
<div id="customTaskWrapper">
  <table>
    <thead>
      <tr>
        <th>Click to select which feature(s) to include</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td data-customtask-id='cid' data-customtask-selected='false'>Client ID as a Custom Dimension</td>
      </tr>
      <tr>
        <td data-customtask-id='ht' data-customtask-selected='false'>Hit Type as a Custom Dimension</td>
      </tr>
      <tr>
        <td data-customtask-id='pl' data-customtask-selected='false'>Payload Length as a Custom Dimension</td>
      </tr>
      <tr>
        <td data-customtask-id='rcd' data-customtask-selected='false'>Remove Custom Definitions from Page Speed Timing Hits</td>
      </tr>
      <tr>
        <td data-customtask-id='dh' data-customtask-selected='false'>Copy Hits to Multiple Properties</td>
      </tr>
      <tr>
        <td data-customtask-id='pr' data-customtask-selected='false'>Remove PII from Hits</td>
      </tr>
      <tr>
        <td data-customtask-id='sp' data-customtask-selected='false'>Copy Hits to Snowplow Collector Endpoint</td>
      </tr>
      <tr>
        <td data-customtask-id='sc' data-customtask-selected='false'>Update Session Cookie</td>
      </tr>
      <tr>
        <td data-customtask-id='id' data-customtask-selected='false'>Decorate Cross-domain Iframes</td>
      </tr>
      <tr>
        <td data-customtask-id='ti' data-customtask-selected='false'>Prevent Duplicate Transactions</td>
      </tr>
      <tr>
        <td data-customtask-id='o' data-customtask-selected='false'>Obfuscate And Copy Hit Payload</td>
      </tr>
      <tr>
        <td data-customtask-id='lsc' data-customtask-selected='false'>Use localStorage To Persist Client ID</td>
      </tr>
    </tbody>
  </table>
<p><button id="copyGtm">Copy to clipboard (for GTM)</button> | <button id="copy">Copy to clipboard</button></p>
  <pre id="result"></pre>
  <style>
    div#customTaskWrapper {
      padding: 10px;
      border: 1px dotted;
      border-radius: 5px;
      background: #f7f7ff;
    }
    
    button#copy, button#copyGtm {
      border: 2px solid #ccc;
      background: #eee;
      font-size: 1em;
      margin-top: 10px;
    }
    
    pre#result {
      overflow: scroll;
      white-space: pre-wrap;
      font-size: 0.8em;
      padding: 5px;
      background: #fff;
      line-height: 1.5em;
      margin-top: 0px;
      border: 2px solid #ccc;
    }

    div#customTaskWrapper table {
      border-bottom: 2px solid #909ba2;
      margin-top: 0;
    }

    td[data-customtask-id] {
      cursor: pointer;
    }

    td[data-customtask-selected="true"] {
      background: #d6ffc1 !important;
    }
  </style>
  <script>
    (function() {
      var customTaskItems = document.querySelectorAll('[data-customtask-id]');

      var copyBtn = document.querySelector('#copy');
	  var copyGtmBtn = document.querySelector('#copyGtm');

      var rowsInCode = {
        cid: [7,8,9,10,113,114,115,116,117,118],
        ht: [11,12,13,14,119,120,121,122,123,124],
        pl: [15,16,17,18,219,220,221,222,223,224,225,226,227],
        rcd: [19,20,21,22,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139],
        dh: [23,24,25,26,245,246,247,248,249,250,251,252,253,254,255,256,257],
        pr: [27,28,29,30,31,32,33,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218],
        sp: [34,35,36,37,232,233,234,235,236,237,238,239,240,241,242,243,244],
        sc: [38,39,40,41,42,43,44,258,259,260,261,262,263,264,265,266,267,268,269],
        id: [45,46,47,48,49,50,51,52,53,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165],
        ti: [54,55,56,57,58,59,60,185,186,187,188,189,190,191,192,193,194,195,196,197],
        o: [61,62,63,64,65,66,67,68,69,70,71,72,73,82,83,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320],
        lsc: [74,75,76,77,78,79,80,166,167,168,169,170,171,172,173,174,175,176]
      };

      var result = document.querySelector('#result');

      var customTask = [
        "var _customTask = function () {",
        "  // customTask Builder by Simo Ahava",
        "  //",
        "  // More information about customTask: https://www.simoahava.com/analytics/customtask-the-guide/",
        "  //",
        "  // Change the default values for the settings below.",
        "",
        "  // clientIdIndex: The Custom Dimension index to where you want to send the visitor's Client ID.",
        "  // https://bit.ly/2Ms0ZcC  ",
        "  var clientIdIndex = 1;",
        "",
        "  // hitTypeIndex: The Custom Dimension index to where you want to send the hit type of the request.",
        "  // https://bit.ly/2KZqLA9",
        "  var hitTypeIndex = 2;",
        "",
        "  // payloadLengthIndex: The Custom Dimension index to where you want to send the length of the payload of the request.",
        "  // https://bit.ly/2PdhPKM",
        "  var payloadLengthIndex = 3;",
        "",
        "  // removeCustomDefinitionsFromTimingHits: Set to true if you want to remove Custom Dimensions and Custom Metrics from the page speed timing hit.",
        "  // https://bit.ly/2nGzw8T",
        "  var removeCustomDefinitionsFromTimingHits = true;",
        "",
        "  // duplicateHitToTrackingIds: Array of all Universal Analytics tracking IDs to where you want to duplicate the initial hit.",
        "  // https://bit.ly/2MwFGGP",
        "  var duplicateHitToTrackingIds = ['UA-12345-1'];",
        "",
        "  // piiRegex: Array of {name, regex} objects, where the regular expression matches a pattern you want to replace with [REDACTED name].",
        "  // https://bit.ly/2wcJym2",
        "  var piiRegex = [{",
        "    name: 'EMAIL',",
        "    regex: /.{4}@.{4}/g",
        "  }];",
        "",
        "  // snowplowEndpoint: The Snowplow collector endpoint to which you want to send the GA request hit payload.",
        "  // https://bit.ly/2OCBzXc",
        "  var snowplowEndpoint = 'https://collector.simoahava.com/';",
        "",
        "  // updateSessionCookie: Object which contains both an expiration time (in milliseconds) and domain name.",
        "  // https://bit.ly/2wh1xsH",
        "  var updateSessionCookie = {",
        "    expiresMs: 1000 * 60 * 30,",
        "    domain: 'mydomain.com'",
        "  };",
        "",
        "  // iframeDecorator: Configuration object for decorating any iframe with cross-domain parameters when this customTask is run. NOTE! Increasingly inefficient with today's browsers blocking third-party cookies - please read the article linked to below.",
        "  // https://bit.ly/2LUoWFf",
        "  var iframeDecorator = {",
        "    selector: 'iframe#decorateMe',",
        "    attempts: 10,",
        "    intervalMs: 1000,",
        "    useAnchor: false",
        "  };",
        "",
        "  // transactionDeduper: Configuration object for preventing duplicate transactions from being recorded.",
        "  // https://bit.ly/2AvSZ2Y",
        "  var transactionDeduper = {",
        "    keyName: '_transaction_ids',",
        "    cookieExpiresDays: 365",
        "  };",
        "",
        "  // obfuscate: Obfuscates the entire hit payload (using a dictionary of words consistently) and dispatches it to the trackingId you provide.",
        "  // https://bit.ly/2RectUl",
        "  var obfuscate = {",
        "    tid: 'UA-12345-1',",
        "    dict: ['tumble', 'noble', 'flourish', 'abandon', 'liberal', 'team', 'conflict', 'collar', 'tiger', 'stun', 'grace', 'resource', 'phantom', 'imagine', 'information', 'hall', 'sweet', 'agriculture', 'bingo', 'relative'],",
        "    stringParams: ['uid','ua','dr','cn','cs','cm','ck','cc','ci','gclid','dclid','dl','dh','dp','dt','cd','cg[1-5]','linkid','an','aid','av','aiid','ec','ea','el','ti','ta','in','ic','iv','pr\\d{1,3}id','pr\\d{1,3}nm','pr\\d{1,3}br','pr\\d{1,3}ca','pr\\d{1,3}va','pr\\d{1,3}cc','pr\\d{1,3}cd\\d{1,3}','tcc','pal','col','il\\d{1,3}nm','il\\d{1,3}pi\\d{1,3}id','il\\d{1,3}pi\\d{1,3}nm','il\\d{1,3}pi\\d{1,3}br','il\\d{1,3}pi\\d{1,3}ca','il\\d{1,3}pi\\d{1,3}va','il\\d{1,3}pi\\d{1,3}cd\\d{1,3}','promo\\d{1,3}id','promo\\d{1,3}nm','promo\\d{1,3}cr','promo\\d{1,3}ps','sn','sa','st','utc','utv','utl','exd','cd\\d{1,3}','xid','exp','_utmz'],",
        "    priceParams: ['tr','ts','tt','ip','pr\\d{1,3}pr','id\\d{1,3}pi\\d{1,3}pr'],",
        "    priceModifier: Math.random(),",
        "    medium: ['organic', 'referral', 'social', 'cpc'],",
        "    replaceString: function(t){if(''===t)return t;'function'==typeof window.btoa&&(t=btoa(t));var n=t.split('').map(function(t){return t.charCodeAt(0)}).join('')%obfuscate.dict.length;return obfuscate.dict[n]},",
        "    init: function(){var c=[];obfuscate.dict.forEach(function(t){obfuscate.dict.forEach(function(o){c.push(t+'-'+o)})}),obfuscate.dict=obfuscate.dict.concat(c)}",
        "  };",
        "",
        "  // localStorageCid: Use localStorage to persist Client ID with Google Analytics tags",
        "  // https://bit.ly/2GNElc4",
        "  var localStorageCid = {",
        "    objectName: 'ga_client_id',",
        "    expires: 1000*60*60*24*365*2",
        "  };",
        "",
        "  // DO NOT EDIT ANYTHING BELOW THIS LINE",
        "  if (typeof obfuscate === 'object' && typeof obfuscate.init === 'function') obfuscate.init();",
        "",
        "  var readFromStorage = function (key) {",
        "    if (!window.Storage) {",
        "      // From: https://stackoverflow.com/a/15724300/2367037",
        "      var value = '; ' + document.cookie;",
        "      var parts = value.split('; ' + key + '=');",
        "      if (parts.length === 2) {",
        "        return parts.pop().split(';').shift();",
        "      }",
        "    } else {",
        "      return window.localStorage.getItem(key);",
        "    }",
        "  };",
        "",
        "  var writeToStorage = function (key, value, expireDays) {",
        "    if (!window.Storage) {",
        "      var expiresDate = new Date();",
        "      expiresDate.setDate(expiresDate.getDate() + expireDays);",
        "      document.cookie = key + '=' + value + ';expires=' + expiresDate.toUTCString();",
        "    } else {",
        "      window.localStorage.setItem(key, value);",
        "    }",
        "  };",
        "",
        "  var globalSendHitTaskName   = '_ga_originalSendHitTask';",
        "",
        "  return function (customTaskModel) {",
        "",
        "    window[globalSendHitTaskName] = window[globalSendHitTaskName] || customTaskModel.get('sendHitTask');",
        "",
        "    // clientIdIndex",
        "    if (typeof clientIdIndex === 'number') {",
        "      customTaskModel.set('dimension' + clientIdIndex, customTaskModel.get('clientId'));",
        "    }",
        "    // /clientIdIndex",
        "",
        "    // hitTypeIndex",
        "    if (typeof hitTypeIndex === 'number') {",
        "      customTaskModel.set('dimension' + hitTypeIndex, customTaskModel.get('hitType'));",
        "    }",
        "    // /hitTypeIndex",
        "",
        "    // removeCustomDefinitionsFromTimingHits",
        "    if (typeof removeCustomDefinitionsFromTimingHits === 'boolean' && removeCustomDefinitionsFromTimingHits === true) {",
        "      if (customTaskModel.get('hitType') === 'timing') {",
        "        var _rcd_tempFieldObject = {};",
        "        var _rcd_dimensionIndex = 1;",
        "        while (_rcd_dimensionIndex !== 201) {",
        "          _rcd_tempFieldObject['dimension' + _rcd_dimensionIndex] = undefined;",
        "          _rcd_tempFieldObject['metric' + _rcd_dimensionIndex] = undefined;",
        "          _rcd_dimensionIndex++;",
        "        }",
        "        customTaskModel.set(_rcd_tempFieldObject);",
        "      }",
        "    }",
        "    // /removeCustomDefinitionsFromTimingHits",
        "",
        "    // iframeDecorator",
        "    if (typeof iframeDecorator === 'object' && typeof iframeDecorator.selector === 'string' && typeof iframeDecorator.attempts === 'number' && typeof iframeDecorator.intervalMs === 'number') {",
        "      var _id_decorateTimer;",
        "      var _id_count = 0;",
        "      var _id_ga = window[window['GoogleAnalyticsObject']];",
        "      var _id_tracker = _id_ga.getByName(customTaskModel.get('name'));",
        "      var _id_decorateIframe = function () {",
        "        var _id_iframe = document.querySelector(iframeDecorator.selector);",
        "        if (_id_iframe !== null && /[?&]_ga=/.test(_id_iframe.src)) {",
        "          window.clearInterval(_id_decorateTimer);",
        "          return;",
        "        }",
        "        if (_id_iframe === null) {",
        "          _id_count += 1;",
        "          if (_id_count === iframeDecorator.attempts) {",
        "            window.clearInterval(_id_decorateTimer);",
        "          }",
        "          return;",
        "        }",
        "        window.clearInterval(_id_decorateTimer);",
        "        _id_iframe.src = (new window.gaplugins.Linker(_id_tracker)).decorate(_id_iframe.src, iframeDecorator.useAnchor);",
        "      };",
        "      _id_decorateTimer = window.setInterval(_id_decorateIframe, iframeDecorator.intervalMs);",
        "    }",
        "    // /iframeDecorator",
        "",
        "    // localStorageCid",
        "    if (typeof localStorageCid === 'object' && typeof localStorageCid.objectName === 'string' && typeof localStorageCid.expires === 'number' && window.Storage) {",
        "      var _lsc_clientId = customTaskModel.get('clientId');",
        "      var _lsc_obj = JSON.stringify({",
        "        clientId: _lsc_clientId,",
        "        expires: new Date().getTime() + localStorageCid.expires",
        "      });",
        "      window.localStorage.setItem(localStorageCid.objectName, _lsc_obj);",
        "    }",
        "    // /localStorageCid",
        "",
        "    customTaskModel.set('sendHitTask', function (sendHitTaskModel) {",
        "",
        "      var originalSendHitTaskModel = sendHitTaskModel,",
        "          originalSendHitTask      = window[globalSendHitTaskName],",
        "          canSendHit               = true;",
        "",
        "      try {",
        "",
        "        // transactionDeduper",
        "        if (typeof transactionDeduper === 'object' && transactionDeduper.hasOwnProperty('keyName') && transactionDeduper.hasOwnProperty('cookieExpiresDays') && typeof sendHitTaskModel.get('&ti') !== 'undefined') {",
        "          var _td_transactionId = sendHitTaskModel.get('&ti');",
        "          var _td_storedIds = JSON.parse(readFromStorage(transactionDeduper.keyName) || '[]');",
        "          if (_td_storedIds.indexOf(_td_transactionId) > -1 && ['transaction', 'item'].indexOf(sendHitTaskModel.get('hitType')) === -1) {",
        "            canSendHit = false;",
        "          } else if (_td_storedIds.indexOf(_td_transactionId) === -1) {",
        "            _td_storedIds.push(_td_transactionId);",
        "            writeToStorage(transactionDeduper.keyName, JSON.stringify(_td_storedIds), transactionDeduper.cookieExpiresDays);",
        "          }",
        "        }",
        "        // /transactionDeduper",
        "",
        "        // piiRegex",
        "        if (typeof piiRegex !== 'undefined' && piiRegex.length) {",
        "          var _pr_hitPayloadParts = sendHitTaskModel.get('hitPayload').split('&');",
        "          for (var _pr_regexI = 0; _pr_regexI < _pr_hitPayloadParts.length; _pr_regexI++) {",
        "            var _pr_param = _pr_hitPayloadParts[_pr_regexI].split('=');",
        "            var _pr_val;",
        "            try {",
        "              _pr_val = decodeURIComponent(decodeURIComponent(_pr_param[1]));",
        "            } catch(e) {",
        "              _pr_val = decodeURIComponent(_pr_param[1]);",
        "            }",
        "            piiRegex.forEach(function(pii) {",
        "              _pr_val = _pr_val.replace(pii.regex, '[REDACTED ' + pii.name + ']');",
        "            });",
        "            _pr_param[1] = encodeURIComponent(_pr_val);",
        "            _pr_hitPayloadParts[_pr_regexI] = _pr_param.join('=');",
        "          }",
        "          sendHitTaskModel.set('hitPayload', _pr_hitPayloadParts.join('&'), true);",
        "        }",
        "        // /piiRegex",
        "",
        "        // payloadLengthIndex",
        "        if (typeof payloadLengthIndex === 'number') {",
        "          var _pl_hitPayload = sendHitTaskModel.get('hitPayload');",
        "          _pl_hitPayload += '&cd' + payloadLengthIndex + '=';",
        "          _pl_hitPayload += (_pl_hitPayload.length + _pl_hitPayload.length.toString().length);",
        "          sendHitTaskModel.set('hitPayload', _pl_hitPayload, true);",
        "        }",
        "        // /payloadLengthIndex",
        "",
        "        if (canSendHit) {",
        "          originalSendHitTask(sendHitTaskModel);",
        "        }",
        "",
        "        // snowplowEndpoint",
        "        if (typeof snowplowEndpoint === 'string') {",
        "          var _sp_hitPayload = sendHitTaskModel.get('hitPayload');",
        "          var _sp_snowplowVendor = 'com.google.analytics';",
        "          var _sp_snowplowVersion = 'v1';",
        "          var _sp_snowplowPath = (snowplowEndpoint.substring(snowplowEndpoint.length-1) !== '/' ? snowplowEndpoint + '/' : snowplowEndpoint) + _sp_snowplowVendor + '/' + _sp_snowplowVersion;",
        "          var _sp_request = new XMLHttpRequest();",
        "          _sp_request.open('POST', _sp_snowplowPath, true);",
        "          _sp_request.setRequestHeader('Content-type', 'text/plain; charset=UTF-8');",
        "          _sp_request.send(_sp_hitPayload);",
        "        }",
        "        // /snowplowEndpoint",
        "",
        "        // duplicateHitToTrackingIds",
        "        if (typeof duplicateHitToTrackingIds !== 'undefined' && duplicateHitToTrackingIds.length) {",
        "          var _dh_hitPayload = sendHitTaskModel.get('hitPayload');",
        "          var _dh_originalTrackingId = new RegExp(sendHitTaskModel.get('trackingId'), 'gi');",
        "          duplicateHitToTrackingIds.forEach(function(newTrackingId) {",
        "            sendHitTaskModel.set('hitPayload', _dh_hitPayload.replace(_dh_originalTrackingId, newTrackingId), true);",
        "            if (canSendHit) {",
        "              originalSendHitTask(sendHitTaskModel);",
        "            }",
        "          });",
        "        }",
        "        // /duplicateHitToTrackingIds",
        "",
        "        // updateSessionCookie",
        "        if (typeof updateSessionCookie === 'object' && updateSessionCookie.hasOwnProperty('expiresMs') && updateSessionCookie.hasOwnProperty('domain')) {",
        "          var _sc_hitType = sendHitTaskModel.get('hitType');",
        "          var _sc_nonInteraction = sendHitTaskModel.get('nonInteraction');",
        "          if (_sc_nonInteraction !== true && (_sc_hitType === 'pageview' || _sc_hitType === 'event')) {",
        "            var _sc_d = new Date();",
        "            _sc_d.setTime(_sc_d.getTime() + updateSessionCookie.expiresMs);",
        "            document.cookie = '_session_' + sendHitTaskModel.get('trackingId') + '=true; expires=' + _sc_d.toUTCString() + '; path=/; domain=' + updateSessionCookie.domain;",
        "          }",
        "        }",
        "        // /updateSessionCookie",
        "",
        "        // obfuscate",
        "        if (typeof obfuscate === 'object' && obfuscate.hasOwnProperty('tid') && obfuscate.hasOwnProperty('dict') && obfuscate.hasOwnProperty('stringParams') && obfuscate.hasOwnProperty('priceParams') && obfuscate.hasOwnProperty('replaceString') && obfuscate.hasOwnProperty('priceModifier')) {",
        "          var _o_hitPayload = sendHitTaskModel.get('hitPayload');",
        "          obfuscate.stringParams.forEach(function(strParam) {",
        "            var regexParam = new RegExp('[?&]' + strParam + '=[^&]+', 'g');",
        "            var paramsInHitpayload = _o_hitPayload.match(regexParam) || [];",
        "            paramsInHitpayload.forEach(function(keyValue) {",
        "              var parts = keyValue.split('=');",
        "              var urlParts = parts[1].split('%2F').map(function(urlPart) {",
        "                if (/https?:/.test(decodeURIComponent(urlPart))) return urlPart;",
        "                return urlPart.split('%20').map(function(wordPart) {",
        "                  return obfuscate.replaceString(wordPart);",
        "                }).join('%20');",
        "              }).join('%2F');",
        "              _o_hitPayload = _o_hitPayload.replace(parts.join('='), parts[0] + '=' + urlParts);",
        "            });",
        "          });",
        "          obfuscate.priceParams.forEach(function(prParam) {",
        "            var regexParam = new RegExp('[?&]' + prParam + '=[^&]+', 'g');",
        "            var paramsInHitpayload = _o_hitPayload.match(regexParam) || [];",
        "            paramsInHitpayload.forEach(function(keyValue) {",
        "              var parts = keyValue.split('=');",
        "              var price = parseFloat(parts[1]) || 0.00;",
        "              price = (price * obfuscate.priceModifier).toFixed(2);",
        "              _o_hitPayload = _o_hitPayload.replace(parts.join('='), parts[0] + '=' + price);",
        "            });",
        "          });",
        "          _o_hitPayload = _o_hitPayload",
        "            .replace(",
        "              '&tid=' + sendHitTaskModel.get('trackingId') + '&', ",
        "              '&tid=' + obfuscate.tid + '&'",
        "            )",
        "            .replace(/[?&]aip($|&|=[^&]*)/, '')",
        "            .replace(/[?&]c[sm]=[^&]*/g, '')",
        "            .replace(/[?&]uip=[^&]*/g, '');",
        "          if (Math.random() <= 0.10) {",
        "            _o_hitPayload += ",
        "              '&cs=' + obfuscate.dict[Math.floor(Math.random()*obfuscate.dict.length)] + ",
        "              '&cm=' + obfuscate.medium[Math.floor(Math.random()*obfuscate.medium.length)];",
        "          }",
        "          _o_hitPayload += '&uip=' + ",
        "            (Math.floor(Math.random() * 255) + 1) + '.' +",
        "            (Math.floor(Math.random() * 255) + 0) + '.' +",
        "            (Math.floor(Math.random() * 255) + 0) + '.' +",
        "            (Math.floor(Math.random() * 255) + 0);",
        "          _o_hitPayload += '&aip=1';",
        "          sendHitTaskModel.set('hitPayload', _o_hitPayload, true);",
        "          originalSendHitTask(sendHitTaskModel);",
        "        }",
        "        // /obfuscate",
        "",
        "      } catch(err) {",
        "        originalSendHitTask(originalSendHitTaskModel);",
        "      }",
        "",
        "    });",
        "",
        "  };",
        "};",
      ];
      
      var buildResult = function() {
        var finalCustomTask = [];
        var deleteCells = [];
        var notSelected = document.querySelectorAll('[data-customtask-selected="false"]');
        notSelected.forEach(function(el) {
          var notSelectedItemID = el.getAttribute('data-customtask-id');
          rowsInCode[notSelectedItemID].forEach(function(cellIndexToBeRemoved) {
            deleteCells.push(cellIndexToBeRemoved);
          });
        });
        customTask.forEach(function(customTaskRow, customTaskRowIndex) {
          if (deleteCells.indexOf(customTaskRowIndex) === -1) {
            finalCustomTask.push(customTaskRow);
          }
        })
        result.textContent = finalCustomTask.join('\n');
      };

      var selectItem = function(e) {
        var item = e.target;
        if (item.getAttribute('data-customtask-selected') === 'false') {
          item.setAttribute('data-customtask-selected', 'true');
        } else if (item.getAttribute('data-customtask-selected') === 'true') {
          item.setAttribute('data-customtask-selected', 'false');
        }
        buildResult();
      };

      var copyToClipboard = function(e) {
        var textArea = document.createElement("textarea");
        textArea.value = result.textContent;
		if (e.target.id === 'copyGtm') {
		  textArea.value = textArea.value.replace('var _customTask = ', '').replace(/;$/, '');
	    }
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
          document.execCommand('copy');
        } catch (err) {
          console.error('Fallback: Oops, unable to copy', err);
        }

        document.body.removeChild(textArea);
      };

      customTaskItems.forEach(function(item) {
        item.addEventListener('click', selectItem, true);
      });

      copyBtn.addEventListener('click', copyToClipboard, true);
	  copyGtmBtn.addEventListener('click', copyToClipboard, true);

      buildResult();
    })();
  </script>
</div>
<h2 id="summary">Summary</h2>
<p>I hope you find this tool useful. I will try to update it as I come up with new <code>customTask</code> ideas, which seems to be quite often.</p>
<p>Please let me know in the comments if you are having trouble using the tool, or if you have new <code>customTask</code> ideas in mind you&rsquo;d want to include in the tool.</p>

              
              

            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/custom-templates/enhanced-ecommerce-object-builder/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/test-page/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/tools/customtask-builder/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=customTask%20Builder%20https://www.simoahava.com/tools/customtask-builder/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/tools/customtask-builder/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


            
              <span id="commento_thread"></span>
<div id="commento"></div>
<script defer src="https://commento.simoahava.com/js/commento.js" data-no-livereload="true"></script>

            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 Simo Ahava. All Rights Reserved
  </span>
</footer>

      </div>
      
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/custom-templates/enhanced-ecommerce-object-builder/">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default" href="https://www.simoahava.com/test-page/">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/tools/customtask-builder/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=customTask%20Builder%20https://www.simoahava.com/tools/customtask-builder/%20via%20@SimoAhava">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/tools/customtask-builder/">
              <i class="fa fa-linkedin"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#commento_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#">
          <i class="fa fa-search"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      
      <div id="share-options-bar" class="share-options-bar" data-behavior="1">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.simoahava.com/tools/customtask-builder/">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=customTask%20Builder%20https://www.simoahava.com/tools/customtask-builder/%20via%20@SimoAhava">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/cws/share?url=https://www.simoahava.com/tools/customtask-builder/">
          <i class="fa fa-linkedin"></i><span>Share on LinkedIn</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>

    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.simoahava.com/images/simo.png" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Simo Ahava</h4>
    
      <div id="about-card-bio">Husband | Father | Analytics developer<br>simo (at) simoahava.com</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Senior Data Advocate at Reaktor
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Finland
      </div>
    
  </div>
</div>

    
  
    
    <div id="cover" style="background-image:url('https://www.simoahava.com/images/maisema.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>




<script src="https://www.simoahava.com/js/script.js"></script>




<script src="https://commento.simoahava.com/js/count.js"></script>

    <script>
      !function(){var e=document.querySelector(".simmer"),t=document.querySelector(".simmer .close"),o=window.sessionStorage&&window.sessionStorage.getItem("nosimmer");if(e){if(o){e.style.display="none"}t.addEventListener("click",function(){window.sessionStorage.setItem("nosimmer","true"),e.style.display="none"})}}();
    </script>
    <script>
      var mylazyload = new LazyLoad({elements_selector: '.lazy'});
      </script>
    <style>
      .ads {
	  width: 1px;
      }
      </style>
         

    
  </body>
</html>

