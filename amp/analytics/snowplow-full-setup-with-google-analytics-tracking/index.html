

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
  .type-simmer {
      padding: 8px;
      background: rgba(179,138,197,0.2);
      box-shadow: 2px 2px 1px #ccc;
      border-radius: 5px;
  }
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}.badge-primary{color:#fff;background-color:#007bff}.badge{display:inline-block;padding:.25em .4em;font-size:80%;font-weight:700;line-height:1;text-align:center;white-space:nowrap;vertical-align:middle;border-radius:.25rem}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/snowplow-full-setup-with-google-analytics-tracking/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Snowplow: Full Setup With Google Analytics Tracking | Simo Ahava's blog</title>
        



  

<meta property="og:title" content="Snowplow: Full Setup With Google Analytics Tracking" />
<meta name="description" content="Step-by-step process for setting up a Snowplow analytics pipeline with data pulled in from your Google Analytics trackers." />
<meta property="og:description" content="Step-by-step process for setting up a Snowplow analytics pipeline with data pulled in from your Google Analytics trackers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/snowplow-full-setup-with-google-analytics-tracking/" />

      <meta name="twitter:image" content="https://www.simoahava.com/images/2018/02/snowplow-etl-emr.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2018/02/snowplow-etl-emr.jpg">
    


    
        <meta property="article:published_time" content="2018-02-07T07:00:37Z"/>
    
    
        <meta property="article:modified_time" content="2018-02-07T07:00:37Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="snowplow" />
        
            <meta property="article:tag" content="amazon" />
        
            <meta property="article:tag" content="aws" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    



<meta itemprop="name" content="Snowplow: Full Setup With Google Analytics Tracking">
<meta itemprop="description" content="Step-by-step process for setting up a Snowplow analytics pipeline with data pulled in from your Google Analytics trackers.">
<meta itemprop="datePublished" content="2018-02-07T09:00:37&#43;02:00" />
<meta itemprop="dateModified" content="2018-02-07T09:00:37&#43;02:00" />
<meta itemprop="wordCount" content="8743">



<meta itemprop="keywords" content="google tag manager,snowplow,amazon,aws," />
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava\u0027s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https:\/\/www.simoahava.com\/amp\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Snowplow: Full Setup With Google Analytics Tracking | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2018\/02\/snowplow-etl-emr.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/amp\/analytics\/snowplow-full-setup-with-google-analytics-tracking\/",
  "datePublished": "2018-02-07T09:00:37\u002b02:00",
  "dateModified": "2018-02-07T09:00:37\u002b02:00",
  "description": "Step-by-step process for setting up a Snowplow analytics pipeline with data pulled in from your Google Analytics trackers.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/custom-templates/">Templates</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/newsletter/">Newsletter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ab-testing/">ab-testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ad-blocker/">ad-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/azure/">azure</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-template/">client-template</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cname/">cname</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent/">consent</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent-mode/">consent-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-export/">container-export</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversions-api/">conversions-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/core-web-vitals/">core-web-vitals</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tags/">custom-html-tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer-tools/">developer-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/experimentation/">experimentation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exploit/">exploit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/false/">false</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fpid/">fpid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga4/">ga4</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-ads/">google-ads</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-4/">google-analytics-4</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag.js/">gtag.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/intelligent-tracking-prevention/">intelligent-tracking-prevention</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/node.js/">node.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/parameter-reporting/">parameter-reporting</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/postmessage/">postmessage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview/">preview</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/proxy/">proxy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/queue-time/">queue-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/recaptcha/">recaptcha</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/samesite/">samesite</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/server-side-tagging/">server-side-tagging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/simmer/">simmer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/single-page-apps/">single-page-apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/still-running/">still-running</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/webkit/">webkit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Snowplow: Full Setup With Google Analytics Tracking</h1>
        <small>Step-by-step process for setting up a Snowplow analytics pipeline with data pulled in from your Google Analytics trackers.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/snowplow">#snowplow</a>
    
        , <a href="https://www.simoahava.com/amp/tags/amazon">#amazon</a>
    
        , <a href="https://www.simoahava.com/amp/tags/aws">#aws</a>
    


<time class="post-date" datetime="2018-02-07T09:00:37&#43;02:00">
    7 February 2018
</time>


<span class="post-date"><a href="https://www.simoahava.com/analytics/snowplow-full-setup-with-google-analytics-tracking/">Non-AMP version</a></span>


        </section>
    </header>

    <section class="post-content">
      
        
        
          <p>A <a href="https://www.simoahava.com/amp/analytics/automatically-fork-google-analytics-hits-snowplow/">recent guide</a> of mine introduced the <a href="https://snowplowanalytics.com/blog/2018/01/25/snowplow-r99-carnac-with-google-analytics-support/">Google Analytics adapter</a> in <a href="https://snowplowanalytics.com/">Snowplow</a>. The idea was that you can duplicate the <a href="https://analytics.google.com/">Google Analytics</a> requests sent via <a href="https://tagmanager.google.com/">Google Tag Manager</a> and dispatch them to your Snowplow analytics pipeline, too. The pipeline then takes care of these duplicated requests, using the new adapter to automatically align the hits with their corresponding data tables, ready for data modeling and analysis.</p>
<p>While testing the new adapter, I implemented a Snowplow pipeline from scratch for parsing data from my own website. This was the first time I&rsquo;d done the whole process from end-to-end myself, so I thought it might be prudent to document the process for the benefit of others who might want to take a jab at Snowplow but are intimidated by the moving parts.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/snowplow-etl-emr.jpg" title="Snowplow ETL in process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/snowplow-etl-emr.jpg" layout="responsive" alt="Snowplow ETL in process" height="467" width="1919"></amp-img>
  
    </a>
  

<p>And make no mistake. There are <strong>plenty</strong> of moving parts. Snowplow leverages a number of <a href="https://aws.amazon.com/">Amazon Web Services</a> components, in addition to a whole host of utilities of its own. It&rsquo;s not like setting up Google Analytics, which is, at its most basic, a fairly rudimentary plug-and-play affair.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/ga-schema.jpg" title="Image source: https://goo.gl/D2f3xi">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/ga-schema.jpg" layout="responsive" alt="Image source: https://goo.gl/D2f3xi" height="317" width="690"></amp-img>
  
    </a>
  

<p>Take this article with a grain of salt. It definitely does <strong>not</strong> describe the most efficient or cost-effective way to do things, but it should help you get started with Snowplow, ending up with a data store full of usable data for modeling and analysis. As such, it&rsquo;s not necessarily a <strong>guide</strong> rather than a description of the steps I took, in good and bad.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/sql-workbench-query.jpg" title="SQL Workbench query against page view hits">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/sql-workbench-query.jpg" layout="responsive" alt="SQL Workbench query against page view hits" height="297" width="1433"></amp-img>
  
    </a>
  

<p><strong>WARNING:</strong> If you DO follow this guide step-by-step (which makes me very happy), please do note that there will be costs involved. For example, my current, very light-weight setup, is costing me a couple of dollars a day to maintain, with most costs incurred by running the collector on a virtual machine in Amazon&rsquo;s cloud. Just keep this in mind when working with AWS. It&rsquo;s unlikely to be totally free, even if you have the free tier for your account.</p>
<!-- raw HTML omitted -->

        
        <article class="post type-simmer">
    <header class="post-header">
        <h2 class="post-title"><a href="https://www.simoahava.com/amp/newsletter/">The Simmer Newsletter</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
	Follow <a href="https://www.teamsimmer.com/newsletter/">this link</a> to subscribe to the <strong>Simmer Newsletter</strong>! Stay up-to-date with the latest content from Simo Ahava and the <a href="https://www.teamsimmer.com/">Simmer online course platform</a>.
      </p>
      </section>
</article>

        
          <h2 id="to-start-with">To start with</h2>
<p>I ended up needing the following things to make the pipeline work:</p>
<ul>
<li>
<p>The Linux/Unix command line (handily accessible via the Terminal application of Mac OS X).</p>
</li>
<li>
<p><a href="https://git-scm.com/">Git</a> client - not strictly necessary but it makes life easier to clone the Snowplow repo and work with it locally.</p>
</li>
<li>
<p>A new <a href="https://aws.amazon.com/">Amazon Web Services</a> account with the introductory free tier (first 12 months).</p>
</li>
<li>
<p>A credit card - even with the free tier the pipeline is not free.</p>
</li>
<li>
<p>A <strong>domain name</strong> of my own (I used gtmtools.com) whose DNS records I can modify.</p>
</li>
<li>
<p>A Google Analytics tag running through Google Tag Manager.</p>
</li>
<li>
<p>A lot of time.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/command-line.jpg" title="The OS X command line">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/command-line.jpg" layout="responsive" alt="The OS X command line" height="470" width="1453"></amp-img>
  
    </a>
  

<p>The bullets concerning money and custom domain name might be a turn-off to some.</p>
<p>You might be able to set up the pipeline without a domain name by using some combination of Amazon CloudFront and Route 53 with Amazon&rsquo;s own SSL certificates, but I didn&rsquo;t explore this option.</p>
<p>And yes, this whole thing is going to cost money. As I wrote in the beginning, I didn&rsquo;t follow the most cost-effective path. But even if I did, it would still cost a dollar or something per day to keep this up and running. If this is enough of a red flag for you, then take a look at what <a href="https://snowplowanalytics.com/products/snowplow-insights/">managed solutions</a> Snowplow is offering. This article is for the engineers out there who want to try building the whole thing from scratch.</p>

        
          <h2 id="why-snowplow">Why Snowplow?</h2>
<p>Why do this exercise at all? Why even look towards Snowplow? The transition from the pre-built, top-down world of Google Analytics to the anarchy represented by Snowplow&rsquo;s agnostic approach to data processing can be daunting.</p>
<p>Let me be frank: Snowplow is not for everyone. Even though the company itself offers managed solutions, making it as turnkey as it can get, it&rsquo;s still <strong>you</strong> building an <strong>analytics pipeline</strong> to suit <strong>your</strong> organization&rsquo;s needs. This involves asking very difficult questions, such as:</p>
<ul>
<li>
<p>What is an &ldquo;event&rdquo;?</p>
</li>
<li>
<p>What constitutes a &ldquo;session&rdquo;?</p>
</li>
<li>
<p>Who owns the data?</p>
</li>
<li>
<p>What&rsquo;s the ROI of data analytics?</p>
</li>
<li>
<p>How should conversions be attributed?</p>
</li>
<li>
<p>How should I measure users across domains and devices?</p>
</li>
</ul>
<p>If you&rsquo;ve never asked one of these (or similar) questions before, you might not want to look at Snowplow or any other custom-built setup yet. These are questions that inevitably surface at some point when using tools that give you very few configuration options.</p>
<p>At this point I think I should add a disclaimer. This article is not <strong>Google Analytics versus Snowplow</strong>. There&rsquo;s no reason to bring one down to highlight the benefits of the other. Both GA and Snowplow have their place in the world of analytics, and having one is not predicated on the absence of the other.</p>
<p>The whole idea behind the Google Analytics plugin, for example, is that you can duplicate tracking to both GA and to Snowplow. You might want to reserve GA tracking for marketing and advertising attribution, as Google&rsquo;s backend integrations are still unmatched by other platforms. You can then run Snowplow to collect this same data so that you&rsquo;ll have access to an unsampled, raw, relational database you can use to enrich and join with your other data sets.</p>
<p><strong>Snowplow is NOT a Google Analytics killer</strong>. They&rsquo;re more like cousins fighting together for the honor of the same family line, but occasionally quarreling over the inheritance of a common, recently deceased relative.</p>

        
          <h2 id="what-we-are-going-to-build">What we are going to build</h2>
<p>Here&rsquo;s a diagram of what we&rsquo;re hopefully going to build in this article:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/snowplow-process.jpg" title="Snowplow pipeline">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/snowplow-process.jpg" layout="responsive" alt="Snowplow pipeline" height="1029" width="1392"></amp-img>
  
    </a>
  

<p>I wonder why no one&rsquo;s hired me as a designer yet&hellip;</p>
<p>The process will cover the following steps.</p>
<ol>
<li>
<p>The website will duplicate the payloads sent to Google Analytics, and send them to a collector written with <a href="https://clojure.org/">Clojure</a>.</p>
</li>
<li>
<p>The collector runs as a web service on AWS <a href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/Welcome.html">Elastic Beanstalk</a>, to which traffic is routed and secured with SSL from my custom domain name using AWS <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/Welcome.html">Route 53</a>.</p>
</li>
<li>
<p>The log data from the collector is stored in AWS <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/Welcome.html">S3</a>.</p>
</li>
<li>
<p>A utility is periodically executed on my local machine, which runs an ETL (<strong>e</strong>xtract, <strong>t</strong>ransform, <strong>l</strong>oad) process using AWS <a href="https://docs.aws.amazon.com/emr/latest/APIReference/Welcome.html">EMR</a> to enrich and &ldquo;shred&rdquo; the data in S3.</p>
</li>
<li>
<p>The same utility finally stores the processed data files into relational tables in AWS <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/welcome.html">Redshift</a>.</p>
</li>
</ol>
<p>So the process ends with a relational database that has all your collected data populated periodically.</p>

        
          <h2 id="step-0-register-on-aws-and-setup-iam-roles">Step 0: Register on AWS and setup IAM roles</h2>
<h3 id="what-you-need-for-this-step">What you need for this step</h3>
<ol>
<li>You&rsquo;ll just need a credit card to <a href="https://portal.aws.amazon.com/billing/signup#/start">register on AWS</a>. You&rsquo;ll get the benefits of a <a href="https://aws.amazon.com/free/">free tier</a>, but you&rsquo;ll still need to enable billing.</li>
</ol>
<h3 id="register-on-amr">Register on AMR</h3>
<p>The very first thing to do is register on Amazon Web Services and setup an IAM (Identity and Access Management) User that will run the whole setup.</p>
<p>So browse to <a href="https://aws.amazon.com/,">https://aws.amazon.com/,</a> and select the option to create a free account.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/create-free-account-aws.jpg" title="Create free AWS account">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/create-free-account-aws.jpg" layout="responsive" alt="Create free AWS account" height="388" width="1466"></amp-img>
  
    </a>
  

<p>The free account gives you access to the <a href="https://aws.amazon.com/free/">free tier</a> of services, some of which will help keep costs down for this pipeline, too.</p>
<h3 id="create-an-identity-and-account-management-iam-user">Create an Identity and Account Management (IAM) user</h3>
<p>Once you&rsquo;ve created the account, you can do the first important thing in setting up the pipeline: create an IAM User. We&rsquo;ll be following Snowplow&rsquo;s own excellent <a href="https://github.com/snowplow/snowplow/wiki/Setup-IAM-permissions-for-users-installing-Snowplow">IAM setup guide</a> for these steps.</p>
<p>In the <strong>Services</strong> menu, select IAM from the long list of items.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/services-menu.jpg" title="Services / IAM">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/services-menu.jpg" layout="responsive" alt="Services / IAM" height="337" width="1232"></amp-img>
  
    </a>
  

<ul>
<li>
<p>In the left-hand menu, select <strong>Groups</strong>.</p>
</li>
<li>
<p>Click the <strong>Create New Group</strong> in the view that opens.</p>
</li>
<li>
<p>Name the group <code>snowplow-setup</code>.</p>
</li>
<li>
<p>Skip the Attach Policy step for now by clicking the <strong>Next Step</strong> button.</p>
</li>
<li>
<p>Click <strong>Create Group</strong>.</p>
</li>
</ul>
<p>Now in the left-hand menu, select <strong>Policies</strong>.</p>
<ul>
<li>
<p>Click <strong>Create Policy</strong>.</p>
</li>
<li>
<p>Select the <strong>JSON</strong> tab, and replace the contents with the following:</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;Version&#34;</span><span class="p">:</span> <span class="s2">&#34;2012-10-17&#34;</span><span class="p">,</span>
  <span class="nt">&#34;Statement&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;Effect&#34;</span><span class="p">:</span> <span class="s2">&#34;Allow&#34;</span><span class="p">,</span>
      <span class="nt">&#34;Action&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;acm:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;autoscaling:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;aws-marketplace:ViewSubscriptions&#34;</span><span class="p">,</span>
        <span class="s2">&#34;aws-marketplace:Subscribe&#34;</span><span class="p">,</span>
        <span class="s2">&#34;aws-marketplace:Unsubscribe&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cloudformation:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cloudfront:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;cloudwatch:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;ec2:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;elasticbeanstalk:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;elasticloadbalancing:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;elasticmapreduce:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;es:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;iam:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;rds:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;redshift:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;s3:*&#34;</span><span class="p">,</span>
        <span class="s2">&#34;sns:*&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;Resource&#34;</span><span class="p">:</span> <span class="s2">&#34;*&#34;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></div>
<ul>
<li>
<p>Next, click <strong>Review Policy</strong>.</p>
</li>
<li>
<p>Name the policy <code>snowplow-setup-policy-infrastructure</code>.</p>
</li>
<li>
<p>Finally, click <strong>Create Policy</strong>.</p>
</li>
</ul>
<p>Now go back to <strong>Groups</strong> from the left-hand menu, and click the <strong>snowplow-setup</strong> group name to open its settings.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/iam-group.jpg" title="IAM Group list">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/iam-group.jpg" layout="responsive" alt="IAM Group list" height="325" width="911"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Switch to the <strong>Permissions</strong> tab and click <strong>Attach Policy</strong>.</p>
</li>
<li>
<p>From the list that opens, select <strong>snowplow-setup-policy-infrastructure</strong> and click <strong>Attach Policy</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/attach-policy.jpg" title="Attach custom policy">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/attach-policy.jpg" layout="responsive" alt="Attach custom policy" height="395" width="855"></amp-img>
  
    </a>
  

<p>Now select <strong>Users</strong> from the left-hand menu, and click the <strong>Add user</strong> button.</p>
<ul>
<li>
<p>Name the user <code>snowplow-setup</code>.</p>
</li>
<li>
<p>Check the box next to <strong>Programmatic access</strong>.</p>
</li>
<li>
<p>Click <strong>Next: Permissions</strong>.</p>
</li>
<li>
<p>With <strong>Add user to group</strong> selected, check the box next to <strong>snowplow-setup</strong>, and click the <strong>Next: Review</strong> button at the bottom of the page.</p>
</li>
<li>
<p>Finally, click <strong>Create user</strong>.</p>
</li>
</ul>
<p>The following screen will show you a success message, and your user with an <strong>Access Key ID</strong> and <strong>Secret Access Key</strong> (click Show to see it) available. At this point, <strong>copy both of these somewhere safe</strong>. You will need them soon, and once you leave this screen you will not be able to see the secret key anymore. You can also download them as a CSV file by clicking the <strong>Download .csv</strong> button.</p>
<p>You have now created a user with which you will set up your entire pipeline. Once everything is set up, you will create a new user with fewer permissions, who will take care of running and managing the pipeline.</p>
<p>Congratulations, step 0 complete!</p>
<h3 id="what-you-should-have-after-this-step">What you should have after this step</h3>
<ol>
<li>
<p>You should have successfully registered a new account on AWS.</p>
</li>
<li>
<p>You should have a new IAM user named <code>snowplow-setup</code> with all the access privileges distributed by the custom policy you created.</p>
</li>
</ol>

        
          <h2 id="step-1-the-clojure-collector">Step 1: The Clojure collector</h2>
<h3 id="what-you-need-for-this-step-1">What you need for this step</h3>
<ol>
<li>A custom domain name and access to its DNS configuration</li>
</ol>
<h3 id="getting-started">Getting started</h3>
<p>This is going to be one of the more difficult steps to do, since there&rsquo;s no generic guide for some of the things that need to be done with the collector endpoint. If you want, you can look into the <a href="https://github.com/snowplow/snowplow/wiki/Setting-up-the-Cloudfront-collector">CloudFront Collector</a> instead, because that runs directly on top of S3 without needing a web service to collect the hits. However, it doesn&rsquo;t support the Google Analytics hit duplicator, which is why in this article we&rsquo;ll use the <a href="https://github.com/snowplow/snowplow/wiki/Setting-up-the-Clojure-collector">Clojure collector</a>.</p>
<p>The Clojure collector is basically a web endpoint to which you will log the requests from your site. The endpoint is a scalable web service running on Apache Tomcat, which is hosted on AWS&rsquo; Elastic Beanstalk. The collector has been configured to automatically log the Tomcat access logs directly into AWS S3 storage, meaning whenever your site sends a request to the collector, it logs this request as an access log entry, ready for the ETL process that comes soon after.</p>
<p>But let&rsquo;s not get ahead of ourselves.</p>
<h3 id="setting-up-the-clojure-collector">Setting up the Clojure collector</h3>
<p>The first thing you&rsquo;ll need to do is download the Clojure collector WAR file and store it locally in a temporary location (such as your Downloads folder).</p>
<p>You can download the binary by following <a href="https://github.com/snowplow/snowplow/wiki/Hosted-assets#21-clojure-collector-resources">this</a> link. It should lead you to a file that looks something like <code>clojure-collector-1.X.X-standalone.war</code>.</p>
<p>Once you&rsquo;ve downloaded it, you can set up the <strong>Elastic Beanstalk</strong> application.</p>
<p>In AWS, open the <strong>Services</strong> menu again, and select <strong>Elastic Beanstalk</strong>.</p>
<p>At this point, you&rsquo;ll also want to make sure that any AWS services you use in this pipeline are located in the same region. There are differences to what services are supported in each region. I built the pipeline in <strong>EU (Ireland)</strong>, and the Snowplow guide itself uses <strong>US West (Oregon)</strong>. Click the region menu and choose the region you want to use.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/region-selection.jpg" title="Select AWS region">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/region-selection.jpg" layout="responsive" alt="Select AWS region" height="405" width="879"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Next, click the <strong>Create New Application</strong> link in the top-right corner of the page (just below the region selector).</p>
</li>
<li>
<p>Give the application a descriptive name (e.g. <code>Snowplow Clojure Collector</code>) and description (e.g. <code>I love Kamaka HF-3</code>), and then click <strong>Next</strong>.</p>
</li>
<li>
<p>In the New Environment view, select <strong>Create web server</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/beanstalk-new-web-server.jpg" title="New Elastic Beanstalk web server">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/beanstalk-new-web-server.jpg" layout="responsive" alt="New Elastic Beanstalk web server" height="481" width="1270"></amp-img>
  
    </a>
  

<ul>
<li>In the Environment Type view, set the following:</li>
</ul>
<blockquote>
<p><strong>Predefined configuration</strong>: Tomcat<br>
<strong>Environment type</strong>: Single instance</p>
</blockquote>
<ul>
<li>
<p>Then, click <strong>Next</strong>.</p>
</li>
<li>
<p>In the Application Version view, select <strong>Upload your own</strong>, click <strong>Choose file</strong>, and find the WAR file you downloaded earlier in this chapter. Click <strong>Next</strong> to upload the file.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/upload-war-file.jpg" title="Upload WAR file">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/upload-war-file.jpg" layout="responsive" alt="Upload WAR file" height="315" width="838"></amp-img>
  
    </a>
  

<ul>
<li>
<p>In the Environment Info view, you&rsquo;ll need to set the <strong>Environment name</strong>, which is then used to generate the <strong>Environment URL</strong> (which, in turn, will be the endpoint URL receiving the collector requests).</p>
</li>
<li>
<p>Remember to click <strong>Check availability</strong> for the URL to make sure someone hasn&rsquo;t grabbed it yet. Click <strong>Next</strong> once you&rsquo;re done.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/environment-name-and-url.jpg" title="Environment name and URL">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/environment-name-and-url.jpg" layout="responsive" alt="Environment name and URL" height="329" width="804"></amp-img>
  
    </a>
  

<ul>
<li>
<p>In Additional Resources, you can leave both options unchecked for now, and click <strong>Next</strong>.</p>
</li>
<li>
<p>In Configuration Details, select <strong>m1.small</strong> as the instance type. You can leave all the other options to their default settings. Click <strong>Next</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/configuration-details.jpg" title="Configuration details">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/configuration-details.jpg" layout="responsive" alt="Configuration details" height="381" width="977"></amp-img>
  
    </a>
  

<ul>
<li>
<p>No need to add any Environment Tags, so click <strong>Next</strong> again.</p>
</li>
<li>
<p>In the Permissions view, by clicking <strong>Next</strong>, AWS assigns default roles to Instance profile and Service role, so that&rsquo;s fine.</p>
</li>
<li>
<p>Finally, you can take a quick look at what you&rsquo;ve done in the Review view, before clicking the <strong>Launch</strong> button.</p>
</li>
</ul>
<p>At this point, you&rsquo;ll see that AWS is firing up your environment, where the Clojure collector WAR file will start running the instant the environment has been created.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/clojure-collector-starting-up.jpg" title="Clojure collector starting up">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/clojure-collector-starting-up.jpg" layout="responsive" alt="Clojure collector starting up" height="614" width="1709"></amp-img>
  
    </a>
  

<p>Once the environment is up and running, you can copy the URL from the top of the view, paste it into the address bar of your browser, and add the path <code>/i</code> to its end, so it ends up something like:</p>
<p><code>http://simoahava-snowplow-collector.eu-west-1.elasticbeanstalk.com/i</code></p>
<p>If the collector is running correctly, you should see a pixel in the center of the screen. By clicking the right mouse button and choosing Inspect (in the Google Chrome browser), you should now find a cookie named <code>sp</code> in the Applications tab. If you do, it means the collector is working correctly.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/clojure-test.jpg" title="Testing the clojure collector">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/clojure-test.jpg" layout="responsive" alt="Testing the clojure collector" height="891" width="1335"></amp-img>
  
    </a>
  

<p>Congratulations! You&rsquo;ve set up the collector.</p>
<p>However, we&rsquo;re not done here yet.</p>
<h3 id="enable-logging-to-s3">Enable logging to S3</h3>
<p>Automatically logging the Tomcat access logs to S3 storage is absolutely crucial for this whole pipeline. The batch process looks for these logs when sorting out the data into queriable chunks. Access logs are your typical web server logs, detailing all the HTTP requests made to the endpoint, with request headers and payloads included.</p>
<p>To enable logging, you&rsquo;ll need to edit the Elastic Beanstalk application you just created. So, once the endpoint is up and running, you can open it by clicking the application name while in the <strong>Elastic Beanstalk</strong> service front page.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/clojure-collector-application.jpg" title="Clojure collector application">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/clojure-collector-application.jpg" layout="responsive" alt="Clojure collector application" height="658" width="1158"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Next, select <strong>Configuration</strong> from the left-hand menu.</p>
</li>
<li>
<p>Click the cogwheel in the box titled <strong>Software Configuration</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/software-configuration.jpg" title="Software configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/software-configuration.jpg" layout="responsive" alt="Software configuration" height="451" width="838"></amp-img>
  
    </a>
  

<ul>
<li>Under <strong>Log Options</strong>, check the box next to <strong>Enable log file rotation to Amazon S3. If checked, service logs are published to S3</strong>.</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/enable-log-rotation.jpg" title="Enable log rotation">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/enable-log-rotation.jpg" layout="responsive" alt="Enable log rotation" height="235" width="921"></amp-img>
  
    </a>
  

<p>This is a crucial step, because it will store all the access logs from your endpoint requests to S3, ready for ETL.</p>
<p>Click <strong>Apply</strong> to apply the change.</p>
<h3 id="set-up-the-load-balancer">Set up the load balancer</h3>
<p>Next, we need to configure the Elastic Beanstalk environment for SSL.</p>
<p>Before you do anything else, youâ€™ll need to switch from a single instance to a load-balancing, auto-scaling environment in Elastic Beanstalk. This is necessary for securing the traffic between your domain name and the Clojure collector.</p>
<p>In the AWS <strong>Services</strong> menu, select <strong>Elastic Beanstalk</strong>, and then click your application name in the view that opens.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/clojure-collector-application.jpg" title="Clojure collector application">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/clojure-collector-application.jpg" layout="responsive" alt="Clojure collector application" height="658" width="1158"></amp-img>
  
    </a>
  

<ul>
<li>
<p>In the next view, select <strong>Configuration</strong> in the left-hand menu.</p>
</li>
<li>
<p>Click the cogwheel in the box titled <strong>Scaling</strong>.</p>
</li>
<li>
<p>From the <strong>Environment type</strong> menu, select <strong>Load balancing, auto scaling</strong>, and then click the <strong>Apply</strong> button, and <strong>Save</strong> in the next view.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/change-environment-type.jpg" title="Change environment type">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/change-environment-type.jpg" layout="responsive" alt="Change environment type" height="380" width="1404"></amp-img>
  
    </a>
  

<p>You now have set up the load balancer.</p>
<h3 id="route-traffic-from-your-custom-domain-name-to-the-load-balancer">Route traffic from your custom domain name to the load balancer</h3>
<p>Next, we&rsquo;ll get started on routing traffic from your custom domain name to this load balancer.</p>
<ul>
<li>
<p>Open the <strong>Services</strong> menu in the AWS console, and select <strong>Route 53</strong> from the list.</p>
</li>
<li>
<p>In the view that opens, click <strong>Create Hosted Zone</strong>.</p>
</li>
<li>
<p>Set the <strong>Domain Name</strong> to the domain whose DNS records you want to delegate to Amazon. I chose <strong>collector.gtmtools.com</strong>. Leave <strong>Type</strong> as <strong>Public Hosted Zone</strong>, and click <strong>Create</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/route-53-hosted-zone.jpg" title="Configure hosted zone in Route 53">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/route-53-hosted-zone.jpg" layout="responsive" alt="Configure hosted zone in Route 53" height="412" width="1050"></amp-img>
  
    </a>
  

<ul>
<li>In the view that opens, you&rsquo;ll see the settings for your Hosted Zone. Make note of the four NS records AWS has assigned to your domain name. You&rsquo;ll need these in the next step.</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/hosted-zone-name-servers.jpg" title="Hosted Zone name servers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/hosted-zone-name-servers.jpg" layout="responsive" alt="Hosted Zone name servers" height="297" width="1271"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Next, you&rsquo;ll need to go wherever it is you manage your DNS records. I use <a href="https://www.godaddy.com/">GoDaddy</a>.</p>
</li>
<li>
<p>You need to add the four NS addresses in the AWS Hosted Zone as <strong>NS</strong> records in the DNS settings of your domain name. This is what the modifications would look like in my GoDaddy control panel:</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/godaddy-ns-records.jpg" title="GoDaddy NS records">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/godaddy-ns-records.jpg" layout="responsive" alt="GoDaddy NS records" height="344" width="1170"></amp-img>
  
    </a>
  

<p>As you can see, there are four <strong>NS</strong> records with host <strong>collector</strong> (for collector.gtmtools.com), each pointing to one of the four corresponding NS addresses in the AWS Hosted Zone. I set the TTL to the shortest possible GoDaddy allows, which is 600 seconds. That means that within 10 minutes, the Hosted Zone name servers should respond to <strong>collector.gtmtools.com</strong>.</p>
<p>You can test this with a service such as <a href="https://dig.whois.com.au/dig/,">https://dig.whois.com.au/dig/,</a> or any similar service that lets you check DNS records. Once the DNS settings are updated, you can increase the TTL to something more sensible, such as 1 hour, or even 1 day.</p>
<p>Now that you&rsquo;ve set up your custom domain name to point to your Route 53 Hosted Zone, there&rsquo;s just one step missing. You&rsquo;ll need to create an <strong>Alias</strong> record in the Hosted Zone, which points to your load balancer. That way when typing the URL <strong>collector.gtmtools.com</strong> into the browser address bar, the DNS record first directs it to your Hosted Zone, where a new A record shuffles the traffic to your load balanced Clojure collector endpoint. Phew!</p>
<ul>
<li>
<p>So, in the Hosted Zone you&rsquo;ve created, click <strong>Create Record Set</strong>.</p>
</li>
<li>
<p>In the overlay that opens, leave the <strong>Name</strong> empty, since you want to apply the name to the root domain of the NS (collector.gtmtools.com in my case). Keep <strong>A - IPv4 address</strong> as the Type, and select <strong>Yes</strong> for <strong>Alias</strong>.</p>
</li>
<li>
<p>When you click the <strong>Target</strong> field, a drop-down list should appear, and your load balancer should be selectable under the <strong>ELB Classic load balancers</strong> heading. Select that, and then click <strong>Create</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/a-record-set.jpg" title="A Record Set">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/a-record-set.jpg" layout="responsive" alt="A Record Set" height="547" width="418"></amp-img>
  
    </a>
  

<p>Now if you visit <code>http://collector.gtmtools.com/i</code>, you should see the same pixel response as you got when visiting the Clojure collector endpoint directly. So your domain name routing works!</p>
<p>But we&rsquo;re STILL not done here.</p>
<h3 id="setting-up-https-for-the-collector">Setting up HTTPS for the collector</h3>
<p>To make sure the collector is secured with HTTPS, you will need to generate a (free) AWS SSL certificate for it, and apply it to the Load Balancer. Luckily this is easy to do now that we&rsquo;re working with Route 53.</p>
<ul>
<li>
<p>The first thing to do is generate the SSL certificate. In <strong>Services</strong>, find and select the <strong>AWS Certificate Manager</strong>. Click <strong>Get started</strong> to, well, get started.</p>
</li>
<li>
<p>Type the domain name you want to apply the certificate to in the relevant field. I wrote <strong>collector.gtmtools.com</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong> when ready.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/apply-certificate.jpg" title="Apply AWS certificate">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/apply-certificate.jpg" layout="responsive" alt="Apply AWS certificate" height="609" width="1351"></amp-img>
  
    </a>
  

<ul>
<li>
<p>In the next step you need to choose a validation method. Since we&rsquo;ve delegated DNS of collector.gtmtools.com to Route 53, I chose <strong>DNS Validation</strong> without hesitation.</p>
</li>
<li>
<p>Then click <strong>Review</strong>, and then <strong>Confirm and request</strong>.</p>
</li>
<li>
<p>Validation is done in the next view. With Route 53, this is really easy. Just click <strong>Create record in Route 53</strong>, and <strong>Create</strong> in the overlay that opens. Amazon takes care of validation for you!</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/validate-certificate.jpg" title="Validate SSL certificate">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/validate-certificate.jpg" layout="responsive" alt="Validate SSL certificate" height="552" width="1781"></amp-img>
  
    </a>
  

<p>After clicking Create, you should see a <strong>Success</strong> message, and you can click the <strong>Continue</strong> button in the bottom of the screen. It might take up to 30 minutes for the certificate to validate, so go grab a cup of coffee or something! We still have one more step left&hellip;</p>
<h3 id="switch-the-load-balancer-to-support-https">Switch the load balancer to support HTTPS</h3>
<p>You&rsquo;ll still need to switch your load balancer to listen for secure requests, too.</p>
<ul>
<li>
<p>In <strong>Services</strong>, open <strong>Elastic Beanstalk</strong>, click your application name in the view that opens, and finally click <strong>Configuration</strong> in the left-hand menu. You should be able to do this stuff in your sleep by now!</p>
</li>
<li>
<p>Next, scroll down to the box titled <strong>Load Balancing</strong> and click the cogwheel in it.</p>
</li>
<li>
<p>In the view that opens, set <strong>Secure listener port</strong> to <strong>443</strong>, and select the SSL certificate you just generated from the menu next to <strong>SSL Certificate ID</strong>. Click <strong>Apply</strong> when ready.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/load-balancer-settings.jpg" title="HTTPS for load balancer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/load-balancer-settings.jpg" layout="responsive" alt="HTTPS for load balancer" height="455" width="1035"></amp-img>
  
    </a>
  

<h3 id="all-done">All done!</h3>
<p>At this point, you might also want to take a look at <a href="https://github.com/snowplow/snowplow/wiki/Configuring-the-Clojure-collector">this Snowplow guide</a> for configuring the collector further (e.g. applying proper scaling settings to the load balancer).</p>
<p>The process above might seem convoluted, but there&rsquo;s a certain practical logic to it all. And once you have the whole pipeline up and running, it will be easier to understand how things proceed from the S3 storage onwards.</p>
<p>Setting up the custom domain name is a bit of chore, though. But if you use Route 53, most of the things are either automated for you or taken care of with the click of a button.</p>
<h3 id="what-you-should-have-after-this-step-1">What you should have after this step</h3>
<ol>
<li>
<p>The Clojure collector application running in an Elastic Beanstalk environment.</p>
</li>
<li>
<p>Your own custom domain name pointing at the router configured in Amazon Route 53.</p>
</li>
<li>
<p>An SSL secured load balancer, to which Route 53 diverts traffic to your custom domain name.</p>
</li>
<li>
<p>Automatic logging of the collector Tomcat logs to S3. The bucket name is something like <strong>elasticbeanstalk-region-id</strong>, and you can find it by clicking <strong>Services</strong> in the AWS navigation and choosing <strong>S3</strong>. The logs are pushed hourly.</p>
</li>
</ol>

        
          <h2 id="step-2-the-tracker">Step 2: The tracker</h2>
<p>You&rsquo;ll need to configure a tracker to collect data to the S3 storage.</p>
<p>This is really easy, since you&rsquo;re of course using Google Analytics, and tracking data to it using Google Tag Manager tags.</p>
<p>Navigate to my <a href="https://www.simoahava.com/amp/analytics/automatically-fork-google-analytics-hits-snowplow/">recent guide</a> on setting up the duplicator, do what it says, and you&rsquo;ll be set. Remember to change the <code>endpoint</code> variable in the Custom JavaScript variable to the domain name you set up in the previous chapter (<code>https://collector.gtmtools.com/</code> in my case).</p>

        
          <h2 id="step-25-test-the-tracker-and-collector">Step 2.5: Test the tracker and collector</h2>
<p>Once you&rsquo;ve installed the GA duplicator, you can test to see if the logs are being stored in S3 properly.</p>
<p>If the duplicator is doing its job correctly, you can open the <strong>Network</strong> tab in your browser&rsquo;s developer tools, and look for requests to your collector endpoint. You should see POST requests for each GA call, with the payload of the request in the POST body:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/network-developer-tools.jpg" title="Network tab in developer tools">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/network-developer-tools.jpg" layout="responsive" alt="Network tab in developer tools" height="383" width="1476"></amp-img>
  
    </a>
  

<p>If you don&rsquo;t see these requests, it means you&rsquo;ve misconfigured the duplicator somehow, and you should re-read the <a href="https://www.simoahava.com/amp/analytics/automatically-fork-google-analytics-hits-snowplow/">instructions</a>.</p>
<p>If you see the requests but there&rsquo;s an error in the HTTP response, you&rsquo;ll need to check the process outlined in the previous two chapters again.</p>
<p>At something like 10 minutes past each hour, the Clojure collector running in Elastic Beanstalk will dump all the Tomcat access logs to S3. You should check that they are being stored, because the whole batch process hinges on the presence of these logs.</p>
<p>In S3, there will be a bucket prefixed with <strong>elasticbeanstalk-region-id</strong>. Within that bucket, browse to folder <strong>resources / environments / logs / publish / (some ID) / (some ID)</strong>. In other words, within the <strong>publish</strong> folder will be a folder named something like <strong>e-ab12cd23ef</strong>, and within that will be a folder named something like <strong>i-1234567890</strong>. Within that final folder will be all your logs in gzip format.</p>
<p>Look for the ones named <strong>_var_log_tomcat8_rotated_localhost_access_log.txt123456789.gz</strong>, as these are the logs that the ETL process will use to build the data tables.</p>
<p>If you open one of those logs, you should find a bunch of GET and POST entries. Look for POST entries where the endpoint is <code>/com.google.analytics/v1</code>, and the HTTP status code is <code>200</code>. If you see these, it means that the Clojure collector is almost certainly doing its job. The entry will contain a bunch of interesting information, such as the IP address of the visitor, the User-Agent string of the browser, and a <em>base64</em> encoded string with the payload. If you decode this string, you should see the full payload of your Google Analytics hit as a query string.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/post-request-from-logs.jpg" title="POST request from Tomcat access logs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/post-request-from-logs.jpg" layout="responsive" alt="POST request from Tomcat access logs" height="205" width="827"></amp-img>
  
    </a>
  


        
          <h2 id="step-3-configure-the-etl-process">Step 3: Configure the ETL process</h2>
<h3 id="what-you-need-for-this-step-2">What you need for this step</h3>
<ol>
<li>
<p>A collector running and dumping the logs in an S3 bucket.</p>
</li>
<li>
<p>Access Key ID and Secret Access Key for the IAM user you created in <a href="#step-0-register-on-aws-and-setup-iam-roles">Step 0</a>.</p>
</li>
</ol>
<h3 id="getting-started-1">Getting started</h3>
<p>This step <strong>should</strong> be pretty straightforward, at least more so than the previous one.</p>
<p>The process does a number of things, and you&rsquo;ll want to check out <a href="https://github.com/snowplow/snowplow/wiki/Batch-pipeline-steps">this page</a> for more info.</p>
<p>But, in short, here are the main steps operated by the AWS Elastic MapReduce (EMR) service.</p>
<ol>
<li>
<p>The Tomcat logs are cleaned up so that they can be parsed more easily. Irrelevant log entries are discarded.</p>
</li>
<li>
<p>Custom enrichments are applied to the data, if you so wish. Enrichments include things like geolocation from IP addresses, or adding <a href="https://www.simoahava.com/amp/analytics/send-weather-data-to-google-analytics-in-gtm-v2/">weather</a> information to the data set.</p>
</li>
<li>
<p>The enriched data is then <em>shredded</em>, or split into more atomic data sets, each corresponding with a hit that validates against a given schema. For example, if you are collecting data with the Google Analytics setup outlined in my <a href="https://www.simoahava.com/amp/analytics/automatically-fork-google-analytics-hits-snowplow/">guide</a>, these hits would be automatically shredded into data sets for Page Views, Events, and other Google Analytics tables, ready for transportation to a relational database.</p>
</li>
<li>
<p>Finally, the data is copied from the shredded sets to a database created in Amazon Redshift.</p>
</li>
</ol>
<p>We&rsquo;ll go over these steps in detail next. It&rsquo;s important to understand that each step of the ETL process leaves a trace in S3 buckets you&rsquo;ll build along the way. This means that even if you choose to apply the current process to your raw logs, you can rerun your entire log history, if you&rsquo;ve decided to keep the files, with new enrichments and shredding schemas later on. All the Tomcat logs are archived, too, so you&rsquo;ll always be able to start the entire process from scratch, using all your historical data, if you wish!</p>
<p>The way we&rsquo;ll work in this process is run a Java application name <strong>EmrEtlRunner</strong> from your local machine. This application initiates and runs the ETL process using Amazon&rsquo;s Elastic MapReduce. At some point, you might want to upgrade your setup, and have <strong>EmrEtlRunner</strong> execute in an AWS EC2 instance (basically a virtual machine in Amazon&rsquo;s cloud). That way you could schedule it to run, say, every 60 minutes, and then forget about it.</p>
<h3 id="download-the-necessary-files">Download the necessary files</h3>
<p>The ETL runner is a Unix application you can download from <a href="http://dl.bintray.com/snowplow/snowplow-generic/">this</a> link. To grab the latest version, look for the file that begins with <code>snowplow_emr_rXX</code>, where XX is the highest number you can find. At the time of writing, the latest binary is <code>snowplow_emr_r97_knossos.zip</code>.</p>
<ul>
<li>
<p>Download this ZIP file, and copy the <code>snowplow-emr-etl-runner</code> Unix executable into a new folder on your hard drive. This folder will be your base of operations.</p>
</li>
<li>
<p>At this point, you&rsquo;ll want to also clone the <a href="https://github.com/snowplow/snowplow">Snowplow Github repo</a> in that folder, because it has all the config file templates and SQL files you&rsquo;ll need later on.</p>
</li>
<li>
<p>So browse to the directory to where you copied the <code>snowplow-emr-etl-runner</code> file, and run the following command:</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">git clone https://github.com/snowplow/snowplow.git</code></pre></div>
<p>If you don&rsquo;t have Git installed, now would be a good time to <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">do it</a>.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/git-clone.jpg" title="Git clone the Snowplow repo">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/git-clone.jpg" layout="responsive" alt="Git clone the Snowplow repo" height="217" width="1015"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Now you should have both the <code>snowplow-emr-etl-runner</code> file and the <strong>snowplow</strong> folder in the same directory.</p>
</li>
<li>
<p>Next, create a new folder named <code>config</code>, and in that, a new folder named <code>targets</code>.</p>
</li>
<li>
<p>Then, perform the following copy operations:</p>
<ol>
<li>
<p>Copy <code>snowplow/3-enrich/emr-etl-runner/config/config.yml.sample</code> to <code>config/config.yml</code>.</p>
</li>
<li>
<p>Copy <code>snowplow/3-enrich/config/iglu_resolver.json</code> to <code>config/iglu_resolver.json</code>.</p>
</li>
<li>
<p>Copy <code>snowplow/4-storage/config/targets/redshift.json</code> to <code>config/targets/redshift.json</code>.</p>
</li>
</ol>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/copy-config-files.jpg" title="Copy config files">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/copy-config-files.jpg" layout="responsive" alt="Copy config files" height="104" width="617"></amp-img>
  
    </a>
  

<p>In the end, you should end up with a folder and file structure like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">.
<span class="p">|</span>-- snowplow-emr-etl-runner
<span class="p">|</span>-- snowplow
<span class="p">|</span>   <span class="p">|</span>-- -SNOWPLOW GIT REPO HERE-
<span class="p">|</span>-- config
<span class="p">|</span>   <span class="p">|</span>-- iglu_resolver.json
<span class="p">|</span>   <span class="p">|</span>-- config.yml
<span class="p">|</span>   <span class="p">|</span>-- targets
<span class="p">|</span>       <span class="p">|</span>-- redshift.json </code></pre></div>
<h3 id="create-an-ec2-key-pair">Create an EC2 key pair</h3>
<p>At this point, you&rsquo;ll also need to create a private key pair in Amazon EC2. The ETL process will run on virtual machines in the Amazon cloud, and these machines are powered by Amazon EC2. For the runner to have full privileges to create and manage these machines, you will need to provide it with access control rights, and that&rsquo;s what the key pair is for.</p>
<ul>
<li>
<p>In AWS, select <strong>Services</strong> from the top navigation, and click on <strong>EC2</strong>. In the left-hand menu, browse down to <strong>Key Pairs</strong>, and click the link.</p>
</li>
<li>
<p>At this point, make sure you are in the Region where you&rsquo;ll be running all the proceeding jobs. For consistency&rsquo;s sake, it makes sense to stay in the same Region you&rsquo;ve been in all along. Remember, you can choose the Region from the top navigation.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/region-selection.jpg" title="Region selection">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/region-selection.jpg" layout="responsive" alt="Region selection" height="405" width="879"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Once you&rsquo;ve made sure you&rsquo;re in the correct Region, click <strong>Create Key Pair</strong>.</p>
</li>
<li>
<p>Give the key pair a name you&rsquo;ll remember. My key pair is named <code>simoahava</code>.</p>
</li>
<li>
<p>Once you&rsquo;re done, you&rsquo;ll see your new key pair in the list, and the browser automatically downloads the file <code>&lt;key pair name&gt;.pem</code> to your computer.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/create-key-pair.jpg" title="Create EC2 key pair">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/create-key-pair.jpg" layout="responsive" alt="Create EC2 key pair" height="194" width="647"></amp-img>
  
    </a>
  

<h3 id="create-the-s3-buckets">Create the S3 buckets</h3>
<p>At this time, you&rsquo;ll need to create a bunch of buckets (storage locations) in Amazon S3. These will be used by the batch process to manage all your data files through various stages of the ETL process.</p>
<p>You will need buckets for the following:</p>
<ul>
<li>
<p><code>:raw:in</code> - you already have this, actually. It&rsquo;s the <strong>elasticbeanstalk-region-id</strong> created by the Clojure collector running in Elastic Beanstalk.</p>
</li>
<li>
<p><code>:processing</code> - intermediate bucket for the log files before they are enriched.</p>
</li>
<li>
<p><code>:archive</code> - you&rsquo;ll need three different archive buckets: <code>:raw</code> (for the raw log files), <code>:enriched</code> (for the enriched files), <code>:shredded</code> (for the shredded files).</p>
</li>
<li>
<p><code>:enriched</code> - you&rsquo;ll need two buckets for enriched data: <code>:good</code> (for data sets successfully enriched), <code>:bad</code> (for those that failed enrich).</p>
</li>
<li>
<p><code>:shredded</code> - you&rsquo;ll likewise need two buckets for shredded data: <code>:good</code> (for data sets successfully shredded), <code>:bad</code> (for those that failed shredding).</p>
</li>
<li>
<p><code>:log</code> - a bucket for logs produced by the ETL process.</p>
</li>
</ul>
<p>To create these buckets, head on over to S3 by clicking <strong>Services</strong> in the AWS top navigation, and choosing <strong>S3</strong>.</p>
<p>You should already have your <code>:raw:in</code> bucket here, it&rsquo;s the one whose name starts with <strong>elasticbeanstalk-</strong>.</p>
<p>Let&rsquo;s start with creating a new bucket that will contain all the &ldquo;sub-buckets&rdquo; for ETL.</p>
<p>Click <strong>+Create bucket</strong>, and name the bucket something like <strong>simoahava-snowplow-data</strong>. The bucket name must be unique across all of S3, so you can&rsquo;t just name it <strong>snowplow</strong>. Click <strong>Next</strong> a couple of times and then finally <strong>Create bucket</strong> to create this root bucket.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/create-root-bucket.jpg" title="create root bucket in S3">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/create-root-bucket.jpg" layout="responsive" alt="create root bucket in S3" height="514" width="722"></amp-img>
  
    </a>
  

<p>Now click the new bucket name to open the bucket. You should see a screen like this:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/empty-bucket.jpg" title="Empty S3 bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/empty-bucket.jpg" layout="responsive" alt="Empty S3 bucket" height="754" width="1807"></amp-img>
  
    </a>
  

<p>Click <strong>+ Create folder</strong>, and create the following three folders into this empty bucket:</p>
<ol>
<li>
<p><strong>archive</strong></p>
</li>
<li>
<p><strong>enriched</strong></p>
</li>
<li>
<p><strong>shredded</strong></p>
</li>
</ol>


    <a href="https://www.simoahava.com/amp/images/2018/02/s3-create-folder.jpg" title="Create folder in S3">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/s3-create-folder.jpg" layout="responsive" alt="Create folder in S3" height="447" width="1033"></amp-img>
  
    </a>
  

<p>Then, in <strong>archive</strong>, create the following three folders:</p>
<ol>
<li>
<p><strong>raw</strong></p>
</li>
<li>
<p><strong>enriched</strong></p>
</li>
<li>
<p><strong>shredded</strong></p>
</li>
</ol>
<p>Next, in both <strong>enriched</strong> and <strong>shredded</strong>, create the following two folders:</p>
<ol>
<li>
<p><strong>good</strong></p>
</li>
<li>
<p><strong>bad</strong></p>
</li>
</ol>
<p>Thus, you should end up with a bucket that has the following structure:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">.
<span class="p">|</span>-- elasticbeanstalk-region-id
<span class="p">|</span>-- simoahava-snowplow-data
<span class="p">|</span>   <span class="p">|</span>-- archive
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- raw
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- enriched
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- shredded
<span class="p">|</span>   <span class="p">|</span>-- encriched
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- good
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- bad
<span class="p">|</span>   <span class="p">|</span>-- shredded
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- good
<span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>-- bad</code></pre></div>
<p>Finally, create one more bucket in the root of S3 named something like <strong>simoahava-snowplow-log</strong>. You&rsquo;ll use this for the logs produced by the batch process.</p>
<h3 id="prepare-for-configuring-the-emretlrunner">Prepare for configuring the EmrEtlRunner</h3>
<p>Now you&rsquo;ll need to configure the EmrEtlRunner. You&rsquo;ll use the <code>config.yml</code> file you copied from the Snowplow repo to the <code>config/</code> folder. For the config, you&rsquo;ll need the following things:</p>
<ol>
<li>
<p>The Access Key ID and Secret Access Key for the <code>snowplow-setup</code> user you created all the way back in <a href="#step-0-register-on-aws-and-setup-iam-roles">Step 0</a>. If you didn&rsquo;t save these, you can generate a new Access Key through AWS <strong>IAM</strong>.</p>
</li>
<li>
<p>You will need to download and install the <a href="https://aws.amazon.com/cli/">AWS Command Line Interface</a>. You can use the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-install-macos.html">official guide</a> to install it with Python/pip, but if you&rsquo;re running Mac OS X, I recommend using <a href="https://brew.sh/">Homebrew</a> instead. Once you&rsquo;ve installed Homebrew, you just need to run <code>brew install awscli</code> to install the AWS client.</p>
</li>
</ol>
<p>Once you&rsquo;ve installed <code>awscli</code>, you need to run <code>aws configure</code> in your terminal, and do what it instructs you to do. You&rsquo;ll need your <strong>Access Key ID</strong> and <strong>Secret Access Key</strong> handy, as well as the region name (e.g. <code>eu-west-1</code>) where you&rsquo;ll be running your EC2 (again, I recommend to use the same region for all parts of this pipeline process).</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ aws configure
AWS Access Key ID: &lt;enter your IAM user Access Key ID here&gt;
AWS Secret Access Key: &lt;enter you IAM user Secret Access Key here&gt;
Default region name: &lt;enter the region name, e.g. eu-west-1 here&gt;
Default output format: &lt;just press enter&gt;</code></pre></div>
<p>This is what it looked like when I ran <code>aws configure</code>.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/aws-configure.jpg" title="aws configure">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/aws-configure.jpg" layout="responsive" alt="aws configure" height="142" width="548"></amp-img>
  
    </a>
  

<p>After running <code>aws configure</code>, the next command you&rsquo;ll need to run is <code>aws emr create-default-roles</code>. This will create default roles for the EmrEtlRunner, so that it can perform the necessary tasks in EC2 for you.</p>
<p>Once you&rsquo;ve done these steps (remember to still keep your Access Key ID and Secret Access Key close by), you&rsquo;re ready to configure EmrEtlRunner!</p>
<h3 id="configure-emretlrunner">Configure EmrEtlRunner</h3>
<p><strong>EmrEtlRunner</strong> is the name of the utility you downloaded earlier, with the filename <code>snowplow-emr-etl-runner</code>.</p>
<p>EmrEtlRunner does a LOT of things. See <a href="https://github.com/snowplow/snowplow/wiki/Batch-pipeline-steps#dataflow-diagram">this diagram</a> to see an overview of the process. At this point, we&rsquo;ll do all the steps except for step 13, <strong>rdb_load</strong>. That&rsquo;s the step where the enriched and shredded data are copied into a relational database. We&rsquo;ll take care of that in the next step.</p>
<p>Anyway, EmrEtlRunner is operated by <code>config.yml</code>, which you&rsquo;ve copied into the <code>config/</code> directory. I&rsquo;ll show you the config I use, and highlight the parts you&rsquo;ll need to change.</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">aws:
  access_key_id: AKIAIBAWU2NAYME55123
  secret_access_key: iEmruXM7dSbOemQy63FhRjzhSboisP5TcJlj9123
  s3:
    region: eu-west-1
    buckets:
      assets: s3://snowplow-hosted-assets
      jsonpath_assets:
      log: s3://simoahava-snowplow-log
      raw:
        in:
          - s3://elasticbeanstalk-eu-west-1-375284143851/resources/environments/logs/publish/e-f4pdn8dtsg
        processing: s3://simoahava-snowplow-data/processing
        archive: s3://simoahava-snowplow-data/archive/raw
      enriched:
        good: s3://simoahava-snowplow-data/enriched/good
        bad: s3://simoahava-snowplow-data/enriched/bad
        errors: 
        archive: s3://simoahava-snowplow-data/archive/enriched
      shredded:
        good: s3://simoahava-snowplow-data/shredded/good
        bad: s3://simoahava-snowplow-data/shredded/bad
        errors:
        archive: s3://simoahava-snowplow-data/archive/shredded
  emr:
    ami_version: 5.9.0
    region: eu-west-1
    jobflow_role: EMR_EC2_DefaultRole
    service_role: EMR_DefaultRole
    placement:
    ec2_subnet_id: subnet-d6e91a9e
    ec2_key_name: simoahava
    bootstrap: []
    software:
      hbase:
      lingual:
    jobflow:
      job_name: Snowplow ETL
      master_instance_type: m1.medium
      core_instance_count: 2
      core_instance_type: m1.medium
      core_instance_ebs:
        volume_size: 100
        volume_type: &#34;gp2&#34;
        volume_iops: 400
        ebs_optimized: false
      task_instance_count: 0
      task_instance_type: m1.medium
      task_instance_bid: 0.015
    bootstrap_failure_tries: 3
    configuration:
      yarn-site:
        yarn.resourcemanager.am.max-attempts: &#34;1&#34;
      spark:
        maximizeResourceAllocation: &#34;true&#34;
    additional_info:
collectors:
  format: clj-tomcat
enrich:
  versions:
    spark_enrich: 1.12.0
  continue_on_unexpected_error: false
  output_compression: NONE
storage:
  versions:
    rdb_loader: 0.14.0
    rdb_shredder: 0.13.0
    hadoop_elasticsearch: 0.1.0
monitoring:
  tags: {}
  logging:
    level: DEBUG</code></pre></div>
<p>The keys you need to edit are listed next, with a comment on how to edit them. All the keys not listed below you can leave with their default values. I really recommend you read through the <a href="https://github.com/snowplow/snowplow/wiki/Common-configuration">configuration documentation</a> for ideas on how to modify the rest of the keys to make your setup more powerful.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:aws:access_key_id</code></td>
<td>Copy-paste the Access Key ID of your IAM user here.</td>
</tr>
<tr>
<td><code>:aws:secret_access_key</code></td>
<td>Copy-paste the Secret Access Key of your IAM user here.</td>
</tr>
<tr>
<td><code>:aws:s3:region</code></td>
<td>Set this to the region where your S3 buckets are located in.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:log</code></td>
<td>Change this to the name of the S3 bucket you created for the ETL logs.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:raw:in</code></td>
<td>This is the bucket where the Tomcat logs are automatically pushed to. Do <strong>not</strong> include the last folder in the path, because this might change with an auto-scaling environment. <strong>Note!</strong> Keep the hyphen in the beginning of the line as in the config file example!</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:raw:processing</code></td>
<td>Set this to the respective processing bucket.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:raw:archive</code></td>
<td>Set this to the archive bucket for raw data.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:enriched:good</code></td>
<td>Set this to the enriched/good bucket.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:enriched:bad</code></td>
<td>Set this to the enriched/bad bucket.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:enriched:errors</code></td>
<td>Leave this empty.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:enriched:archive</code></td>
<td>Set this to the archive bucket for enriched data.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:shredded:good</code></td>
<td>Set this to the shredded/good bucket.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:shredded:bad</code></td>
<td>Set this to the shredded/bad bucket.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:shredded:errors</code></td>
<td>Leave this empty.</td>
</tr>
<tr>
<td><code>:aws:s3:buckets:shredded:archive</code></td>
<td>Set this to the archive bucket for shredded data.</td>
</tr>
<tr>
<td><code>:aws:emr:region</code></td>
<td>This should be the region where the EC2 job will run.</td>
</tr>
<tr>
<td><code>:aws:emr:placement</code></td>
<td>Leave this empty.</td>
</tr>
<tr>
<td><code>:aws:emr:ec2_subnet_id</code></td>
<td>The subnet ID of the Virtual Private Cloud the job will run in. You can use the same subnet ID used by the EC2 instance running your collector.</td>
</tr>
<tr>
<td><code>:aws:emr:ec2_key_name</code></td>
<td>The name of the EC2 Key Pair you created earlier.</td>
</tr>
<tr>
<td><code>:collectors:format</code></td>
<td>Set this to <strong>clj-tomcat</strong>.</td>
</tr>
<tr>
<td><code>:monitoring:snowplow</code></td>
<td>Remove this key and all its children (<code>:method</code>, <code>:app_id</code>, and <code>:collector</code>).</td>
</tr>
</tbody>
</table>
<p>Just two things to point out.</p>
<p>First, when copying the <code>:aws:s3:buckets:raw:in</code> path, do not copy the last folder name. This is the instance ID. With an auto-scaling environment set for the collector, there might be multiple instance folders in this bucket. If you only name one folder, you&rsquo;ll risk missing out on a lot of data.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/s3-raw-in-bucket.jpg" title="Path to the raw:in bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/s3-raw-in-bucket.jpg" layout="responsive" alt="Path to the raw:in bucket" height="892" width="2704"></amp-img>
  
    </a>
  

<p>You can get the <code>:aws:emr:ec2_subnet_id</code> by opening the <strong>Services</strong> menu in AWS and clicking <strong>EC2</strong>. Click the link titled <strong>Running Instances</strong> (there should be 1 running instance - your collector). Scroll down the <strong>Description</strong> tab contents until you find the <strong>Subnet ID</strong> entry. Copy-paste that into the <code>aws:emr:ec2_subnet_id</code> field.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/subnet-id.jpg" title="EC2 subnet ID">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/subnet-id.jpg" layout="responsive" alt="EC2 subnet ID" height="1072" width="2878"></amp-img>
  
    </a>
  

<p>If you&rsquo;ve followed all the steps in this chapter, you should now be set.</p>
<p>You can verify everything works by running the following command in the directory where the <code>snowplow-emr-etl-runner</code> executable is, and where the <code>config</code> folder is located.</p>
<p><code>./snowplow-emr-etl-runner run -c config/config.yml -r config/iglu_resolver.json</code></p>


    <a href="https://www.simoahava.com/amp/images/2018/02/emr-etl-runner.jpg" title="Successfully ran that emr-etl-runner">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/emr-etl-runner.jpg" layout="responsive" alt="Successfully ran that emr-etl-runner" height="202" width="1482"></amp-img>
  
    </a>
  

<p>You can also follow the process in real-time by opening the <strong>Services</strong> menu in AWS and clicking <strong>EMR</strong>. There, you should see the job named <strong>Snowplow ETL</strong>. By clicking it, you can see all the steps it is running through. If the process ends in an error, you can also debug quite handily via this view, since you can see the exact step where the process failed.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/aws-emr-view.jpg" title="AWS EMR steps">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/aws-emr-view.jpg" layout="responsive" alt="AWS EMR steps" height="998" width="2878"></amp-img>
  
    </a>
  

<p>Once the ETL has successfully completed, you can check your S3 buckets again. Your Snowplow data buckets should now contain a lot of new stuff. The folder with the interesting data is <strong>archive</strong> / <strong>shredded</strong>. This is where the good shredded datasets are copied to, and corresponds to what would have been copied to the relational database had you set this up in this step.</p>
<p>Anyway, with the ETL process up and running, just one more step remains in this monster of a guide: setting up AWS Redshift as the relational database where you&rsquo;ll be warehousing your analytics data!</p>
<h3 id="what-you-should-have-after-this-step-2">What you should have after this step</h3>
<ol>
<li>
<p>The <code>snowplow-emr-etl-runner</code> executable configured with your <code>config.yml</code> file.</p>
</li>
<li>
<p>New buckets in S3 to store all the files created by the batch process.</p>
</li>
<li>
<p>The ETL job running without errors all the way to completion, enriching and shredding the raw Tomcat logs into relevant S3 buckets.</p>
</li>
</ol>

        
          <h2 id="step-4-load-the-data-into-redshift">Step 4: Load the data into Redshift</h2>
<h3 id="what-you-need-for-this-step-3">What you need for this step</h3>
<ol>
<li>
<p>The ETL process configured and available to run at your whim.</p>
</li>
<li>
<p>Shredded files being stored in the <strong>archive</strong> / <strong>shredded</strong> S3 bucket.</p>
</li>
<li>
<p>An SQL query client. I recommend <a href="http://www.sql-workbench.net/">SQL Workbench/J</a>, which is free. That&rsquo;s the one I&rsquo;ll be using in this guide.</p>
</li>
</ol>
<h3 id="getting-started-2">Getting started</h3>
<p>In this final step of this tutorial, we&rsquo;ll load the shredded data into Redshift tables. Redshift is a data warehouse service offered by AWS. We&rsquo;ll use it to build a relational database, where each table stores the information shredded from the Tomcat logs in a format easy to query with SQL. By the way, if you&rsquo;re unfamiliar with SQL, look no further than this great <a href="https://www.codecademy.com/learn/learn-sql">Codecademy course</a> to get you started with the query language!</p>
<p>The steps you&rsquo;ll take in this chapter are roughly these:</p>
<ol>
<li>
<p>Create a new cluster and database in Redshift.</p>
</li>
<li>
<p>Add users and all the necessary tables to the database.</p>
</li>
<li>
<p>Configure the EmrEtlRunner to automatically load the shredded data into Redshift tables.</p>
</li>
</ol>
<p>Once you&rsquo;re done, each time you run EmrEtlRunner, the tables will be populated with the parsed tracker data. You can then run SQL queries against this data, and use it to proceed with the two remaining steps (not covered in this guide) of the Snowplow pipeline: <a href="https://github.com/snowplow/snowplow/wiki/getting-started-with-data-modeling">data modeling</a> and <a href="https://github.com/snowplow/snowplow/wiki/getting-started-analyzing-snowplow-data">analysis</a>.</p>
<h3 id="create-the-cluster">Create the cluster</h3>
<p>In AWS, select <strong>Services</strong> from the top navigation and choose the <strong>Amazon Redshift</strong> service.</p>
<p>Again, double-check that you are in the correct region (the same one where you&rsquo;ve been working on all along, or, at the very least, the one where your S3 logs are). Then click the <strong>Launch cluster</strong> button.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/redshift-launch-cluster.jpg" title="Launch Redshift cluster">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/redshift-launch-cluster.jpg" layout="responsive" alt="Launch Redshift cluster" height="790" width="1918"></amp-img>
  
    </a>
  

<p>Give the cluster an identifier. I named my cluster <code>simoahava</code>. Give a name to the database, too. The name I chose was <code>snowplow</code>.</p>
<p>Keep the database port at its default value (<strong>5439</strong>).</p>
<p>Add a username and password to your master user. This is the user you&rsquo;ll initially log in with, and it&rsquo;s the one you&rsquo;ll create the rest of the users and all the necessary tables with. Remember to write these down somewhere - you&rsquo;ll need them in just a bit.</p>
<p>Click <strong>Continue</strong> when ready.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/cluster-details.jpg" title="Redshift Cluster details">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/cluster-details.jpg" layout="responsive" alt="Redshift Cluster details" height="1114" width="2252"></amp-img>
  
    </a>
  

<p>In the next view, leave the two options at their default values. Node type should be <strong>dc2.large</strong>, and Cluster type should be <strong>Single Node</strong> (with <code>1</code> as the number of compute nodes used). Click <strong>Continue</strong> when ready.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/node-configuration.jpg" title="Configure cluster node">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/node-configuration.jpg" layout="responsive" alt="Configure cluster node" height="1294" width="2190"></amp-img>
  
    </a>
  

<p>In the Additional Configuration view, you can leave most of the options at their default values. For the <strong>VPC security group</strong>, select the <strong>default</strong> group. The settings should thus be something like these:</p>
<p><strong>Cluster parameter group</strong>: default-redshift-1.0<br>
<strong>Encrypt database</strong>: None<br>
<strong>Choose a VPC</strong>: Default VPC (&hellip;)<br>
<strong>Cluster subnet group</strong>: default<br>
<strong>Publicly accessible</strong>: Yes<br>
<strong>Choose a public IP address</strong>: No<br>
<strong>Enhanced VPC Routing</strong>: No<br>
<strong>Availability zone</strong>: No Preference<br>
<strong>VPC security groups</strong>: default (sg-&hellip;)<br>
<strong>Create CloudWatch Alarm</strong>: No<br>
<strong>Available roles</strong>: No selection</p>
<p>Once done, click <strong>Continue</strong>.</p>
<p>You can double-check your settings, and then just click <strong>Launch cluster</strong>.</p>
<p>The cluster will take some minutes to launch. You can check the status of the cluster in the Redshift dashboard.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/launching-cluster.jpg" title="Launching Redshift cluster">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/launching-cluster.jpg" layout="responsive" alt="Launching Redshift cluster" height="454" width="2838"></amp-img>
  
    </a>
  

<p>Once the cluster has been launched, you are ready to log in and configure it!</p>
<h3 id="configure-the-cluster-and-connect-to-it">Configure the cluster and connect to it</h3>
<p>The first thing you&rsquo;ll need to do is make sure the cluster accepts incoming connections from your local machine.</p>
<p>So after clicking <strong>Services</strong> in the AWS top navigation and choosing <strong>Amazon Redshift</strong>, go to <strong>Clusters</strong> and then click the cluster name in the dashboard.</p>
<p>Under <strong>Cluster Properties</strong>, click the link to the <strong>VPC security group</strong> (should be named something like <code>default (sg-1234abcd)</code>).</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/vpc-security-group.jpg" title="VPC Security Group">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/vpc-security-group.jpg" layout="responsive" alt="VPC Security Group" height="502" width="748"></amp-img>
  
    </a>
  

<p>You should be transported to the <strong>EC2</strong> dashboard, and <strong>Security Groups</strong> should be active in the navigation menu.</p>
<p>In the bottom of the screen, the settings for the security group you clicked should be visible.</p>
<p>Select the <strong>Inbound</strong> tab, and make sure it shows a <strong>TCP</strong> connection with Port Range <strong>5439</strong> and <strong>0.0.0.0/0</strong> as the Source. This means that all incoming TCP connections are permitted (you can change this to a more stricter policy later on).</p>
<p>If the values are different, you can <strong>Edit</strong> the Inbound rule to match these.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/edit-security-group.jpg" title="Edit security group">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/edit-security-group.jpg" layout="responsive" alt="Edit security group" height="837" width="1912"></amp-img>
  
    </a>
  

<p>Now it&rsquo;s time to connect to the cluster. Go back to <strong>Amazon Redshift</strong>, and open your cluster settings as before. Copy the link to the cluster from the top of the settings list.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/redshift-cluster-url.jpg" title="Redshift cluster address">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/redshift-cluster-url.jpg" layout="responsive" alt="Redshift cluster address" height="190" width="727"></amp-img>
  
    </a>
  

<p>Next, open the SQL query tool of your choice. I&rsquo;m using <a href="http://www.sql-workbench.net/">SQL Workbench/J</a>. Select <strong>File</strong> / <strong>Connect Window</strong>, and create a new connection with the following settings changed from defaults:</p>
<p><strong>Driver</strong>: Amazon Redshift (com.amazon.redshift.jdbc.Driver)<br>
<strong>URL</strong>: jdbc:redshift://cluster_url:cluster_port/database_name<br>
<strong>Username</strong>: master_username<br>
<strong>Password</strong>: master_password<br>
<strong>Autocommit</strong>: Check</p>
<p>In <strong>URL</strong>, copy-paste the Redshift URL with port after the colon and database name after the slash.</p>
<p>As <strong>Username</strong> and <strong>Password</strong>, add the master username and master password you chose when creating the cluster.</p>
<p>Make sure <strong>Autocommit</strong> is checked. These are settings I have:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/connect-cluster-settings.jpg" title="Cluster connection settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/connect-cluster-settings.jpg" layout="responsive" alt="Cluster connection settings" height="385" width="978"></amp-img>
  
    </a>
  

<p>Once done, you can click <strong>OK</strong>, and the tool will connect to your cluster and database.</p>
<p>Once connected, you can feed the command <code>SELECT current_database();</code> and click the <strong>Execute</strong> button to check if everything works. This is what you should see:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/test-sql.jpg" title="Test SQL query">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/test-sql.jpg" layout="responsive" alt="Test SQL query" height="419" width="980"></amp-img>
  
    </a>
  

<p>If the query returns the name of the database, you&rsquo;re good to go!</p>
<h3 id="create-the-database-tables">Create the database tables</h3>
<p>First, we&rsquo;ll need to create the tables that will store the Google Analytics tracker data within them. The tables are loaded as <code>.sql</code> files, and these files contain DDL (data-definition language) constructions that build all the necessary schemas and tables.</p>
<p>For this, you&rsquo;ll need access to the schema <code>.sql</code> files, which you&rsquo;ll find in the following locations within the snowplow Git repo:</p>
<ul>
<li>
<p><a href="https://github.com/snowplow/snowplow/blob/master/4-storage/redshift-storage/sql/atomic-def.sql">snowplow/4-storage/redshift-storage/sql/atomic-def.sql</a></p>
</li>
<li>
<p><a href="https://github.com/snowplow/snowplow/blob/master/4-storage/redshift-storage/sql/manifest-def.sql">snowplow/4-storage/redshift-storage/sql/manifest-def.sql</a></p>
</li>
</ul>
<p>Load <code>atomic-def.sql</code> first, and run the file in your SQL query tool while connected to your Redshift database. You should see a message that the schema <code>atomic</code> and table <code>atomic.events</code> were created successfully.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/atomic-def-run.jpg" title="atomic-def.sql run successfully">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/atomic-def-run.jpg" layout="responsive" alt="atomic-def.sql run successfully" height="600" width="1540"></amp-img>
  
    </a>
  

<p>Next, run <code>manifest-def.sql</code> while connected to the database. You should see a message that the table <code>atomic.manifest</code> was created successfully.</p>
<p>Now you need to load all the DDLs for the Google Analytics schemas. If you don&rsquo;t create these tables, then the ETL process will run into an error, where the utility tries to copy shredded events into non-existent tables.</p>
<p>You can find all the required <code>.sql</code> files in the following three directories:</p>
<ul>
<li>
<p><a href="https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics">https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics</a></p>
</li>
<li>
<p><a href="https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics.enhanced-ecommerce">https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics.enhanced-ecommerce</a></p>
</li>
<li>
<p><a href="https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics.measurement-protocol">https://github.com/snowplow/iglu-central/tree/master/sql/com.google.analytics.measurement-protocol</a></p>
</li>
</ul>
<p>You need to load all the <code>.sql</code> files in these three directories and run them while connected to your database. This will create a whole bunch of tables you&rsquo;ll need if you want to collect Google Analytics tracker data.</p>
<p>It might be easiest to clone the <strong>iglu-central</strong> repo, and then load the <code>.sql</code> files into your query tool from the local directories.</p>
<p>Once you&rsquo;re done, you should be able to run the following SQL query and see a list of all the tables you just created as a result (should be 40 in total):</p>
<p><code>SELECT * FROM pg_tables WHERE schemaname='atomic';</code></p>


    <a href="https://www.simoahava.com/amp/images/2018/02/all-tables-created.jpg" title="All tables created">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/all-tables-created.jpg" layout="responsive" alt="All tables created" height="880" width="2008"></amp-img>
  
    </a>
  

<h3 id="create-the-database-users">Create the database users</h3>
<p>Next thing we&rsquo;ll do is create three users:</p>
<ul>
<li>
<p><code>storageloader</code>, who will be in charge of the ETL process.</p>
</li>
<li>
<p><code>power_user</code>, who will have admin privileges, so you no longer have to log in with the master credentials.</p>
</li>
<li>
<p><code>read_only</code>, who can query data and create his/her own tables.</p>
</li>
</ul>
<p>Make sure you&rsquo;re still connected to the database, and copy-paste the following SQL queries into the query window. For each <code>$password</code>, change it to a proper password, and make sure you write these user + password combinations down somewhere.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">storageloader</span> <span class="n">PASSWORD</span> <span class="s1">&#39;$password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">storageloader</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">INSERT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="n">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">storageloader</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">read_only</span> <span class="n">PASSWORD</span> <span class="s1">&#39;$password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">USAGE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">read_only</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="n">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">read_only</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">scratchpad</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="n">scratchpad</span> <span class="k">TO</span> <span class="n">read_only</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">power_user</span> <span class="n">PASSWORD</span> <span class="s1">&#39;$password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">DATABASE</span> <span class="n">snowplow</span> <span class="k">TO</span> <span class="n">power_user</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">power_user</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="k">ALL</span> <span class="n">TABLES</span> <span class="k">IN</span> <span class="k">SCHEMA</span> <span class="k">atomic</span> <span class="k">TO</span> <span class="n">power_user</span><span class="p">;</span></code></pre></div>
<p>Again, remember to change the three <code>$password</code> values to proper SQL user passwords.</p>
<p>If all goes well, you should see 12 &ldquo;COMMAND executed successfully&rdquo; statements.</p>
<p>Finally, you need to grant ownership of all tables in schema <code>atomic</code> to <strong>storageloader</strong>, because this user will need to run some commands (specifically, <code>vacuum</code> and <code>analyze</code>) that only table owners can run.</p>
<p>So, first run the following query in the database.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="s1">&#39;ALTER TABLE atomic.&#39;</span> <span class="o">||</span> <span class="n">tablename</span> <span class="o">||</span><span class="s1">&#39; OWNER TO storageloader;&#39;</span>
<span class="k">FROM</span> <span class="n">pg_tables</span> <span class="k">WHERE</span> <span class="n">schemaname</span><span class="o">=</span><span class="s1">&#39;atomic&#39;</span> <span class="k">AND</span> <span class="k">NOT</span> <span class="n">tableowner</span><span class="o">=</span><span class="s1">&#39;storageloader&#39;</span><span class="p">;</span></code></pre></div>
<p>In the query results, you should see a bunch of <code>ALTER TABLE atomic.* OWNER TO storageloader;</code> queries. Copy all of these, and paste them into the statement field as new queries. Then run the statements.</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/change-owner.jpg" title="Change ownership of all tables">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/change-owner.jpg" layout="responsive" alt="Change ownership of all tables" height="1148" width="2080"></amp-img>
  
    </a>
  

<p>Now, if you run <code>SELECT * FROM pg_tables WHERE schemaname='atomic' AND tableowner='storageloader';</code>, you should see all the tables in the atomic schema as a result.</p>
<p>You have successfully created the users and the tables in the database. All that&rsquo;s left is to configure the EmrEtlRunner to execute the final step of the ETL process, where the <code>storageloader</code> user copies all the data from the shredded files into the corresponding Redshift tables.</p>
<h3 id="create-new-iam-role-for-database-loader">Create new IAM role for database loader</h3>
<p>The EmrEtlRunner will copy the files to Redshift using a utility called RDB Loader (Relational Database Loader). For this tool to work with sufficient privileges, you&rsquo;ll need to create a new <strong>IAM Role</strong>, which grants the Redshift cluster read-only access to your S3 buckets.</p>
<ul>
<li>
<p>So, in AWS, click <strong>Services</strong> and select <strong>IAM</strong>.</p>
</li>
<li>
<p>Select <strong>Roles</strong> from the left-hand navigation. Click the <strong>Create role</strong> button.</p>
</li>
<li>
<p>In the <strong>Select type of trusted entity</strong> view, keep the default <strong>AWS Service</strong> selected, and choose <strong>Redshift</strong> from the list of services. In the <strong>Select your use case</strong> list, choose <strong>Redshift - Customizable</strong>, and then click <strong>Next: Permissions</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/iam-role-redshift.jpg" title="Grant Redshift permissions to IAM role">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/iam-role-redshift.jpg" layout="responsive" alt="Grant Redshift permissions to IAM role" height="1454" width="1522"></amp-img>
  
    </a>
  

<ul>
<li>In the next view, find the policy named <strong>AmazonS3ReadOnlyAccess</strong>, and check the box next to it. Click <strong>Next: Review</strong>.</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/amazon-s3-read-only.jpg" title="AmazonS3ReadOnlyAccess rights">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/amazon-s3-read-only.jpg" layout="responsive" alt="AmazonS3ReadOnlyAccess rights" height="1220" width="1996"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Name the role something useful, such as <code>RedshiftS3Access</code> and click <strong>Create Role</strong> when ready.</p>
</li>
<li>
<p>You should be back in the list of roles. Click the newly created <code>RedshiftS3Access</code> role to see its configuration. Copy the value in the <strong>Role ARN</strong> field to the clipboard. You&rsquo;ll need it very soon.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/role-arn.jpg" title="Role ARN for redshift IAM role">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/role-arn.jpg" layout="responsive" alt="Role ARN for redshift IAM role" height="950" width="2458"></amp-img>
  
    </a>
  

<ul>
<li>
<p>Finally, select <strong>Services</strong> from AWS top navigation and choose the <strong>Amazon Redshift</strong> service. Click <strong>Clusters</strong> in the left-hand navigation to see the list of running clusters.</p>
</li>
<li>
<p>Check the box next to your Snowplow cluster, and click <strong>Manage IAM Roles</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/manage-iam-roles.jpg" title="Manage IAM Roles">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/manage-iam-roles.jpg" layout="responsive" alt="Manage IAM Roles" height="672" width="2246"></amp-img>
  
    </a>
  

<ul>
<li>In the <strong>Available roles</strong> list, choose the role you just created, and then click <strong>Apply changes</strong> to apply the role to your cluster.</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2018/02/apply-role.jpg" title="Apply IAM role">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/apply-role.jpg" layout="responsive" alt="Apply IAM role" height="630" width="1212"></amp-img>
  
    </a>
  

<p>The Cluster Status should change to <strong>modifying</strong>. Once it&rsquo;s done, the status will change to <strong>available</strong>, and you can check if the role you assigned is labeled as <strong>in-sync</strong> by clicking <strong>Manage IAM Roles</strong> again.</p>
<h3 id="edit-the-redshift-target-configuration">Edit the Redshift target configuration</h3>
<p>If you copied all necessary files back in <a href="#download-the-necessary-files">Step 3</a>, your project <code>config/</code> directory should include a <code>targets/</code> folder with the file <code>redshift.json</code> in it. If you don&rsquo;t have it, go back to Step 3 and make sure you copy the <code>redshift.json</code> template to the correct folder.</p>
<p>Once you&rsquo;ve found the template, open it for editing, and make sure it looks something like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">{<span class="w">
</span><span class="w">    </span><span class="k">&#34;schema&#34;: </span><span class="s2">&#34;iglu:com.snowplowanalytics.snowplow.storage/redshift_config/jsonschema/2-1-0&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="k">&#34;data&#34;: </span>{<span class="w">
</span><span class="w">        </span><span class="k">&#34;name&#34;: </span><span class="s2">&#34;AWS Redshift enriched events storage&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;host&#34;: </span><span class="s2">&#34;simoahava.coyhone1deuh.eu-west-1.redshift.amazonaws.com&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;database&#34;: </span><span class="s2">&#34;snowplow&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;port&#34;: </span><span class="m">5439</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;sslMode&#34;: </span><span class="s2">&#34;DISABLE&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;username&#34;: </span><span class="s2">&#34;storageloader&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;password&#34;: </span><span class="s2">&#34;...&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;roleArn&#34;: </span><span class="s2">&#34;arn:aws:iam::375284143851:role/RedshiftS3Access&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;schema&#34;: </span><span class="s2">&#34;atomic&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;maxError&#34;: </span><span class="m">1</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;compRows&#34;: </span><span class="m">20000</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;sshTunnel&#34;: </span><span class="kc">null</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="k">&#34;purpose&#34;: </span><span class="s2">&#34;ENRICHED_EVENTS&#34;</span><span class="w">
</span><span class="w">    </span>}<span class="w">
</span><span class="w"></span>}</code></pre></div>
<p>Here are the fields you need to edit:</p>
<ul>
<li><strong>host</strong>: The URL of your Redshift cluster</li>
<li><strong>database</strong>: The database name</li>
<li><strong>username</strong>: storageloader</li>
<li><strong>password</strong>: storageloader password</li>
<li><strong>roleArn</strong>: The Role ARN of the IAM role you created in the previous step</li>
</ul>
<p>All the other options you can leave with their default values.</p>
<h3 id="re-run-emretlrunner-through-the-whole-process">Re-run EmrEtlRunner through the whole process</h3>
<p>Now that you&rsquo;ve configured <strong>everything</strong>, you&rsquo;re ready to run the EmrEtlRunner with all the steps in the ETL process included. This means <strong>enrichment</strong> of the log data, <strong>shredding</strong> of the log data to atomic datasets, and <strong>loading</strong> these datasets into your Redshift tables.</p>
<p>The command you&rsquo;ll need to run in the root of your project folder (where the <code>snowplow-emr-etl-runner</code> executable is) is this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">./snowplow-emr-etl-runner run -c config/config.yml -r config/iglu_resolver.json -t config/targets</code></pre></div>
<p>This command will process all the data in the <code>:raw:in</code> bucket (the one with all your Tomcat logs), and proceed to extract and transform them, and finally load them into your Redshift tables. The process will take a while, so go grab a coffee. Remember that you can check the status of the job by browsing to <strong>EMR</strong> via the AWS <strong>Services</strong> navigation.</p>
<p>Once complete, you should see something like this in the command line:</p>


    <a href="https://www.simoahava.com/amp/images/2018/02/emr-etl-complete.jpg" title="EmrEtlRunner finished">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/emr-etl-complete.jpg" layout="responsive" alt="EmrEtlRunner finished" height="338" width="1722"></amp-img>
  
    </a>
  

<h3 id="test-it">Test it</h3>
<p>Now you should be able to login to the database using the new <code>read_only</code> user. If you run the following query, it should return a list of timestamps and events for each Client ID visiting your site.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">root_tstamp</span><span class="p">,</span> <span class="n">u</span><span class="p">.</span><span class="n">client_id</span><span class="p">,</span> <span class="n">h</span><span class="p">.</span><span class="k">type</span>
<span class="k">FROM</span> <span class="k">atomic</span><span class="p">.</span><span class="n">com_google_analytics_measurement_protocol_user_1</span> <span class="k">AS</span> <span class="n">u</span> 
<span class="k">JOIN</span> <span class="k">atomic</span><span class="p">.</span><span class="n">com_google_analytics_measurement_protocol_hit_1</span> <span class="k">AS</span> <span class="n">h</span>
<span class="k">ON</span> <span class="n">u</span><span class="p">.</span><span class="n">root_id</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">root_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">root_tstamp</span> <span class="k">ASC</span></code></pre></div>


    <a href="https://www.simoahava.com/amp/images/2018/02/sql-example-query.jpg" title="SQL Example Query">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/02/sql-example-query.jpg" layout="responsive" alt="SQL Example Query" height="836" width="1648"></amp-img>
  
    </a>
  

<p>Considering how much time you have probably put into making everything work (if following this guide diligently), I really hope it all works correctly.</p>

        
          <h2 id="wrapping-it-all-up">Wrapping it all up</h2>
<p>By following this guide, you should be able to set up an end-to-end Snowplow batch pipeline.</p>
<ol>
<li>
<p>Google Tag Manager duplicates the payloads sent to Google Analytics, and sends these to your Amazon endpoint, using a custom domain name whose DNS records you have delegated to AWS.</p>
</li>
<li>
<p>The endpoint is a collector which logs all the HTTP requests to Tomcat logs, and stores them in an S3 bucket.</p>
</li>
<li>
<p>An ETL process is then run, enriching the stored data, and shredding it to atomic datasets, again stored in S3.</p>
</li>
<li>
<p>Finally, the ETL runner copies these datasets into tables you&rsquo;ve set up in a new relational database running on an AWS Redshift cluster.</p>
</li>
</ol>
<p>There are <strong>SO</strong> many moving parts here, that it&rsquo;s possible you&rsquo;ll get something wrong at some point. Just try to patiently walk through the steps in this guide to see if you&rsquo;ve missed anything.</p>
<p>Feel free to ask questions in the comments, and maybe I or my readers will be able to help you along.</p>
<p>You can also join the discussions in Snowplow&rsquo;s <a href="https://discourse.snowplowanalytics.com/">Discourse site</a> - I&rsquo;m certain the folks there are more than happy to help you if you run into trouble setting up the pipeline.</p>
<p>Do note also that the setup outlined in this guide is very rudimentary. There are many ways you can, and should, optimize the process, such as:</p>
<ol>
<li>
<p>Add SSL support to your Redshift cluster.</p>
</li>
<li>
<p>Scale the instances (collector and the ETL process) correctly to account for peaks in traffic and dataset size.</p>
</li>
<li>
<p>Move the EmrEtlRunner to AWS, too. There&rsquo;s no need to run it on your local machine.</p>
</li>
<li>
<p>Schedule the EmrEtlRunner to run (at least) once a day, so that your database is refreshed with new data periodically.</p>
</li>
</ol>
<p>Good luck!</p>

        
      
    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>





<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

