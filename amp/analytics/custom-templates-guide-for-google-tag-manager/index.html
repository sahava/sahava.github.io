

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Custom Templates Guide for Google Tag Manager | Simo Ahava's blog</title>
        <meta property="og:title" content="Custom Templates Guide for Google Tag Manager" />
<meta name="description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager." />
<meta property="og:description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/" />

    
        
    



    
        <meta property="article:published_time" content="2019-05-23T15:00:00Z"/>
    
    
        <meta property="article:modified_time" content="2019-05-23T15:00:00Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="custom templates" />
        
            <meta property="article:tag" content="guide" />
        
            <meta property="article:tag" content="tag templates" />
        
            <meta property="article:tag" content="variable templates" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    



<meta itemprop="name" content="Custom Templates Guide For Google Tag Manager">
<meta itemprop="description" content="A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.">
<meta itemprop="datePublished" content="2019-05-23T18:00:00&#43;03:00" />
<meta itemprop="dateModified" content="2019-05-23T18:00:00&#43;03:00" />
<meta itemprop="wordCount" content="17313">



<meta itemprop="keywords" content="google tag manager,custom templates,guide,tag templates,variable templates," />
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava\x27s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https:\/\/www.simoahava.com\/amp\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Custom Templates Guide For Google Tag Manager | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2019\/01\/custom-templates-google-tag-manager.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/amp\/analytics\/custom-templates-guide-for-google-tag-manager\/",
  "datePublished": "2019-05-23T18:00:00\x2b03:00",
  "dateModified": "2019-05-23T18:00:00\x2b03:00",
  "description": "A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent/">consent</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tags/">custom-html-tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/node.js/">node.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/parameter-reporting/">parameter-reporting</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/postmessage/">postmessage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview/">preview</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/recaptcha/">recaptcha</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/single-page-apps/">single-page-apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/still-running/">still-running</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Custom Templates Guide for Google Tag Manager</h1>
        <small>A comprehensive guide to building custom templates (both tag templates and variable templates) in Google Tag Manager.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/custom-templates">#custom templates</a>
    
        , <a href="https://www.simoahava.com/amp/tags/guide">#guide</a>
    
        , <a href="https://www.simoahava.com/amp/tags/tag-templates">#tag templates</a>
    
        , <a href="https://www.simoahava.com/amp/tags/variable-templates">#variable templates</a>
    

<time class="post-date" datetime="2019-05-23T18:00:00&#43;03:00">
    23 May 2019
</time>


        </section>
    </header>

    <section class="post-content">
      <p>As I have finally managed to pick up my jaw from the floor, it's now time to tell you what's got me so excited. <a href="https://tagmanager.google.com/">Google Tag Manager</a> recently released a new feature called <a href="https://developers.google.com/tag-manager/templates/"><strong>Custom Templates</strong></a>. Actually, it's not fair to call it a <em>feature</em>. It's a full-blown paradigm shift in how we use Google Tag Manager. It's a <em>suite</em> of features designed to help brands, companies, and users create and share their own custom JavaScript and HTML setups with ease, while taking care that the code is optimized for delivery in the web browser.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/custom-templates-google-tag-manager.jpg" title="custom templates in google tag manager">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/custom-templates-google-tag-manager.jpg" layout="responsive" alt="custom templates in google tag manager" height="942" width="2626"></amp-img>
  
    </a>
  

<p><strong>Custom Templates</strong>, in short, are tag and variable templates that <strong>you</strong> can create and configure. In other words, if you have a cool idea for a tag (e.g. an analytics tracking tag for a vendor not natively supported by GTM) or a variable (e.g. a Custom JavaScript variable that does something with a string), you can now turn them into reusable templates which can, in turn, be shared with other users and containers via template export and import.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/template-in-the-list.jpg" title="Example template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/template-in-the-list.jpg" layout="responsive" alt="Example template" height="382" width="1574"></amp-img>
  
    </a>
  

<p>Templates use a customized, sandboxed version of JavaScript, which has its own idiosyncratic vernacular that you must learn (with the help of this guide, of course). The reason for this added complexity is that with templates you can ensure that the code being executed is safe, unintrusive, and optimized.</p>
<p>Furthermore, templates you create will define certain <strong>permissions</strong> that are required for the template code to be able to run. An additional level of governance is provided by way of <strong>policies</strong> defined on the web page itself where the template code might be run. The interplay between these permissions and policies is a core feature of template security.</p>
<p>There are lots and lots of things to cover in this guide, so let's just get started.</p>
<!-- raw HTML omitted -->
<h2 id="how-to-read-this-guide">How to read this guide</h2>
<p>This is a long guide. It has to be - there's so much about custom templates that needs to be addressed in any document whose purpose is to provide a comprehensive treatment of the subject matter.</p>
<p>However, <strong>don't interpret my inability to write concise prose as indicative of how complex custom templates are</strong>. I can assure you - they're absolutely manageable by anyone who's been using Google Tag Manager for a while.</p>
<p>This guide is a <strong>reference</strong>. Its purpose is to offer you documentation to support your work with custom templates.</p>
<p>Because of this, I want to suggest some different ways to approach this guide.</p>
<ul>
<li>
<p><strong>Everyone</strong> should read the chapters <a href="#custom-templates-in-a-nutshell">Custom Templates in a nutshell</a> and <a href="#core-concepts">Core concepts</a>.</p>
</li>
<li>
<p>I really recommend that <strong>everyone</strong> take a look at the two walkthroughs in the <a href="#getting-started">Getting started</a> chapter.</p>
</li>
<li>
<p>Keep the <a href="#official-documentation">Official documentation</a> handy at all times, particularly the <a href="https://developers.google.com/tag-manager/templates/api">API reference</a>.</p>
</li>
<li>
<p>When working with templates, the <a href="#field-editor">Fields editor</a> (with a deep-dive into <a href="#field-configuration-reference">Field configurations</a>) chapter should be very useful - same as the one on <a href="#permissions">Permissions</a>.</p>
</li>
<li>
<p>If you're a site admin, you might want to read through the <a href="#policies-reference">Policies reference</a> to get an idea of how you can further restrict the execution of custom code on your site.</p>
</li>
<li>
<p>If you suffer from insomnia, start from the beginning and don't stop until you fall asleep. Should happen by the 10,000 word mark.</p>
</li>
</ul>
<p>Be sure to check out my other guide on how to <a href="https://www.simoahava.com/amp/analytics/create-facebook-pixel-custom-tag-template/">create a Facebook pixel template</a> - it should shed more light on how templates work. You can also check the corresponding <a href="https://youtu.be/5ESEtwq7fxc">video</a> if you prefer watching rather than reading.</p>
<p>You can also view all the custom templates I have created and/or collected in <a href="https://github.com/sahava/GoogleTagManagerTemplates">this GitHub repository</a>.</p>
<h2 id="custom-templates-in-a-nutshell">Custom Templates in a nutshell</h2>
<p>Google Tag Manager's Custom Templates offer a way to build a user interface around the custom code you might want to run on the site using Google Tag Manager. The user interface is what you've come accustomed to when using GTM's tags and variables. It comprises <strong>text input fields</strong>, <strong>settings</strong>, <strong>tables</strong>, <strong>labels</strong>, <strong>drop-down menus</strong>, and so forth.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/tag-template-before-after.jpg" title="Tag template before and after">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/tag-template-before-after.jpg" layout="responsive" alt="Tag template before and after" height="1078" width="2972"></amp-img>
  
    </a>
  

<p>Obviously, the UI itself is already a huge asset. Being able to offer a user interface in lieu of a complicated code block will minimize problems arising from input errors, and will help keep the code stable.</p>
<p>However, the templates have another, less apparent (but no less impactful) function. They add layers of <strong>protection</strong> and <strong>security</strong> to the code they abstract. Templates use a <a href="#sandboxed-javascript">custom <strong>JavaScript framework</strong></a> which introduces a handful of <a href="#template-apis">APIs</a> (application programming interfaces) that you must use if you want the code to actually do anything.</p>
<p>This introduces a steep learning curve, because you can't just copy-paste code from <a href="https://www.stackoverflow.com/">Stack Overflow</a> any more. If you want to set a global <code>window</code> property, you need to use <a href="https://developers.google.com/tag-manager/templates/api#setinwindow">an API for that</a>. If you want to log to console, you need to use <a href="https://developers.google.com/tag-manager/templates/api#logtoconsole">an API for that</a>. If you want to check the value of a cookie, guess what, you need to use <a href="https://developers.google.com/tag-manager/templates/api#getcookievalues">an API for that</a>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/api-in-use.jpg" title="API in use">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/api-in-use.jpg" layout="responsive" alt="API in use" height="410" width="1872"></amp-img>
  
    </a>
  

<p>Basically any code that tries to access the global state of the page or run any native JavaScript functions defined on the global level requires an API call.</p>
<p>So why this added complexity? Well, for one, these APIs make sure that potentially dangerous and/or intrusive modifications to the global state are done in a controlled manner.</p>
<p>Whenever you want to use an API, you must <code>require()</code> it in the template code. And when you introduce an API like that, the template automatically generates a set of configurable <a href="#permissions">permissions</a> for that API call.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/api-permissions.jpg" title="API permissions">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/api-permissions.jpg" layout="responsive" alt="API permissions" height="496" width="1932"></amp-img>
  
    </a>
  

<p>In a nutshell, templates encapsulate the logic you would otherwise introduce with custom code. By introducing APIs with <strong>permissions</strong>, the templates can be configured to work in a secure and easily managed context.</p>
<p>An added level of security is the introduction of <a href="#policies-reference"><strong>policies</strong></a>, where you as the site owner can add some code to the web page itself, which can have additional levels of control over how template permissions are resolved.</p>
<p>For example, if I have a tag configured to send hits to some endpoint, I can write a policy on the page that only allows pixel requests to one of the many endpoints configured in the tag.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[</span><span class="p">]</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">gtag</span><span class="p">(</span><span class="p">)</span><span class="p">{</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>

<span class="nx">gtag</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="s1">&#39;send_pixel&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span> <span class="o">!==</span> <span class="s1">&#39;https://snowplow.simoahava.com/i&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;Invalid pixel endpoint!&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>With that policy in place, the image request will only be executed if the endpoint URL is <code>https://snowplow.simoahava.com/i</code>. Otherwise, the tag will fail in an error, and you can see the error message in the <a href="https://www.simoahava.com/analytics/new-errors-tab-preview-mode/"><strong>Errors</strong> tab</a> of Preview mode.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/tag-errors.jpg" title="Tag errors">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/tag-errors.jpg" layout="responsive" alt="Tag errors" height="227" width="1066"></amp-img>
  
    </a>
  

<p>An additional perk of using templates is that you don't have to add the nasty <code>unsafe-eval</code> keyword to your <a href="https://www.simoahava.com/amp/analytics/google-tag-manager-content-security-policy/">Content Security Policy</a>. Any code run through a template is compiled into JavaScript when the container is written, and thus doesn't require the use of <code>eval()</code>.</p>
<p>Conversely, with Custom HTML tags and Custom JavaScript variables, the code is written into a string which is then compiled with <code>eval()</code> at runtime. This is a bad practice and requires a huge compromise in security if using a Content Security Policy.</p>
<p>I hope you can see the usefulness of Custom Templates. Imagine a library of Custom Templates, where anyone can share their own work for others to download and use in their containers. Smaller brands and companies could finally get their tools and platforms out there for the masses using Google Tag Manager.</p>
<blockquote>
<p><strong>Update 2 October 2019</strong>: You no longer have to imagine such a library as it now exists. Check out the <a href="https://tagmanager.google.com/gallery/">Community Template Gallery</a> as well as my <a href="https://www.simoahava.com/amp/analytics/introducing-tag-manager-template-gallery/">introduction</a> to it.</p>
</blockquote>
<h2 id="getting-started">Getting started</h2>
<p>Before exhausting you with all the details about custom templates (and trust me, there's a <strong>lot</strong> to digest in the feature), I want to start by walking you through creating a <strong>tag template</strong> and a <strong>variable template</strong>. We won't use all the most complex features for this, but it should serve as a nice intro to how custom templates work in Google Tag Manager.</p>
<p>Don't forget to check out my other article, which covers the creation of a <a href="https://www.simoahava.com/amp/analytics/create-facebook-pixel-custom-tag-template/">Facebook pixel template</a>. It should provide a more comprehensive (and more overwhelming) look at how templates are created.</p>
<h3 id="tag-template-walkthrough">Tag template walkthrough</h3>
<p>In this walkthrough, we'll go through how to create a simple <strong>script injection tag</strong>. This is how many of the third-party vendors out there want their scripts to be loaded.</p>
<p>We'll use a wonderful company called <a href="https://conductrics.com/">Conductrics</a> as an example. They have developed a tool with which you can do A/B-testing and personalization, using ML-driven targeting logic, dynamic goals, server-side and client-side deployment options, and a whole host of other features to help you answer those difficult business questions you have with <strong>data</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/conductrics.jpg" title="Conductrics tag template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/conductrics.jpg" layout="responsive" alt="Conductrics tag template" height="832" width="1860"></amp-img>
  
    </a>
  

<p><strong>Note!</strong> You can of course replace the Conductrics-specific stuff with some other vendor source URL, if you want. The steps you take in this guide would still be identical.</p>
<p>The tag template is simple, by design. Conductrics offers the option to host the required JavaScript for you, so all you need to do is add the <code>&lt;script&gt;</code> tag to the page that loads the JavaScript library from Conductrics&rsquo; server.</p>
<p>However, I've added some UI sugar to make the setup slightly more interesting.</p>
<p>Basically, all templates comprise four components:</p>
<ol>
<li>
<p>The details, which determine the template name, logo, and description.</p>
</li>
<li>
<p>The user interface, which governs the fields and field configurations the template has.</p>
</li>
<li>
<p>The code editor, which makes use of whatever the user input into the fields to run the actual template code.</p>
</li>
<li>
<p>Permissions, which determine what type of code can be run by the tag.</p>
</li>
</ol>
<p>We'll walk through each of these steps here.</p>
<h4 id="step-1---create-and-set-the-details-of-the-tag-template">Step 1 - Create and set the details of the tag template</h4>
<p>The first thing you need to do is create a new tag template:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/create-new-tag-template.jpg" title="Create new tag template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/create-new-tag-template.jpg" layout="responsive" alt="Create new tag template" height="916" width="2484"></amp-img>
  
    </a>
  

<p>Next, fill in some details. For the image, I used <a href="https://dribbble.com/shots/584991--Process">the logo</a> created by Conductrics&rsquo; brand designer <a href="https://dribbble.com/shablazm/projects/58695-Conductrics">Joshua McCowen</a>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/conductrics-settings.jpg" title="Conductrics settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/conductrics-settings.jpg" layout="responsive" alt="Conductrics settings" height="1112" width="1558"></amp-img>
  
    </a>
  

<p>You can <strong>Save</strong> the template by clicking the respective icon in the top-right corner now. You should see the logo and the template title in the preview window.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/tag-preview.jpg" title="Tag preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/tag-preview.jpg" layout="responsive" alt="Tag preview" height="570" width="1888"></amp-img>
  
    </a>
  

<p>There! Almost done. Well, not quite.</p>
<h4 id="step-2---create-the-ui">Step 2 - Create the UI</h4>
<p>Now we need to create the bells and whistles of the tag's actual user interface.</p>
<p>First, click the <strong>Fields</strong> tab to open the <a href="#fields-editor">Fields editor</a>. Then, click the blue <strong>Add Field</strong> button.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/add-field-button.jpg" title="Add field button">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/add-field-button.jpg" layout="responsive" alt="Add field button" height="400" width="924"></amp-img>
  
    </a>
  

<p>In the overlay that opens, select <strong>Text input</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/choose-text-input.jpg" title="Choose text input">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/choose-text-input.jpg" layout="responsive" alt="Choose text input" height="464" width="1436"></amp-img>
  
    </a>
  

<p>You should see a <a href="#text-input">text input</a> field appear in the Fields editor. Rename the field to <strong>sourceUrl</strong>, and edit the <a href="#display-name">Display name</a> setting. The field name is used in the code editor, and the <strong>Display name</strong> setting is what the user sees above the field when editing the tag settings.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/rename-text-field.jpg" title="Rename the text field">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/rename-text-field.jpg" layout="responsive" alt="Rename the text field" height="568" width="1900"></amp-img>
  
    </a>
  

<p>The UI could be ready now - it's really the only field and the only configuration you'd need.</p>
<p>But let's make it a bit more robust by adding some <strong>validation</strong>.</p>
<p>Click the <strong>cogwheel</strong> icon associated with the field to open the <a href="#field-configuration">Field configuration</a> overlay. In the overlay, make sure <strong>Display name</strong>, <strong>Help text</strong>, and <strong>Validation rules</strong> are all toggled <strong>ON</strong>.</p>
<p>Each field type has its own set of configurations you can edit to make the field more versatile.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/field-configurations.jpg" title="Field configurations">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/field-configurations.jpg" layout="responsive" alt="Field configurations" height="1390" width="2382"></amp-img>
  
    </a>
  

<p>Close the overlay by clicking the <strong>X</strong> in the corner, or anywhere outside the overlay.</p>
<p>Next, add some <a href="#help-text">Help text</a>. Help text can be seen by hovering over the little question mark next to the Display name when editing the tag.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/add-help-text.jpg" title="Add help text">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/add-help-text.jpg" layout="responsive" alt="Add help text" height="1058" width="3624"></amp-img>
  
    </a>
  

<p>You can <strong>Save</strong> the template periodically to refresh the template preview and see the changes there.</p>
<p>Next, let's add some <a href="#validation-rules">Validation rules</a>. These can be used to ensure the user adds valid values to the fields.</p>
<p>Click <strong>Add rule</strong> and edit the rule to <strong>match a regular expression</strong> where the expression is <code>^https://.*</code>. Validation regular expressions look for <strong>full matches only</strong>, so you need to add leading and/or trailing <code>.*</code> to use an open-ended pattern.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/first-validation-rule.jpg" title="First validation rule">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/first-validation-rule.jpg" layout="responsive" alt="First validation rule" height="516" width="1820"></amp-img>
  
    </a>
  

<p>Next, click the little action menu in the top corner of the validation rule box, and select <strong>Show advanced settings</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/show-advanced-settings.jpg" title="Show advanced settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/show-advanced-settings.jpg" layout="responsive" alt="Show advanced settings" height="374" width="1326"></amp-img>
  
    </a>
  

<p>Validation rules have two advanced settings. The first is where you can provide a <strong>custom error message</strong> (which we'll use). The second is one where you can establish conditions for <strong>when</strong> this validation rule is active (or inactive).</p>
<p>In this case, let's add a descriptive error message. Set the <strong>Error message</strong> field to <code>The URL must start with &quot;https://&quot;.</code>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/error-message.jpg" title="Error message">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/error-message.jpg" layout="responsive" alt="Error message" height="362" width="986"></amp-img>
  
    </a>
  

<p>You can now quickly <strong>test</strong> how this works. Click <strong>Save</strong> in the top right corner, then click the tag template in the preview mode to enter edit mode. Add some string to the text input field that <strong>doesn't</strong> start with &ldquo;https://&quot;, and click the <strong>Test</strong> button in the top-right corner. You should see your error message.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/error-message-shown.jpg" title="Error message shown">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/error-message-shown.jpg" layout="responsive" alt="Error message shown" height="986" width="1868"></amp-img>
  
    </a>
  

<p>Cool, right?</p>
<p>Let's add <strong>two</strong> more validation rules. Make them look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/last-validation-rules.jpg" title="Last validation rules">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/last-validation-rules.jpg" layout="responsive" alt="Last validation rules" height="1306" width="1750"></amp-img>
  
    </a>
  

<p>The first rule ensures that the script is loaded from a <code>*.conductrics.com</code> domain, and the second rule requires that the script URL has the <code>apikey</code> parameter.</p>
<p>One final thing we'll add to the user interface is a simple <strong>debug</strong> toggle.</p>
<p>Click the <strong>Add field</strong> button, and select <strong>Checkbox</strong> from the overlay.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/checkbox.jpg" title="Checkbox">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/checkbox.jpg" layout="responsive" alt="Checkbox" height="550" width="1362"></amp-img>
  
    </a>
  

<p>Set the field name to <strong>debug</strong>, and set the <strong>Checkbox text</strong> field to <strong>Log debug messages to console</strong>. Feel free to save the template to see how the checkbox looks like in the wild.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/checkbox-in-preview.jpg" title="Checkbox in template preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/checkbox-in-preview.jpg" layout="responsive" alt="Checkbox in template preview" height="796" width="2852"></amp-img>
  
    </a>
  

<p>We're all done with the UI, finally!</p>
<h4 id="step-3---add-some-code">Step 3 - Add some code</h4>
<p>Now, select the <strong>Code</strong> tab from the template editor. You should see some boilerplate code that will help you get started (we'll replace this with some other stuff soon enough).</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/code-editor-template.jpg" title="Code editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/code-editor-template.jpg" layout="responsive" alt="Code editor" height="758" width="1904"></amp-img>
  
    </a>
  

<p>For <strong>tag</strong> templates, the code you write has three components you need to be aware of.</p>
<ul>
<li>
<p>The <strong>code format</strong> itself, which utilizes a special, <a href="#sandboxed-javascript">sandboxed JavaScript</a>. This sandboxed JS offers a bunch of <a href="#template-apis">template APIs</a> you can use to work with JavaScript outside the scope of the code itself (access <code>dataLayer</code>, write cookies, and so forth).</p>
</li>
<li>
<p>The <code>data</code> object, which comprises the contents of the tag fields the user might have interacted with.</p>
</li>
<li>
<p>The <code>data.gtmOnSuccess()</code> and <code>data.gtmOnFailure()</code> methods, which indicate success or failure, respectively, of the tag execution.</p>
</li>
</ul>
<p>With these three in mind, we need to do the following.</p>
<ol>
<li>
<p>We need the tag to load Conductrics&rsquo; JavaScript from their network, which means we'll utilize the <a href="https://developers.google.com/tag-manager/templates/api#injectscript"><code>injectScript</code> API</a> to do so.</p>
</li>
<li>
<p>We'll take the URL for the <code>injectScript</code> API from the text field in the tag, and if the user has chosen to write debug messages to the console, we'll respect that choice.</p>
</li>
<li>
<p>If the script loads fine, we'll signal this with <code>data.gtmOnSuccess()</code>, but if there's a failure (such as a <code>404</code> error), we'll call the <code>data.gtmOnFailure()</code> method.</p>
</li>
</ol>
<p><strong>Success</strong> and <strong>failure</strong> are relevant for <a href="#tag-templates-in-the-code-editor">Preview mode output</a> and also for <a href="https://www.simoahava.com/amp/analytics/understanding-tag-sequencing-in-google-tag-manager/">tag sequencing</a>.</p>
<p>Without further ado, here's the complete code you should replace the contents of the code editor with:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Require the necessary APIs
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">logToConsole</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">injectScript</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;injectScript&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queryPermission</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;queryPermission&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// Get the URL the user input into the text field
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">sourceUrl</span><span class="p">;</span>

<span class="c1">// If the user chose to log debug output, initialize the logging method
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">debug</span> <span class="o">?</span> <span class="nx">logToConsole</span> <span class="o">:</span> <span class="p">(</span><span class="p">(</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span><span class="p">}</span><span class="p">)</span><span class="p">;</span>

<span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Conductrics: Loading script from &#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// If the script loaded successfully, log a message and signal success
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">onSuccess</span> <span class="o">=</span> <span class="p">(</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Conductrics: Script loaded successfully.&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="c1">// If the script fails to load, log a message and signal failure
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">onFailure</span> <span class="o">=</span> <span class="p">(</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Conductrics: Script load failed.&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnFailure</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>

<span class="c1">// If the URL input by the user matches the permissions set for the template,
</span><span class="c1"></span><span class="c1">// inject the script with the onSuccess and onFailure methods as callbacks.
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">queryPermission</span><span class="p">(</span><span class="s1">&#39;inject_script&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">injectScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">onSuccess</span><span class="p">,</span> <span class="nx">onFailure</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Conductrics: Script load failed due to permissions mismatch.&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnFailure</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The code comments should help you understand how the code works. Here are some key things about the code:</p>
<ul>
<li>
<p>The <strong>APIs</strong> are loaded with the <code>require()</code> method. You must use these APIs - their counterparts in browser JavaScript have been suppressed. For example, <code>console.log()</code> would not work, nor would <code>document.createElement()</code>.</p>
</li>
<li>
<p>The <code>data</code> object has keys matching the <strong>field names</strong> you edited in the field editor. Any value those fields have will be the values stored in the <code>data</code> object. Thus, if the user typed <code>hello</code> into the <code>sourceUrl</code> field, that value would be available via <code>data.sourceUrl</code>.</p>
</li>
<li>
<p>Using <code>queryPermission()</code> is a good way to ensure the user input matches the permissions set in the template. The permissions are updated <strong>automatically</strong> when you <code>require()</code> a specific API in the code editor (we'll get to the permissions in the next chapter).</p>
</li>
</ul>
<p>Key thing to note is that this editor is a <strong>JavaScript editor</strong>. Thus, unlike with Custom HTML tags, you <strong>should not</strong> wrap the code with <code>&lt;script&gt;</code> and <code>&lt;/script&gt;</code>.</p>
<p>Once you're done, click <strong>Save</strong> and move on to the next chapter.</p>
<h4 id="step-4---modify-permissions">Step 4 - Modify permissions</h4>
<p>The final thing to edit are the <strong>permissions</strong>. When you <code>require()</code> APIs, you'll also automatically enable their permission configurations in the <strong>Permissions</strong> tab. See the <a href="#permissions">chapter on permissions</a> for more details on how these work.</p>
<p>Anyway, since you are using the <code>logToConsole</code> and <code>injectScript</code> APIs, their permissions are now available for editing. The <code>queryPermission</code> and <code>require</code> APIs don't have any permissions associated with them.</p>
<p>Click to the <strong>Permissions</strong> tab and expand the two permissions you find.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/permissions-expanded.jpg" title="Permissions expanded">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/permissions-expanded.jpg" layout="responsive" alt="Permissions expanded" height="431" width="900"></amp-img>
  
    </a>
  

<p>The <a href="#injects-scripts">Injects Scripts</a> permission is, surprise surprise, for the <code>injectScript</code> API. It expects URL match patterns that the value input by the user into the text field must match.</p>
<p>Add the value <code>https://*.conductrics.com/</code> into the text field.</p>
<p>This value basically means that the script URL injected in the page must be a subdomain of <code>conductrics.com</code>, and it can have any path structure (the <code>/</code> after the hostname acts as a wildcard). Thus it will match, for example:</p>
<ul>
<li>
<p><code>https://conductrics.com/tracker</code></p>
</li>
<li>
<p><code>https://de.cdn-v3.conductrics.com/ac-aBcDeFgH/v3/agent-api/js/f-aBcDeFggg/dt-b1234567?apikey=api-w123456</code></p>
</li>
</ul>
<p>The <a href="#logs-to-console">Logs to Console</a> permission should be self-explanatory. It governs how the <code>logToConsole</code> API works. You can check the <strong>Always log</strong> option, because we manage logging to console in the template code itself.</p>
<p>Right now, the permissions should look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/permission-settings-done.jpg" title="Permission settings done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/permission-settings-done.jpg" layout="responsive" alt="Permission settings done" height="368" width="646"></amp-img>
  
    </a>
  

<p>Click <strong>Save</strong> to save the current template.</p>
<h4 id="step-5---preview-and-test">Step 5 - Preview and test</h4>
<p>You can now click to edit the tag in the <strong>Template Preview</strong> window. When you've added some text, you can click the <strong>Test</strong> button to see what happens.</p>
<p>You can also choose to show a <strong>test page</strong> from the template menu:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/template-preview.jpg" title="Template preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/template-preview.jpg" layout="responsive" alt="Template preview" height="684" width="1095"></amp-img>
  
    </a>
  

<p>Test different things:</p>
<ul>
<li>
<p>Try with a random, non-URL string to see the warning about the missing <code>https://</code>.</p>
</li>
<li>
<p>Try with <code>https://</code> but with a hostname that doesn't contain <code>conductrics.com</code> to see the error for incorrect URL.</p>
</li>
<li>
<p>Try with <code>https://domain.conductrics.com/loader</code> to see the error for missing <code>apikey</code>.</p>
</li>
<li>
<p>Try with <code>https://domain.conductrics.com/loader?apikey=12345</code> to see the code pass with flying colors.</p>
</li>
<li>
<p>Try with and without the <strong>Debug</strong> checkbox checked, and see how this impacts what you see in the <strong>Console</strong>.</p>
</li>
</ul>


    <a href="https://www.simoahava.com/amp/images/2019/04/console-logging.jpg" title="Console output">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/console-logging.jpg" layout="responsive" alt="Console output" height="255" width="956"></amp-img>
  
    </a>
  

<p>If you already have a <a href="https://conductrics.com/contact/">Conductrics account</a>, you can test with a real deployment URL to see the success message in the console.</p>
<p>Finally, you can dig deep into the <code>iframe</code> of the <strong>Test page</strong> to find your script tag there.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/script-in-test-page.jpg" title="Script in the test page">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/script-in-test-page.jpg" layout="responsive" alt="Script in the test page" height="268" width="1113"></amp-img>
  
    </a>
  

<p>Once done testing to your satisfaction, you can do one final <strong>Save</strong> and then close the template editor - you are ready to create your first tag off of this template!</p>
<h4 id="step-6---create-tag-and-preview">Step 6 - Create tag and preview</h4>
<p>In the GTM UI, go to Tags and click <strong>New</strong>. In the overlay that opens, find your new template and click it.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/create-new-tag.jpg" title="Create new tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/create-new-tag.jpg" layout="responsive" alt="Create new tag" height="289" width="1017"></amp-img>
  
    </a>
  

<p>This screen should be familiar to you. The only difference to native templates in GTM is the <strong>Tag permissions</strong> bar. Click it to preview what permissions have been set for the template.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/permissions-in-the-template.jpg" title="Permissions in the template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/permissions-in-the-template.jpg" layout="responsive" alt="Permissions in the template" height="324" width="862"></amp-img>
  
    </a>
  

<p>Then, fill in the tag fields as you would with a regular template. For testing purposes, just set it to fire on the <strong>All Pages</strong> trigger.</p>
<p>You can try with invalid URLs to see the error messages. However, to test how the tag actually works, use a correct (but ultimately invalid) URL like <code>https://domain.conductrics.com/loader?apikey=12345</code>, and the tag should look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/first-conductrics-tag.jpg" title="First Conductrics tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/first-conductrics-tag.jpg" layout="responsive" alt="First Conductrics tag" height="583" width="1179"></amp-img>
  
    </a>
  

<p>Then, go the <strong>Preview mode</strong> and enter your site.</p>
<p>You should see the tag having fired, but in <strong>Failed</strong> state because the endpoint returned a <code>404</code> error.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/conductrics-failed.jpg" title="Conductrics failed">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/conductrics-failed.jpg" layout="responsive" alt="Conductrics failed" height="250" width="612"></amp-img>
  
    </a>
  

<p>Check out the <a href="https://kb.mailster.co/how-can-i-open-the-browsers-console/">JavaScript console</a>, too. You should see some relevant output there.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/javascript-console-output.jpg" title="JavaScript console output">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/javascript-console-output.jpg" layout="responsive" alt="JavaScript console output" height="151" width="627"></amp-img>
  
    </a>
  

<p>Finally, since we're <strong>injecting a script</strong>, you can drill into the page elements to find it in the <code>&lt;head&gt;</code> of the page.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/elements-panel.jpg" title="Elements panel">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/elements-panel.jpg" layout="responsive" alt="Elements panel" height="227" width="771"></amp-img>
  
    </a>
  

<h4 id="step-7---youre-done">Step 7 - You're done!</h4>
<p><strong>And that's it!</strong>. This was an extremely simple use case, and it might seem like a really complicated way to go about it. However, remember that you're providing controls for <strong>governance</strong> and <strong>responsible</strong> code injection here.</p>
<p>The use of <a href="#permissions">permissions</a>, <a href="#sandboxed-javascript">sandboxed JavaScript</a>, and, if you choose to use them, <a href="#policies-reference">policies</a> help you run a tight ship on what the custom tags can and can't do on the site.</p>
<p>The template itself does a simple script injection, but I hope I convinced you how powerful the UI editor can be, and we barely scratched the surface!</p>
<h3 id="variable-template-walkthrough">Variable template walkthrough</h3>
<p>Variable templates differ from tag templates in that they only have a singular purpose: to <strong>return</strong> a value. Optimally, they should <strong>not</strong> have any <em>side effects</em>, which include e.g. setting variables in the global scope, writing cookies, pushing to <code>dataLayer</code>, injecting scripts, or firing pixels.</p>
<p>In this example, we'll create a simple variable which is intended to work with the <a href="https://www.simoahava.com/amp/gtm-tips/hitcallback-eventcallback/"><code>hitCallback</code></a> field of your Google Analytics tags.</p>
<p>The idea is that the variable will return a function (<code>hitCallback</code> always requires a function as its value), which when executed will write a cookie into the browser. This cookie can then be used to check if less than 30 minutes (the default expiration) have passed since the last Google Analytics hit to GA, thus giving you a <em>very rough</em> estimate of whether a GA session is currently active.</p>
<p>So yes, we're breaking the &ldquo;no side effects&rdquo; rule I literally <em>just</em> mentioned, but this is a bit different. It's not an uncontrollable side effect, which it would be if it fired every single time the variable is called. Instead, the functionality is restricted to the <code>hitCallback</code> function, which is only executed <strong>once</strong>, when the Google Analytics request has been dispatched.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-variable.jpg" title="Session cookie variable">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-variable.jpg" layout="responsive" alt="Session cookie variable" height="916" width="1590"></amp-img>
  
    </a>
  

<p>Note, there are <a href="https://www.simoahava.com/amp/analytics/create-and-update-google-analytics-session-timeout-cookie/">more elegant ways</a> to handle this, but for the purposes of this guide I wanted to start off with something simple.</p>
<h4 id="step-1---create-and-set-the-details-of-the-variable-template">Step 1 - Create and set the details of the variable template</h4>
<p>Browse to <strong>Templates</strong>, and click <strong>New</strong> in the corner of the <strong>Variable Templates</strong> area.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-new-template.jpg" title="New variable template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-new-template.jpg" layout="responsive" alt="New variable template" height="530" width="2548"></amp-img>
  
    </a>
  

<p>In the view that opens, make sure the <strong>Info</strong> tab is selected, and add a <strong>Name</strong> and <strong>Description</strong> to the variable.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-description.jpg" title="Variable template details">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-description.jpg" layout="responsive" alt="Variable template details" height="624" width="1140"></amp-img>
  
    </a>
  

<p>As you can see, you can add HTML styling to the description field. The text I wrote was this:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">Use this variable to write (and update) a session cookie after each Google Analytics hit by using the <span class="p">&lt;</span><span class="nt">code</span><span class="p"></span><span class="p">&gt;</span>hitCallback<span class="p">&lt;</span><span class="p">/</span><span class="nt">code</span><span class="p">&gt;</span> field in the GA tags.</code></pre></div>
<p>Once done, click <strong>Save</strong> in the top right corner and you should see the <strong>Template Preview</strong> area show the new template name.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-preview.jpg" title="Variable template preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-preview.jpg" layout="responsive" alt="Variable template preview" height="414" width="1806"></amp-img>
  
    </a>
  

<p>Next, let's create the user interface for this template!</p>
<h4 id="step-2---create-the-ui-1">Step 2 - Create the UI</h4>
<p>Click over to the <strong>Fields</strong> tab in the template editor.</p>
<p>This template will comprise three <a href="#text-input">text input</a> fields. One for the cookie's <strong>maximum age</strong>, one for the <strong>cookie path</strong>, and one for the <strong>cookie domain</strong>.</p>
<p>Click the <strong>Add Field</strong> button, and choose the Text Input field from the overlay.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-text-input.jpg" title="Text input fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-text-input.jpg" layout="responsive" alt="Text input fields" height="424" width="3188"></amp-img>
  
    </a>
  

<p>Do this two more times, so that you end up with three text input fields.</p>
<p>Name the first field <code>maxAge</code>, the second <code>cookiePath</code>, and the third <code>cookieDomain</code>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-three-fields.jpg" title="Three text fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-three-fields.jpg" layout="responsive" alt="Three text fields" height="512" width="1310"></amp-img>
  
    </a>
  

<p>Expand the first field, <code>maxAge</code>, and click the <strong>cogwheel</strong> icon to open its field configurations. Toggle on <a href="#always-in-summary"><strong>Always in summary</strong></a>, <a href="#default-value"><strong>Default value</strong></a>, and <a href="#display-name"><strong>Display name</strong></a>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-max-age-configurations.jpg" title="Max Age configurations">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-max-age-configurations.jpg" layout="responsive" alt="Max Age configurations" height="894" width="3834"></amp-img>
  
    </a>
  

<p>Edit the <code>maxAge</code> settings to be like this:n</p>
<p><strong>Display name</strong>: Maximum age in seconds<br>
<strong>Default value</strong>: 1800<br>
<strong>Always in summary</strong>: Checked</p>
<p>The <strong>Display name</strong> is what appears above the field in the editor.</p>
<p>We'll use a <strong>Default value</strong> of <code>1800</code> seconds (that's 30 minutes), so if the user doesn't touch the field, that's the value that will be used.</p>
<p><strong>Always in summary</strong> means that the field contents will show up when the variable is opened in the UI but not in edit mode. It's a convenience thing, not vital in any way.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-max-age-ready.jpg" title="Max age ready">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-max-age-ready.jpg" layout="responsive" alt="Max age ready" height="570" width="1344"></amp-img>
  
    </a>
  

<p>Next, click the <strong>cogwheel</strong> for the <code>cookiePath</code> field, and toggle the same configurations on (<strong>Display name</strong>, <strong>Default value</strong>, and <strong>Always in summary</strong>).</p>
<p>Set them to these values:</p>
<p><strong>Display name</strong>: Cookie path<br>
<strong>Default value</strong>: /<br>
<strong>Always in summary</strong>: Checked</p>
<p>Finally, click the <strong>cogwheel</strong> for the <code>cookieDomain</code> field, and toggle the same conditions on, together with the <strong>Help text</strong> configuration.</p>
<p>Set them to these values:</p>
<p><strong>Display name</strong>: Cookie domain<br>
<strong>Help text</strong>: Set to &lsquo;auto&rsquo; to write the cookie on the highest possible domain name.<br>
<strong>Default value</strong>: auto<br>
<strong>Always in summary</strong>: Checked</p>
<p>The fields should look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-finished-fields.jpg" title="Session cookie finished fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-finished-fields.jpg" layout="responsive" alt="Session cookie finished fields" height="1710" width="1906"></amp-img>
  
    </a>
  

<p>The <a href="#help-text"><strong>Help text</strong></a> configuration is pretty cool. If you refresh the <strong>Template Preview</strong>, you'll see how there's a little question mark next to the <strong>Cookie domain</strong> field. By hovering over it, you'll see the help text.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/session-cookie-template-preview.jpg" title="Session cookie template preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/session-cookie-template-preview.jpg" layout="responsive" alt="Session cookie template preview" height="872" width="1352"></amp-img>
  
    </a>
  

<p>Now you're ready to add the code!</p>
<h4 id="step-3---add-some-code-1">Step 3 - Add some code</h4>
<p>Click the <strong>Code</strong> tab, and replace the contents with the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Require the necessary APIs
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">setCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="c1">// Build the options object from user input
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">domain</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cookieDomain</span><span class="p">,</span>
  <span class="s1">&#39;max-age&#39;</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">maxAge</span><span class="p">,</span>
  <span class="nx">path</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">path</span>
<span class="p">}</span><span class="p">;</span>

<span class="c1">// Return the hitCallback function
</span><span class="c1"></span><span class="k">return</span> <span class="p">(</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Set the cookie when the hit has been dispatched
</span><span class="c1"></span>  <span class="nx">setCookie</span><span class="p">(</span><span class="s1">&#39;_ga_session&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div>
<p>As you can see, it's a <strong>very</strong> simple variable. It uses a single API, <a href="https://developers.google.com/tag-manager/templates/api#setcookie"><code>setCookie</code></a> (for obvious reasons), and it has a <code>return</code> statement at the end, which returns a function wherever the variable is called.</p>
<p>If you read the <a href="https://developers.google.com/tag-manager/templates/api#setcookie"><code>setCookie</code> specification</a>, you can see that it takes three arguments.</p>
<p><code>setCookie(name, value, options)</code></p>
<p>To make things a bit easier, we're building the <code>options</code> object before calling the method. The object has three properties, <code>domain</code> for the domain name, <code>max-age</code> for the maximum age, and <code>path</code> for the cookie path.</p>
<p>The <code>setCookie</code> API has a nice feature where if you set the value of <code>domain</code> to <code>'auto'</code>, it automatically finds the highest possible (i.e. shortest) domain name it can use. Thus, if the variable is called on <code>sub.domain.simoahava.com</code>, the API writes it on <code>simoahava.com</code>.</p>
<p>As you can see, there are no validations or permission checks going on here. After reading this guide, you'll be able to extend the UI to do the validations directly on the fields, or you can also check the field values in code, falling back to some valid values in case the user input is not perfect.</p>
<p>Once you've added the code, make sure to <strong>save</strong> the template, and then click on over to the <strong>Permissions</strong> tab of the editor. You'll need to make sure the template has permissions to write the cookie.</p>
<h4 id="step-4---modify-permissions-1">Step 4 - Modify permissions</h4>
<p>In the <strong>Permissions</strong> tab, you should now see a permission for <a href="#sets-a-cookie-value">Sets A Cookie Value</a>. It's added automatically when you run <code>require('setCookie')</code> in the template code. Pretty sweet!</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/sets-a-cookie-value.jpg" title="Sets a cookie value">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/sets-a-cookie-value.jpg" layout="responsive" alt="Sets a cookie value" height="466" width="1522"></amp-img>
  
    </a>
  

<p>Expand the permission, and click the <strong>+ Add allowed cookie</strong> button. In the overlay that opens, configure the cookie as follows:</p>
<p><strong>Cookie name</strong>: _ga_session<br>
<strong>Domain</strong>: *<br>
<strong>Path</strong>: *<br>
<strong>Secure</strong>: Any<br>
<strong>Session</strong>: Any</p>
<p>Click <strong>Save</strong> in the overlay when done. This is what you should see in the permissions area:</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/cookie-permissions.jpg" title="Cookie permissions">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/cookie-permissions.jpg" layout="responsive" alt="Cookie permissions" height="400" width="1898"></amp-img>
  
    </a>
  

<p>You're done with the template! Remember to <strong>Save</strong> it one last time.</p>
<p>There's not much sense in previewing or testing it in the template editor itself. The variable returns a <strong>function</strong>, so the only logical place to test it is in an environment where the function is actually executed in context.</p>
<p>Thus, it's time to create a variable from the template and add it to a tag!</p>
<h4 id="step-5---create-variable-add-to-tag-and-preview">Step 5 - Create variable, add to tag, and preview</h4>
<p>Click to <strong>Variables</strong> in the GTM UI, and click <strong>New</strong> in the <strong>User-Defined Variables</strong> section.</p>
<p>In the variable type picker, choose your newly created template from the list.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/variable-picker.jpg" title="Variable picker">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/variable-picker.jpg" layout="responsive" alt="Variable picker" height="592" width="1346"></amp-img>
  
    </a>
  

<p>You can now configure the variable to your liking. The default settings are more than fine for most cases, though.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/hitcallback-session-cookie.jpg" title="Hitcallback session cookie">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/hitcallback-session-cookie.jpg" layout="responsive" alt="Hitcallback session cookie" height="1280" width="2094"></amp-img>
  
    </a>
  

<p>Next, find your Google Analytics Page View tag (or create one if you don't have it), check its <strong>Enable overriding settings in this tag</strong>, and browse to <strong>More Settings</strong> &gt; <strong>Fields to Set</strong>. Click <strong>+Add Field</strong>.</p>
<p>Set the <strong>Field Name</strong> to <code>hitCallback</code>, and <strong>Value</strong> to the variable you just created.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/hitcallback-in-tag.jpg" title="Hitcallback in tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/hitcallback-in-tag.jpg" layout="responsive" alt="Hitcallback in tag" height="990" width="1850"></amp-img>
  
    </a>
  

<p>Save the tag, and go to <strong>Preview mode</strong>. Then, load the page where the Page View tag will fire.</p>
<p>If all goes as planned, you should now find a new browser cookie named <code>_ga_session</code>, with an expiration set to the number of seconds you set in the <strong>Maximum age in seconds</strong> field. Easiest way to find your browser cookies is to use the developer tools of your browser.</p>
<p>In Chrome, press <strong>CMD + OPT + I</strong> (Mac) or <strong>CTRL + SHIFT + I</strong> (Win/Linux) to open the developer tools. Then, activate the <strong>Application</strong> tab, and select the <strong>Cookies</strong> option for your domain. You should see the <code>_ga_session</code> cookie with value <code>true</code>, and an expiration in the future (or in the past if you set its maximum age to <code>0</code>).</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/ga-session-cookie-dev-tools.jpg" title="GA Session cookie">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/ga-session-cookie-dev-tools.jpg" layout="responsive" alt="GA Session cookie" height="616" width="2564"></amp-img>
  
    </a>
  

<p>If you see the cookie then congratulations, your variable template works as intended!</p>
<h4 id="step-7---youre-done-1">Step 7 - Youâ€™re done!</h4>
<p>The purpose of this guide was to walk you through the steps how to create a variable template.</p>
<p>Yes, we used an extremely simple example, but the idea was to get familiarized with the <em>routine</em> of template creation, rather than jump in the deep end with all the APIs, field configurations, and permissions available.</p>
<p>The main difference to tag templates is that the variable needs to <strong>return</strong> something. Whatever happens before that final <code>return</code> statement is up to you, but you might want to avoid too many side effects unless you are absolutely certain they are only invoked in a specific, predictable context (such as <code>hitCallback</code>).</p>
<p>That's it for the tutorial part! Now it's time to explore with more detail what custom templates are, how they work, and how they are such a game-changer for tag management with GTM.</p>
<p>But first, take a break. You've earned it.</p>
<h2 id="core-concepts">Core concepts</h2>
<p>Welcome back!</p>
<p>Before we get to the good stuff, let me go over some of the <strong>core concepts</strong> of Custom Templates. These concepts will emerge and re-emerge in much of the discussion below, and they are fundamental to understanding what Custom Templates are and what they can do.</p>
<h3 id="sandboxed-javascript">Sandboxed JavaScript</h3>
<p>Custom Templates are written with <strong>JavaScript</strong>. If you are unfamiliar with the language but still aching to start working with templates, I recommend taking a look at some <a href="https://www.simoahava.com/amp/analytics/10-javascript-concepts-for-web-analytics-implementation/#get-the-basics-right">learning materials</a> before trying your hand with the template code. Check out these (free) learning portals, too:</p>
<ul>
<li>
<p><a href="https://www.freecodecamp.org">freeCodeCamp</a> - Excellent and comprehensive JavaScript and web technology tracks that span everything from the very basics to creating stateful web services.</p>
</li>
<li>
<p><a href="https://www.codecademy.com">Codecademy</a> - Great tracks for all sorts of programming languages and disciplines offered in a nice, interactive way.</p>
</li>
</ul>
<p>A further complication is that Custom Templates don't actually use just any old browser JavaScript. They use a special, <a href="https://developers.google.com/tag-manager/templates/sandboxed-javascript"><strong>sandboxed</strong> version</a> of the JavaScript language.</p>
<p>Basically, any code you write in the code editor will be automatically wrapped in a function that provides a single argument named <code>data</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Start of code editor code
</span><span class="c1"></span>
  <span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">copyFromWindow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copyFromWindow&#39;</span><span class="p">)</span><span class="p">;</span>

  <span class="kr">const</span> <span class="nx">ga</span> <span class="o">=</span> <span class="nx">copyFromWindow</span><span class="p">(</span><span class="s1">&#39;GoogleAnalyticsObject&#39;</span><span class="p">)</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ga</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Google Analytics not loaded!&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">userInputText</span><span class="p">)</span><span class="p">;</span>

  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>

  <span class="c1">// End of code editor code
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<p>The <code>data</code> object is really important. Each field in the template will be accessible as a property of the <code>data</code> object, and the value of that property will be the result of the user's interaction with the field. The <code>data</code> object also has the <code>gtmOnSuccess()</code> and <code>gtmOnFailure()</code> methods you must use to signal the tag's successful completion or its failure. Variable completion is signalled by a <code>return</code> statement.</p>
<p>In addition to being automatically wrapped as a function body, the set of JavaScript methods and accessors available to you is limited. Basically, you will have no access to the global <code>window</code> object. This includes things like <code>location</code>, <code>document</code> (and <code>document.cookie</code>), <code>console</code>, and any constructors (such as <code>new Date()</code>.</p>
<p>To access these global methods and properties, you'll need to use the <strong>template APIs</strong> exposed by the template editor.</p>
<h3 id="es6-syntax">ES6+ syntax</h3>
<p>ES6 (ECMAScript 6) is one of the most significant updates the JavaScript standard, originally released in 2015, with prominent support in all the major browsers. The code editor in GTM's templates supports <strong>some</strong> ES6 features. These features include:</p>
<ul>
<li>
<p><a href="https://medium.com/front-end-weekly/es6-cool-stuffs-var-let-and-const-in-depth-24512e593268"><strong><code>const</code> and <code>let</code> keywords</strong></a>. These two keywords are offered as alternatives to JavaScript's <code>var</code> keyword. The main difference is that <code>const</code> and <code>let</code> have <strong>block-level scope</strong>, meaning they are scoped to the context of the wrapping <code>{</code> and <code>}</code>, rather than the whole surrounding function context as with <code>var</code>. Furthermore, there's no <a href="https://www.w3schools.com/js/js_hoisting.asp">variable hoisting</a> - <code>const</code> and <code>let</code> variables cannot be referenced before their declaration. Finally, <code>const</code> variables cannot be reassigned.</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions"><strong>Arrow functions</strong></a>. Arrow functions are a new way to write JavaScript function expressions. It's syntactically more compact, so pursuers of &ldquo;elegant code&rdquo; rejoice. For example, <code>var multiplyByTwo = function(a) { return a*2; };</code> becomes <code>const multiplyByTwo = a =&gt; a*2;</code>. Unlike &ldquo;regular&rdquo; JavaScript functions, there's no <code>this</code> binding and no access to the <code>arguments</code> object.</p>
</li>
</ul>
<p>You are of course free to use the &ldquo;old&rdquo; style of JavaScript. In the templates&rsquo; code editor, I will try to adhere to ES6 syntax purely out of habit, but also because using <code>const</code> and <code>let</code> actually has some functional weight in the code, too.</p>
<h3 id="restrictions-to-what-type-of-data-you-can-handle">Restrictions to what type of data you can handle</h3>
<p>To prevent users from circumventing template permissions and from running code that breaks through the templates&rsquo; sandbox, Google Tag Manager has a number of suppression mechanisms built in.</p>
<ol>
<li>
<p><strong>You can't access <code>window</code> or <code>document</code> directly</strong>. Access to the global namespace is restricted to <a href="#template-apis">template APIs</a>. Even if you tried something clever such as returning <code>window.setTimeout</code> in a JavaScript variable, so that it's <em>technically</em> not in the code editor itself, the template editor automatically parses all variables and user-based input brought into the template before it is made accessible to the code editor.</p>
</li>
<li>
<p><strong>You can't pass non-plain objects</strong>, such as instances created with construtors, to the template code. It's difficult to contain security of these, because the prototype chain can be manipulated by code outside the template, making the template itself vulnerable and less secure. This basically means that things like <a href="https://www.simoahava.com/amp/analytics/customtask-the-guide/"><code>customTask</code></a> will not be possible to do with variable templates for now, because it requires access to a constructed, non-plain <code>model</code> object to function.</p>
</li>
<li>
<p><strong>You can't access DOM elements</strong>. This is kind of the same as (2), because a DOM element represents a complex, non-plain object type. Nevertheless, it means that you can't access things like <code>{{Click Element}}</code> in template code.</p>
</li>
</ol>


    <a href="https://www.simoahava.com/amp/images/2019/05/template-restrictions.jpg" title="Template restrictions">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/05/template-restrictions.jpg" layout="responsive" alt="Template restrictions" height="351" width="957"></amp-img>
  
    </a>
  

<p>In time, I'm certain the proliferation of APIs in the template will solve many of the restrictions above, but first and foremost the point of templates is to add a layer of security to prevent scripts outside the template from messing with the code within.</p>
<p>Another one of the idiosyncracies of the templates&rsquo; sandboxed JavaScript is how function expressions exposed outside the template code are encapsulated in a <strong>wrapper</strong> by GTM.</p>
<p>The purpose of this wrapper is to make sure functions set in the window or returned by the variable template can't be used to circumvent permissions set in the template.</p>
<p>The wrapper itself is <strong>almost always</strong> inconsequential, because it passes the parameters collected by the wrapper to the function created in or handled by the template. However, if any one of the parameters violates the restrictions listed above, the parameter is suppressed and replaced with <code>undefined</code>.</p>
<h3 id="template-apis">Template APIs</h3>
<p>The most common global properties and methods you'll need to use are abstracted behind custom <strong>APIs</strong>. We've covered a number of API examples in the preceding chapters. For example, there's <code>logToConsole</code> for logging items to the JavaScript console of the browser, and there's <code>copyFromWindow</code> for accessing global variables defined in the <code>window</code> object.</p>
<p>Each API comes with its own configurable set of permissions. The <code>copyFromWindow</code> API, for example, requires that you define the global keys the code has access to. As soon as you type the <code>require('copyFromWindow')</code> statement and refresh the template, the <strong>Accesses Global Variables</strong> permissions will become available in the respective tab.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/copyfromwindow-permissions.jpg" title="Accesses global variables">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/copyfromwindow-permissions.jpg" layout="responsive" alt="Accesses global variables" height="304" width="962"></amp-img>
  
    </a>
  

<p>As you can see, for these particular permissions you can define the keys and whether the code has read and/or write and/or execution permissions for them. You might have guessed now that <strong>Access Global Variables</strong> is not limited to just <code>copyFromWindow</code> (which is read-only), but also determines the usefulness of e.g. <code>setInWindow</code> (for writing/setting global variables) and <code>callInWindow</code> (for calling global methods).</p>
<p>The purpose of this sandboxed JavaScript is to give you a <strong>safe and secure</strong> JavaScript environment to write and run your code in. The interplay between your code and the permissions model is designed to produce code that is as conservative as possible without compromising the runtime logic of what you want to do with the code.</p>
<p>This doesn't mean that you can't cause havoc with your custom template - quite the contrary. However, the user interface guides you to make the correct choices when choosing the APIs and the permissions thereof. Hopefully the guide you are currently reading will further help you understand how to make your code run in the most efficient and responsible way possible.</p>
<h3 id="policies">Policies</h3>
<p>The counterpart of permissions are <strong>policies</strong>. Policies give the site owner the ability to block potentially hazardous code from running. It's somewhat similar to Google Tag Manager's <a href="https://developers.google.com/tag-manager/devguide#restrict">whitelist/blacklist</a> feature, except with policies you have extremely granular access to how individual permissions are handled.</p>
<p>Policies are basically <code>dataLayer</code> commands which specify what happens when a Custom Template for which some permissions have been set tries to execute on the page.</p>
<p>If you don't define any policies then the tag or variable will run its course unimpeded.</p>
<p>However, you can create a policy which is invoked whenever some specific permission is accessed by the template. Let me show you an example:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">getCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="nx">log</span><span class="p">(</span><span class="nx">getCookie</span><span class="p">(</span><span class="s1">&#39;_user_id&#39;</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
<span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>The template code above uses the <code>getCookieValues</code> API to log the value of a cookie named <code>_user_id</code>. When you save that code, a new permission appears in the editor, and you need to whitelist the cookie names the code is allowed to access:</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/whitelist-cookie-values.jpg" title="Whitelisted cookie values">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/whitelist-cookie-values.jpg" layout="responsive" alt="Whitelisted cookie values" height="178" width="610"></amp-img>
  
    </a>
  

<p>Now, if you didn't specify a policy, the code would always log the cookie value into the console when the tag runs, because the <code>_user_id</code> cookie has been whitelisted in the tag permissions.</p>
<p>However, let's say the page has the following code in the HTML:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[</span><span class="p">]</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">gtag</span><span class="p">(</span><span class="p">)</span><span class="p">{</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>

<span class="nx">gtag</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="s1">&#39;get_cookies&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;_user_id&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;You are not allowed to query _user_id on this page!&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p>Don't be confused by the <code>gtag()</code> command - policies use the <code>gtag()</code> method, which is essentially a helper to push the arguments into <code>dataLayer</code>. You do <strong>not</strong> need to download the gtag.js library to be able to run policies on the site template.</p>
</blockquote>
<p>Now when the tag is run and the <code>getCookie('_user_id')</code> code is executed, the policy you created will activate. This policy checks if the requested cookie was named <code>_user_id</code>, and reacts by throwing an error. Perhaps the developers have deemed it too risky to allow GTM to query the <code>_user_id</code> cookie like this.</p>
<p>You don't <strong>need</strong> policies to work with Google Tag Manager's Custom Templates. However, given how popular Custom Templates are likely to become, I do expect to see more and more policies defined, too.</p>
<p>Be sure to check out the <a href="#policy-reference">policy reference</a> at the end of this guide for more details on how individual policies should be set.</p>
<h3 id="tests">Tests</h3>
<p><strong>Tests</strong> allow you to write <em>unit tests</em> for your template code directly in the editor. The <strong>tests</strong> feature comprises a number of APIs you can use to, for example, mock the data object and write assertions against the compiled and executed template code.</p>


    <a href="https://www.simoahava.com/amp/images/2019/11/template-test-example.jpg" title="Tests">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/11/template-test-example.jpg" layout="responsive" alt="Tests" height="288" width="611"></amp-img>
  
    </a>
  

<p>For more information about how to write and run tests with custom templates, see this guide:</p>
<p><a href="https://www.simoahava.com/amp/analytics/writing-tests-for-custom-templates-google-tag-manager/">Writing Tests For Custom Templates In Google Tag Manager</a></p>
<h2 id="official-documentation">Official documentation</h2>
<p>When working with <strong>Custom Templates</strong>, you should have two documents at hand:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api"><strong>Custom template APIs reference</strong></a> - This document introduces the various APIs you'll need to use if you want your code to run beyond the boundaries of the sandbox.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/permissions"><strong>Custom template permissions reference</strong></a> - This reference lists the permissions the APIs require, and which are used to create <strong>policies</strong> with which web pages can deploy an additional layer of governance for running custom templates.</p>
</li>
</ul>
<p>Keep those documents open when working with Custom Templates. I won't repeat their contents in this guide, but I do refer to them where necessary.</p>
<h2 id="the-editor">The editor</h2>
<p>Let's jump right in! To start creating a new template, click the <strong>Templates</strong> menu option.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/templates-menu.jpg" title="Templates in the menu">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/templates-menu.jpg" layout="responsive" alt="Templates in the menu" height="968" width="1406"></amp-img>
  
    </a>
  

<p>Next, click <strong>New</strong> in the right corner of the <strong>Tag Templates</strong> card.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/tag-templates-new.jpg" title="Tag templates new">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/tag-templates-new.jpg" layout="responsive" alt="Tag templates new" height="218" width="1986"></amp-img>
  
    </a>
  

<p>What you see now is the <strong>template</strong> editor. There are several views and menus here, so let's start with a quick overview.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/editor-overview.jpg" title="Editor overview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/editor-overview.jpg" layout="responsive" alt="Editor overview" height="1242" width="3838"></amp-img>
  
    </a>
  

<p><strong>1</strong> - The main navigation of the editor. If you have <strong>Show advanced settings</strong> checked in the editor menu, you'll also see the <strong>Notes</strong> tab here.</p>
<p><strong>2</strong> - The editor view for the selected tab. If you have <strong>Show advanced settings</strong> checked in the editor menu, you might see extra options here.</p>
<p><strong>3</strong> - Template Preview shows what the template will look like when saved. If you've made changes to the template, you'll see a <strong>Refresh</strong> link here, which will update the preview when clicked.</p>
<p><strong>4</strong> - The Console will log information about template performance when you <strong>Test</strong> the template. Additionally, any calls to the <code>logging</code> API will be output here, too.</p>
<p>If you select <strong>Show Test Page</strong> from the editor menu, you'll see the <strong>Test Page</strong> window between the Template Preview and Console.</p>
<p><strong>5</strong> - Click Test to execute the template code with the settings you have entered in the preview. If you've chosen <strong>Show Test Page</strong> from the editor menu, then any code that modifies the page will impact what the Test Page shows.</p>
<p><strong>6</strong> - Save the template. The template cannot be saved if the code has syntax errors or invalid JavaScript. You need to fix the errors before saving. Note that the template can be saved even if you have incorrect permissions for the APIs you use.</p>
<p><strong>7</strong> - The editor menu. The editor menu has options for managing the template and for customizing the editor.</p>
<p>The editor for <strong>tag templates</strong> and <strong>variable templates</strong> is largely the same. The main difference is the absence of an icon/logo selector in the <a href="#info-view">info view</a> and how the code editor is utilized. With tags, the code editor needs <code>data.gtmOnSuccess()</code> for successful execution and <code>data.gtmOnFailure()</code> (if necessary) for a failure. Variables, on the other hand, don't use this. You just need a <code>return</code> statement that returns whatever the variable is supposed to return.</p>
<h3 id="info-view">Info view</h3>
<p>The <strong>Info view</strong> is where you'll customize what the template looks like. Verbosity is not a sin - try to be as clear and descriptive in the template name and description as possible.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/info-view.jpg" title="Info view">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/info-view.jpg" layout="responsive" alt="Info view" height="908" width="2002"></amp-img>
  
    </a>
  

<p>The <strong>Name</strong> of the template is what appears in the tag/variable selection menu as well as in the template itself when you create a new instance from it.</p>
<p>The <strong>Description</strong> will appear in the tag/variable selection menu below the template name.</p>
<p>Tag templates allow you to choose an <strong>image</strong> for the template. This image will appear in the tag selection menu and the template itself.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/tag-template-menu.jpg" title="Tag template menu">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/tag-template-menu.jpg" layout="responsive" alt="Tag template menu" height="500" width="1382"></amp-img>
  
    </a>
  

<p>At the bottom of the Info view is the checkbox for approving the terms of service for the <strong>Community Template Gallery</strong>. You only need to check this if you want to submit your template to the <a href="https://tagmanager.google.com/gallery/">gallery</a>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/10/terms-of-service-template.jpg" title="TOS template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/10/terms-of-service-template.jpg" layout="responsive" alt="TOS template" height="932" width="1142"></amp-img>
  
    </a>
  

<p>If you have <strong>Show advanced settings</strong> selected, you'll also see the template <strong>version</strong> as well as the <strong>contexts</strong> in which the template works.</p>
<p>You'll also see a <strong>Source</strong> toggle in the top of the view. By clicking the toggle, you'll see the JSON representation of the template info, which you can edit (if you want to change the context, for example).</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/source-toggle-info.jpg" title="Source toggle for info">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/source-toggle-info.jpg" layout="responsive" alt="Source toggle for info" height="630" width="1912"></amp-img>
  
    </a>
  

<h3 id="fields-editor">Fields editor</h3>
<p>The <strong>Fields editor</strong> is where you'll spend a lot of your time. You use this editor to establish what the tag or variable user interface will look like, and how individual fields interact with each other.</p>
<p>For each field you create, you need to specify (at least) a name with which you can refer to the field value in the code editor. The field name must be <strong>unique</strong>, since all fields (even those nested within other fields) will be directly accessible using the field name as a property of the <code>data</code> object. For example, to access the value of a field whose name is <code>gaTrackingId</code>, you'd use this in the code editor:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">gaTrackingId</span><span class="p">;</span>
<span class="nx">log</span><span class="p">(</span><span class="nx">ua</span><span class="p">)</span><span class="p">;</span> <span class="c1">// logs UA-12345-1 or whatever the user set the value of the field to.
</span></code></pre></div>
<p>Furthermore, each field has a <strong>field configuration</strong> that you'll use to establish how the field functions in the user interface of the template itself.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/field-editor.jpg" title="Field editor view">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/field-editor.jpg" layout="responsive" alt="Field editor view" height="564" width="1908"></amp-img>
  
    </a>
  

<p>Below the <strong>field name</strong> are the options and settings for the field. You'll see more of these as you add additional <strong>configurations</strong>.</p>
<p>In the top right corner of each field row you'll see a <strong>trash can</strong> for deleting the field.</p>
<p>There's also a <strong>cogwheel</strong> which opens the <strong>field configuration</strong> options.</p>
<p>The <strong>more options</strong> menu opens options for manipulating the positioning of the field (see screenshot above), and the <strong>caret</strong> at the very right lets you collapse and expand the field in the editor.</p>
<p>If you have <strong>Show advanced settings</strong> enabled, you can toggle the <strong>Source</strong> toggle in the top corner of the view to see a JSON representation of the fields.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/source-toggle-fields.jpg" title="Source toggle for fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/source-toggle-fields.jpg" layout="responsive" alt="Source toggle for fields" height="592" width="1922"></amp-img>
  
    </a>
  

<h4 id="field-configuration">Field configuration</h4>
<p>Whenever you add a field in the editor, you have the option of configuring field-specific rules and settings by clicking the <strong>cogwheel</strong> icon next to the field.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/field-configuration-intro.jpg" title="Field configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/field-configuration-intro.jpg" layout="responsive" alt="Field configuration" height="242" width="1904"></amp-img>
  
    </a>
  

<p>Depending on the field you opened the configuration for, you'll see a set of toggles that you can toggle on or off. Some toggles are on by default, again depending on the field you are configuring.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/text-input-configuration.jpg" title="Text input configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/text-input-configuration.jpg" layout="responsive" alt="Text input configuration" height="890" width="1960"></amp-img>
  
    </a>
  

<p>As you read through the field descriptions below, I've added the configuration options for each field. Furthermore, at the end of this guide there's a <a href="#field-configuration-reference">field configuration reference</a> which lists all the possible configuration options in more detail.</p>
<p>Note that some fields can be <strong>nested</strong>, and some fields actually include nested fields by default (e.g. the <a href="#param-table">Param table</a> field). In these cases, the nested fields are treated as their own fields with their own configurations. The only difference between an isolated and nested field is that the latter is subservient to the field configurations of its parent. For example, if the parent is disabled due to enabling conditions not validating, the nested fields will be disabled, too.</p>
<h4 id="text-input">Text input</h4>
<h5 id="description">Description</h5>
<p>The <strong>Text input</strong> field is a simple input box to which the user can write text.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/text-input-1.jpg" title="Text input field in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/text-input-1.jpg" layout="responsive" alt="Text input field in the editor" height="306" width="1906"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/text-input-2.jpg" title="Text input field in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/text-input-2.jpg" layout="responsive" alt="Text input field in the UI" height="18" width="608"></amp-img>
  
    </a>
  

<h5 id="code-editor-output">Code editor output</h5>
<p>The property <code>data.fieldName</code> will resolve to whatever the user typed in the field, or whatever a GTM variable used in the field resolves to.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Using the example from the screenshot above
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">textFieldValue</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">textToWriteToConsole</span><span class="p">;</span>
</code></pre></div>
<h5 id="available-field-configurations">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#allow-empty-strings">Allow empty strings</a> - Convert and unfilled field into an empty string. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-line-count">Display line count</a> - Line count of greater than 1 turns the field into a text area. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#text-as-list">Text as list</a> - When the text field is a text area (see <strong>Display line count</strong> above), store the value of the field as an array, where each item represents a row of input. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
<li><a href="#value-hint">Value hint</a> - Text shown as a placeholder help text in the field before the user starts editing it. OFF by default.</li>
<li><a href="#value-unit">Value unit</a> - Text shown next to the field. Useful to specify a format or type, for example. OFF by default.</li>
</ul>
<h4 id="drop-down-menu">Drop-down menu</h4>
<h5 id="description-1">Description</h5>
<p>The <strong>Drop-down menu</strong> field provides a menu where only <strong>a single item can be selected</strong>. It's often a combination of predefined items (such as <code>True</code> and <code>False</code>), and all the Google Tag Manager variables in the container.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/dropdown-menu-1.jpg" title="Drop-down menu in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/dropdown-menu-1.jpg" layout="responsive" alt="Drop-down menu in the editor" height="748" width="1812"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/drop-down-menu-2.jpg" title="Drop-down menu in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/drop-down-menu-2.jpg" layout="responsive" alt="Drop-down menu in the UI" height="496" width="1170"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-1">Code editor output</h5>
<p>The <code>data.fieldName</code> property will resolve to the value of the item selected from the drop-down menu. If the item was one of those you defined in the template editor, then what you wrote in the Value field is what the property resolves to. If the user selected a GTM variable, then the value returned by that variable is what the property resolves to.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">dropDownFieldValue</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">dropDownMenu1</span><span class="p">;</span>
<span class="nx">log</span><span class="p">(</span><span class="nx">dropDownFieldValue</span><span class="p">)</span><span class="p">;</span> <span class="c1">// logs true if an item whose Value is true is selected.
</span></code></pre></div>
<h5 id="available-field-configurations-1">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#not-set-option">&ldquo;Not set&rdquo; option</a> - Show a placeholder value in the menu before the user has selected anything. If menu is left untouched, the field returns an empty string. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#include-variables">Include variables</a> -Â Check this box if you want to include all GTM variables in the drop-down menu. <strong>ON by default</strong>.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
<li><a href="#value-unit">Value unit</a> - Text shown next to the field. Useful to specify a format or type, for example. OFF by default.</li>
</ul>
<h4 id="checkbox">Checkbox</h4>
<h5 id="description-2">Description</h5>
<p>The <strong>Checkbox</strong> field should be self-explanatory. The checkbox doesn't have a display name by default. Instead, text you type in the <strong>Checkbox text</strong> field will be shown next to the box in the UI.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/checkbox-1.jpg" title="Checkbox in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/checkbox-1.jpg" layout="responsive" alt="Checkbox in the editor" height="304" width="1146"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/checkbox-2.jpg" title="Checkbox in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/checkbox-2.jpg" layout="responsive" alt="Checkbox in the UI" height="208" width="734"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-2">Code editor output</h5>
<p>The <code>data.fieldName</code> property resolves to <code>true</code> if the checkbox was checked and <code>false</code> if not.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">checkBoxValue</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">useDataLayer</span><span class="p">;</span>
<span class="nx">log</span><span class="p">(</span><span class="nx">checkBoxValue</span><span class="p">)</span><span class="p">;</span> <span class="c1">// true
</span></code></pre></div>
<h5 id="available-field-configurations-2">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. OFF by default.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="radio-buttons">Radio buttons</h4>
<h5 id="description-3">Description</h5>
<p>You can add one or more radio buttons into a single radio button group. The radio button group is treated as a single field. Each radio button has a name (displayed next to the button) and a value (what is returned if the button is selected). The user can only select one button from the group. You can expand <strong>advanced settings</strong> to add a help text and to add nested fields under each radio button selection.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/radio-buttons-1.jpg" title="Radio buttons in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/radio-buttons-1.jpg" layout="responsive" alt="Radio buttons in the editor" height="1158" width="1736"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/radio-buttons-2.jpg" title="Radio buttons in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/radio-buttons-2.jpg" layout="responsive" alt="Radio buttons in the UI" height="390" width="784"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-3">Code editor output</h5>
<p>The <code>data.fieldName</code> property, where <code>fieldName</code> is the name of the entire radio button group, will resolve to the value of the selected radio button.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">selectedButton</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">gaEventType</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">selectedButton</span> <span class="o">===</span> <span class="s1">&#39;pageView&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">gaId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">trackingId</span><span class="p">;</span>
  <span class="c1">// Do something with gaId
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h5 id="available-field-configurations-3">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#nested-fields">Nested fields</a> - Nested fields are useful if you want to show fields related to a specific value of the parent field only under certain conditions, for example. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="simple-table">Simple table</h4>
<h5 id="description-4">Description</h5>
<p>With a <strong>simple table</strong>, you can define columns (either <a href="#text-input">text input</a> fields or <a href="#drop-down-menu">drop-down menus</a>), and the users can add and remove rows to and from the table as they wish.</p>
<p>You can specify that all values in a column must be unique (i.e. the user can't add multiple rows with the same value in such a column), and you can add things like default values and validation rules to each column, once you have selected to <strong>Show advanced settings</strong> for the column.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/simple-table-1.jpg" title="Simple table in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/simple-table-1.jpg" layout="responsive" alt="Simple table in the editor" height="1368" width="1876"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/simple-table-2.jpg" title="Simple table in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/simple-table-2.jpg" layout="responsive" alt="Simple table in the UI" height="348" width="1776"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-4">Code editor output</h5>
<p>The <code>data.fieldName</code> property will resolve to an array of objects, where each object represents a row the user has added in the UI. Furthermore, each row object will have key-value pairs for every column, where the key is the column name and the value is the value of the input (the selection value if a drop-down menu or the input text if a text field).</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cookieSettings</span><span class="p">)</span><span class="p">;</span> 
<span class="cm">/* Logs:
</span><span class="cm">[
</span><span class="cm">  {&#34;cookieOption&#34;:&#34;cookieDomain&#34;,&#34;optionValue&#34;:&#34;simoahava.com&#34;},
</span><span class="cm">  {&#34;cookieOption&#34;:&#34;cookieName&#34;,&#34;optionValue&#34;:&#34;myCookie&#34;}
</span><span class="cm">]
</span><span class="cm">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-4">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#new-row-button-text">&ldquo;New row&rdquo; button text</a> - Change the value of the &ldquo;Add row&rdquo; button text. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="param-table">Param table</h4>
<h5 id="description-5">Description</h5>
<p>A <strong>Param table</strong> is a more complicated table. Instead of being able to edit individual column values in the table itself, a param table requires you to input all the values of the row in a special overlay menu that pops up when you click to add a row. The individual columns can be any of the supported field types, and thus you can add far more complexity into the table than you could with a regular <a href="#simple-table">simple table</a> field.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/param-table-1.jpg" title="Param table in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/param-table-1.jpg" layout="responsive" alt="Param table in the editor" height="1634" width="1876"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/param-table-2.jpg" title="Param table in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/param-table-2.jpg" layout="responsive" alt="Param table in the UI" height="1864" width="1010"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-5">Code editor output</h5>
<p>Similar to the <a href="#simple-table">simple table</a>, the <code>data.fieldName</code> property resolves to an array of objects, where each object represents a row in the table. Each row object has key-value pairs for each column, and the value is whatever the column field returns. For example, the screenshot above would render as:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">userSelection</span><span class="p">)</span><span class="p">;</span>
<span class="cm">/* Logs:
</span><span class="cm">[
</span><span class="cm">  {&#34;genderSelect&#34;: &#34;male&#34;, &#34;nameInput&#34;: &#34;Simo Ahava&#34;},
</span><span class="cm">  {&#34;genderSelect&#34;: &#34;female&#34;, &#34;nameInput&#34;: &#34;Simona Ahava&#34;}
</span><span class="cm">]
</span><span class="cm">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-5">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#edit-row-dialog-title">&ldquo;Edit row&rdquo; dialog title</a> - You can change what the heading of the &ldquo;Edit row&rdquo; overlay is. OFF by default.</li>
<li><a href="#new-row-button-text">&ldquo;New row&rdquo; button text</a> - Change the value of the &ldquo;Add row&rdquo; button text. OFF by default.</li>
<li><a href="#new-row-dialog-title">&ldquo;New row&rdquo; dialog title</a> - You can change what the heading text is in the overlay you see when adding a new row. OFF by default.</li>
<li><a href="#always-in-summary">Always in summary</a> - Show the field and its current value in the summary view of the tag or variable. OFF by default.</li>
<li><a href="#clear-on-copy">Clear on copy</a> - Prevent filled field values from being copied when a copy is made of the tag or variable. OFF by default.</li>
<li><a href="#default-value">Default value</a> - The value of the field until the user decides to change it. OFF by default.</li>
<li><a href="#display-message-when-not-set">Display message when not set</a> - When the field is untouched, show this text in the summary view. OFF by default.</li>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
<li><a href="#validation-rules">Validation rules</a>- One or more rules against which the field must validate before the user can save the tag or variable. OFF by default.</li>
</ul>
<h4 id="group">Group</h4>
<h5 id="description-6">Description</h5>
<p>A <strong>Group</strong> is simply a logical way to group different fields together. The main benefit is that it offers you a <strong>Group style</strong> selection.</p>
<ul>
<li>
<p><strong>Simple section</strong> - This style simply shows the nested fields in the group without any collapsing.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Open</strong> - This style shows the nested fields in a collapsible section which is open initially.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Closed</strong> - This style shows the nested fields in a collapsible section which is collapsed initially.</p>
</li>
<li>
<p><strong>Collapsible section &ndash; Open if not default</strong> - This style shows the nested fields in a collapsible section which is open if the nested field(s) don't have default values (i.e. the user has changed the value of the fields).</p>
</li>
</ul>
<p>A Group is useful if you want to section a set of fields separately, because you can also control the entire groups visibility with the <strong>Enabling condition</strong> field configuration.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/more-settings-1.jpg" title="Collapsible group in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/more-settings-1.jpg" layout="responsive" alt="Collapsible group in the editor" height="854" width="1896"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/more-settings-2.jpg" title="Collapsible group in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/more-settings-2.jpg" layout="responsive" alt="Collapsible group in the UI" height="568" width="1778"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-6">Code editor output</h5>
<p>The <strong>Group</strong> doesn't bring anything extra to the code editor. The nested fields are accessed directly as properties of the <code>data</code> object - the group itself is not present in the object in any way.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="p">;</span>
<span class="cm">/* Logs:
</span><span class="cm">[
</span><span class="cm">  {&#34;cookieSettings&#34;: [{&#34;cookieOption&#34;: &#34;cookieDomain&#34;, &#34;optionValue&#34;: &#34;auto&#34;}]},
</span><span class="cm">  {&#34;trackerName&#34;: &#34;_ga_tracker&#34;}
</span><span class="cm">]
</span><span class="cm">*/</span>
</code></pre></div>
<h5 id="available-field-configurations-6">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
<li><a href="#group-style">Group style</a> - How the group section is rendered in the GTM UI (simple vs. collapsed vs. open). <strong>ON by default</strong>.</li>
<li><a href="#help-text">Help text</a> - Add text to a question mark tooltip shown next to the field. OFF by default.</li>
</ul>
<h4 id="label">Label</h4>
<h5 id="description-7">Description</h5>
<p>The <strong>Label</strong> field is extremely simple. It's just text that you show in the GTM UI when the instance is opened. The <strong>Display name</strong> configuration determines the text that is shown. Additionally, a Label field has only one other configuration: an <strong>Enabling condition</strong> which you can use to conditionally show the text.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/label-1.jpg" title="Label in the editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/label-1.jpg" layout="responsive" alt="Label in the editor" height="528" width="1844"></amp-img>
  
    </a>
  



    <a href="https://www.simoahava.com/amp/images/2019/01/label-2.jpg" title="Label in the UI">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/label-2.jpg" layout="responsive" alt="Label in the UI" height="116" width="308"></amp-img>
  
    </a>
  

<h5 id="code-editor-output-7">Code editor output</h5>
<p>There is no way to access the label in the code editor.</p>
<h5 id="available-field-configurations-7">Available field configurations</h5>
<blockquote>
<p>Click the configuration name to jump to details about the configuration in the reference at the end of this guide.</p>
</blockquote>
<ul>
<li><a href="#display-name">Display name</a> - The label of the field shown in the GTM UI. <strong>ON by default</strong>.</li>
<li><a href="#enabling-conditions">Enabling conditions</a> - Establish conditions (based on other field inputs) for showing this particular field. OFF by default.</li>
</ul>
<h4 id="utilizing-apis">Utilizing APIs</h4>
<p><strong>Template APIs</strong> are methods in the Google Tag Manager sandboxed JavaScript which let you invoke commonly used utilities of the browser. GTM restricts direct access to global methods to improve the stability and reliability of the code, and to optimize the way the code is delivered in the browser.</p>
<p>When working with the code editor, remember to always have the <a href="https://developers.google.com/tag-manager/templates/api">API reference</a> document open in your browser.</p>
<p>Because the official documentation is pretty thorough, I won't do an exhaustive overview of all the APIs. Instead, I'll point out <strong>quirks</strong> or <strong>things you should know</strong> about some of the APIs, listed below in their separate chapters.</p>
<h5 id="the-require-api">The <code>require</code> API</h5>
<p>To invoke a template API, you must first <strong>require</strong> it in the editor. If you've been working with <a href="https://nodejs.org/en/">Node.js</a>, you'll recognize the <code>require()</code> method as a way to include JavaScript <strong>modules</strong> into your code.</p>
<p>In GTM templates, <code>require()</code> is used to gain access to template APIs, so the functionality is similar even if quite a bit more restricted, as the list of APIs you can integrate is limited.</p>
<p>To utilize an API, you simply run <code>const method = require(name);</code>, where <code>name</code> is the name of the API you want to use, and <code>method</code> is the name of the variable to which you will locally scope the API function.</p>
<p>For example, to make it possible to log to the console and to set cookies in the template code, you would need to require the respective APIs:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">setCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>When you require an API that is governed by a set of <strong>permissions</strong>, those permissions will automatically appear in the <a href="#permissions">Permissions</a> tab of the template UI. When you use the API, you need to make sure that the permissions allow you to perform the tasks you are trying to perform.</p>
<h5 id="the-querypermission-api">The <code>queryPermission</code> API</h5>
<p>Especially if you've written the template for public use, you might want to utilize the <code>queryPermission</code> API to wrap your code in a validator that only runs if the required permissions have been set.</p>
<p>For example, if you want to make sure you can actually set some cookie, you might want to use this type of syntax:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">queryPermission</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;queryPermission&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">setCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">domain</span><span class="o">:</span> <span class="s1">&#39;www.simoahava.com&#39;</span>
<span class="p">}</span><span class="p">;</span>

<span class="c1">// Check whether it&#39;s possible to write the cookie before writing it
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">queryPermission</span><span class="p">(</span><span class="s1">&#39;set_cookies&#39;</span><span class="p">,</span> <span class="s1">&#39;_gaClientId&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">setCookie</span><span class="p">(</span><span class="s1">&#39;_gaClientId&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>setCookie()</code> API code is only run if the permissions allow you to write a cookie named <code>_gaClientId</code> on the domain <code>www.simoahava.com</code>. This is a good way to avoid your tag running into errors.</p>
<h5 id="the-copyfromdatalayer-api">The <code>copyFromDataLayer</code> API</h5>
<p><a href="https://developers.google.com/tag-manager/templates/api/#copyfromdatalayer">This API</a> is relatively straightforward - it fetches the item from GTM's data model that you requested. For example, to fetch the current value for <code>gtm.elementUrl</code>, you'd run:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">copyFromDataLayer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copyFromDataLayer&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">clickUrl</span> <span class="o">=</span> <span class="nx">copyFromDataLayer</span><span class="p">(</span><span class="s1">&#39;gtm.element&#39;</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>This code would fetch the value from the data model at the time that the tag was run.</p>
<p>However, there's a very important <strong>catch</strong> here.</p>
<p>If the template code fetching the <code>dataLayer</code> value is run <strong>asynchronously</strong> (e.g. with the <a href="https://developers.google.com/tag-manager/templates/api/#calllater"><code>callLater</code> API</a>), or if the tag built from the template is part of a <a href="https://www.simoahava.com/amp/analytics/understanding-tag-sequencing-in-google-tag-manager/"><strong>tag sequence</strong></a>, the value fetched from <code>dataLayer</code> will be <strong>whatever is currently stored in the data model</strong>. In all other scenarios, the code is run synchronously, relative to the <code>dataLayer.push()</code>, so the value returned by <code>copyFromDataLayer</code> will reflect what was included in the pushed object.</p>
<p>To illustrate, consider the following code executed on the site:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="p">{</span>
  <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;fire&#39;</span><span class="p">,</span>
  <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="p">{</span>
  <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;fire&#39;</span><span class="p">,</span>
  <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;otherValue&#39;</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>These two  <code>dataLayer.push()</code> calls are run one after the other. If you've built a tag that fires on the &ldquo;fire&rdquo; event, and the template for that tag uses <code>copyFromDataLayer</code> to fetch the value for <code>key</code>, then in most cases it will always return whatever the value of <code>key</code> was during the trigger push.</p>
<p>In other words, the first time the tag fires, <code>key</code> will be set to <code>value</code>, and the second time the tag fires, <code>key</code> will return <code>otherValue</code>. This is understandable, and it's how Google Tag Manager has always worked.</p>
<p>However, if the template uses <code>copyFromDataLayer</code> in an asynchronous method, or if the tag is part of a sequence, then when the first tag fires, it's possible that <code>key</code> will actually return <code>otherValue</code>, because by the time the tag resolves that code, the second push will have happened and the values stored in GTM's data model will have been updated.</p>
<p>This is something to be mindful of. I hope that we get the chance to control this behavior by providing a flag that lets us choose whether to use this asynchronous behavior or to fall back to the original, synchronous process.</p>
<h5 id="the-global-variable-apis">The &ldquo;global variable&rdquo; APIs</h5>
<p>Templates offer you a handful of APIs that all interact with the global namespace (namely, the <code>window</code> object). These APIs are:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#aliasinwindow"><code>aliasInWindow</code></a> for creating a copy of a global variable in another global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#callinwindow"><code>callInWindow</code></a> for executing a global function.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#copyfromwindow"><code>copyFromWindow</code></a> for creating a local copy (a <strong>proper copy</strong>, NOT a <strong>reference</strong> to the original) of the global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createargumentsqueue"><code>createArgumentsQueue</code></a> for creating an array as well as a helper function that passes its arguments to the array.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createqueue"><code>createQueue</code></a> for creating an array as a global variable.</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#setinwindow"><code>setInWindow</code></a> for setting a global variable.</p>
</li>
</ul>
<p>These APIs have a number of permissions associated with them, so you need to make sure you make <a href="#accesses-global-variables">the necessary modifications</a> to the template permissions.</p>
<p>Another thing to keep in mind is that when you access these global variables in the context of the templates, GTM creates a <strong>local copy</strong> of each and does NOT copy objects by reference, which is the typical way of handling JavaScript objects.</p>
<p>See this example:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">copy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copyFromWindow&#39;</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">copy</span><span class="p">(</span><span class="s1">&#39;someObject&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">someProperty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</code></pre></div>
<p>This sets <code>someProperty</code> on the object to <code>true</code> <strong>only in the template code</strong>. It doesn't change it to <code>true</code> in the global object itself. That's because GTM creates a clone of the global variable rather than a reference to it.</p>
<p>Finally, GTM handles <strong>functions</strong> in a special way. When you try to run <code>setInWindow('someVariable', someFunction)</code>, where <code>someFunction</code> is a function you have created, what gets set in the global variable <code>someVariable</code> is <strong>not</strong> the actual function, but rather a wrapper created by GTM which ends up calling the function.</p>
<p>This shouldn't be a big deal - since the end result is always the same. Whatever you call the global variable with gets executed in the function you created.</p>
<p>However, it does mean that you won't be able to <strong>set individual properties to that function</strong>. Take this example:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">str</span> <span class="p">=&gt;</span> <span class="nx">str</span> <span class="o">+</span> <span class="s2">&#34; Simo&#34;</span><span class="p">;</span>
<span class="nx">func</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="nx">setInWindow</span><span class="p">(</span><span class="s1">&#39;someFunction&#39;</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>If you now call <code>window.someFunction('Hello');</code>, the code ends up returning <code>&quot;Hello Simo&quot;</code>, so it works. However, if you check <code>someFunction.loaded</code>, you'll notice it's undefined when it should be <code>true</code>.</p>
<h5 id="the-maketablemap-api">The <code>makeTableMap</code> API</h5>
<p>The <a href="https://developers.google.com/tag-manager/templates/api#maketablemap"><code>makeTableMap</code></a> API makes the <a href="#simple-table">simple table</a> field more manageable.</p>
<p>The simple table field itself returns an array of objects, where each object represents a <strong>row</strong> of the table and is comprised of key-value pairs. Each key-value pair corresponds to a column.</p>
<p>For example, if the simple table had two columns:</p>
<p><strong>Column 1:</strong> fieldToSetName<br>
<strong>Column 2:</strong> fieldToSetValue</p>
<p>The resulting <code>data</code> object would look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&#34;fieldToSetName&#34;</span><span class="p">:</span> <span class="s2">&#34;page&#34;</span><span class="p">,</span>
    <span class="nt">&#34;fieldToSetValue&#34;</span><span class="p">:</span> <span class="s2">&#34;/home/&#34;</span>
  <span class="p">}</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nt">&#34;fieldToSetName&#34;</span><span class="p">:</span> <span class="s2">&#34;userId&#34;</span><span class="p">,</span>
    <span class="nt">&#34;fieldToSetValue&#34;</span><span class="p">:</span> <span class="s2">&#34;abc123&#34;</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></div>
<p>The <code>makeTableMap</code> API turns this into a single object whose contents are mapped from the values the user input. Naturally, this means that the column you use as the &ldquo;key&rdquo; of this new map must have unique values.</p>
<p>To continue the example from above, if you run <code>makeTableMap</code> against the array above, this is the result:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">makeTableMap</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;makeTableMap&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">properties</span><span class="p">;</span> <span class="c1">// This is the array from the example above
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">newMap</span> <span class="o">=</span> <span class="nx">makeTableMap</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;fieldToSetName&#39;</span><span class="p">,</span> <span class="s1">&#39;fieldToSetValue&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="nx">log</span><span class="p">(</span><span class="nx">newMap</span><span class="p">)</span><span class="p">;</span>
<span class="cm">/* LOGS:
</span><span class="cm">  {
</span><span class="cm">    &#34;page&#34;: &#34;/home&#34;,
</span><span class="cm">    &#34;userId&#34;: &#34;abc123&#34;
</span><span class="cm">  }
</span><span class="cm">*/</span>
</code></pre></div>
<h4 id="the-data-object">The <code>data</code> object</h4>
<p>If you want to access values the user has input into the template fields, you need to use the <code>data</code> object. Furthermore, to signal <strong>tag</strong> template completion (or failure), you will also need to use the <code>data</code> object in your template code.</p>
<p>Every single user input in the template fields is encoded in the <code>data</code> object as properties, where the property name matches the <strong>field name</strong> you gave in the editor.</p>


    <a href="https://www.simoahava.com/amp/images/2019/02/field-name.jpg" title="Field name">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/field-name.jpg" layout="responsive" alt="Field name" height="190" width="962"></amp-img>
  
    </a>
  

<p>To access the values the user input into the <code>cookieSettings</code> field above, you would use this syntax:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cookieSettings</span><span class="p">;</span>
</code></pre></div>
<p>You don't need to <code>require()</code> any API to access the user input - the <code>data</code> object is always available for fetching the values the user has entered. Read through the <a href="#fields-editor">Fields editor</a> chapter to see how each different field type is encoded into the <code>data</code>object.</p>
<h4 id="variable-templates-in-the-code-editor">Variable templates in the code editor</h4>
<p>Variable templates have just one requirement, similar to Custom JavaScript variables in GTM: they must <strong>return</strong> a value. If you don't have a <code>return</code> statement in the template, the variable will always return <code>undefined</code> (not very useful).</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">someNumber</span><span class="p">;</span>

<span class="k">return</span> <span class="nx">userInput</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<p>The variable template above would take the value entered by user into the <code>someNumber</code> field and return it multiplied by 2.</p>
<h4 id="tag-templates-in-the-code-editor">Tag templates in the code editor</h4>
<p>With tag templates, you <strong>must</strong> invoke one of two methods in the code:</p>
<ul>
<li>
<p><code>data.gtmOnSuccess()</code> to indicate that the tag was a success.</p>
</li>
<li>
<p><code>data.gtmOnFailure()</code> to indicate that the tag execution failed.</p>
</li>
</ul>
<p>I recommend to always have <code>data.gtmOnSuccess()</code> (after all, why create a tag that doesn't indicate successful completion). If there is a clear point of failure, such as something you want to block a <a href="https://www.simoahava.com/amp/analytics/understanding-tag-sequencing-in-google-tag-manager/">tag sequence</a> with, you should also add a <code>data.gtmOnFailure()</code> call into the code.</p>
<p>Try to avoid paths in the code that do not lead to either <code>data.gtmOnSuccess()</code> or <code>data.gtmOnFailure()</code>, as the tag will be in &ldquo;Still running&rdquo; status for perpetuity.</p>
<p>Here's an example. Let's say the template's purpose is to write a cookie into the browser storage. If the template permissions allow the cookie to be written, <code>data.gtmOnSuccess()</code> is called after the write. If the permissions prevent this, a warning is logged into the console and <code>data.gtmOnFailure()</code> is run instead.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">setCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">)</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">queryPermission</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;queryPermission&#39;</span><span class="p">)</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">queryPermission</span><span class="p">(</span><span class="s1">&#39;set_cookies&#39;</span><span class="p">,</span> <span class="s1">&#39;_gaClientId&#39;</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">setCookie</span><span class="p">(</span><span class="s1">&#39;_gaClientId&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Unable to write cookie due to missing permissions!&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnFailure</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Tag success/failure/incompletion status is shown in Preview mode, too.</p>


    <a href="https://www.simoahava.com/amp/images/2019/02/firing-status.jpg" title="Firing status in debug mode">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/firing-status.jpg" layout="responsive" alt="Firing status in debug mode" height="658" width="823"></amp-img>
  
    </a>
  

<h3 id="permissions">Permissions</h3>
<p>When you add one of the <strong>supported APIs</strong> using the <code>require</code> method in the code editor, the associated permissions for that API are automatically displayed in the <strong>Permissions</strong> tab.</p>


    <a href="https://www.simoahava.com/amp/images/2019/03/tag-template-permissions-tab.jpg" title="Permissions tab">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/tag-template-permissions-tab.jpg" layout="responsive" alt="Permissions tab" height="482" width="1048"></amp-img>
  
    </a>
  

<p>Permissions are described at length <a href="https://developers.google.com/tag-manager/templates/permissions">in the official documentation</a>. Nevertheless, in this chapter I'll show what the UI for each permission looks like, and what the different settings are used for.</p>
<p>Note that you can <strong>save</strong> a template with code that conflicts with a permission. It's not until the tag is run that an error is thrown, and this error is surfaced in the <a href="https://www.simoahava.com/amp/analytics/new-errors-tab-preview-mode/">Errors tab</a> in Preview mode, signalling that there was a permissions conflict within the tag.</p>
<h4 id="accesses-global-variables">Accesses Global Variables</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-access-global-variables.jpg" title="Accesses global variables">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-access-global-variables.jpg" layout="responsive" alt="Accesses global variables" height="508" width="1900"></amp-img>
  
    </a>
  

<p>The Accesses Global Variables permission allows the code to <strong>Read</strong> (see what value is assigned to the variable), <strong>Write</strong> (update the value assigned to the variable), and <strong>Execute</strong> (if the variable is a function, execute it) global variables. The <strong>Key</strong> is the name of the global variable, accessed via <code>window[key]</code>.</p>
<p>Here are the APIs and the relevant permissions for them:</p>
<table>
<thead>
<tr>
<th>API example</th>
<th>Permission</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aliasInWindow('copyTo', 'copyFrom')</code></td>
<td><strong>Write</strong> on <code>copyTo</code>, <strong>Read</strong> on <code>copyFrom</code>.</td>
</tr>
<tr>
<td><code>callInWindow('someFunction')</code></td>
<td><strong>Execute</strong> on <code>someFunction</code>.</td>
</tr>
<tr>
<td><code>copyFromWindow('copyFrom')</code></td>
<td><strong>Read</strong> on <code>copyFrom</code>.</td>
</tr>
<tr>
<td><code>createArgumentsQueue('helper', 'queue')</code></td>
<td><strong>ReadWrite</strong> on <code>helper</code>, <strong>ReadWrite</strong> on <code>queue</code>.</td>
</tr>
<tr>
<td><code>createQueue('someArray')</code></td>
<td><strong>ReadWrite</strong> on <code>someArray</code>.</td>
</tr>
<tr>
<td><code>setInWindow('someVariable', 'someValue', true)</code></td>
<td><strong>ReadWrite</strong> on <code>someVariable</code> (regardless of third parameter).</td>
</tr>
</tbody>
</table>
<p>In other words, if your code needs to access any global variable using e.g. <code>setInWindow</code> or <code>copyFromWindow</code>, you need to add those variables into these permission settings, and you need to specify if the code can read, write, and/or execute the variable in question.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#access_globals"><code>access_globals</code></a>.</p>
</blockquote>
<h4 id="reads-cookie-values">Reads Cookie Value(s)</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-reads-cookie-values.jpg" title="Reads cookie values">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-reads-cookie-values.jpg" layout="responsive" alt="Reads cookie values" height="344" width="1912"></amp-img>
  
    </a>
  

<p>The Reads Cookie Value(s) permission lists all the first-party cookies the tag or variable code can access with the <code>getCookieValues</code> API. To allow the code to read from a first-party cookie, you need to list all the cookie names that can be accessed on <strong>their own line</strong> in the text box in the permission settings.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get_cookies"><code>get_cookies</code></a>.</p>
</blockquote>
<h4 id="reads-referrer-url">Reads Referrer URL</h4>


    <a href="https://www.simoahava.com/amp/images/2019/05/permissions-gets-referrer.jpg" title="Gets referrer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/05/permissions-gets-referrer.jpg" layout="responsive" alt="Gets referrer" height="472" width="1910"></amp-img>
  
    </a>
  

<p>The Reads Referrer URL permission allows template code to access any or only parts of the referring page URL (from <code>document.referrer</code>. You can restrict access to any combination of its URL components. Since the permission model is the same as for the <a href="#reads-url">Reads URL</a> permission, please read the very next section for more details.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get_referrer"><code>get_referrer</code></a>.</p>
</blockquote>
<h4 id="reads-url">Reads URL</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-reads-url.jpg" title="Reads URL">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-reads-url.jpg" layout="responsive" alt="Reads URL" height="462" width="1916"></amp-img>
  
    </a>
  

<p>The Reads URL permission allows template code to access any or only parts of the current page URL. You can restrict access to any combination of the following URL components:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>protocol</td>
<td><code>http</code>, <code>https</code>, or <code>file</code></td>
</tr>
<tr>
<td>host</td>
<td><code>blog.simoahava.com</code></td>
</tr>
<tr>
<td>port</td>
<td><code>443</code></td>
</tr>
<tr>
<td>path</td>
<td><code>/analytics/articles/</code></td>
</tr>
<tr>
<td>extension</td>
<td><code>html</code></td>
</tr>
<tr>
<td>fragment</td>
<td><code>about-us</code></td>
</tr>
<tr>
<td>query</td>
<td><code>gclid=1.2.3.4</code></td>
</tr>
</tbody>
</table>
<p>After selecting <strong>query</strong>, You can specify which <strong>query keys</strong> the <code>getUrl</code> API is allowed to access, or you can leave it to its default setting which is any query keys.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#get-url"><code>get_url</code></a>.</p>
</blockquote>
<h4 id="injects-hidden-iframes">Injects Hidden Iframes</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-injects-hidden-iframes.jpg" title="Injects Hidden Iframes">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-injects-hidden-iframes.jpg" layout="responsive" alt="Injects Hidden Iframes" height="344" width="1908"></amp-img>
  
    </a>
  

<p>You can list a number of URL patterns, each on its own row, that must match those in the code editor used to inject hidden iframes on the page. The <code>src</code> attribute of the iframe the editor wants to inject must match one of these parameters.</p>
<p>The URL patterns must include <code>https://</code>, a valid hostname, and a valid path. Hostnames can use asterisk to wildcard match any subdomains, and paths can use asterisk to wildcard match any characters. Path ending with a <code>/</code> is also a wildcard match for anything that follows.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*tracker.html</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/track/</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/this/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker.html</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/track/superdupertracker.html</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#inject_hidden_iframe"><code>inject_hidden_iframe</code></a>.</p>
</blockquote>
<h4 id="injects-scripts">Injects Scripts</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-injects-scripts.jpg" title="Injects Scripts">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-injects-scripts.jpg" layout="responsive" alt="Injects Scripts" height="362" width="1910"></amp-img>
  
    </a>
  

<p>You can list a number of URL patterns, each on its own row, that must match those in the code editor used to inject scripts on the page. The <code>src</code> attribute of the script the editor wants to inject must match one of these patterns.</p>
<p>The URL patterns must include <code>https://</code>, a valid hostname, and a valid path. Hostnames can use asterisk to wildcard match any subdomains, and paths can use asterisk to wildcard match any characters. Path that only consists of a <code>/</code> is also a wildcard match for anything that follows.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*tracker.js</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/gtmtracker.js</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker.js</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/track/superdupertracker.js</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#inject_script"><code>inject_script</code></a>.</p>
</blockquote>
<h4 id="logs-to-console">Logs To Console</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-logs-to-console.jpg" title="Logs to Console">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-logs-to-console.jpg" layout="responsive" alt="Logs to Console" height="370" width="1912"></amp-img>
  
    </a>
  

<p>You can choose whether the <code>logToConsole</code> API can log into the browser console only when in preview/debug mode, or whether it can log to console whenever the tag fires, regardless of debug context.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#logging"><code>logging</code></a>.</p>
</blockquote>
<h4 id="reads-document-character-set">Reads Document Character Set</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-reads-document-character-set.jpg" title="Reads Document Character Set">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-reads-document-character-set.jpg" layout="responsive" alt="Reads Document Character Set" height="194" width="1912"></amp-img>
  
    </a>
  

<p>An extremely simple permission for an extremely simple API. This permission governs whether or not the code editor can use the <code>readCharacterSet</code> API, which, in turn, returns the value of <code>document.characterSet</code>.</p>
<p>There are no configuration options you can pass to the permission, so it's always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_character_set"><code>read_character_set</code></a>.</p>
</blockquote>
<h4 id="reads-data-layer">Reads Data Layer</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-reads-data-layer.jpg" title="Reads Data Layer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-reads-data-layer.jpg" layout="responsive" alt="Reads Data Layer" height="344" width="1910"></amp-img>
  
    </a>
  

<p>In the permission configuration, add the Data Layer keys the code has access to, each on its own row.</p>
<p>You can use wildcards to allow the code access to any subproperties of the key. For example, a permission like this:</p>
<ul>
<li><code>ecommerce.*</code></li>
</ul>
<p>Will allow the code editor to read <code>ecommerce</code>, <code>ecommerce.purchase.actionField.id</code>, <code>ecommerce.purchase.products</code>, and any other key nested under <code>ecommerce</code>.</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_data_layer"><code>read_data_layer</code></a>.</p>
</blockquote>
<h4 id="reads-document-title">Reads Document Title</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-reads-document-title.jpg" title="Reads Document Title">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-reads-document-title.jpg" layout="responsive" alt="Reads Document Title" height="178" width="1906"></amp-img>
  
    </a>
  

<p>Another really simple permission for a really simple API. This permission allows the code to use the <code>readTitle</code> API, which returns the value of <code>document.title</code>.</p>
<p>This permission doesn't take any configuration options, so it's always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_title"><code>read_title</code></a>.</p>
</blockquote>
<h4 id="reads-event-metadata">Reads Event Metadata</h4>


    <a href="https://www.simoahava.com/amp/images/2019/07/reads-event-metadata.jpg" title="Reads Event Metadata">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/reads-event-metadata.jpg" layout="responsive" alt="Reads Event Metadata" height="96" width="956"></amp-img>
  
    </a>
  

<p>This permission allows the code to use the <code>addEventCallback</code> API, which updates the <code>eventCallback</code> of the <code>dataLayer.push()</code> that triggered the tag created from this template. A data object of tags that fired for the <code>dataLayer</code> event is passed as an argument to the callback.</p>
<p>Take a look at <a href="https://www.simoahava.com/amp/analytics/google-tag-manager-monitor/">this article</a> for more details on how this API works.</p>
<p>This permission doesn't take any configuration options, so it's always permitted (unless a policy is used to block it).</p>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#read_event_metadata"><code>read_event_metadata</code></a>.</p>
</blockquote>
<h4 id="sends-pixels">Sends Pixels</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-sends-pixels.jpg" title="Sends Pixels">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-sends-pixels.jpg" layout="responsive" alt="Sends Pixels" height="362" width="1908"></amp-img>
  
    </a>
  

<p>You can provide a list of URL patterns (each on its own row), and when using the the <code>sendPIxel</code> API, the URL the pixel is dispatched to must match one of these patterns.</p>
<p>For example, given these three patterns:</p>
<ul>
<li>
<p><code>https://*.simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/*/track</code></p>
</li>
</ul>
<p>Any of these will be <strong>valid</strong> matches:</p>
<ul>
<li>
<p><code>https://simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://blog.tracker.simoahava.com/collect</code></p>
</li>
<li>
<p><code>https://www.gtmtools.com/tracking/collect</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/tracker/track</code></p>
</li>
<li>
<p><code>https://www.tracksimo.com/collect/analytics/track</code></p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#send_pixel"><code>send_pixel</code></a>.</p>
</blockquote>
<h4 id="sets-a-cookie-value">Sets A Cookie Value</h4>


    <a href="https://www.simoahava.com/amp/images/2019/03/permissions-sets-a-cookie-value.jpg" title="Sets a Cookie Value">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/permissions-sets-a-cookie-value.jpg" layout="responsive" alt="Sets a Cookie Value" height="476" width="1914"></amp-img>
  
    </a>
  

<p>This permission lets you configure which cookies the template code is allowed to set. You can also configure the following parameters per cookie:</p>
<ul>
<li>
<p><strong>Domain</strong> - on which domain the cookie can be written on or <code>*</code> for any.</p>
</li>
<li>
<p><strong>Path</strong> - on which path the cookie can be written on or <code>*</code> for any.</p>
</li>
<li>
<p><strong>Secure</strong> - whether the cookie must be set with the <code>secure</code> flag, without the <code>secure</code> flag, or either.</p>
</li>
<li>
<p><strong>Session</strong> - whether the cookie must be a session cookie, a cookie with an expiration, or either.</p>
</li>
</ul>
<blockquote>
<p>Name used with the <a href="#the-querypermission-api"><code>queryPermission</code></a> API and <a href="#policies-reference">policies</a>: <a href="#set_cookies"><code>set_cookies</code></a>.</p>
</blockquote>
<h3 id="tests-1">Tests</h3>
<p>For more information on writing and running <strong>tests</strong> against your template code, see <a href="#tests">this chapter</a>, and read <a href="https://www.simoahava.com/amp/analytics/writing-tests-for-custom-templates-google-tag-manager/">this article</a>.</p>
<h3 id="template-preview">Template preview</h3>
<p>The <strong>Template Preview</strong> window is where you can see what your template user interface looks like in its current state, and you can also try filling in the inputs before <a href="#testing-the-template">testing</a> the template.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/template-preview-editor.jpg" title="Template preview editor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/template-preview-editor.jpg" layout="responsive" alt="Template preview editor" height="714" width="1884"></amp-img>
  
    </a>
  

<p>When you make changes to the template, whether in the <strong>Info</strong>, <strong>Fields</strong>, <strong>Code</strong>, or <strong>Permission</strong> tabs, the <strong>Refresh</strong> icon appears. By clicking this icon, the template preview is updated to reflect the changes you have made to the template in the editor.</p>
<p>Other than that, the template preview should perform exactly as the real thing. In the <strong>summary view</strong>, i.e. before you click it for editing, the template will show you only those fields that are included in summary. You can manually toggle this with the <a href="#always-in-summary">Always in summary</a> field configuration.</p>
<p>The template preview is the perfect place to try out your template user interface before testing how the template actually runs, and finally saving it into the template library of your container.</p>
<h3 id="importing-and-exporting">Importing and exporting</h3>
<p><strong>Importing and exporting</strong> templates will almost certainly be one of the most useful things you can do with templates. By exporting your custom templates, you can create a store or library of Google Tag Manager templates for others to use. By importing templates, you can add custom templates created by others into your own template library.</p>
<p><strong>To export a template</strong>, click open the editor menu and choose <strong>Export</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/export-import-template.jpg" title="Export and import template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/export-import-template.jpg" layout="responsive" alt="Export and import template" height="490" width="1178"></amp-img>
  
    </a>
  

<p>Your browser should automatically download a file named <code>&lt;your template name&gt;.tpl</code>. The <strong>TPL</strong> suffix is a custom file format for Google Tag Manager templates. If you open the file in a text editor, you can see that it's a combination of JSON objects and plain text.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/template-export-file.jpg" title="Template export file">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/template-export-file.jpg" layout="responsive" alt="Template export file" height="872" width="1710"></amp-img>
  
    </a>
  

<p><strong>To import a template</strong>, click open the editor menu and choose <strong>Import</strong>. When importing a template, it's a good idea to first <strong>create a new template</strong> which will host the imported item. Unless of course you are deliberately updating an existing template with a newer version of the import.</p>
<p>Once you've chosen the file, a pop-up will warn you that importing the file will overwrite the template currently being edited.</p>
<p>Why is this significant? Well, an <strong>import completely overwrites the template to which it is imported</strong>. So if you expect some sort of &ldquo;merging&rdquo; being an option, well, at the time of writing there's no such feature.</p>
<h3 id="advanced-settings">Advanced settings</h3>
<p>When you select <strong>Show Advanced Settings</strong> from the editor menu, a number of changes takes place in the UI.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/show-advanced-settings-editor.jpg" title="Show advanced settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/show-advanced-settings-editor.jpg" layout="responsive" alt="Show advanced settings" height="374" width="1326"></amp-img>
  
    </a>
  

<ol>
<li>A <strong>Notes</strong> option becomes visible in the editor navigation. You can write anything you want into this text area, such as developer documentation, instructions for use, etc. The <strong>Notes</strong> field contents are included with the template export/import.</li>
</ol>


    <a href="https://www.simoahava.com/amp/images/2019/04/editor-notes.jpg" title="Editor Notes">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/editor-notes.jpg" layout="responsive" alt="Editor Notes" height="376" width="1308"></amp-img>
  
    </a>
  

<ol start="2">
<li>The <strong>Info</strong> tab will now show the <strong>Version</strong> (of the templating system itself) and the <strong>Container Context</strong> (whether the template is for web containers or for app containers). You can't change either of these values - they are set when you start creating the template. The <strong>Info</strong> tab will also show the <strong>Brand Name</strong> field.</li>
</ol>


    <a href="https://www.simoahava.com/amp/images/2019/04/version-context-info.jpg" title="Version and context info">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/version-context-info.jpg" layout="responsive" alt="Version and context info" height="306" width="836"></amp-img>
  
    </a>
  

<ol start="3">
<li>In the <strong>Info</strong> and <strong>Fields</strong> tabs, you can directly edit the JSON source. Note that even though this lets you edit anything you want in the source, trying to change things that can't be changed (such as <strong>Version</strong> and <strong>Container Context</strong> from above) will result in the template issuing a warning when you try to refresh it in the preview or save it.</li>
</ol>


    <a href="https://www.simoahava.com/amp/images/2019/04/source-toggle.jpg" title="Source toggler">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/source-toggle.jpg" layout="responsive" alt="Source toggler" height="692" width="1934"></amp-img>
  
    </a>
  

<h3 id="running-the-template-code">Running the template code</h3>
<p>Whenever you want to test how the template actually <strong>runs</strong>, you can click the <strong>Run code</strong> button in the Template Preview window. This executes the tag/variable template code itself, outputting any debug messages into the console.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/test-example.jpg" title="Test example">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/test-example.jpg" layout="responsive" alt="Test example" height="438" width="1912"></amp-img>
  
    </a>
  

<p>For <strong>tag templates</strong>, the console will tell you when the preview was last refreshed. It will also output any test logs, such as test start and completion (with elapsed time), as well as any errors.</p>
<p>If you don't change anything in the <a href="#code-editor">code editor</a>, the default code snippet will output the contents of the <code>data</code> object into the console.</p>
<p>Generally, the console will display any strings you write into the console using the <a href="https://developers.google.com/tag-manager/templates/api#logtoconsole"><code>logToConsole</code></a> API.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/error-in-console.jpg" title="Error in console">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/error-in-console.jpg" layout="responsive" alt="Error in console" height="580" width="1754"></amp-img>
  
    </a>
  

<p>Furthermore, when you choose to <strong>Show test page</strong> in the editor menu, a content area will pop up which you can <strong>inspect</strong> to find any changes the tag code has made to the page on which the tag runs. This is useful if you want to check if and how your hidden iframe was added to the page, for example.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/show-test-page.jpg" title="Show test page">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/show-test-page.jpg" layout="responsive" alt="Show test page" height="820" width="2058"></amp-img>
  
    </a>
  

<p>To find your modifications to the test page, right-click it in your browser and choose <strong>Inspect</strong> (this may vary by browser). Start drilling down the DOM until you find an iframe with GTM's sandbox HTML file. The <code>&lt;body&gt;</code> of that iframe should contain any modifications your tag did to the page.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/test-page-inspect.jpg" title="Inspect test page">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/test-page-inspect.jpg" layout="responsive" alt="Inspect test page" height="582" width="2314"></amp-img>
  
    </a>
  

<p><strong>Variable templates</strong> differ in that they don't modify the underlying page (or, they SHOULDN'T modify the underlying page). Instead, when you <strong>test</strong> the template, the console outputs what the variable will return.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/test-template-variable.jpg" title="Test variable template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/test-template-variable.jpg" layout="responsive" alt="Test variable template" height="1448" width="1916"></amp-img>
  
    </a>
  

<h2 id="templates-in-gtms-preview-mode">Templates in GTM's Preview mode</h2>
<p>In <strong>Preview</strong> mode, tag and variable templates work just like their built-in template counterparts.</p>
<p>For <strong>tags</strong>, you'll see the tag <strong>name</strong> and <strong>properties</strong>.</p>
<p>Two default properties are always included:</p>
<ol>
<li>
<p><strong>Type</strong> - which is the template name, basically.</p>
</li>
<li>
<p><strong>Firing Status</strong> - which will show &ldquo;Succeeded&rdquo; if <code>data.gtmOnSuccess()</code> was reached in the tag code, &ldquo;Failure&rdquo; if <code>data.gtmOnFailure()</code> was reached in the tag code, and <code>Still running</code> if neither was reached or if the tag is, actually, still running (due to e.g. the endpoint timing out).</p>
</li>
</ol>
<p>The rest of the properties mirror the fields and <a href="#field-configuration-reference">field configurations</a> you have generated. In the example below, a <a href="#text-input">text input</a> field named <strong>Iframe URL</strong> has been populated with the value <code>https://www.gtmtools.com/</code>, and a <a href="#param-table">param table</a> field named <strong>Iframe parameters</strong> has been populated with the values you see.</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/tag-template-parameters.jpg" title="Tag template parameters">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/tag-template-parameters.jpg" layout="responsive" alt="Tag template parameters" height="588" width="1492"></amp-img>
  
    </a>
  

<p>For <strong>variables</strong>, the output can be found in the <strong>Variables</strong> tab of Preview mode, and you can see the return value of each custom variable in exactly the same way you can see the return values for all predefined variable templates.</p>
<p>The variable template <strong>type</strong> will be the name of the custom template (&ldquo;Multiply&rdquo; in the example below).</p>


    <a href="https://www.simoahava.com/amp/images/2019/04/variable-template-example.jpg" title="Variable template example">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/04/variable-template-example.jpg" layout="responsive" alt="Variable template example" height="296" width="1966"></amp-img>
  
    </a>
  

<p>The <strong>Errors</strong> tab will surface any errors thrown by <a href="#policies-reference">policies</a> or if the template failed a <a href="#permissions">permission</a> check.</p>


    <a href="https://www.simoahava.com/amp/images/2019/01/tag-errors.jpg" title="Tag errors">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/01/tag-errors.jpg" layout="responsive" alt="Tag errors" height="227" width="1066"></amp-img>
  
    </a>
  

<h2 id="field-configuration-reference">Field configuration reference</h2>
<p>This chapter lists all the <strong>Field configuration</strong> options you can configure for individual fields. Remember to check out the <a href="#fields-editor">Fields editor</a> chapter for a detailed description of the fields and the configurations available to them.</p>


    <a href="https://www.simoahava.com/amp/images/2019/02/field-configuration.jpg" title="Field configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/field-configuration.jpg" layout="responsive" alt="Field configuration" height="550" width="3178"></amp-img>
  
    </a>
  

<h3 id="edit-row-dialog-title">&ldquo;Edit row&rdquo; dialog title</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-edit-row.jpg" title="Edit row dialog title">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-edit-row.jpg" layout="responsive" alt="Edit row dialog title" height="662" width="3004"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>&ldquo;Edit row&rdquo; dialog title</strong> is available in fields where the user adds rows to a table and can edit those rows in an overlay. Defaults to &ldquo;Edit row&rdquo;.</p>
<p><strong>How it works</strong>: The text you write into the configuration field will appear as the title of the overlay which pops out when the user <strong>edits</strong> a row they have already added to the table.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>.</p>
<h3 id="new-row-button-text">&ldquo;New row&rdquo; button text</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-new-row.jpg" title="New row button text">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-new-row.jpg" layout="responsive" alt="New row button text" height="732" width="1964"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>&ldquo;New row&rdquo; button text</strong> determines the button text with which the user can add a new row to a table field.</p>
<p><strong>How it works</strong>: The text you type into the configuration field will be the text of the button below the table, which the user can use to add new rows to the table. Defaults to &ldquo;Add row&rdquo;.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>, <a href="#simple-table">Simple table</a>.</p>
<h3 id="new-row-dialog-title">&ldquo;New row&rdquo; dialog title</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-new-row-dialog.jpg" title="New row dialog title">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-new-row-dialog.jpg" layout="responsive" alt="New row dialog title" height="566" width="1978"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>&ldquo;New row&rdquo; dialog title</strong> determines the text you see as the heading of the overlay that pops out when you choose to add a new row into a table. Defaults to &ldquo;New row&rdquo;.</p>
<p><strong>How it works</strong>: Type the new title into the configuration field, and it will show as the heading of the overlay the user sees when adding a new row to a table that uses overlays for data input.</p>
<p><strong>Used in</strong>: <a href="#param-table">Param table</a>.</p>
<h3 id="not-set-option">&ldquo;Not set&rdquo; option</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-not-set-option.jpg" title="not set option">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-not-set-option.jpg" layout="responsive" alt="not set option" height="308" width="1224"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Before the user chooses an item in the drop-down list, you can use the <strong>&ldquo;Not set&rdquo; option</strong> to show a placeholder value.</p>
<p><strong>How it works</strong>: The <strong>&ldquo;Not set&rdquo; option</strong> is a selectable option in the drop-down list, which also shows up if the user hasn't made any selection yet. If the user leaves the &ldquo;Not set&rdquo; option as the selected item, the value of the field in the code editor will be a <strong>blank string</strong>.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>.</p>
<h3 id="allow-empty-strings">Allow empty strings</h3>
<p><strong>Description</strong>: The <strong>Allow empty strings</strong> checkbox lets you determine whether or not an empty text input field shows up as an empty string when accessing the field value in the <code>data</code> object.</p>
<p><strong>How it works</strong>: If the checkbox is checked, the text input field value in the code editor will be an empty string. If unchecked or if the configuration hasn't been added to the field, the value will be <code>undefined</code> for empty text fields.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a></p>
<h3 id="always-in-summary">Always in summary</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-always-in-summary.jpg" title="Always in summary">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-always-in-summary.jpg" layout="responsive" alt="Always in summary" height="962" width="1854"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>Always in summary</strong> configuration determines whether the field name and current value will show up in the summary view of the item.</p>
<p><strong>How it works</strong>: When the checkbox is toggled, the user will see the name (if <a href="#display-name">Display name</a> is configured) and current value of the field in the summary view if the item. The summary is view what you see when the tag or variable is not in edit mode.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="clear-on-copy">Clear on copy</h3>
<p><strong>Description</strong>: With <strong>Clear on copy</strong>, you can toggle whether or not the field will retain or clear its value if a copy is made of the tag or variable.</p>
<p><strong>How it works</strong>: If <strong>Clear on copy</strong> is checked, then when the user makes a copy of an item created with this template, the field will have its value cleared (returned to its initial state) in the copy. If <strong>Clear on copy</strong> is unchecked or missing, the value of the field from the original item will be preserved in the copy.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="default-value">Default value</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-default-value.jpg" title="Default value">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-default-value.jpg" layout="responsive" alt="Default value" height="438" width="1356"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>Default value</strong> option determines what the value of the field is before the user inputs anything into the field.</p>
<p><strong>How it works</strong>: <strong>Default value</strong> represents the <em>initial</em> value of the field. It is considered a true value, meaning if the user doesn't delete or change it, the default value will be what the field returns in the code editor.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="display-line-count">Display line count</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-line-count.jpg" title="Line count">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-line-count.jpg" layout="responsive" alt="Line count" height="764" width="1750"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Set the height of the text input area, and whether or not a multi-line value can be given.</p>
<p><strong>How it works</strong>: If <strong>Display line count</strong> is set to <code>1</code>, then only one row of data can be input into the field. Anything larger than <code>1</code>, and the height of the text area grows as a result, and the user can type on multiple rows in the text input field.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="display-message-when-not-set">Display message when not set</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-display-message-not-set.jpg" title="Display message when not set">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-display-message-not-set.jpg" layout="responsive" alt="Display message when not set" height="958" width="1844"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>Display message when not set</strong> allows you to show a &ldquo;default value&rdquo; for the field when in the summary view and the field doesn't have a value.</p>
<p><strong>How it works</strong>: The text will show up only in the summary view when the field is not set, i.e. has no determinable value. It will not impact what the code editor returns as the field value.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="display-name">Display name</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-display-name.jpg" title="Display name">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-display-name.jpg" layout="responsive" alt="Display name" height="484" width="1804"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The <strong>Display name</strong> configuration lets you set a label for the field.</p>
<p><strong>How it works</strong>: The text you input in the <strong>Display name</strong> is shown as a label for the field when both in edit mode and the summary view.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>, <a href="#label">Label</a>.</p>
<h3 id="enabling-conditions">Enabling conditions</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-enabling-conditions.jpg" title="Enabling conditions">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-enabling-conditions.jpg" layout="responsive" alt="Enabling conditions" height="544" width="2674"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: You can establish a dependency with <strong>Enabling conditions</strong>. The field will only be visible in the UI if the enabling condition validates.</p>
<p><strong>How it works</strong>: An <em>Enabling condition</em> is essentially a check against <strong>some other field's value</strong>. You can use it to check whether some checkbox is unchecked, for example (as in the screenshot above).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>, <a href="#label">Label</a>.</p>
<h3 id="group-style">Group style</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-group-style.jpg" title="Group style">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-group-style.jpg" layout="responsive" alt="Group style" height="696" width="2592"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Use the <strong>Group style</strong> configuration to determine how the <a href="#group">Group</a> field works.</p>
<p><strong>How it works</strong>: The options you can choose are:</p>
<ol>
<li>
<p>Simple section: the fields are simply grouped without UI impact. This is useful if you simply want to have the field configurations for the group impact the nested fields within.</p>
</li>
<li>
<p>Collapsible section &ndash; Open: The fields are in a section that can be collapsed, and the section defaults to being open.</p>
</li>
<li>
<p>Collapsible section &ndash; Closed: The fields are in a section that can be collapsed, and the section defaults to being closed.</p>
</li>
<li>
<p>Collapsible section &ndash; Open if not default: The fields are in a section that can be collapsed, and if the fields have not been edited, the section is closed.</p>
</li>
</ol>
<p><strong>Used in</strong>: <a href="#group">Group</a>.</p>
<h3 id="help-text">Help text</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-help-text.jpg" title="Help text">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-help-text.jpg" layout="responsive" alt="Help text" height="434" width="3112"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Use <strong>Help text</strong> to show a little tooltip when hovering over the question mark icon next to the field in the UI.</p>
<p><strong>How it works</strong>: The text you type into the <strong>Help text</strong> configuration field will appear in the UI when the user hovers the mouse cursor over the little question mark icon.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>, <a href="#group">Group</a>.</p>
<h3 id="include-variables">Include variables</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-include-variables.jpg" title="Include variables">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-include-variables.jpg" layout="responsive" alt="Include variables" height="458" width="1956"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: When checked, <strong>Include variables</strong> will make the full list of GTM variables available for selection as the field value.</p>
<p><strong>How it works</strong>: The drop-down menu will include all the GTM variables as selectable options if this field configuration is checked.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>.</p>
<h3 id="nested-fields">Nested fields</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-nested-fields.jpg" title="Nested fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-nested-fields.jpg" layout="responsive" alt="Nested fields" height="680" width="2192"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: When you add <strong>Nested fields</strong> to a field, those fields become dependent on the enabling condition set for the parent field. Also, visually they will be placed closer to the parent field compared to if they were regular, non-nested fields.</p>
<p><strong>How it works</strong>: Toggle <strong>Nested fields</strong> on, and you can add any available field type as a nested field of the current field. After that, if the parent field is disabled due to an invalid <a href="#enabling-conditions">Enabling condition</a>, for example, the nested fields will be disabled, too.</p>
<p><strong>Used in</strong>: <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>.</p>
<h3 id="text-as-list">Text as list</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-text-as-list.jpg" title="Text as list">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-text-as-list.jpg" layout="responsive" alt="Text as list" height="550" width="2468"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Use this with <a href="#line-count">Line count</a> to access the field value as an array of strings (where each row corresponds to an item in the array).</p>
<p><strong>How it works</strong>: When <strong>Text as list</strong> is checked, then each row in a <a href="#text-input">Text input</a> field (when Line count is also configured) will be an item in the array of the resulting <code>data</code> object. Without <strong>Text as list</strong>, a multi-line input will result in a single string, where each row is separated with the newline character (<code>\n</code>).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="validation-rules">Validation rules</h3>


    <a href="https://www.simoahava.com/amp/images/2019/02/reference-validation-rules.jpg" title="Validation rules">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/reference-validation-rules.jpg" layout="responsive" alt="Validation rules" height="790" width="2962"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Use the <strong>Validation rules</strong> configuration to establish validation criteria for the field.</p>
<p><strong>How it works</strong>: When you add a <strong>Validation rule</strong> to the field, the field must pass the validation, or the user won't be able to save the tag or variable. The available rules are:</p>
<table>
<thead>
<tr>
<th>Rule</th>
<th>How to fail validation</th>
</tr>
</thead>
<tbody>
<tr>
<td>&hellip;cannot be empty</td>
<td>User does not input anything into the field.</td>
</tr>
<tr>
<td>&hellip;must be a string of the required length</td>
<td>User inputs a string that is less than the minimum or more than the maximum length.</td>
</tr>
<tr>
<td>&hellip;must be a number</td>
<td>User inputs a value that is not an <strong>integer</strong> number.</td>
</tr>
<tr>
<td>&hellip;must be a positive number</td>
<td>User inputs an <strong>integer</strong> number that is equal to or less than 0.</td>
</tr>
<tr>
<td>&hellip;must be a positive number or 0</td>
<td>User inputs an <strong>integer</strong> number that is less than 0.</td>
</tr>
<tr>
<td>&hellip;must be an integer between 0 and 100 (inclusive)</td>
<td>User inputs an <strong>integer</strong> number that is less than 0 or more than 100.</td>
</tr>
<tr>
<td>&hellip;must be a number between 0 and 1 (inclusive)</td>
<td>User inputs a number (integer or floating point) which is less than 0.0 or more than 1.0.</td>
</tr>
<tr>
<td>&hellip;must match a regular expression</td>
<td>User inputs a value that does not match the given <strong>regular expression</strong>. The RegEx accepts <strong>full matches only</strong>, so don't forget to add leading and/or trailing <code>.*</code> if you want it to be an open-ended match.</td>
</tr>
<tr>
<td>&hellip;must be a valid GA tracking ID</td>
<td>User inputs a value that does not match the GA tracking ID format (UA-11111-1).</td>
</tr>
<tr>
<td>&hellip;must be a list of the required length</td>
<td>User inputs rows into a table fewer than the minimum length or more than the maximum length. Applies also to a Text input field where <a href="#text-as-list">Text as list</a> is being used.</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>NOTE!</strong> For fields that are governed by <a href="#enabling-conditions">enabling conditions</a>, the validation rule will only apply if the field has been enabled.</p>
</blockquote>
<p>You can click the <strong>action menu</strong> for the Validation rule configuration to <strong>Show advanced settings</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/02/validation-show-advanced-settings.jpg" title="Show advanced settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/02/validation-show-advanced-settings.jpg" layout="responsive" alt="Show advanced settings" height="358" width="1796"></amp-img>
  
    </a>
  

<p>The advanced settings include:</p>
<ul>
<li>
<p><strong>Error messages</strong>: You can customize the error message that is shown if the field does not pass validation.</p>
</li>
<li>
<p><strong>Enabling conditions</strong>: You can add <a href="#enabling-conditions">enabling conditions</a> to the <strong>validation rule itself</strong>, meaning <strong>if the enabling conditions do not pass</strong>, the <strong>validation rule is ignored</strong>.</p>
</li>
</ul>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>, <a href="#checkbox">Checkbox</a>, <a href="#radio-buttons">Radio buttons</a>, <a href="#simple-table">Simple table</a>, <a href="#param-table">Param table</a>.</p>
<h3 id="value-hint">Value hint</h3>


    <a href="https://www.simoahava.com/amp/images/2019/03/reference-value-hint.jpg" title="Value hint">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/reference-value-hint.jpg" layout="responsive" alt="Value hint" height="718" width="2316"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: The text you enter here will be shown as a <em>placeholder</em> value in the field before the user has added any input.</p>
<p><strong>How it works</strong>: The text will simply be a placeholder - it will not be the value of the field if saved without any input.</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>.</p>
<h3 id="value-unit">Value unit</h3>


    <a href="https://www.simoahava.com/amp/images/2019/03/reference-value-unit.jpg" title="Value unit">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/03/reference-value-unit.jpg" layout="responsive" alt="Value unit" height="666" width="2328"></amp-img>
  
    </a>
  

<p><strong>Description</strong>: Use this to guide the users on what type of value is expected in the field.</p>
<p><strong>How it works</strong>: The text will be displayed to the right of the field, giving users indication what type of value is expected in the field. The text can be anything (i.e. isn't restricted to e.g. JavaScript types).</p>
<p><strong>Used in</strong>: <a href="#text-input">Text input</a>, <a href="#drop-down-menu">Drop-down menu</a>.</p>
<h2 id="policies-reference">Policies reference</h2>
<p><strong>Policies</strong> are directives the site admin adds to the page template (or, if necessarily, dynamically with JavaScript), which dictate the type of API permissions each custom template can use.</p>
<p>They differ from <a href="#permissions">Permissions</a> in one critical detail: where permissions are built into the template, and specify a broader set of API configurations the template can run with, policies are implemented by the site where these templates are run.</p>
<p>In other words, template permissions come from the vendor, template policies come from the site owner. Both have the capability to delimit or restrict the types of templates that can run on any given page.</p>
<p>To provide a policy, you need to use some <a href="https://developers.google.com/analytics/devguides/collection/gtagjs/"><code>gtag.js</code> code</a> (note, you do <strong>not</strong> have to install the <code>gtag.js</code> snippet!) where you specify the permission requests your site will listen to.</p>
<p>For example, if you have a template that is trying to send a pixel to an endpoint whitelisted in the template's permissions, you can use a policy to make sure that the template can actually only send the request to one specific endpoint. See the example below.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[</span><span class="p">]</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">gtag</span><span class="p">(</span><span class="p">)</span><span class="p">{</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>

<span class="nx">gtag</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="s1">&#39;send_pixel&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Only restrict the policy to one specific container by returning true
</span><span class="c1"></span>  <span class="c1">// for all other containers
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">container</span> <span class="o">!==</span> <span class="s1">&#39;GTM-ABCDE&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Check if the URL of the pixel request is a specific endpoint,
</span><span class="c1"></span>  <span class="c1">// and if it isn&#39;t throw an error and prevent the tag from working.
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">url</span> <span class="o">!==</span> <span class="s1">&#39;https://snowplow.simoahava.com/i&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span><span class="p">(</span><span class="s1">&#39;Invalid pixel endpoint!&#39;</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>Note: The policy <strong>must</strong> return <code>true</code> explicitly if you want the check to pass. The policy will always default to returning <code>false</code> and preventing the template from working.</p>
<p>You can add more than one policy to the page, each in its own <code>gtag()</code> command, or you can check against ALL permissions requests by setting the policy name to <code>all</code> as below:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[</span><span class="p">]</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">gtag</span><span class="p">(</span><span class="p">)</span><span class="p">{</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)</span><span class="p">;</span><span class="p">}</span>

<span class="nx">gtag</span><span class="p">(</span><span class="s1">&#39;policy&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">policy</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Prevent sending pixels and injecting iframes
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">policy</span> <span class="o">===</span> <span class="s1">&#39;send_pixel&#39;</span> <span class="o">||</span> <span class="nx">policy</span> <span class="o">===</span> <span class="s1">&#39;inject_hidden_iframe&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s1">&#39;Sending pixels and injecting hidden iframes blocked!&#39;</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">)</span><span class="p">;</span>
</code></pre></div>
<p>Please read the <a href="https://developers.google.com/tag-manager/templates/policies">official policy documentation</a> for more details on how policies work.</p>
<p>Below are listed all the policy names and what the <code>data</code> object comprises for each.</p>
<h3 id="access-globals">access_globals</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#aliasinwindow"><code>aliasInWindow</code></a> (once for the <code>toPath</code> key and once for the <code>fromPath</code> key).</p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#callinwindow"><code>callInWindow</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#copyfromwindow"><code>copyFromWindow</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createargumentsqueue"><code>createArgumentsQueue</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#createqueue"><code>createQueue</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#setinwindow"><code>setInWindow</code></a></p>
</li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;key&#34;</span><span class="o">:</span> <span class="s2">&#34;some_global_var&#34;</span><span class="p">,</span> <span class="c1">// name of the key the permission tries to access
</span><span class="c1"></span>  <span class="s2">&#34;read&#34;</span><span class="o">:</span> <span class="kc">true</span> <span class="o">||</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// does the key have read access
</span><span class="c1"></span>  <span class="s2">&#34;write&#34;</span><span class="o">:</span> <span class="kc">true</span> <span class="o">||</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// does the key have write access
</span><span class="c1"></span>  <span class="s2">&#34;execute&#34;</span><span class="o">:</span> <span class="kc">true</span> <span class="o">||</span> <span class="kc">false</span> <span class="c1">// does the key have execute access
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="get-cookies">get_cookies</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#getcookievalues"><code>getCookieValues</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;some_cookie_name&#34;</span> <span class="c1">// name of the cookie being accessed
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="get-referrer">get_referrer</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#getreferrerurl"><code>getReferrer</code></a></p>
</li>
<li>
<p><a href="https://developers.google.com/tag-manager/templates/api#getreferrerqueryparameters"><code>getReferrerQueryParameters</code></a></p>
</li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;component&#34;</span><span class="o">:</span> <span class="s2">&#34;query&#34;</span> <span class="c1">// the component of the referrer URL being accessed
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="get-url">get_url</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#geturl"><code>getUrl</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;component&#34;</span><span class="o">:</span> <span class="s2">&#34;protocol&#34;</span> <span class="c1">// the URL component name being accessed
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="inject-hidden-iframe">inject_hidden_iframe</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#injecthiddeniframe"><code>injectHiddenIframe</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;url&#34;</span><span class="o">:</span> <span class="s2">&#34;https://some-iframe.com/&#34;</span> <span class="c1">// the URL of the iframe being injected
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="inject-script">inject_script</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#injectscript"><code>injectScript</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;url&#34;</span><span class="o">:</span> <span class="s2">&#34;https://some-script.com/script.js&#34;</span> <span class="c1">// the URL of the script being loaded
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="logging">logging</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#logtoconsole"><code>logToConsole</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read-character-set">read_character_set</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#readcharacterset"><code>readCharacterSet</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read-data-layer">read_data_layer</h3>
<p><strong>Triggered by APIs</strong>:<!-- raw HTML omitted --></p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#copyfromdatalayer"><code>copyFromDataLayer</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;key&#34;</span><span class="o">:</span> <span class="s2">&#34;some.variable.name&#34;</span> <span class="c1">// name of the Data Layer Variable being accessed
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="read-event-metadata">read_event_metadata</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#addeventcallback"><code>addEventCallback</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="read-title">read_title</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#readtitle"><code>readTitle</code></a></li>
</ul>
<p><strong>There is no <code>data</code> object associated with this permission.</strong></p>
<h3 id="send-pixel">send_pixel</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#sendpixel"><code>sendPixel</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;url&#34;</span><span class="o">:</span> <span class="s2">&#34;https://some-endpoint.com/endpoint&#34;</span> <span class="c1">// the URL of the pixel request endpoint
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div>
<h3 id="set-cookies">set_cookies</h3>
<p><strong>Triggered by APIs</strong>:</p>
<ul>
<li><a href="https://developers.google.com/tag-manager/templates/api#sendpixel"><code>setCookie</code></a></li>
</ul>
<p><strong><code>data</code> object composition</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;some_cookie_name&#34;</span><span class="p">,</span> <span class="c1">// the name of the cookie
</span><span class="c1"></span>  <span class="s2">&#34;options&#34;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&#34;domain&#34;</span><span class="o">:</span> <span class="s2">&#34;somedomain.com&#34;</span><span class="p">,</span> <span class="c1">// the domain of the cookie
</span><span class="c1"></span>    <span class="s2">&#34;path&#34;</span><span class="o">:</span> <span class="s2">&#34;/some-path/&#34;</span><span class="p">,</span> <span class="c1">// the path of the cookie
</span><span class="c1"></span>    <span class="s2">&#34;max-age&#34;</span><span class="o">:</span> <span class="s2">&#34;15000&#34;</span><span class="p">,</span> <span class="c1">// the maximum age of the cookie (in seconds)
</span><span class="c1"></span>    <span class="s2">&#34;expires&#34;</span><span class="o">:</span> <span class="s2">&#34;Sun, 11 Aug 2019 10:00:00 GMT&#34;</span><span class="p">,</span> <span class="c1">// UTC date string of the cookie&#39;s expiration
</span><span class="c1"></span>    <span class="s2">&#34;secure&#34;</span><span class="o">:</span> <span class="kc">true</span> <span class="o">||</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// Secure cookie
</span><span class="c1"></span>    <span class="s2">&#34;sameSite&#34;</span><span class="o">:</span> <span class="kc">true</span> <span class="o">||</span> <span class="kc">false</span> <span class="c1">// sameSite cookie
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="final-thoughts">Final thoughts</h2>
<p>It's difficult to compose any sort of summary to what I consider to be the most extensive and fundamental Google Tag Manager update since the programmatic API was released almost five years ago.</p>
<p>Custom templates are, for now, a completely <strong>optional</strong> feature. No one is forcing you to use them, and you can continue as a happy GTM user without having to bother about the new <strong>Templates</strong> menu.</p>
<p>However, I have a hunch that there is a huge incentive for the GTM team to get rid of the Custom HTML tag and the Custom JavaScript variable. When talking about governance and the existing prejudices towards GTM, especially from developers, it often boils down to being able to inject <strong>any</strong> arbitrary JavaScript code on the site, using the outdated and questionable <code>eval()</code> method, no less.</p>
<p>With custom templates, many of the problems around governance are presented with a solution:</p>
<ol>
<li>
<p>The template code is compiled into JavaScript when the container is created, so <code>eval()</code> is no longer used to run the code.</p>
</li>
<li>
<p>Template-specific permissions (created by the template author) can delimit what the template does <strong>and</strong> what types of user input are valid and accepted.</p>
</li>
<li>
<p>Page-specific policies (created by the site admin) can be used to further restrict what <strong>any</strong> template can do on the site.</p>
</li>
</ol>
<p>But these are mostly how templates address <strong>negative</strong> qualities of GTM - it would be foolish to ignore their net <strong>positive</strong> effect.</p>
<p>Google Tag Manager is a UI-driven tool. Brands can now use custom templates to encapsulate their complicated JavaScript activation mechanisms under a user interface, thus minimizing the possibility of human error, and demystifying how the vendor JavaScript runs. Thus, instead of sharing a JavaScript snippet the user has to copy-paste to a Custom HTML tag, the brand can share a template export that can be added to the container directly, with all the code in the correct place.</p>
<p>I can't wait to see what the community comes up with, too! I'm waiting for a library of custom templates to emerge, hopefully sanctioned by Google but moderated by the community (with brands being able to add <strong>verified</strong> templates, too).</p>
<p>So now, brave traveller. You have reached the end, though I can only assume you skipped most of the above. What do you think about custom templates? Is my hyperbolic exuberance (yet again) unwarranted?</p>



    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

