

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:transparent}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:b 4s 2s infinite;animation:b 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:a .6s;animation:a .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:a .9s;animation:a .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{content:"";width:7px;height:7px;border:1px solid #e7eef2;bottom:-5px;margin-left:-5px;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image,.author-profile:after{display:block;position:absolute;left:50%;background:#fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;top:-56px;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes a{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes a{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes b{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes b{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open,#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:a}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(a,lower-roman);counter-increment:a}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;background:transparent}.menu-button,.menu-button:hover{border-color:transparent;color:#2e2e2e}.menu-button:hover{background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/100-google-tag-manager-learnings/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>100&#43; Google Tag Manager Learnings | Simo Ahava's blog</title>
        <meta property="og:title" content="100&#43; Google Tag Manager Learnings" />
<meta name="description" content="Over 100 tips and lessons learned after five years of using Google Tag Manager." />
<meta property="og:description" content="Over 100 tips and lessons learned after five years of using Google Tag Manager." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/100-google-tag-manager-learnings/" />

    
        
    



    
        <meta property="article:published_time" content="2017-03-01T10:18:43Z"/>
    
    
        <meta property="article:modified_time" content="2017-03-01T10:18:43Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="Google Tag Manager" />
        
            <meta property="article:tag" content="JavaScript" />
        
            <meta property="article:tag" content="Tips" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    




<meta itemprop="name" content="100&#43; Google Tag Manager Learnings">
<meta itemprop="description" content="Over 100 tips and lessons learned after five years of using Google Tag Manager.">


<meta itemprop="datePublished" content="2017-03-01T10:18:43&#43;00:00" />
<meta itemprop="dateModified" content="2017-03-01T10:18:43&#43;00:00" />
<meta itemprop="wordCount" content="10791">



<meta itemprop="keywords" content="Google Tag Manager,JavaScript,Tips," />

<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https://www.simoahava.com/amp/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "100&#43; Google Tag Manager Learnings | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2017/02/100-tips.png",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/amp/analytics/100-google-tag-manager-learnings/",
  "datePublished": "2017-03-01T10:18:43+00:00",
  "dateModified": "2017-03-01T10:18:43+00:00",
  "description": "Over 100 tips and lessons learned after five years of using Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">100&#43; Google Tag Manager Learnings</h1>
        <small>Over 100 tips and lessons learned after five years of using Google Tag Manager.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#Google Tag Manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/javascript">#JavaScript</a>
    
        , <a href="https://www.simoahava.com/amp/tags/tips">#Tips</a>
    

<time class="post-date" datetime="2017-03-01T10:18:43Z">
    1 March 2017
</time>


        </section>
    </header>

    <section class="post-content">
      

<p>I&rsquo;ve always been proud to avoid the typical headline clickbait of &ldquo;Ultimate guide to pigeon care&rdquo;, &ldquo;All you need to know about the Great Vowel Shift&rdquo;, &ldquo;Did you know that you&rsquo;ve been smoking peyote wrong your whole life?&rdquo;. I&rsquo;m ready to make an exception now by adding a BIG WHOPPING NUMBER to the title. You see, the amount of knowledge one can accumulate about anything they do on a daily basis is mind-blowing. It helps if you write a blog about the topic, since creative output is a great way to organize your thoughts. It also helps to be active in community support, since problem-solving is an excellent way to accumulate new skills and to hone the edge of your existing talent.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/100-tips.png" title="Google Tag Manager lessons learned">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/100-tips.png" layout="responsive" alt="Google Tag Manager lessons learned" height="1106" width="1974"></amp-img>
  
    </a>
  


<p>Now, I already have 50+ <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a> written, so it&rsquo;s not like this is a novel idea, even on this blog. But this time I just wanted to write short, byte-sized things I&rsquo;ve learned along the way, and I want to share them with you.</p>

<p>As you can read from the outrageously baiting title, there should be 100+ tips, but I only enumerated an even 100. That&rsquo;s because I want YOU to add your ideas to the end of this post, and let&rsquo;s see if we can keep it going. Yes, it&rsquo;s my shameful attempt to delegate content creation to the community. I am guilty of that, too, now.</p>

<!-- toc  -->

<h2 id="container-javascript-snippet">Container JavaScript Snippet</h2>

<h3 id="1-initializes-the-datalayer">1. Initializes the <code>dataLayer</code></h3>

<p>The JavaScript snippet part of the GTM container has one very important function (among others). It initializes the <code>window.dataLayer</code> array. Thus, if you haven&rsquo;t initialized a <code>dataLayer</code> object yourself, the container snippet will do this for you. This ensures that <code>dataLayer.push()</code> works within GTM.</p>

<h3 id="2-creates-the-script-loader-for-the-gtm-library">2. Creates the script loader for the GTM library</h3>

<p>Perhaps even more importantly, the JavaScript container snippet creates a <code>&lt;script&gt;</code> element, which loads the Google Tag Manager container library for your GTM container ID from Google&rsquo;s servers.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/script-loader.png" title="GTM container script loader">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/script-loader.png" layout="responsive" alt="GTM container script loader" height="104" width="1116"></amp-img>
  
    </a>
  


<h3 id="3-javascript-snippet-should-be-in-head-but-can-be-almost-anywhere">3. JavaScript snippet should be in <code>&lt;head&gt;</code> but can be (almost) anywhere</h3>

<p>The latest (and best) <em>recommendation</em> for placing the JavaScript snippet is to put it in the <code>&lt;head&gt;</code> of the document. This helps GTM load as early as possible, resulting in greater tracking accuracy. However, you can execute the JavaScript snippet pretty much any time during the page load and anywhere in your site code where execution of JavaScript is possible. The sooner the library loads, though, the more accurate your data collection will be.</p>

<h3 id="4-pushes-the-initial-event-gtm-js">4. Pushes the initial <code>event: 'gtm.js'</code></h3>

<p>The JavaScript snippet also pushes the initial <code>event: 'gtm.js'</code> into <code>dataLayer</code>. This is an important GTM event. It is used by the All Pages and Page View triggers. Any Data Layer variables you want to use with these triggers must be added to <code>dataLayer</code> <em>before the JavaScript container snippet is executed</em>.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/gtm-js-pushed.png" title="event: gtm.js pushed">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/gtm-js-pushed.png" layout="responsive" alt="event: gtm.js pushed" height="156" width="980"></amp-img>
  
    </a>
  


<h3 id="5-multiple-container-snippets-on-a-page-are-supported">5. Multiple container snippets on a page are supported</h3>

<p>You can add multiple JavaScript container snippets on a page. This is <a href="https://developers.google.com/tag-manager/devguide?hl=en#multiple-containers">officially supported</a>. The caveat is that they all need to use the same <code>dataLayer</code> name.</p>

<hr />

<h2 id="container-noscript-snippet">Container <code>&lt;noscript&gt;</code> snippet</h2>

<h3 id="6-the-noscript-block-should-be-at-the-very-beginning-of-body">6. The <code>&lt;noscript&gt;</code> block should be at the very beginning of <code>&lt;body&gt;</code></h3>

<p>At the time of writing, the <code>&lt;noscript&gt;</code> block should be added to the very beginning of <code>&lt;body&gt;</code>. This is the only way that <a href="https://support.google.com/webmasters/answer/35179?hl=en">Search Console Verification</a> using the Google Tag Manager method will work. Naturally, if you don&rsquo;t care about verifying the site using the GTM method, nor do you have any use for tracking non-JavaScript visits, you can leave the <code>&lt;noscript&gt;</code> block out altogether. Just don&rsquo;t place it in <code>&lt;head&gt;</code> as that would result in HTML validation issues.</p>

<h3 id="7-only-executed-by-browsers-with-javascript-disabled">7. Only executed by browsers with JavaScript disabled</h3>

<p>The <code>&lt;noscript&gt;</code> snippet is only executed by browsers with JavaScript disabled. If you want to test it, you can disable JavaScript using your browser&rsquo;s developer tools (e.g. <a href="http://stackoverflow.com/a/13405409">Chrome</a>).</p>

<h3 id="8-loads-an-html-page-in-an-iframe">8. Loads an HTML page in an <code>&lt;iframe&gt;</code></h3>

<p>The block loads an <code>&lt;iframe&gt;</code> element, which fetches its data as an HTML file from Google Tag Manager&rsquo;s servers. In essence, this HTML file is your container. The HTML will contain the image elements you have configured to fire for JavaScript-disabled visitors.</p>

<h3 id="9-only-the-page-view-trigger-works">9. Only the Page View trigger works</h3>

<p>Because the JavaScript-less GTM can&rsquo;t run JavaScript (d&rsquo;oh), only the Page View trigger is at your disposal. Thus, there&rsquo;s no dynamic triggers, and no way to wait for the page to load or anything like that. The Page View trigger is fired when the <code>&lt;iframe&gt;</code> contents are fetched.</p>

<h3 id="10-use-a-function-return-true-custom-javascript-variable-in-the-trigger">10. Use a <code>function() { return true; }</code> Custom JavaScript variable in the trigger</h3>

<p>A very handy way to fire tags only when executed in the <code>&lt;iframe&gt;</code> is to create a Custom JavaScript Variable with the following content:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>This variable will only return <code>true</code> if the browser executes it, i.e. executes JavaScript. By adding <strong>{{Variable}} does not equal true</strong> as a trigger condition fires the trigger only in browsers where JavaScript is disabled.</p>

<h3 id="11-only-the-custom-image-tag-is-useful">11. Only the Custom Image tag is useful</h3>

<p>Since the JavaScript-less container can&rsquo;t execute JavaScript, you are left with just the Custom Image tag. In other words, you can create image elements that are added directly into the container HTML. These image elements will then be rendered by the browser. In fact, you can even do some basic Google Analytics tracking using an image tag, since GA requests are basically image pixels. See <a href="http://www.lunametrics.com/blog/2015/03/23/gtm-iframe-no-javascript/">this LunaMetric guide</a> for inspiration.</p>

<h3 id="12-can-utilize-data-layer-parameters-via-query-parameters">12. Can utilize &ldquo;Data Layer&rdquo; parameters via query parameters</h3>

<p>You can feed &ldquo;Data Layer&rdquo; values to the container HTML using query parameters in the <code>&lt;iframe&gt;</code> src attribute value. The query parameters need to be added as key-value pairs, and the keys that you add can then be used in Data Layer variables. For further details, see the LunaMetrics guide linked to in the previous paragraph, or check the <a href="https://www.simoahava.com/amp/analytics/track-non-javascript-visits-google-analytics/">guide I&rsquo;ve written</a>.</p>

<hr />

<h2 id="the-datalayer-structure">The <code>dataLayer</code> structure</h2>

<h3 id="13-global-javascript-array">13. Global JavaScript array</h3>

<p>The <code>dataLayer</code> structure is a global JavaScript array, and can thus be accessed in any site code that can also access the <code>window</code> object. It&rsquo;s a good idea to always prefix the <code>dataLayer</code> name with <code>window.</code> to avoid conflicts with any locally scoped structures that use the same name.</p>

<h3 id="14-you-can-use-a-different-name-than-datalayer">14. You can use a different name than <code>dataLayer</code></h3>

<p>You can change the name of this global structure in the JavaScript container snippet. Just remember to always use this new name when adding messages to <code>dataLayer</code>!</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/rename-datalayer.png" title="Rename dataLayer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/rename-datalayer.png" layout="responsive" alt="Rename dataLayer" height="194" width="1262"></amp-img>
  
    </a>
  


<h3 id="15-only-the-push-method-works-with-gtm">15. Only the <code>.push()</code> method works with GTM</h3>

<p>Google Tag Manager only reacts to the <code>.push()</code> method. You can <code>.splice()</code>, <code>.slice()</code>, <code>.shift()</code> and <code>.pop()</code> all you like. GTM only listens for <code>.push()</code> commands.</p>

<h3 id="16-typically-only-plain-objects-work-with-gtm">16. Typically only plain objects work with GTM</h3>

<p>The most common way to feed data to Google Tag Manager is using plain objects. Each object contains one or more key-value pairs. These key-value pairs are then translated into Data Layer variables, which you can create in Google Tag Manager to fetch values from the Data Layer.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">plainObject</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">someKey</span><span class="o">:</span> <span class="s1">&#39;someValue&#39;</span><span class="p">,</span>
  <span class="nx">someOtherKey</span><span class="o">:</span> <span class="s1">&#39;someOtherValue&#39;</span>
<span class="p">};</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">plainObject</span><span class="p">);</span></code></pre></div>

<h3 id="17-you-can-use-any-javascript-type-as-a-value-of-a-key">17. You can use any JavaScript type as a value of a key</h3>

<p>All JavaScript types are supported as values when you push your <code>dataLayer</code> messages. When you create a Data Layer variable in GTM, it will contain a reference to whatever the value of the key is, regardless of type.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
  <span class="nx">type_number</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="nx">type_string</span><span class="o">:</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span>
  <span class="nx">type_object</span><span class="o">:</span> <span class="p">{</span> <span class="nx">someKey</span><span class="o">:</span> <span class="s1">&#39;someValue&#39;</span> <span class="p">},</span>
  <span class="nx">type_array</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
  <span class="nx">type_function</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;hello&#39;</span><span class="o">!</span><span class="p">;</span> <span class="p">},</span>
  <span class="nx">type_boolean</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span></code></pre></div>

<h3 id="18-only-event-key-can-trigger-tags">18. Only <code>event</code> key can trigger tags</h3>

<p>Only a message with an <code>event: 'someValue'</code> key-value pair can trigger tags. Any object without an <code>'event'</code> key is treated as just a &ldquo;message&rdquo;, and has no triggering power of its own.</p>

<h3 id="19-you-can-also-push-a-command-array">19. You can also <code>.push()</code> a command array</h3>

<p>There&rsquo;s a special <em>command array</em> you can <code>.push()</code> into <code>dataLayer</code> if you want to execute methods for values already in the data model. So technically it&rsquo;s not just plain objects that <code>dataLayer</code> digests. There&rsquo;s more about this in tip #26.</p>

<h3 id="20-never-overwrite-always-push">20. Never overwrite, always <code>.push()</code></h3>

<p>I usually hate to dole out best practices, so consider this a fact of life instead. Never, ever, ever, ever use this syntax:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">dataLayer</span> <span class="o">=</span> <span class="p">[{...}];</span></code></pre></div>

<p>It&rsquo;s destructive. If this command is executed after the GTM container snippet or after you&rsquo;ve already established a <code>dataLayer</code> object, you will end up overwriting the existing object with this newly initialized structure. Worst-case scenario (surprisingly common) is that you&rsquo;ll end up breaking GTM, since you also overwrite the custom <code>.push()</code> listener added by the container library.</p>

<p>Prefer this syntax instead:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[];</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({...});</span></code></pre></div>

<h3 id="21-the-array-is-capped-at-300">21. The array is capped at 300</h3>

<p>This is perhaps more obscure, but in addition to adding a <code>.push()</code> listener, the GTM container library also caps the length of the <code>dataLayer</code> structure at 300. This means that when you <code>.push()</code> the 301st item into <code>dataLayer</code>, the <em>first/oldest</em> item in <code>dataLayer</code> is removed. As you will learn in the next section, this has no impact on GTM&rsquo;s data model. It just caps the <code>dataLayer</code> structure itself.</p>

<hr />

<h2 id="gtm-s-data-model">GTM&rsquo;s data model</h2>

<h3 id="22-copies-messages-queued-via-datalayer-push">22. Copies messages queued via <code>dataLayer.push()</code></h3>

<p>When you use the Data Layer Variable, Google Tag Manager doesn&rsquo;t fetch the value from the <code>dataLayer</code> array. Instead, it polls its own <a href="https://www.simoahava.com/amp/analytics/google-tag-manager-data-model/">internal data model</a> to see if any value has been pushed to the given key (or variable name). If a value is found, GTM returns it. This means that GTM&rsquo;s internal data model has access to the <strong>most recently pushed value for any given key</strong>.</p>

<h3 id="23-gtm-freezes-variable-values-when-a-trigger-fires">23. GTM freezes variable values when a trigger fires</h3>

<p>Triggers only fire when the key <code>'event'</code> is pushed into <code>dataLayer</code>. When this happens, GTM &ldquo;freezes&rdquo; the state of the container, and any tags that fire on this trigger will only have access to the current state of the internal data model. Thus, if you want to push values into <code>dataLayer</code> so that they become available to a tag that triggers on the site, these values need to be pushed before or in the same object as the <code>'event'</code> that triggers the tag.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/trigger-order.png" title="Order of dataLayer.pushes for triggers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/trigger-order.png" layout="responsive" alt="Order of dataLayer.pushes for triggers" height="508" width="1316"></amp-img>
  
    </a>
  


<h3 id="24-objects-are-recursively-merged">24. Objects are recursively merged</h3>

<p>Recursive merge is one of the more complex concepts to understand. When you work with primitive values (strings, numbers, booleans, for example), the internal data model of GTM only has access to whatever was most recently pushed into a key whose value is one of these primitive types. However, when you work with structured objects and arrays, it&rsquo;s more complicated.</p>

<p>When you push an object into <code>dataLayer</code>, GTM goes through each key in this object, and only overwrites those that have shared keys and primitive values (or where the type changes). New keys are simply added to the existing object value.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/recursive-merge.png" title="Recursive merge">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/recursive-merge.png" layout="responsive" alt="Recursive merge" height="992" width="2338"></amp-img>
  
    </a>
  


<p>When pushing an object to a key that already contains an object with the same keys, only the keys that have primitive values or a different type are overwritten. All others are simply updated.</p>

<h3 id="25-arrays-are-recursively-merged">25. Arrays are recursively merged</h3>

<p>In JavaScript, arrays are structured objects, too, where the keys are index numbers that start from 0. So when you push an array into a key that already had an array, these two arrays are recursively merged starting from index 0, and any indices that are not modified remain the same.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/array-merge.png" title="Array recursive merge">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/array-merge.png" layout="responsive" alt="Array recursive merge" height="400" width="1626"></amp-img>
  
    </a>
  


<h3 id="26-you-can-run-javascript-methods-on-existing-data-layer-values-with-a-command-array">26. You can run JavaScript methods on existing Data Layer values with a command array</h3>

<p>What if you already have an array in a key, but instead of merging or overwriting you want to add values to it, i.e. push items to the end of the array? You can use a special <em>command array</em> that you push into <code>dataLayer</code>. The first element in the array is a string that contains the key name and the command you want to execute, and all the other items are passed as arguments to the command.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/command-array.png" title="Command array">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/command-array.png" layout="responsive" alt="Command array" height="414" width="840"></amp-img>
  
    </a>
  


<h3 id="27-version-1-vs-version-2-of-the-data-layer-variable">27. Version 1 vs. Version 2 of the Data Layer Variable</h3>

<p>You&rsquo;ve probably noticed that you can <a href="https://www.simoahava.com/amp/gtm-tips/data-layer-variable-versions-explained/">choose a <strong>version</strong> when using the Data Layer Variable</a>. There are some very important differences between the two.</p>

<p><strong>Version 2</strong> supports deep structures with dot notation. If you want to access array indices, you need to use dot notation too (<code>products.0.name</code> rather than <code>products[0].name</code>). Only Version 2 supports recursive merge.</p>

<p><strong>Version 1</strong> does not support dot notation, and it only fetches the most recently pushed value whether it&rsquo;s an object or not. Thus there&rsquo;s no recursive merge - what you push is what you get.</p>

<h3 id="28-google-tag-manager-gtm-xxxx-datalayer-methods">28. <code>google_tag_manager['GTM-XXXX'].dataLayer</code> methods</h3>

<p>If you want to access values stored in Google Tag Manager&rsquo;s data model from outside GTM or without using a Data Layer Variable, you can use the <code>google_tag_manager</code> interface.</p>

<p><code>google_tag_manager['GTM-XXXX'].dataLayer.get('keyName')</code> fetches the value stored in GTM&rsquo;s data model for variable name <strong>keyName</strong>.</p>

<p><code>google_tag_manager['GTM-XXXX'].dataLayer.set('keyName', 'someValue')</code> sets the value of <strong>keyName</strong> to <strong>someValue</strong> in GTM&rsquo;s data model. This is the equivalent to using <code>dataLayer.push({keyName: 'someValue'});</code></p>

<p><code>google_tag_manager['GTM-XXXX'].dataLayer.reset()</code> purges GTM&rsquo;s data model, removing all stored keys.</p>

<hr />

<h2 id="preview-mode">Preview mode</h2>

<h3 id="29-preview-mode-works-with-a-cookie-on-www-googletagmanager-com-in-the-preview-browser">29. Preview mode works with a cookie on www.googletagmanager.com in the preview browser</h3>

<p>When you enter GTM&rsquo;s Preview Mode, you are transported through the domain www.googletagmanager.com (the same domain that serves the gtm.js library), during which a cookie is written in your browser for that domain.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/preview-cookie.png" title="Preview mode cookie">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/preview-cookie.png" layout="responsive" alt="Preview mode cookie" height="722" width="1372"></amp-img>
  
    </a>
  


<p>When you then visit your website, the request for the gtm.js library identifies that you have the Preview mode cookie written on www.googletagmanager.com, and the preview container library is returned instead. So what you&rsquo;re basically dealing with is a third-party cookie, even though the cookie isn&rsquo;t set while browsing the site itself.</p>

<h3 id="30-shows-the-state-of-tags-triggers-variables-and-data-layer-at-each-data-layer-message">30. Shows the state of tags, triggers, variables, and Data Layer at each Data Layer message</h3>

<p>Preview mode is a great way to understand how Google Tag Manager works. The navigation in the left column is a chronological (oldest at the bottom) list of messages that have been pushed into <code>dataLayer</code>. By selecting a message, you can see if any tags fired during that message, and you can see the state of tags, variables, and triggers at the time of the message.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/messages-state.png" title="Messages and state of data layer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/messages-state.png" layout="responsive" alt="Messages and state of data layer" height="528" width="1830"></amp-img>
  
    </a>
  


<p>What you see is what you get. If the variable does not have a value at the time of the message, it means that any tags that fire for that message will not have access to any value if using that variable. This is why it&rsquo;s important to understand that <strong>if you want to use a variable, it must have a value when the message that triggers the tag is pushed into <code>dataLayer</code></strong>.</p>

<h3 id="31-summary-shows-the-state-at-the-latest-message">31. Summary shows the state at the latest message</h3>

<p><strong>Summary</strong> is not a message itself. It&rsquo;s a recap of what the state of the container is after the latest message has fired. Note that if you have Summary (or any other message, for that matter) selected, and you select a tag that fired in an earlier message, the tag might have different values than what you&rsquo;d expect. That&rsquo;s because when you select a message (or Summary), the variables reflect what their values are <strong>at the time of the selected message</strong>. This way tags can show different values from those that were actually used.</p>

<p>That&rsquo;s why it&rsquo;s really important to start debugging by selecting the message that fired the tag. Any other message and you might see confusing data.</p>

<h3 id="32-variables-are-resolved-multiple-times-at-least-once-per-message">32. Variables are resolved multiple times - at least once per message</h3>

<p>If you&rsquo;ve ever created a variable with side effects and then gone to preview mode, you might have been surprised at what happens. For example, create a Custom JavaScript Variable with this:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">_testCount</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">_testCount</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">_testCount</span><span class="o">++</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>Now when you go to Preview mode, you&rsquo;ll see a bunch of alerts with a number that increments with each alert. Depending on how many messages are pushed into dataLayer and how many tags use this variable, you might see a huge number in the last alert box.</p>

<p>This is because GTM <strong>resolves variables in Preview mode multiple times</strong>. Preview mode needs to resolve the variables <em>at least</em> once per message pushed into dataLayer. Why? Because Preview mode must be able to tell you the value of each variable in each tag, trigger, variable, and message.</p>

<p>In a live container, variables won&rsquo;t be resolve this many times. Most likely they are only resolved when they are directly invoked, e.g. in triggers and tags upon injection.</p>

<h3 id="33-preview-can-be-minimized">33. Preview can be minimized</h3>

<p>The Preview mode panel can be visually obstructive, so it&rsquo;s a good thing the developers added a minimize button some time ago:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/minimize-preview.png" title="Minimize GTM preview">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/minimize-preview.png" layout="responsive" alt="Minimize GTM preview" height="566" width="1718"></amp-img>
  
    </a>
  


<p>After clicking it, you can bring the panel back up by clicking the small <strong>DEBUG ^</strong> icon in the lower right corner of the window.</p>

<h3 id="34-to-quit-preview-you-need-to-exit-preview-mode-via-the-gtm-ui">34. To quit preview, you need to exit preview mode via the GTM UI</h3>

<p>The easiest way to quit Preview mode is to go to the Google Tag Manager user interface and click the &ldquo;Leave preview mode&rdquo; link:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/leave-preview-mode.png" title="Leave preview mode">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/leave-preview-mode.png" layout="responsive" alt="Leave preview mode" height="676" width="2136"></amp-img>
  
    </a>
  


<p>You can also go to your browser&rsquo;s content settings, and delete all cookies written on the www.googletagmanager.com domain. This works with Shared Preview, too.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/remove-cookies.png" title="Exit preview and debug mode">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/remove-cookies.png" layout="responsive" alt="Exit preview and debug mode" height="502" width="1562"></amp-img>
  
    </a>
  


<p>Wouldn&rsquo;t it be handy if you could just quit Preview mode from the panel itself on the site? Yes, I think so too.</p>

<h3 id="35-to-quit-a-shared-preview-you-need-to-follow-the-original-link">35. To quit a shared preview, you need to follow the original link</h3>

<p>If you want to quit Preview mode that has been shared with you, you should follow the original Share Preview link and click &ldquo;Exit preview and debug mode&rdquo;.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/exit-preview-debug.png" title="Exit preview and debug mode">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/exit-preview-debug.png" layout="responsive" alt="Exit preview and debug mode" height="514" width="1672"></amp-img>
  
    </a>
  


<p>Note that you can also delete the cookies as described in the previous tip.</p>

<h3 id="36-problems-with-the-preview-mode-not-showing-correctly-are-most-typically-due-to-css-conflicts">36. Problems with the preview mode not showing correctly are most typically due to CSS conflicts</h3>

<p>Sometimes you might not see a Preview mode on a website at all. Other times the panel might be buggy, such as being partly transparent or completely white.</p>

<p>In these cases, it&rsquo;s most often a CSS conflict with the site code. GTM loads the panel on the website itself, so style conflicts can arise if they share the same namespace.</p>

<p>If this happens, your best bet is to contact the developer team via the Send Feedback link in the UI, or by posting the issue in the <a href="https://productforums.google.com/forum/#!forum/tag-manager">Product Forums</a>.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/send-feedback.png" title="Send feedback link">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/send-feedback.png" layout="responsive" alt="Send feedback link" height="598" width="1718"></amp-img>
  
    </a>
  


<h3 id="37-you-can-also-preview-without-the-debug-panel">37. You can also preview without the debug panel</h3>

<p>Note that you can also preview a container on the site without the benefit of the debug panel. Why you&rsquo;d want to do this when you can minimize the debug panel escapes me, but to do so you need to click the Share Preview link in the GTM UI, uncheck &ldquo;Turn on debugging when previewing&rdquo;, and then follow the link in your browser. This sets your browser into Preview mode without showing the debug panel.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/turn-off-debugging.png" title="Turn off debugging">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/turn-off-debugging.png" layout="responsive" alt="Turn off debugging" height="918" width="1138"></amp-img>
  
    </a>
  


<h3 id="38-preview-must-be-refreshed-after-every-change">38. Preview must be refreshed after every change</h3>

<p>GTM doesn&rsquo;t auto-refresh the Preview mode when you save changes in your container. You need to click the &ldquo;Refresh&rdquo; link to update the preview mode for yourself and anyone with the preview link.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/refresh-preview.png" title="Refresh preview link">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/refresh-preview.png" layout="responsive" alt="Refresh preview link" height="522" width="1534"></amp-img>
  
    </a>
  


<hr />

<h2 id="universal-analytics">Universal Analytics</h2>

<h3 id="39-gtm-creates-a-new-tracker-with-every-tag-instance">39. GTM creates a new tracker with every tag instance</h3>

<p>Unlike on-page Universal Analytics (analytics.js), Google Tag Manager creates a new, unique tracker object with every single tag that fires, even if they use the same template.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/multiple-trackers.png" title="Multiple trackers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/multiple-trackers.png" layout="responsive" alt="Multiple trackers" height="556" width="1506"></amp-img>
  
    </a>
  


<p>This might not be the most elegant technical design ever, but it&rsquo;s necessary in how GTM structures Universal Analytics tags. Basically each tag is its own sandbox, and settings are not shared from tag to tag.</p>

<h3 id="40-settings-are-not-shared-across-tags">40. Settings are not shared across tags</h3>

<p>Because each tag has a unique tracker, no settings are shared from tag to tag. This is very much unlike on-page Universal Analytics, where you create a single tracker and then invoke that tracker in commands like <code>ga('trackerName.send', 'pageview');</code>.</p>

<p>If you want to share settings of a single tag with other tags, currently you need to set the <strong>Tracker Name</strong> field in the tag settings. But before you do, read the next tip.</p>

<h3 id="41-you-can-set-a-tracker-name-but-most-often-this-is-risky-and-unnecessary">41. You can set a tracker name, but most often this is risky and unnecessary</h3>

<p>If you do set the Tracker Name, you are likely to run into a host of problems. First of all - ALL settings are shared across the two tags. This is because GTM sets all fields and Custom Dimension / Metrics on the tracker object itself rather than just the hit. So you&rsquo;ll need to take great care to reset any fields that you don&rsquo;t want values to leak into.</p>

<p>Until GTM introduces some type of shared tag settings feature, I suggest avoiding the tracker name setting and working with GTM variables instead. If you want a setting to apply across two or more tags, just replicate the setting in each tag and use a variable to populate the same value in all the tags.</p>

<h3 id="42-use-fields-to-set-for-setting-any-analytics-js-fields">42. Use Fields to Set for setting any analytics.js fields</h3>

<p>You can use Fields to Set to set any <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference">analytics.js</a> fields. These fields are set on the tracker object itself (see previous tip), but will work as if set on the hit itself.</p>

<p>You can also add <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters">Measurement Protocol parameters</a> to Fields to Set, but this is, in most cases, unnecessary.</p>

<h3 id="43-if-a-field-has-the-variable-icon-you-can-use-variables-in-it">43. If a field has the variable icon, you can use variables in it</h3>

<p>Fields in Google Tag Manager support adding a variable if the field has the variable icon next to it.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/variable-icon.png" title="variable icon in fields">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/variable-icon.png" layout="responsive" alt="variable icon in fields" height="392" width="1824"></amp-img>
  
    </a>
  


<p>By clicking the icon, a list of all available variables pops up. You can also use the auto-complete feature by typing <code>{{</code> into the field, after which an auto-complete menu shows, and you can continue typing to find the variable you&rsquo;re looking for.</p>

<hr />

<h2 id="enhanced-ecommerce">Enhanced Ecommerce</h2>

<h3 id="44-use-data-layer-option-uses-version-1-of-the-data-layer-variable">44. Use Data Layer option uses Version 1 of the Data Layer Variable</h3>

<p>When you select the <strong>Use Data Layer</strong> option in your Enhanced Ecommerce enabled Universal Analytics tags, GTM uses the Version 1 of the Data Layer Variable to locate the most recently pushed <code>ecommerce</code> key from the Data Layer.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/use-data-layer.png" title="Use Data Layer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/use-data-layer.png" layout="responsive" alt="Use Data Layer" height="398" width="1896"></amp-img>
  
    </a>
  


<p>Read that again. GTM only has access to the <strong>most recently pushed</strong> Enhanced Ecommerce payload in <code>dataLayer</code>. This means that if you first push impressions, for example, but don&rsquo;t fire a tag, and then you push a Product Detail View which does fire a tag, that tag will only access the Product Detail View data. The impressions data is lost in cyberspace, due to no tag firing when it was pushed to <code>dataLayer</code>. To avert this, either make sure you always add an <code>event</code> to all your Enhanced Ecommerce pushes, and always use a Custom Event Trigger to fire an Enhanced Ecommerce enable tag.</p>

<p>Alternatively, you can use the far more flexible Custom JavaScript variable method.</p>

<h3 id="45-requires-data-layer-object-to-be-syntactically-flawless">45. Requires Data Layer object to be syntactically flawless</h3>

<p>Enhanced Ecommerce is a bit different from how Data Layer typically works. Generally, you can push any key-value pairs into Data Layer, because you can always transform and mutate them in the GTM UI later on. However, when working with Enhanced Ecommerce, either via &ldquo;Use Data Layer&rdquo; or the Custom JavaScript Variable method, the payload must be syntactically accurate. It <strong>must</strong> have all the required keys, it <strong>must</strong> be structured correctly, and it <strong>must</strong> obey certain limitations to the structure (<a href="https://www.simoahava.com/amp/analytics/enhanced-ecommerce-tips-and-learnings/">more details about structure</a>).</p>

<p>You should always make sure you&rsquo;re following the official <a href="https://developers.google.com/tag-manager/enhanced-ecommerce">developer guide</a> to the letter.</p>

<h3 id="46-the-currency-type-is-just-a-string-with-a-monetary-value">46. The Currency type is just a string with a monetary value</h3>

<p>If you read the official <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/enhanced-ecommerce">Enhanced Ecommerce developer guide</a>, you might have noticed references to a type called &ldquo;currency&rdquo;.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/currency-type.png" title="Currency data type">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/currency-type.png" layout="responsive" alt="Currency data type" height="708" width="1782"></amp-img>
  
    </a>
  


<p>Well, there&rsquo;s no such data type in JavaScript. What the guide means is a string that has a monetary value (without currency symbol). Don&rsquo;t use a thousand separator (e.g. &ldquo;1 045.99&rdquo;), and use the period as the decimal character.</p>

<p>A valid &ldquo;currency&rdquo; type would be <code>&quot;1045.99&quot;</code>. Invalid types would be <code>&quot;1 045.99&quot;</code> and <code>&quot;1045,99&quot;</code>. Due to loose typing in JavaScript, you could just as well pass it as a number <code>1045.99</code>, but that will definitely lead to problems if the number is incorrectly formatted.</p>

<h3 id="47-product-scoped-custom-dimensions-and-metrics-need-to-be-formatted-correctly">47. Product-scoped Custom Dimensions and Metrics need to be formatted correctly</h3>

<p><a href="https://www.simoahava.com/amp/gtm-tips/product-scoped-custom-dimensions-and-metrics/">Product-scoped Custom Dimensions and Metrics</a> need to be formatted in a certain way to work. With regular Custom Dimensions and Metrics, all you need to do is add them to the tags under the respective tag settings.</p>

<p>However, in Enhanced Ecommerce, all the information must be in the payload. With Product-scoped Custom Dimensions and Metrics, this data must be in the <code>products</code> array, under each individual product you want to add the dimensions and metrics to. The dimensions and metrics must be named <code>dimensionX</code> and <code>metricX</code> where X is the index number for the given custom variable.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">ecommerce</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">purchase</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">actionField</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">},</span>
      <span class="nx">products</span><span class="o">:</span> <span class="p">[{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Shirt&#39;</span><span class="p">,</span>
        <span class="nx">dimension1</span><span class="o">:</span> <span class="s1">&#39;Red&#39;</span><span class="p">,</span>
        <span class="nx">metric1</span><span class="o">:</span> <span class="mi">132</span><span class="p">,</span>
        <span class="nx">quantity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">price</span><span class="o">:</span> <span class="s1">&#39;10.99&#39;</span>
      <span class="p">},{</span>
        <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Pants&#39;</span><span class="p">,</span>
        <span class="nx">dimension1</span><span class="o">:</span> <span class="s1">&#39;Black&#39;</span><span class="p">,</span>
        <span class="nx">dimension2</span><span class="o">:</span> <span class="s1">&#39;Adidas&#39;</span><span class="p">,</span>
        <span class="nx">metric1</span><span class="o">:</span> <span class="mi">133</span><span class="p">,</span>
        <span class="nx">quantity</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">price</span><span class="o">:</span> <span class="s1">&#39;13.99&#39;</span>
      <span class="p">}]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<h3 id="48-custom-javascript-variable-method-is-more-flexible-than-use-data-layer">48. Custom JavaScript variable method is more flexible than Use Data Layer</h3>

<p>I always implement Enhanced Ecommerce using the <a href="https://www.simoahava.com/amp/analytics/enhanced-ecommerce-with-a-custom-javascript-variable/">Custom JavaScript variable method</a>. It gives me so much more flexibility, as I can simply create the original <code>dataLayer</code> object as semantically unambiguous as possible, and then use the Custom JavaScript variable to mutate the object into the state the Enhanced Ecommerce requires. Why? Because I have plenty of other platforms that need the ecommerce data, too, and they might not be happy with the way that Google Tag Manager enforces a specific structure.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">order</span> <span class="o">=</span> <span class="p">{{</span><span class="nx">DLV</span> <span class="o">-</span> <span class="nx">Order</span><span class="p">}};</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">ecommerce</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">purchase</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">actionField</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">id</span><span class="o">:</span> <span class="nx">order</span><span class="p">.</span><span class="nx">orderId</span><span class="p">,</span>
          <span class="nx">revenue</span><span class="o">:</span> <span class="nx">order</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">totalWithTax</span><span class="p">,</span>
          <span class="nx">tax</span><span class="o">:</span> <span class="nx">order</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">taxValue</span><span class="p">,</span>
          <span class="nx">affiliation</span><span class="o">:</span> <span class="nx">order</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">name</span>
        <span class="p">},</span>
        <span class="nx">products</span><span class="o">:</span> <span class="p">[</span><span class="nx">order</span><span class="p">.</span><span class="nx">productsForGTM</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span></code></pre></div>



    <a href="https://www.simoahava.com/amp/images/2017/02/eec-custom-javascript-variable.png" title="Enhanced Ecommerce Custom JavaScript Variable">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/eec-custom-javascript-variable.png" layout="responsive" alt="Enhanced Ecommerce Custom JavaScript Variable" height="418" width="1756"></amp-img>
  
    </a>
  


<p>The Custom JavaScript variable itself is simple. All you need to do is make sure it returns a valid Enhanced Ecommerce object as required by Google Tag Manager.</p>

<hr />

<h2 id="triggers">Triggers</h2>

<h3 id="49-variables-can-only-be-used-to-check-against">49. Variables can only be used to check against</h3>

<p>This is perhaps slightly oddly worded, but what I mean is that you can only use a variable as the thing in the trigger whose value you are checking. You can&rsquo;t use a variable as the condition value itself.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/variables-in-triggers.png" title="Variables in triggers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/variables-in-triggers.png" layout="responsive" alt="Variables in triggers" height="510" width="1848"></amp-img>
  
    </a>
  


<h3 id="50-use-a-custom-javascript-variable-to-check-for-dynamic-values">50. Use a Custom JavaScript variable to check for dynamic values</h3>

<p>If you DO want to check against dynamic values in your triggers, you can always use a Custom JavaScript variable. Let&rsquo;s say you want to check if the clicked URL contains the current page hostname. Why? Because you want a trigger that fires only for clicks on links that take the user away from the website. This is what the Custom JavaScript variable might look like:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{{</span><span class="nx">Click</span> <span class="nx">URL</span><span class="p">}}.</span><span class="nx">indexOf</span><span class="p">({{</span><span class="nx">Page</span> <span class="nx">Hostname</span><span class="p">}})</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>This variable returns <code>true</code> if the clicked URL contains the current page hostname, and <code>false</code> otherwise. Now you can use a trigger like this:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/dynamic-trigger-variable.png" title="Dynamic trigger with Custom JavaScript variable">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/dynamic-trigger-variable.png" layout="responsive" alt="Dynamic trigger with Custom JavaScript variable" height="940" width="2048"></amp-img>
  
    </a>
  


<h3 id="51-event-is-implicit-in-all-but-the-custom-event-trigger">51. <code>'event'</code> is implicit in all but the Custom Event trigger</h3>

<p>All triggers require an <code>event</code> key in <code>dataLayer</code> to fire. Thus, when you create a trigger, they check for the value of <code>event</code>, and if there&rsquo;s a match the trigger fires. Only the Custom Event trigger requires you to explicitly state the value of <code>event</code> you want to fire against. Here are the basic trigger types and their implicit <code>event</code> values:</p>

<ul>
<li><p>DOM Ready - gtm.dom</p></li>

<li><p>Page View - gtm.js</p></li>

<li><p>Window Loaded - gtm.load</p></li>

<li><p>Click / All Elements - gtm.click</p></li>

<li><p>Click / Just Links - gtm.linkClick</p></li>

<li><p>Form submission - gtm.formSubmit</p></li>

<li><p>History Change - gtm.historyChange</p></li>

<li><p>JavaScript Error - gtm.pageError</p></li>

<li><p>Timer - gtm.timer</p></li>

<li><p>Scroll Depth - gtm.scrollDepth</p></li>

<li><p>YouTube Video - gtm.video</p></li>
</ul>

<h3 id="52-multiple-trigger-conditions-are-and-multiple-triggers-are-or">52. Multiple trigger conditions are AND, multiple triggers are OR</h3>

<p>Multiple conditions in a single trigger <strong>must ALL match</strong> for the trigger to fire. Thus a trigger like this should never work:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/multiple-conditions.png" title="Multiple trigger conditions">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/multiple-conditions.png" layout="responsive" alt="Multiple trigger conditions" height="660" width="1778"></amp-img>
  
    </a>
  


<p>Why won&rsquo;t it work? Because the hostname of the current page can&rsquo;t be two things at once.</p>

<p>If you add multiple triggers to a tag, then <strong>any one of these will fire the tag</strong>. So, if you want your tag to fire when the page hostname is either www.domain.com or www.other-domain.com, you can create two triggers, one for each hostname, and add both to the tag.</p>

<h3 id="53-use-regular-expressions-or-custom-javascript-variables-to-add-optionality-in-a-single-trigger">53. Use regular expressions or Custom JavaScript variables to add optionality in a single trigger</h3>

<p>There&rsquo;s an easier way to introduce optionality, though. First, if it&rsquo;s a simple string check, you can always use <a href="http://www.regular-expressions.info/quickstart.html">regular expressions</a>.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/regex-trigger.png" title="Regex in triggers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/regex-trigger.png" layout="responsive" alt="Regex in triggers" height="580" width="1802"></amp-img>
  
    </a>
  


<p>If you have more complex logic, a Custom JavaScript variable is your best friend, again.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">hn</span> <span class="o">=</span> <span class="p">{{</span><span class="nx">Page</span> <span class="nx">Hostname</span><span class="p">}},</span>
      <span class="nx">ut</span> <span class="o">=</span> <span class="p">{{</span><span class="nx">DLV</span> <span class="o">-</span> <span class="nx">userType</span><span class="p">}};</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hn</span> <span class="o">===</span> <span class="s1">&#39;www.mydomain.com&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">ut</span> <span class="o">===</span> <span class="s1">&#39;visitor&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;visitor&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hn</span> <span class="o">===</span> <span class="s1">&#39;www.mydomain.com&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">ut</span> <span class="o">===</span> <span class="s1">&#39;member&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;member&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hn</span> <span class="o">===</span> <span class="s1">&#39;www.other-domain.com&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">ut</span> <span class="o">===</span> <span class="s1">&#39;loyal&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;loyal&#39;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s1">&#39;other&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<hr />

<h2 id="auto-event-trigger">Auto-event trigger</h2>

<h3 id="54-just-links-listens-to-clicks-on-a-elements-and-their-descendants">54. Just Links listens to clicks on <code>&lt;a&gt;</code> elements and their descendants</h3>

<p>When you create a <strong>Just Links</strong> trigger, it listens to clicks on <code>&lt;a&gt;</code> elements and their descendants. When a click is registered, Google Tag Manager checks if there is a link node wrapping the clicked element, and if there is, GTM stores a reference to the link in the <code>dataLayer</code>.</p>

<p>For example, say the page HTML looks like this:</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;content&#34;</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://www.google.com/&#34;</span><span class="p"></span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span><span class="p"></span><span class="p">&gt;</span>Google<span class="p">&lt;</span><span class="p">/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></div>

<p>If someone clicks on the link, the click actually falls on the <code>&lt;span&gt;</code> element, but the Just Links trigger propagates the click to the <code>&lt;a&gt;</code> element, and returns that for you to leverage with Auto-event variables.</p>

<h3 id="55-all-elements-listens-to-all-clicks">55. All Elements listens to all clicks</h3>

<p>All Elements, on the other hand, listens to all clicks and returns the element that was actually clicked. In the HTML example above, the All Elements trigger would return the <code>&lt;span&gt;</code> element because that&rsquo;s the element that was actually clicked.</p>

<h3 id="56-form-listens-to-a-submit-event-dispatched-by-a-form-element">56. Form listens to a <code>submit</code> event dispatched by a <code>&lt;form&gt;</code> element</h3>

<p>The Form trigger only works with an actual <code>&lt;form&gt;</code> element submitted with default HTML form functionality. This means that there actually needs to be a <code>submit</code> event dispatched by the form, and it must be allowed to bubble up.</p>

<p>Any custom server-side validation, suppressing of the <code>submit</code> event, or customized form handling will result in the Form trigger not working. Thus, the Form trigger is typically the trigger you&rsquo;ll have the most difficulties with due to the ridiculously diverse number of ways that forms can be handled with JavaScript.</p>

<h3 id="57-history-change-listens-to-interactions-with-the-browser-history-api">57. History Change listens to interactions with the browser history API</h3>

<p>The History Change trigger listens for the following browser history API events: <code>hashchange</code>, <code>pushState</code>, <code>replaceState</code> and <code>popstate</code>.</p>

<p>Typically these are used on single-page websites, where page transitions are done without a page refresh.</p>

<p>When creating History Change triggers, you&rsquo;ll typically want to work mainly with <code>pushState</code> and <code>replaceState</code>, as those are managed by the by the site code itself. <code>popstate</code> and <code>hashchange</code> can be triggered automatically by the web browser (and there are differences between browsers), which might lead to inaccuracies in your tracking.</p>

<h3 id="58-error-listens-to-uncaught-javascript-exceptions">58. Error listens to uncaught JavaScript exceptions</h3>

<p>The Error triggers listens to <strong>uncaught</strong> JavaScript errors that occur on the website. If there&rsquo;s a <code>try...catch</code> block anywhere in the error path, this trigger will not react to it.</p>

<p>Do note that Custom JavaScript variables automatically catch all exceptions, so this trigger will not help you debug errors in Custom JavaScript variables.</p>

<h3 id="59-all-triggers-but-the-click-all-elements-trigger-require-that-the-original-event-bubble-up">59. All triggers but the Click / All Elements trigger require that the original event bubble up</h3>

<p>Google Tag Manager attaches its auto-event listeners to the <code>document</code> element of the page. This is the highest node in the web document. The reason GTM does this is because it allows you to handle events that take place anywhere on the page, even for elements that don&rsquo;t exist when GTM first loads.</p>

<p>For this type of <em>event delegation</em> to work, the event must bubble up to the top of the document. It&rsquo;s surprising how often bubbling is cancelled, leading to GTM&rsquo;s events not working.</p>

<p>The only exception is the All Elements trigger, which uses the <em>capture</em> phase of the event path. This means that even if bubbling is stopped, the <em>capture</em> phase can still record the click. So if you find your Just Links trigger isn&rsquo;t working, you can recreate the same logic with an All Elements trigger and some clever CSS selector / Custom JavaScript variable work.</p>

<p>For more information, see e.g. this article on <a href="https://www.simoahava.com/amp/gtm-tips/fix-problems-with-gtm-listeners/">GTM listener issues</a>, and this on <a href="https://www.simoahava.com/amp/analytics/capturing-the-correct-element-in-google-tag-manager/">element capturing with the All Elements trigger</a>.</p>

<h3 id="60-check-validation-checks-for-event-preventdefault">60. Check Validation checks for <code>event.preventDefault()</code></h3>

<p>If you have <strong>Check Validation</strong> checked in your Just Links or Form trigger, the trigger will only fire if the event&rsquo;s default action is not cancelled.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/check-validation.png" title="Check Validation">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/check-validation.png" layout="responsive" alt="Check Validation" height="628" width="1856"></amp-img>
  
    </a>
  


<p>This is a useful feature to leverage, since often the default action of a link (redirect) or a form (submit) is prevented due to the link simply changing a content tab, or the form being incorrectly filled, for example. In these cases, you&rsquo;ll want to have Check Validation checked, because you probably don&rsquo;t want to track clicks on links that don&rsquo;t redirect or submissions of forms that don&rsquo;t actually submit.</p>

<h3 id="61-wait-for-tags-pauses-the-original-event-but-be-careful">61. Wait for Tags pauses the original event, but be careful</h3>

<p>If you use the <strong>Wait for Tags</strong> option in the Just Links or Form triggers, Google Tag Manager halts the action of the link or form, respectively, to wait until all tags that use the trigger have fired. After tags signal completion, GTM allows the original event to continue.</p>

<p>This is a great feature. It mitigates the risk of losing data due to the link or form redirecting the user to a new page before the tags that use the trigger have fired.</p>

<p>However, there are many ways to do custom link redirects and form submissions. When GTM pauses the event, it&rsquo;s not 100% reliable GTM understands what the custom behavior was. Thus, when GTM then proceeds with the paused action, it might be a different action altogether that GTM resumes.</p>

<p>This is typical in single-page apps, where internal links have a lot of complex logic added to them to prevent links from redirecting the user to new URLs.</p>

<p>So, when you use the Wait for Tags option, <strong>always remember to test the pages where the trigger is active</strong>. Test links and forms, both, to make sure that their functionalities are not compromised. If you are in doubt, simply uncheck Wait for Tags and accept a certain level of inaccuracy in your tracking.</p>

<h3 id="62-enable-this-trigger-when-vs-this-trigger-fires-on">62. Enable this trigger when&hellip; vs. This trigger fires on&hellip;</h3>

<p>If you do check Wait for Tags or Check Validation, you&rsquo;ll see the &ldquo;Enable this trigger when&hellip;&rdquo; option appear in the trigger settings.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/enable-this-trigger.png" title="Enable this trigger vs. fire on">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/enable-this-trigger.png" layout="responsive" alt="Enable this trigger vs. fire on" height="1150" width="1894"></amp-img>
  
    </a>
  


<p>The &ldquo;Enable this trigger when&hellip;&rdquo; option is for determining <strong>on which pages the trigger should listen to actions</strong>. Thus you can use it to have the trigger listen only on pages where you have thoroughly tested the trigger doesn&rsquo;t mess with site functionality.</p>

<p>It&rsquo;s a good idea to start with a generic <strong>Page URL contains /</strong> condition here, as it will simply set the trigger to listen to user actions on all pages of the site. If you do run into trouble, you can modify this condition to only activate the trigger on a specific subset of pages.</p>

<p>The &ldquo;This trigger fires on&hellip;&rdquo; option is for determining what conditions OTHER than the trigger event itself need to exist for any tags which use the trigger to fire. This is where you&rsquo;ll add your &ldquo;Click URL&rdquo; and &ldquo;Form ID&rdquo; conditions, for example.</p>

<h3 id="63-data-layer-object-composition-of-an-auto-event">63. Data Layer object composition of an auto-event</h3>

<p>When an auto-event trigger fires, the following items are pushed into <code>dataLayer</code>:</p>

<ul>
<li><p><code>event</code> - gets the value of the trigger event that was registered.</p></li>

<li><p><code>gtm.element</code> - reference to the HTML element that was the target of the event.</p></li>

<li><p><code>gtm.elementClasses</code> - string with the value from the <code>class</code> attribute of the target element (if any).</p></li>

<li><p><code>gtm.elementId</code> - string with the value from the <code>id</code> attribute of the target element (if any).</p></li>

<li><p><code>gtm.elementTarget</code> - string with the value from the <code>target</code> attribute of the target element (if any).</p></li>

<li><p><code>gtm.elementUrl</code> - string with the value from the <code>href</code> or <code>action</code> attribute of the target element (if any).</p></li>

<li><p><code>gtm.triggers</code> - a regular expression which determines if the trigger that activated is enabled on the current page.</p></li>
</ul>

<p>In addition to these, you might see variables like <code>gtm.uniqueEventId</code>, <code>eventCallback</code>, <code>eventTimeout</code> and <code>eventReporter</code>. These are internal to GTM, but suffice to say that they govern how the Wait for Tags option works, among other things.</p>

<h3 id="64-auto-event-variable">64. Auto-event variable</h3>

<p>If you&rsquo;re not satisfied with the Built-in variables (Click / Form) for auto-events, you can create your own. Google Tag Manager has a user-defined variable type called Auto-Event Variable, which lets you analyse pretty much any part of the auto-event target element you want.</p>

<p>For example, if you&rsquo;ve added a custom data attribute <code>data-gtm-cta=&quot;Subscribe call to action&quot;</code>, and you want to check if the clicked link has this data attribute, you can create a new Auto-Event Variable that looks like this:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/auto-event-variable.png" title="Auto-event variable">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/auto-event-variable.png" layout="responsive" alt="Auto-event variable" height="674" width="1804"></amp-img>
  
    </a>
  


<p>This comes in very handy, as you won&rsquo;t be limited to the rather small number of available built-in variables.</p>

<h3 id="65-matches-css-selector-with-the-click-form-element-built-in-variable">65. Matches CSS selector with the Click / Form Element built-in variable</h3>

<p>The <strong>matches CSS selector</strong> is <a href="https://www.simoahava.com/amp/analytics/matches-css-selector-operator-in-gtm-triggers/">one of the most effective ways</a> you can create triggers in Google Tag Manager. When combined with the Click / Form Element Built-in variable, it gains a whole new level of awesomeness.</p>

<p>You can write complex CSS selectors to check whether the element that was the target of the auto-event matches what you expect. For example, let&rsquo;s say you have the following HTML structure:</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;products&#34;</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;some-product.html&#34;</span><span class="p"></span><span class="p">&gt;</span>Product/a&gt;
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;services&#34;</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p"></span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;some-service.html&#34;</span><span class="p"></span><span class="p">&gt;</span>Service<span class="p">&lt;</span><span class="p">/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></div>

<p>Now, you only want your Just Links trigger to fire when the user clicks the &ldquo;Product&rdquo; link. However, as you can see, the HTML structures between &ldquo;Product&rdquo; and &ldquo;Service&rdquo; are almost identical, making it difficult to pinpoint the exact element without having to resort to suboptimal selection mechanisms. Well, CSS selectors to the rescue. The following Just Links trigger will only fire when the click is on a link that is the descendant of a <code>div</code> with the id <code>&quot;products&quot;</code>:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/matches-css-selector.png" title="Matches css selector">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/matches-css-selector.png" layout="responsive" alt="Matches css selector" height="720" width="1798"></amp-img>
  
    </a>
  


<p>Just remember: <strong>matches CSS selector only works against an HTML element</strong>. So don&rsquo;t try to match a selector against the Click ID or Click URL variables, for example. Only Click / Form Element will do.</p>

<hr />

<h2 id="custom-html-tags">Custom HTML tags</h2>

<h3 id="66-code-is-automatically-minified">66. Code is automatically minified</h3>

<p>Custom HTML tags automatically minify / uglify the JavaScript, so no need to do so yourself.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/minified-custom-html-tag.png" title="Minified custom HTML tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/minified-custom-html-tag.png" layout="responsive" alt="Minified custom HTML tag" height="1036" width="1796"></amp-img>
  
    </a>
  


<h3 id="67-code-is-injected-to-the-end-of-body">67. Code is injected to the end of <code>&lt;body&gt;</code></h3>

<p>When you write HTML code in a Custom HTML tag, the entire code block is always injected to the end of <code>&lt;body&gt;</code> when the trigger fires for the tag.</p>

<p>If you want to place the HTML code somewhere else, you need to write JavaScript (within the Custom HTML tag) that creates a new HTML element with your specifications, and then uses DOM methods to place it wherever you like on the page.</p>

<h3 id="68-can-be-used-to-add-any-html-elements">68. Can be used to add any HTML elements</h3>

<p>You can use the Custom HTML tag to add any supported HTML5 code to the page. This means that tags such as these are all supported: <code>meta</code>, <code>link</code>, <code>style</code>, <code>video</code>, <code>script</code>, and so forth.</p>

<p>Naturally, with some JavaScript DOM magic, you can also <strong>modify</strong> existing elements or even remove them entirely from the page.</p>

<h3 id="69-the-document-write-option-is-fixed-to-prevent-the-site-from-breaking">69. The <code>document.write</code> option is fixed to prevent the site from breaking</h3>

<p>If you are adding a script which makes use of <code>document.write</code> to place elements on the page, you will need to check the &ldquo;Support document.write&rdquo; option in the Custom HTML tag editor.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/support-document-write.png" title="Support document.write">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/support-document-write.png" layout="responsive" alt="Support document.write" height="666" width="1988"></amp-img>
  
    </a>
  


<p>If you don&rsquo;t check this option, you run the risk of the <code>document.write</code> command clearing the entire page of all contents because of how <code>document.write</code> works post-page-load.</p>

<p>Dan Wilkerson has written a great <a href="https://www.simoahava.com/amp/gtm-tips/using-document-write-safely-gtm-tags/">guest post on this topic</a>, so remember to check it out for more information.</p>

<h3 id="70-variables-are-automatically-renamed-in-custom-html-tags-too">70. Variables are automatically renamed in Custom HTML tags, too</h3>

<p>Did you know that when you create a variable reference in GTM with <strong>{{Variable Name}}</strong> and you then change the variable name to <strong>{{Some Other Variable Name}}</strong>, all references are automatically updated?</p>

<p>Well this applies to Custom HTML tags, too, so you don&rsquo;t have to worry about syntax errors when renaming variables. The new name will be automatically applied to all places in the container where the variable is referred to.</p>

<hr />

<h2 id="built-in-variables">Built-in variables</h2>

<h3 id="71-need-to-be-enabled">71. Need to be enabled</h3>

<p>The only Built-in Variables enabled by default in your web container are <strong>Event</strong>, <strong>Page URL</strong>, <strong>Page Path</strong>, <strong>Page Hostname</strong> and <strong>Referrer</strong>.</p>

<p>To enable others, go to <strong>Variables</strong> and click the red <strong>CONFIGURE</strong> under the heading &ldquo;Built-In Variables&rdquo;.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/built-in-variables-enable.png" title="Enable built-in variables">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/built-in-variables-enable.png" layout="responsive" alt="Enable built-in variables" height="886" width="2090"></amp-img>
  
    </a>
  


<p>In the overlay that flies out, check the box next to each Built-in variable you want to enable. Only after enabling the variables will they be available in variable selection drop-downs.</p>

<h3 id="72-click-and-form-variables-are-copies-of-each-other">72. Click and Form variables are copies of each other</h3>

<p>You might have noticed that there&rsquo;s a very similar set of six auto-event Built-in variables: Click/Form Element, Click/Form ID, Click/Form URL, Click/Form Target, Click/Form Classes, Click/Form Text.</p>

<p>These are identical in functionality, so you really only need to enable either Click or Form Built-in variables.</p>

<hr />

<h2 id="custom-javascript-variables">Custom JavaScript variables</h2>

<h3 id="73-must-be-anonymous-functions">73. Must be anonymous functions</h3>

<p>When you create a Custom JavaScript variable, it should be an anonymous function. Yes, you can name it, but it doesn&rsquo;t matter since there&rsquo;s no way to call the variable with its name, as it&rsquo;s locally scoped to whatever execution context invokes the variable when your container needs to do so.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Not ideal:
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">clickTextLowercase</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{{</span><span class="nx">Click</span> <span class="nx">Text</span><span class="p">}}.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Use this:
</span><span class="c1"></span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{{</span><span class="nx">Click</span> <span class="nx">Text</span><span class="p">}}.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span></code></pre></div>

<p>To avoid any potential namespace conflicts, just use an anonymous function, since you call GTM&rsquo;s variables with the  syntax and not with whatever name you give the method itself.</p>

<h3 id="74-must-have-a-return-statement">74. Must have a <code>return</code> statement</h3>

<p>All Custom JavaScript variables must have a <code>return</code> statement or Google Tag Manager will throw an error when you try to create a version of the container.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Will not work:
</span><span class="c1"></span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Works:
</span><span class="c1"></span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h3 id="75-can-be-used-to-return-another-function">75. Can be used to return another function</h3>

<p>Remember that a Custom JavaScript variable is just regular JavaScript, and as such you can use it to return another function. This is also called returning a <strong>closure</strong>.</p>

<p>For example, let&rsquo;s say I want to create a utility function that takes a string as an argument and reverses all letters in it. First, I&rsquo;d create a Custom JavaScript variable like this:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">}</span></code></pre></div>

<p>Then, when I want to use this utility in a Custom HTML tag or another variable, I can pass any string to the GTM variable as an attribute:</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a reference to the Custom JavaScript variable we just created
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">reverseString</span> <span class="o">=</span> <span class="p">{{</span><span class="nx">JS</span> <span class="o">-</span> <span class="nx">ReverseString</span><span class="p">}}</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;reverseComplete&#39;</span><span class="p">,</span>
      <span class="nx">reversedString</span><span class="o">:</span> <span class="nx">reverseString</span><span class="p">(</span><span class="s2">&#34;Reverse me!&#34;</span><span class="p">)</span>
    <span class="p">});</span>
  <span class="p">})();</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>

<p>This Custom HTML tag calls the function returned by the Custom JavaScript variable with the string &ldquo;Reverse me!&rdquo;, resulting in a <code>dataLayer.push()</code> where the key <code>reversedString</code> will have the value &ldquo;!em esreveR&rdquo;.</p>

<h3 id="76-should-avoid-side-effects">76. Should avoid side effects</h3>

<p>Custom JavaScript variables should avoid side effects. In other words, they shouldn&rsquo;t do anything except process an input and produce an output. Any transformations or mutations should happen in local scope alone.</p>

<p>If you don&rsquo;t respect this, you might run into all sorts of issues due to the fact that Google Tag Manager&rsquo;s resolution of variables is unpredictable and can&rsquo;t be counted on to only happen once per tag.</p>

<p>Here are some things to avoid:</p>

<ul>
<li><p>Modifying, creating, or deleting items in the global <code>window</code> namespace.</p></li>

<li><p>Creating or processing custom HTTP requests.</p></li>

<li><p>Setting or removing items in globally available APIs, such as <code>dataLayer</code>, <code>google_tag_manager</code>, <code>document.cookie</code> and <code>localStorage</code>.</p></li>
</ul>

<p>If you do want to modify global state, use Custom HTML tags or closures instead.</p>

<h3 id="77-can-refer-to-other-variables">77. Can refer to other variables</h3>

<p>This might seem like a no-brainer, but you can freely refer to other variables in Custom JavaScript variables, too.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">hostname</span> <span class="o">=</span> <span class="p">{{</span><span class="nx">Page</span> <span class="nx">Hostname</span><span class="p">}};</span>
  <span class="k">return</span> <span class="nx">hostname</span> <span class="o">===</span> <span class="s1">&#39;www.domain.com&#39;</span> <span class="o">?</span> <span class="s1">&#39;Main domain&#39;</span> <span class="o">:</span> <span class="s1">&#39;Other domain&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<hr />

<h2 id="tag-sequencing">Tag sequencing</h2>

<h3 id="78-setup-and-cleanup-are-fired-with-the-main-tag-regardless-of-their-own-triggers">78. Setup and cleanup are fired with the main tag, regardless of their own triggers</h3>

<p>When you add a Setup or Cleanup tag to a sequence with a main tag, the Setup and Cleanup will be fired with the main tag regardless of what triggers they might actually have themselves.</p>

<p>So here&rsquo;s a tip: When creating Setup and Cleanup tags, <strong>use them only for that purpose</strong> and do not add any triggers to them. This way you will never run the risk of these tags firing when they shouldn&rsquo;t, as they are strictly bound to whatever sequence they are in.</p>

<h3 id="79-use-onhtmlsuccess-and-onhtmlfailure-to-signal-that-the-sequence-can-continue">79. Use <code>onHtmlSuccess()</code> and <code>onHtmlFailure()</code> to signal that the sequence can continue</h3>

<p>When you have a Custom HTML tag as a Setup or Main tag, you can let Google Tag Manager know if the tag completed successfully or failed by using the <code>onHtmlSuccess()</code> and <code>onHtmlFailure()</code> methods.</p>

<p>For these to work, you first need to enable Built-in variables <strong>Container ID</strong> and <strong>HTML ID</strong>.</p>

<p>Here&rsquo;s an example of a Custom HTML Setup tag, where we wait for the asynchronous POST request to complete before telling GTM to continue to the main tag. If the asynchronous request fails, we tell GTM that the Setup tag was a failure.</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/test.php&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">google_tag_manager</span><span class="p">[{{</span><span class="nx">Container</span> <span class="nx">ID</span><span class="p">}}].</span><span class="nx">onHtmlSuccess</span><span class="p">({{</span><span class="nx">HTML</span> <span class="nx">ID</span><span class="p">}});</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">google_tag_manager</span><span class="p">[{{</span><span class="nx">Container</span> <span class="nx">ID</span><span class="p">}}].</span><span class="nx">onHtmlFailure</span><span class="p">({{</span><span class="nx">HTML</span> <span class="nx">ID</span><span class="p">}});</span>
      <span class="p">});</span>
  <span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>

<p>If you didn&rsquo;t have the <code>onHtmlSuccess/Failure()</code> methods there, Google Tag Manager would simply signal completion as soon as it reaches the last line of code in the tag. Thus the browser won&rsquo;t wait for any asynchronous requests to complete, and you might end up with a nasty race condition if you need the request to complete before proceeding with the Main tag.</p>

<h3 id="80-use-datalayer-set-to-change-data-layer-variable-values-mid-sequence">80. Use <code>dataLayer.set()</code> to change Data Layer variable values mid-sequence</h3>

<p>If you want to change some value in GTM&rsquo;s Data Layer while in the middle of a sequence, you can&rsquo;t use <code>dataLayer.push()</code>, because GTM freezes its state for the duration of each message that is pushed into <code>dataLayer</code>.</p>

<p>However, there&rsquo;s a workaround. You CAN update the value of GTM&rsquo;s Data Layer variables, even though the same <code>dataLayer</code> message is still being processed. To do this, you need to use the <code>google_tag_manager[{{Container ID}}].dataLayer.set('keyName', 'value')</code> interface you learned of here.</p>

<hr />

<h2 id="tag-settings">Tag settings</h2>

<h3 id="81-once-per-page-is-once-per-page-load-once-per-event-is-once-per-gtm-event">81. Once per page is once per page load, once per event is once per GTM event</h3>

<p>There are three options in the <strong>Tag firing options</strong> menu that you can find at the end of each tag&rsquo;s settings.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/tag-firing-options.png" title="Tag firing options">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/tag-firing-options.png" layout="responsive" alt="Tag firing options" height="792" width="1898"></amp-img>
  
    </a>
  


<p><strong>Unlimited</strong> means the tag will fire whenever its triggers fire - no restrictions.</p>

<p><strong>Once per event</strong> means that the tag will fire just once per the trigger event that caused it to fire. Thus if you have, for example, multiple Click triggers attached to the tag, and there&rsquo;s a chance that some of these have overlapping trigger conditions, <strong>Once per event</strong> ensures that the tag fires just once per click.</p>

<p><strong>Once per page</strong> means that the tag will fire only once per page load. No matter what triggers you have attached to it - if the tag fires on the page, it will not fire again until the page is reloaded from the web server. Tag Sequencing respects this, too, so if a Setup or Cleanup tag are set to fire just once per page, they will not fire multiple times even if the main tag does.</p>

<h3 id="82-tag-priority-is-for-a-single-gtm-event-doesn-t-necessarily-mean-tags-are-completed-in-the-given-order">82. Tag priority is for a single GTM event - doesn&rsquo;t necessarily mean tags are completed in the given order</h3>

<p>The <strong>Tag priority</strong> field can be used to establish an order execution for tags that fire on the same trigger event. When a trigger event happens, Google Tag Manager executes tags in order of priority.</p>

<p>Note that Tag priority only establishes the order in which tags <strong>begin execution</strong>. It has no implications on when they <strong>complete</strong>. Thus, even if a tag starts its execution first, it might have a long, complex, asynchronous process involved, and it still ends up completing only after tags later in the priority order have already finished.</p>

<hr />

<h2 id="workspaces">Workspaces</h2>

<h3 id="83-you-will-always-have-at-least-one-workspace">83. You will always have at least one workspace</h3>

<p>Workspaces have come to stay, and it&rsquo;s impossible to use Google Tag Manager without a workspace.</p>

<p>Thus, even if you try to delete all workspaces, GTM will always leave you with one.</p>

<h3 id="84-when-you-create-a-version-out-of-a-workspace-that-workspace-is-deleted">84. When you create a version out of a workspace, that workspace is deleted</h3>

<p>Workspaces are ephemeral - they only exist until a version is created from them. Once you create a version, it&rsquo;s as if the workspace never existed. Thus workspaces shouldn&rsquo;t be used as permanent container subsets that you could, for example, delegate to a certain user group only. Instead, workspaces should be approached as branches of a version control system. When you start working on a new feature, create a workspace first so that any changes you make are contained until you choose to create a version and merge the changes to the latest container version.</p>

<h3 id="85-you-don-t-have-to-update-your-workspace-until-you-are-ready-to-create-a-version">85. You don&rsquo;t have to update your workspace until you are ready to create a version</h3>

<p>When someone else updates the latest container version, all the workspaces in the container need to be updated. You&rsquo;ll know this has happened when you see the following notice in the GTM UI:</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/update-workspace.png" title="Update workspace">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/update-workspace.png" layout="responsive" alt="Update workspace" height="572" width="1716"></amp-img>
  
    </a>
  


<p>You don&rsquo;t <em>have</em> to update the workspace the minute you see this warning. You can bide your time, and only sync the changes once you are ready to create a version out of your workspace.</p>

<p>Nevertheless, the sooner you update the better. Why? Because once merges start piling up, you&rsquo;ll have a hard time resolving all the conflicts at once.</p>

<hr />

<h2 id="amp-container">AMP container</h2>

<h3 id="86-no-custom-javascript-or-custom-html">86. No Custom JavaScript or Custom HTML</h3>

<p>Accelerated Mobile Pages place some pretty strict restrictions on what you can use Google Tag Manager for. You can&rsquo;t execute arbitrary JavaScript code anymore, nor can you simply inject HTML via Google Tag Manager. In fact, all dynamic operations need to be handled server-side in GTM, because all that GTM returns is the AMP configuration JSON object, which has very limited capabilities for any advanced tracking.</p>

<p>So no Custom JavaScript variables or Custom HTML tags in the AMP container, unfortunately.</p>

<h3 id="87-amp-is-very-restricting">87. AMP is very restricting</h3>

<p>As said, AMP is very restricting. Only JavaScript sanctioned by AMP and provided as an AMP module can be executed. This means that the development of the GTM AMP container is bound very closely to the roadmap of AMP itself. Any attempts to deviate would result in an invalid configuration JSON, which would, in turn, lead to an invalid AMP page.</p>

<p>It&rsquo;s a good idea to closely follow the <a href="https://www.ampproject.org/docs/reference/components/amp-analytics">amp-analytics</a> project, as it contains the latest release details for the amp-analytics module. This is the module used by Google Tag Manager&rsquo;s AMP container.</p>

<h3 id="88-client-id-is-currently-ambiguous">88. Client ID is (currently) ambiguous</h3>

<p>Universal Analytics&rsquo; Client ID is problematic with AMP, especially when run through the GTM container. There are actually <a href="https://developers.google.com/analytics/devguides/collection/amp-analytics/client-id#client_id_scenarios">four</a> different Client ID scenarios for AMP analytics.</p>

<ol>
<li><p>When visiting the regular site (no AMP): <code>_ga</code> cookie stores the Universal Analytics Client ID.</p></li>

<li><p>When visiting the regular site (AMP): <code>AMP_ECID_GOOGLE</code> cookie stores a randomly generated AMP Client ID.</p></li>

<li><p>When visiting the site via the AMP cache: the AMP client ID is stored in <code>localStorage</code> on the ampproject.org domain.</p></li>

<li><p>When visiting the site via Google search: the AMP client ID is stored on google.com and ampproject.org in <code>localStorage</code>.</p></li>
</ol>

<p>In all of these scenarios, it&rsquo;s possible that the Client ID is different, which means that you&rsquo;ll have quite a bit of difficulty in tracking the same user across AMP and non-AMP sites, or between Google search and direct access to the site.</p>

<p>Some time ago, Dan Wilkerson and I <a href="https://www.simoahava.com/amp/analytics/google-analytics-client-id-amp-pages/">wrote a hack around this</a>, which does require some web server muscle, but it will make sure that all the scenarios above use the same Universal Analytics client ID in the <code>_ga</code> cookie.</p>

<h3 id="89-new-triggers-e-g-scroll">89. New triggers, e.g. scroll</h3>

<p>AMP introduces a bunch of really useful triggers, which I hope we&rsquo;ll see in GTM for web soon, too.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/amp-triggers.png" title="AMP triggers">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/amp-triggers.png" layout="responsive" alt="AMP triggers" height="714" width="1786"></amp-img>
  
    </a>
  


<p>Since you can&rsquo;t execute arbitrary JavaScript, AMP provides stuff like scroll and visibility tracking out-of-the-box with amp-analytics. Google Tag Manager gives you a way to easily configure the triggers, but it should be noted that there&rsquo;s not much room to configure the triggers. AMP is restricted in this way, too.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/scroll-trigger.png" title="Scroll trigger in AMP">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/scroll-trigger.png" layout="responsive" alt="Scroll trigger in AMP" height="704" width="1578"></amp-img>
  
    </a>
  


<p>For example, I would like to configure the scroll trigger to track scroll-to-element rather than scroll-to-percentage. Unfortunately, this is not possible.</p>

<h3 id="90-can-be-augmented-with-the-on-page-json-configuration">90. Can be augmented with the on-page JSON configuration</h3>

<p>Remember that even if you use the AMP Google Tag Manager container, you can also add a JSON configuration block to the page. You can use this extra configuration to complement the tracking you setup via Google Tag Manager.</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">  ...
  <span class="c">&lt;!-- AMP Analytics --&gt;</span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">async</span> <span class="na">custom-element</span><span class="o">=</span><span class="s">&#34;amp-analytics&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.ampproject.org/v0/amp-analytics-0.1.js&#34;</span><span class="p"></span><span class="p">&gt;&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p"></span><span class="p">&gt;</span>
  <span class="c">&lt;!-- Google Tag Manager --&gt;</span>
  <span class="p">&lt;</span><span class="nt">amp-analytics</span> <span class="na">config</span><span class="o">=</span><span class="s">&#34;https://www.googletagmanager.com/amp.json?id=GTM-XXXXX&gt;m.url=SOURCE_URL&#34;</span> <span class="na">data-credentials</span><span class="o">=</span><span class="s">&#34;include&#34;</span><span class="p"></span><span class="p">&gt;&lt;</span><span class="p">/</span><span class="nt">amp-analytics</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;application/json&#34;</span><span class="p"></span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="s2">&#34;vars&#34;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;pageType&#34;</span><span class="o">:</span> <span class="s2">&#34;profile&#34;</span><span class="p">,</span>
      <span class="s2">&#34;userType&#34;</span><span class="o">:</span> <span class="s2">&#34;member&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>

<p>This is a pretty simple way to add some web server logic to your GTM AMP container.</p>

<hr />

<h2 id="gtm-for-mobile">GTM for mobile</h2>

<h3 id="91-not-the-same-as-gtm-for-web">91. Not the same as GTM for web</h3>

<p>Let&rsquo;s address the elephant in the room first. If AMP was restricted, then GTM for mobile is doubly so. Why? Because you&rsquo;re no longer working with a website that self-corrects any JavaScript mistakes you happen to have in the site code. When working with mobile apps, the app needs to be well-formed without exceptions, and you can&rsquo;t add runtime code to it without it being sanctioned by the platform the app is running on.</p>

<p>Also, since this isn&rsquo;t the web anymore, there&rsquo;s no &ldquo;Custom HTML&rdquo; or &ldquo;Custom JavaScript&rdquo; here, either. Android apps use Java, and iOS relies on Swift and Objective-C.</p>

<p>Due to these restrictions, it&rsquo;s a valid concern to raise whether you need Google Tag Manager at all. It takes pretty much the same effort as simply using the analytics SDK directly.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/firebase-templates.png" title="Firebase templates">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/firebase-templates.png" layout="responsive" alt="Firebase templates" height="1534" width="1618"></amp-img>
  
    </a>
  


<p>The benefit of using GTM is that it will always leverage the latest analytics SDKs. Also, with the Firebase integration you have access to the entire Firebase suite of services, and most of them are really useful for app developers.</p>

<p>Finally, GTM is still GTM. You can implement tracking tags without having to worry too much about how the app itself works. Support for different tag templates isn&rsquo;t too impressive yet, but this will surely change in the future.</p>

<h3 id="92-an-sdk-you-need-to-download-and-add-to-the-project">92. An SDK you need to download and add to the project</h3>

<p>Google Tag Manager isn&rsquo;t a container file that is just fetched from the web and then everything works nicely. No, it&rsquo;s actually a combination of SDKs (software development kit) and container binaries / JSON files that you need to integrate into the app itself.</p>

<p>With the latest version of Google Tag Manager for mobile (Firebase), implementing GTM to a project is really simple. You basically need to include just two podfiles: Firebase/Core and GoogleTagManager. The rest is added automatically via dependencies.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/firebase-dependencies.png" title="Firebase dependencies">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/firebase-dependencies.png" layout="responsive" alt="Firebase dependencies" height="806" width="1822"></amp-img>
  
    </a>
  


<p>The app fetches the latest container version if a &ldquo;fresh&rdquo; container is available. You can&rsquo;t always trust that a fresh container can be fetched, so it&rsquo;s a good idea to always keep a recent version of the container in the app assets. So,  when publishing a new release of the app, make sure to check if there&rsquo;s an updated container version that needs to be added to the project before going live.</p>

<h3 id="93-ga-tracker-object-is-not-exposed">93. GA tracker object is not exposed</h3>

<p>Google Tag Manager doesn&rsquo;t expose the GA tracker object in the same way that GTM for web does. In other words, if you want to check what the user&rsquo;s Client ID is, for example, there&rsquo;s no command that lets you dig that information from the available GTM interfaces.</p>

<p>A hacky but working solution in these cases is to create a dummy tracker using the regular Google Analytics SDK, and mining tracker-specific information from this to be used in your Google Tag Manager setup.</p>

<h3 id="94-gtm-legacy-uses-datalayer">94. GTM legacy uses <code>dataLayer</code></h3>

<p>GTM for mobile, before Firebase, is now called &ldquo;Legacy&rdquo;. If you&rsquo;re used to GTM for web, the legacy SDK should be quite familiar to you, since it also uses a <code>dataLayer</code> construct to pass messages to Google Tag Manager. As before, there is the <code>event</code> key you need to use to fire the triggers, and there are Data Layer Variables you can use to access values in this message queue.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/ios-analytics-module.png" title="iOS analytics module">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/ios-analytics-module.png" layout="responsive" alt="iOS analytics module" height="792" width="1692"></amp-img>
  
    </a>
  


<p>Note that unlike with GTM for web, there is no differentiation between <code>dataLayer</code> the message queue and GTM&rsquo;s internal data model. The <code>dataLayer</code> structure acts as both.</p>

<h3 id="95-latest-version-of-gtm-for-mobile-uses-firebase">95. Latest version of GTM for mobile uses Firebase</h3>

<p>The most recent incarnation of GTM for mobile uses Firebase. Firebase is a cloud-based application framework that provides a number of services your apps can use, such as Firebase Analytics.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/firebase-analytics.png" title="Firebase Analytics via GTM">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/firebase-analytics.png" layout="responsive" alt="Firebase Analytics via GTM" height="424" width="1664"></amp-img>
  
    </a>
  


<p>When you want to use GTM with Firebase, you need to actually <em>use Firebase</em>. You add tracking using regular Firebase Analytics tracking methods, which means that unless you use GTM to radically change the tracking, you will end up using Firebase Analytics in addition to the other analytics tools you want to track via Google Tag Manager.</p>

<h3 id="96-you-can-intercept-firebase-events-using-gtm">96. You can intercept Firebase events using GTM</h3>

<p>The way that Google Tag Manager works with Firebase is that it listens to all the events you log into Firebase. Once it detects an event, it goes through the triggers and tags you&rsquo;ve configured in the container, and if a tag is set to fire on a specific Firebase event, it will go off.</p>



    <a href="https://www.simoahava.com/amp/images/2017/02/firebase-ga-tag.png" title="Firebase GA Tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/02/firebase-ga-tag.png" layout="responsive" alt="Firebase GA Tag" height="988" width="1822"></amp-img>
  
    </a>
  


<p>And as with Google Tag Manager for web, the more tag endpoints you have, the more useful GTM becomes. You can use a single event stream (the logged Firebase events) to send data to multiple endpoints, such as Google Analytics, Firebase, and AppsFlyer.</p>

<h3 id="97-firebase-gtm-has-imperfect-support-for-ga-enhanced-ecommerce">97. Firebase GTM has (imperfect) support for GA Enhanced Ecommerce</h3>

<p>At the time of writing, you can&rsquo;t configure Universal Analytics Ecommerce tags via Firebase GTM. The reason is that GTM&rsquo;s data model does not support array structures, which is how you&rsquo;d need to send product data to Google Analytics.</p>

<p>Hopefully we&rsquo;ll see <a href="https://support.google.com/tagmanager/answer/7003315?hl=en">support for Ecommerce soon</a>. Until then, if you need to collect Ecommerce data to Google Analytics, you might want to use the GTM Legacy SDK or GA SDK.</p>

<p><strong>Update</strong>: Support for Enhanced Ecommerce has finally reached Firebase (<a href="https://developers.google.com/tag-manager/ios/v5/enhanced-ecommerce">iOS</a> and <a href="https://developers.google.com/tag-manager/android/v5/enhanced-ecommerce">Android</a>). Still missing product-scoped custom dimensions and metrics, though! (Thanks <strong>Yuhui</strong> for the tip in the comments).</p>

<hr />

<h2 id="other-stuff">Other stuff</h2>

<h3 id="98-debugging-is-a-complex-process">98. Debugging is a complex process</h3>

<p>End-to-end debugging with Google Tag Manager isn&rsquo;t just a case of opening up Preview mode and being satisfied with what you see. It&rsquo;s a complex process, involving not only front-end conflicts in your site code, but also things like race conditions, unresponsive tag endpoints, and <code>dataLayer</code> <a href="https://www.simoahava.com/amp/analytics/automated-tests-for-google-tag-managers-datalayer/">automated tests</a>.</p>

<p>I recommend you take a look at this article: <a href="https://www.simoahava.com/amp/gtm-tips/debugging-tag-execution-properly/">#GTMTips: Debugging Tag Execution Properly</a>. Make sure you familiarize yourself with the Network tab of your browser&rsquo;s developer tools. If Preview mode says that your tags fire but you don&rsquo;t see any evidence in the endpoint you are looking at (e.g. Google Analytics reports), take a look at the Network tab to see if you are dispatching hits to <code>/collect</code> correctly. <a href="https://support.google.com/analytics/answer/6277302?hl=en">Google Tag Assistant Recordings</a> is your friend, too, for all Google-related tagging issues.</p>

<p>Finally, I recommend adding <code>dataLayer</code> to your organization&rsquo;s quality assurance process. This would mean writing unit tests and browser tests that verify <code>dataLayer</code> has a predictable composition with each new release of the site or app. I&rsquo;ve written a simple framework for running automated tests against <code>dataLayer</code>, and you can read about it <a href="https://www.simoahava.com/amp/analytics/automated-tests-for-google-tag-managers-datalayer/">here</a>.</p>

<h3 id="99-load-sequence-of-gtm-s-default-events-is-important-to-understand">99. Load sequence of GTM&rsquo;s default events is important to understand</h3>

<p>When Google Tag Manager loads on a site, it pushes three default events into <code>dataLayer</code>: <strong>gtm.js</strong>, <strong>gtm.dom</strong> and <strong>gtm.load</strong>.</p>

<p><strong>gtm.js</strong> is pushed in the container snippet itself. Thus it introduces a state which contains all the Data Layer variables pushed <em>before or at the time</em> when the container snippet runs. This event is used by the <strong>Page View</strong> trigger. In other words, if you have tags that fire on the Page View trigger (or All Pages), any Data Layer variables you want to use need to be pushed into <code>dataLayer</code> <em>before</em> the container snippet is executed by the browser. Typically this means to physically add your <code>dataLayer</code> initialization in the page template above the GTM container snippet.</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p"></span><span class="p">&gt;</span>
  <span class="c1">// Always use this syntax to initialize dataLayer
</span><span class="c1"></span>  <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nx">userType</span><span class="o">:</span> <span class="s1">&#39;member&#39;</span><span class="p">,</span>
    <span class="nx">loyaltyLevel</span><span class="o">:</span> <span class="s1">&#39;premium&#39;</span>
  <span class="p">});</span>
<span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">script</span><span class="p"></span><span class="p">&gt;</span>
  <span class="c1">// GTM container snippet here
</span><span class="c1"></span><span class="p">&lt;</span><span class="p">/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>

<p><strong>gtm.dom</strong> is pushed into <code>dataLayer</code> when the browser signals the <code>DOMContentLoaded</code> event has taken place. This browser event happens when the browser has read the HTML template and built the Document Object Model (DOM) using the structure within. Thus, if you have tags which refer to DOM elements, you might want to make sure they don&rsquo;t fire before the <strong>gtm.dom</strong> event. The trigger which uses this event is <strong>DOM Ready</strong>, so any tags firing on this trigger will have access to any elements described in the page HTML.</p>

<p><strong>gtm.load</strong> is pushed into <code>dataLayer</code> when the browser signals the <code>load</code> event, which means that the entire page, and all linked assets such as images, scripts (both asynchronous and synchronous), and videos have completed downloading. This is the event you&rsquo;d need to use if you want your tags to access the result of some asynchronous process, such as the download of the <a href="https://jquery.org">jQuery</a> library (if downloaded asynchronously, as you should). The trigger which uses this event is <strong>Window Loaded</strong>.</p>

<p>It&rsquo;s important to understand how these three events work. They are not fired at <em>the exact time the underlying browser event takes place</em>. For example, <strong>gtm.js</strong> will fire triggers only after the GTM library has downloaded, and this might be seconds after the browser originally reads the event in the page template. Thus these events don&rsquo;t describe the <em>time</em> something happens but rather the <em>state</em>. <strong>gtm.js</strong> describes the state of GTM&rsquo;s data when the container snippet was first read by the browser, <strong>gtm.dom</strong> reflects GTM&rsquo;s state when the browser signalled <code>DOMContentLoaded</code>, and <strong>gtm.load</strong> is the state of GTM when the entire page had completed loading.</p>

<h3 id="100-some-ad-and-content-blockers-block-gtm-from-loading">100. Some ad and content blockers block GTM from loading</h3>

<p>Call it a feature or symptom of today&rsquo;s web browsing behavior, but ad and content blockers are making life for web analysts difficult. Firefox, for example, offers <a href="https://support.mozilla.org/t5/Protect-your-privacy/Tracking-Protection-in-Private-Browsing/ta-p/36899">Tracking Protection</a> out-of-the-box, and it blocks Google Analytics by default.</p>

<p>Popular browser extensions like <a href="https://www.ghostery.com/">Ghostery</a> and <a href="https://adblockplus.org/">AdBlock Plus</a> make it easy to block Google Tag Manager, too.</p>

<p>Whether you like this or not, it&rsquo;s a common practice and you should therefore accept a certain level of inaccuracy in your data.</p>

<p>With Google Tag Manager, however, you can actively modify and extend the site experience with Custom JavaScript. If the user&rsquo;s browser doesn&rsquo;t load Google Tag Manager, these modifications will not be executed.</p>

<p>Thus, <strong>be very wary of potential GTM blocking when running code via Google Tag Manager</strong>. Never rely on GTM to handle your link redirects or form submissions, and never use GTM to fix on-site issues that should be fixed in front-end code. You are depriving an ever-increasing subset of your visitors of a full experience, and at worst destroying the site user experience altogether for them.</p>

<hr />

<h3 id="101-use-undefined-to-clear-individual-keys-from-data-layer-upepo-mwindaji">101. Use <code>undefined</code> to clear individual keys from Data Layer (upepo mwindaji)</h3>

<p>The first guest tip comes from <strong>upepo mwindaji</strong>. You can clear individual values from GTM&rsquo;s data model by pushing the keys with the value <code>undefined</code>. This effectively resets the value of the key.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
  <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;userLoggedOut&#39;</span><span class="p">,</span>
  <span class="nx">loginStatus</span><span class="o">:</span> <span class="s1">&#39;loggedOut&#39;</span><span class="p">,</span>
  <span class="nx">userId</span><span class="o">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="nx">memberStatus</span><span class="o">:</span> <span class="kc">undefined</span>
<span class="p">});</span></code></pre></div>

<p>The code above, for example, clears the values of <code>userId</code> and <code>memberStatus</code> from GTM&rsquo;s data model because the user logged out.</p>

<h3 id="102-you-can-track-to-multiple-universal-analytics-properties-in-the-same-container">102. You can track to multiple Universal Analytics properties in the same container</h3>

<p>This guest tip is from <strong>samgabell</strong>. Since GTM creates a unique tracker with every Universal Analytics tag, you can freely track to multiple Universal Analytics properties in the same container. There will be no interference between sets of tags tracking to different properties.</p>

<p>The only thing that will cause issues is if one set of tags is configured for cross-domain tracking with the <code>allowLinker</code> field set to <code>true</code>. In this case, a linker parameter in the URL will overwrite the Client ID stored in the <code>_ga</code> cookie, impacting all trackers on the site - even those that should ignore cross-domain tracking. You can read about a solution to this issue <a href="https://www.simoahava.com/amp/gtm-tips/cross-domain-tracking-with-multiple-ga-trackers/">here</a>.</p>

<h2 id="summary">Summary</h2>

<p>So that was my 100 tips. Some of them were indeed very simple and obvious, but I&rsquo;ve run into enough people having issues with all of the things covered here to justify my adding them to the list.</p>

<p>Google Tag Manager turns 5 years old this year. It&rsquo;s been a colorful journey, and I&rsquo;m sure the popularity of the tool has changed the landscape for all tag management solutions for the better. Via GTM, so many new people have had the pleasure to (or have been forced to) get acquainted with the wonderful world of JavaScript, and have thus accumulated new skills to help them on their digital journeys.</p>

<p>Now is your turn - are there invaluable tips that you&rsquo;d want to share with the readers? I&rsquo;d love to add them to the end of the list. Thank you!</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

