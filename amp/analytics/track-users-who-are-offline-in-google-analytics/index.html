

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/track-users-who-are-offline-in-google-analytics/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Track Users Who Are Offline in Google Analytics | Simo Ahava's blog</title>
        <meta property="og:title" content="Track Users Who Are Offline in Google Analytics" />
<meta name="description" content="Use this solution to automatically collect data from users who are offline, and send the data to Google Analytics once they are back online." />
<meta property="og:description" content="Use this solution to automatically collect data from users who are offline, and send the data to Google Analytics once they are back online." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/track-users-who-are-offline-in-google-analytics/" />

    
        
    



    
        <meta property="article:published_time" content="2017-08-28T08:19:25Z"/>
    
    
        <meta property="article:modified_time" content="2017-08-28T08:19:25Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="customtask" />
        
            <meta property="article:tag" content="google analytics" />
        
            <meta property="article:tag" content="Google Tag Manager" />
        
            <meta property="article:tag" content="JavaScript" />
        
            <meta property="article:tag" content="guest post" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    



<meta itemprop="name" content="Track Users Who Are Offline In Google Analytics">
<meta itemprop="description" content="Use this solution to automatically collect data from users who are offline, and send the data to Google Analytics once they are back online.">


<meta itemprop="datePublished" content="2017-08-28T08:19:25&#43;00:00" />
<meta itemprop="dateModified" content="2017-08-28T08:19:25&#43;00:00" />
<meta itemprop="wordCount" content="2821">



<meta itemprop="keywords" content="customtask,google analytics,Google Tag Manager,JavaScript,guest post," />

<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava\x27s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https:\/\/www.simoahava.com\/amp\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Track Users Who Are Offline In Google Analytics | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2017\/08\/track-offline-hits.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/amp\/analytics\/track-users-who-are-offline-in-google-analytics\/",
  "datePublished": "2017-08-28T08:19:25\x2b00:00",
  "dateModified": "2017-08-28T08:19:25\x2b00:00",
  "description": "Use this solution to automatically collect data from users who are offline, and send the data to Google Analytics once they are back online.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview/">preview</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/still-running/">still-running</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Track Users Who Are Offline in Google Analytics</h1>
        <small>Use this solution to automatically collect data from users who are offline, and send the data to Google Analytics once they are back online.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/customtask">#customtask</a>
    
        , <a href="https://www.simoahava.com/amp/tags/google-analytics">#google analytics</a>
    
        , <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#Google Tag Manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/javascript">#JavaScript</a>
    
        , <a href="https://www.simoahava.com/amp/tags/guest-post">#guest post</a>
    

<time class="post-date" datetime="2017-08-28T08:19:25Z">
    28 August 2017
</time>


        </section>
    </header>

    <section class="post-content">
      

<p>The steady increase in mobile use over the last years has introduced some new challenges for web analytics. It&rsquo;s not just about mismatches in the tracking model (the concept of <a href="https://www.simoahava.com/amp/analytics/the-schema-conspiracy/"><em>sessions</em></a> is even more absurd for apps than it is for desktop browsing), but about something more fundamental, more basic. Think about it: if a visitor visits the website using a mobile device, there&rsquo;s a significant chance of them losing internet connectivity and going unintentionally offline.</p>

<p>Actually, it&rsquo;s enough for them to simply traverse an area with poor coverage - if the HTTP requests sent by the browser don&rsquo;t complete in time, they timeout, and the hits are lost.</p>

<p>For <a href="https://analytics.google.com">Google Analytics</a> pageviews it&rsquo;s not such a big deal, because if the user sees the web page, it&rsquo;s very likely the first pageview has completed. However, what about all the other interactions that we want to track, and the user doesn&rsquo;t have an internet connection to boot? That&rsquo;s right - we&rsquo;ll lose these interactions, since the requests are dropped by the browser and never picked up, even when the user gets their connection back.</p>

<p>In this article, the brilliant <a href="http://www.thyngster.com/">David Vallejo</a> and I will offer a solution for retrieving these hits initially dropped by the browser due to the internet connection being offline. OK, who am I kidding, this is all David. I&rsquo;m just a glorified editor at this point.</p>



    <a href="https://www.simoahava.com/amp/images/2017/08/track-offline-hits.jpg" title="track offline hits in universal analytics">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/08/track-offline-hits.jpg" layout="responsive" alt="track offline hits in universal analytics" height="156" width="1023"></amp-img>
  
    </a>
  


<p>Anyway, let&rsquo;s frame it like this: the visitor is viewing our contact page, and we have an event queued up for when they click on our email contact information. However, the visitor is also on the subway, and the moment they click the email, they enter a tunnel. Oh noes! They lose their internet connection (damn subways without WiFi), and we miss our vital conversion tracking.</p>

<p>That&rsquo;s the premise. Here&rsquo;s the execution.</p>

<p>In this article, we&rsquo;ll touch upon a number of fairly technical concepts, but we&rsquo;ll try to frame them so that they make sense in the big picture.</p>

<ol>
<li><p>Universal Analytics <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks?hl=en">Tasks API</a></p></li>

<li><p>The browser&rsquo;s <a href="https://www.w3schools.com/html/html5_webstorage.asp">Storage API</a></p></li>

<li><p>Sending Google Analytics hits with a delay (the <code>&amp;qt</code> parameter)</p></li>

<li><p>Sending custom POST and HEAD requests (HTTP protocol)</p></li>

<li><p><a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide#batch">Batching</a> Universal Analytics Hits</p></li>
</ol>

<p>All of these concepts are very useful to know if you want to know more about the mechanisms that the web browser employs to compile and dispatch requests to Universal Analytics.</p>

<!-- toc -->

<p>Let&rsquo;s go!</p>

<h2 id="1-universal-analytics-tasks-api">1. Universal Analytics Tasks API</h2>

<p>Each time a <code>send</code> command is dispatched to the <code>ga()</code> global method, a series of <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks"><em>tasks</em></a> are run in sequence by the analytics.js library. These tasks do a number of things, such as construct the payload, validate it, sample the requests, and finally dispatch the requests to the Universal Analytics endpoint.</p>

<p>The neat thing about these tasks is that we can intercept them and modify them using the API provided by analytics.js.</p>

<p>You can find a list of all available tasks in the API <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/tasks">here</a>. However, in this article we will focus on just a very special, very significant task: <code>customTask</code>. It&rsquo;s a new task introduced very recently (here&rsquo;s a <a href="https://www.simoahava.com/amp/gtm-tips/use-customtask-access-tracker-values-google-tag-manager/">guide by Simo</a>).</p>

<p>This task is true to its name - it&rsquo;s entirely customizable. It runs first in the task queue, so you can use it to configure the tracker object or even to set other tasks up for customization.</p>

<p>In this guide, we&rsquo;ll use <code>customTask</code> to modify the <code>sendHitTask</code>. This way we can check if the user has internet connectivity when <code>sendHitTask</code> is run, and we can do a number of things if the user has dropped their connection. We use <code>customTask</code> instead of directly accessing <code>sendHitTask</code> simply because this way is much more <a href="https://tagmanager.google.com/">Google Tag Manager</a>-friendly.</p>

<p>In short, here&rsquo;s the process:</p>

<p><code>customTask</code> <strong>modifies</strong> <code>sendHitTask</code> with <code>OUR CODE</code> before <strong>hit is sent</strong>.</p>

<p>In order to detect if the user has internet connectivity, we could simply poll our own web server endpoint. However, that wouldn&rsquo;t be a good litmus test since it could be just Google&rsquo;s servers that are not responding. That&rsquo;s why we&rsquo;ll actually poll Google&rsquo;s endpoint to check if the user has the connectivity required for Google Analytics tracking.</p>

<h2 id="2-the-offline-tracker">2. The offline tracker</h2>

<p>The solution is that with every single request to Universal Analytics, we&rsquo;ll send an HTTP HEAD request to the Universal Analytics endpoint. If the endpoint isn&rsquo;t responding, we can infer that the user does not have connectivity for communicating with Google Analytics, and so we&rsquo;ll store the hit into browser storage until such a time that internet coverage is restored.</p>



    <a href="https://www.simoahava.com/amp/images/2017/04/offline-hits-in-universal-analytics.jpg" title="Track offline hits in Universal Analytics">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/04/offline-hits-in-universal-analytics.jpg" layout="responsive" alt="Track offline hits in Universal Analytics" height="1282" width="2370"></amp-img>
  
    </a>
  


<p>We&rsquo;ll use <code>localStorage</code> for the queue, but we&rsquo;ll need to cheat a little. <code>localStorage</code> itself doesn&rsquo;t introduce any structure or a deeper data model - it just processes key-value pairs. So, to give us some additional flexibility, we&rsquo;ll use the <a href="https://github.com/tsironis/lockr"><strong>Lockr</strong></a> open-source database layer. It&rsquo;s a simple and efficient framework, and it has pretty solid browser support.</p>

<p>This solution picks up the Universal Analytics hit payload from <code>sendHitTask</code>, and if there is no internet connection, this hit is stored in <code>localStorage</code> with the timestamp of the request. Thus, when we later do manage to send the stored hit, we can send it <em>at its original timestamp</em> to Universal Analytics.</p>

<h3 id="2-1-the-qt-parameter">2.1. The &amp;qt parameter</h3>

<p>The <code>&amp;qt</code> Measurement Protocol stands for <strong>queue time</strong>. Basically, you can set a number in milliseconds in that parameter, and the hit will be sent with a timestamp that many milliseconds in the past. For example, if I know that the hit I want to send actually happened 45 minutes ago, I can set the parameter to:</p>

<p><code>&amp;qt=2700000</code></p>

<p>There&rsquo;s just an odd little quirk you need to know about <code>&amp;qt</code>. The latest you can send the displaced hit is at 03:59:59 the following day (in the timezone of the Google Analytics view the hit is being sent to). Thus, the maximum value for <code>&amp;qt</code> is 27 hours, 59 minutes, and 59 seconds (in milliseconds), if the hit occurred at exactly midnight, and you then send it the following morning, just before 4 AM.</p>

<p>Yes, it might be difficult to grasp, so we&rsquo;ll go with the official recommendation: <strong>avoid sending hits more than 4 hours in the past</strong>, since there&rsquo;s no guarantee they will get sent.</p>

<h2 id="3-the-http-head-request">3. The HTTP HEAD request</h2>

<p>So what is this <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD">HEAD request</a> and why are we using it? Well, it&rsquo;s identical to GET, except it only returns the HTTP headers (and associated metadata), never any content.</p>

<p>It&rsquo;s thus a great method to use if we only want to test an endpoint, and not get into the expensive process of actually retrieving data from it.</p>

<p>Since we are only interested in knowing if the Universal Analytics endpoint responds, the HTTP HEAD request is perfect for this purpose. Also, see how efficient it is compared to POST and GET:</p>



    <a href="https://www.simoahava.com/amp/images/2017/04/http-head-request.jpg" title="HTTP HEAD request">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/04/http-head-request.jpg" layout="responsive" alt="HTTP HEAD request" height="796" width="2430"></amp-img>
  
    </a>
  


<h2 id="4-the-javascript-code">4. The JavaScript code</h2>

<p>The code comes in three parts. First is the library for extending the database: <strong>Lockr</strong>. Next we have the <code>customTask</code> execution, and finally we&rsquo;ll chain the HTTP HEAD and batch requests together to make the whole thing click.</p>

<h3 id="4-1-lockr-download">4.1. Lockr download</h3>

<p>To get started, go ahead and <a href="https://raw.githubusercontent.com/tsironis/lockr/master/lockr.js">load <strong>Lockr</strong></a> on your site in any way you want. If you&rsquo;re using Google Tag Manager, we recommend loading the following code in a <strong>Custom HTML Tag</strong> that fires on <strong>All Pages</strong> with the highest possible <strong>Tag Priority</strong>. Alternatively, if you accept some overhead and redundancy, you can just add the library to the top of the Custom JavaScript Variable itself, as in the example in the next chapter.</p>

<p>Here&rsquo;s the minified JavaScript code Â - it should be executed by the browser before the offline tracking solution is run:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">exports</span><span class="o">?</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">module</span><span class="o">&amp;&amp;</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">exports</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">exports</span><span class="p">))</span><span class="o">:</span><span class="s2">&#34;function&#34;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">define</span><span class="o">&amp;&amp;</span><span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="o">?</span><span class="nx">define</span><span class="p">([</span><span class="s2">&#34;exports&#34;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">Lockr</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)})</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">Lockr</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,{})}(</span><span class="k">this</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="s2">&#34;use strict&#34;</span><span class="p">;</span><span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="o">||</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;&gt;&gt;</span><span class="mi">0</span><span class="p">,</span><span class="nx">r</span><span class="o">=</span><span class="nb">Number</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span><span class="k">for</span><span class="p">((</span><span class="nx">r</span><span class="o">=</span><span class="nx">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">:</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">r</span><span class="o">+=</span><span class="nx">t</span><span class="p">);</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span> <span class="k">in</span> <span class="k">this</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">===</span><span class="nx">e</span><span class="p">)</span><span class="k">return</span> <span class="nx">r</span><span class="p">;</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}),</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nx">t</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">t</span><span class="o">=</span><span class="nx">t</span><span class="o">||</span><span class="p">{}).</span><span class="nx">noPrefix</span><span class="o">?</span><span class="nx">e</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">prefix</span><span class="o">+</span><span class="nx">e</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">set</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">t</span><span class="p">}))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr didn&#39;t successfully save the &#39;{&#34;</span><span class="o">+</span><span class="nx">e</span><span class="o">+</span><span class="s2">&#34;: &#34;</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span><span class="s2">&#34;}&#39; pair, because the localStorage is full.&#34;</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="p">,</span><span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">o</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">n</span><span class="p">))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">o</span><span class="o">=</span><span class="nx">localStorage</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="o">?</span><span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">n</span><span class="p">)}</span><span class="o">:</span><span class="kc">null</span><span class="p">}</span><span class="k">return</span> <span class="nx">o</span><span class="o">?</span><span class="s2">&#34;object&#34;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">o</span><span class="o">&amp;&amp;</span><span class="k">void</span> <span class="mi">0</span><span class="o">!==</span><span class="nx">o</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="nx">o</span><span class="p">.</span><span class="nx">data</span><span class="o">:</span><span class="k">void</span> <span class="mi">0</span><span class="o">:</span><span class="nx">t</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">sadd</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">),</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="kc">null</span><span class="p">;</span><span class="k">try</span><span class="p">{</span><span class="nx">i</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span><span class="nx">n</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">i</span><span class="p">}),</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">n</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr didn&#39;t successfully add the &#34;</span><span class="o">+</span><span class="nx">r</span><span class="o">+</span><span class="s2">&#34; to &#34;</span><span class="o">+</span><span class="nx">e</span><span class="o">+</span><span class="s2">&#34; set, because the localStorage is full.&#34;</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">r</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">o</span><span class="p">))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">r</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">return</span> <span class="nx">r</span><span class="o">&amp;&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="o">:</span><span class="p">[]},</span><span class="nx">t</span><span class="p">.</span><span class="nx">sismember</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="p">[],</span><span class="nx">r</span><span class="o">=</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">);</span><span class="k">return</span> <span class="mi">0</span><span class="o">===</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">r</span><span class="o">:</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="o">-</span><span class="mi">1</span><span class="o">!==</span><span class="nx">r</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))}),</span><span class="nx">e</span><span class="p">)},</span><span class="nx">t</span><span class="p">.</span><span class="nx">getAll</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span><span class="k">return</span> <span class="nx">e</span><span class="o">?</span><span class="nx">r</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="p">{};</span><span class="k">return</span> <span class="nx">o</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span><span class="nx">e</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span><span class="nx">e</span><span class="p">},[])</span><span class="o">:</span><span class="nx">r</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">e</span><span class="p">)})},</span><span class="nx">t</span><span class="p">.</span><span class="nx">srem</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">),</span><span class="nx">c</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);(</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span><span class="o">&gt;-</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nx">n</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">c</span><span class="p">});</span><span class="k">try</span><span class="p">{</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">n</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr couldn&#39;t remove the &#34;</span><span class="o">+</span><span class="nx">r</span><span class="o">+</span><span class="s2">&#34; from the set &#34;</span><span class="o">+</span><span class="nx">e</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">rm</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">t</span><span class="p">)},</span><span class="nx">t</span><span class="p">.</span><span class="nx">flush</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">))})</span><span class="o">:</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">()},</span><span class="nx">t</span><span class="p">});</span>
</code></pre></div>

<p>After this code puke, we&rsquo;re ready to jump in the deep end with some offline hit tracking!</p>

<h3 id="4-2-offline-hit-tracker-for-on-page-universal-analytics">4.2. Offline hit tracker for on-page Universal Analytics</h3>

<p>The following JavaScript runs with the default <strong>Universal Analytics tracker</strong>, and thus any hits sent with the <code>ga('send', '...');</code> will be included in the process.</p>

<p>To make the whole thing work, you should setup your code in the following order:</p>

<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  ...
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c1">// Put the Lockr code here first
</span><span class="c1"></span>  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">_offlineTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">customTaskModel</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// _offlineTracker (see below) here
</span><span class="c1"></span>    <span class="p">};</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c1">// Universal Analytics snippet here
</span><span class="c1"></span>    <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;UA-12345-1&#39;</span><span class="p">);</span>
    <span class="c1">// Add the following line AFTER the &#39;create&#39; command and BEFORE the first &#39;send&#39; command
</span><span class="c1"></span>    <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="s1">&#39;customTask&#39;</span><span class="p">,</span> <span class="nx">_offlineTracker</span><span class="p">);</span>
    <span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span> <span class="s1">&#39;pageview&#39;</span><span class="p">);</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  ...
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span></code></pre></div>

<p>And here&rsquo;s the code for the <code>_offlineTracker</code> callback function.</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">_offlineTracker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">customTaskModel</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">Lockr</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;ga_&#39;</span><span class="p">;</span>
  <span class="c1">// Grab the original sentHitTask Function from the first tracker. to kept the original hit sending function.
</span><span class="c1"></span>  <span class="kd">var</span> <span class="nx">originalSendHitTask</span> <span class="o">=</span> <span class="nx">customTaskModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sendHitTask&#39;</span><span class="p">);</span>
  <span class="nx">customTaskModel</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;sendHitTask&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Let&#39;s send the original hit using the native functionality
</span><span class="c1"></span>    <span class="nx">originalSendHitTask</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
    <span class="c1">// Grab the hit Payload
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">payload_lz</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;hitPayload&#39;</span><span class="p">);</span>
    <span class="c1">// Check if GA Endpoint is Ready
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.google-analytics.com/collect&#39;</span><span class="p">);</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Google Analytics endpoint is not reachable, let&#39;s save the hit                
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">DONE</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Lockr</span><span class="p">.</span><span class="nx">sadd</span><span class="p">(</span><span class="s1">&#39;hits&#39;</span><span class="p">,</span> <span class="nx">payload_lz</span> <span class="o">+</span> <span class="s2">&#34;&amp;qt=&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Google Analytics endpoint is available, let&#39;s check if there are any unsent hits
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                        
          <span class="c1">// Process hits in queue
</span><span class="c1"></span>          <span class="kd">var</span> <span class="nx">current_ts</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">hits</span> <span class="o">=</span> <span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">);</span>

          <span class="c1">// ./batch endpoint only allows 20 hits per batch, let&#39;s chunk the hits array. 
</span><span class="c1"></span>          <span class="kd">var</span> <span class="nx">chunk_size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">chunked_hits</span> <span class="o">=</span> <span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">i</span> <span class="o">%</span> <span class="nx">chunk_size</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">hits</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">chunk_size</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
          <span class="p">});</span>
          <span class="c1">// Let&#39;s loop thru the chunks array and send the hits to GA
</span><span class="c1"></span>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chunked_hits</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
            <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.google-analytics.com/batch&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="c1">// Build the Batch Payload and Take care of calculating the Queue Time 
</span><span class="c1"></span>            <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">chunked_hits</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;&amp;qt=&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/qt=([^&amp;]*)/</span><span class="p">,</span> <span class="s2">&#34;qt=&#34;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">current_ts</span> <span class="o">-</span> <span class="nx">x</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/qt=([^&amp;]*)/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
            <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;\n&#34;</span><span class="p">));</span>
          <span class="p">}</span>
          <span class="c1">//Hits sent, flush the Storage
</span><span class="c1"></span>          <span class="nx">Lockr</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>

<p>Once you create this <code>_offlineTracker</code> and invoke it in the <code>ga('set', 'customTask', _offlineTracker)</code> command, every single hit that uses this tracker will be stored in the queue if there is no internet connectivity. Once a hit is sent with a solid connection, all hits in the queue are sent as well.</p>

<h3 id="4-3-offline-hit-tracker-for-google-tag-manager">4.3. Offline hit tracker for Google Tag Manager</h3>

<p>With Google Tag Manager, you can get by with a single Custom JavaScript variable. This variable can be configured to include the Lockr code as well, so it&rsquo;s completely self-contained. Give the variable a descriptive name, e.g. <strong>{{JS - customTask Offline Hit Tracker}}</strong> and put the following code within:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">customTaskModel</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Load Lockr if it hasn&#39;t already been loaded
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">Lockr</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">exports</span><span class="o">?</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">module</span><span class="o">&amp;&amp;</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">exports</span><span class="o">=</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">exports</span><span class="p">))</span><span class="o">:</span><span class="s2">&#34;function&#34;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">define</span><span class="o">&amp;&amp;</span><span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="o">?</span><span class="nx">define</span><span class="p">([</span><span class="s2">&#34;exports&#34;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">Lockr</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">)})</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">Lockr</span><span class="o">=</span><span class="nx">t</span><span class="p">(</span><span class="nx">e</span><span class="p">,{})}(</span><span class="k">this</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="s2">&#34;use strict&#34;</span><span class="p">;</span><span class="k">return</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="o">||</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">indexOf</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;&gt;&gt;</span><span class="mi">0</span><span class="p">,</span><span class="nx">r</span><span class="o">=</span><span class="nb">Number</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span><span class="k">for</span><span class="p">((</span><span class="nx">r</span><span class="o">=</span><span class="nx">r</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">:</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">r</span><span class="o">+=</span><span class="nx">t</span><span class="p">);</span><span class="nx">r</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">;</span><span class="nx">r</span><span class="o">++</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">r</span> <span class="k">in</span> <span class="k">this</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">===</span><span class="nx">e</span><span class="p">)</span><span class="k">return</span> <span class="nx">r</span><span class="p">;</span><span class="k">return</span><span class="o">-</span><span class="mi">1</span><span class="p">}),</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nx">t</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">t</span><span class="o">=</span><span class="nx">t</span><span class="o">||</span><span class="p">{}).</span><span class="nx">noPrefix</span><span class="o">?</span><span class="nx">e</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">prefix</span><span class="o">+</span><span class="nx">e</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">set</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">t</span><span class="p">}))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr didn&#39;t successfully save the &#39;{&#34;</span><span class="o">+</span><span class="nx">e</span><span class="o">+</span><span class="s2">&#34;: &#34;</span><span class="o">+</span><span class="nx">t</span><span class="o">+</span><span class="s2">&#34;}&#39; pair, because the localStorage is full.&#34;</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="p">,</span><span class="nx">n</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">o</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">n</span><span class="p">))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">o</span><span class="o">=</span><span class="nx">localStorage</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="o">?</span><span class="p">{</span><span class="nx">data</span><span class="o">:</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">n</span><span class="p">)}</span><span class="o">:</span><span class="kc">null</span><span class="p">}</span><span class="k">return</span> <span class="nx">o</span><span class="o">?</span><span class="s2">&#34;object&#34;</span><span class="o">==</span><span class="k">typeof</span> <span class="nx">o</span><span class="o">&amp;&amp;</span><span class="k">void</span> <span class="mi">0</span><span class="o">!==</span><span class="nx">o</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="nx">o</span><span class="p">.</span><span class="nx">data</span><span class="o">:</span><span class="k">void</span> <span class="mi">0</span><span class="o">:</span><span class="nx">t</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">sadd</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">),</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="kc">null</span><span class="p">;</span><span class="k">try</span><span class="p">{</span><span class="nx">i</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span><span class="nx">n</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">i</span><span class="p">}),</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">n</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr didn&#39;t successfully add the &#34;</span><span class="o">+</span><span class="nx">r</span><span class="o">+</span><span class="s2">&#34; to &#34;</span><span class="o">+</span><span class="nx">e</span><span class="o">+</span><span class="s2">&#34; set, because the localStorage is full.&#34;</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="k">try</span><span class="p">{</span><span class="nx">r</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">o</span><span class="p">))}</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">r</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">return</span> <span class="nx">r</span><span class="o">&amp;&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="o">?</span><span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="o">:</span><span class="p">[]},</span><span class="nx">t</span><span class="p">.</span><span class="nx">sismember</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">},</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="p">[],</span><span class="nx">r</span><span class="o">=</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">localStorage</span><span class="p">);</span><span class="k">return</span> <span class="mi">0</span><span class="o">===</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">r</span><span class="o">:</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span><span class="o">-</span><span class="mi">1</span><span class="o">!==</span><span class="nx">r</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">))}),</span><span class="nx">e</span><span class="p">)},</span><span class="nx">t</span><span class="p">.</span><span class="nx">getAll</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="p">();</span><span class="k">return</span> <span class="nx">e</span><span class="o">?</span><span class="nx">r</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="p">{};</span><span class="k">return</span> <span class="nx">o</span><span class="p">[</span><span class="nx">r</span><span class="p">]</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">r</span><span class="p">),</span><span class="nx">e</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span><span class="nx">e</span><span class="p">},[])</span><span class="o">:</span><span class="nx">r</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">e</span><span class="p">)})},</span><span class="nx">t</span><span class="p">.</span><span class="nx">srem</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">,</span><span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">n</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">o</span><span class="p">),</span><span class="nx">c</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">r</span><span class="p">);(</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">r</span><span class="p">))</span><span class="o">&gt;-</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nx">n</span><span class="o">=</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">c</span><span class="p">});</span><span class="k">try</span><span class="p">{</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">n</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">console</span><span class="o">&amp;&amp;</span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&#34;Lockr couldn&#39;t remove the &#34;</span><span class="o">+</span><span class="nx">r</span><span class="o">+</span><span class="s2">&#34; from the set &#34;</span><span class="o">+</span><span class="nx">e</span><span class="p">)}},</span><span class="nx">t</span><span class="p">.</span><span class="nx">rm</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">t</span><span class="p">)},</span><span class="nx">t</span><span class="p">.</span><span class="nx">flush</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="nx">t</span><span class="p">.</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">t</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">_getPrefixedKey</span><span class="p">(</span><span class="nx">e</span><span class="p">))})</span><span class="o">:</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">()},</span><span class="nx">t</span><span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">Lockr</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;ga_&#39;</span><span class="p">;</span>
    <span class="c1">// Grab the original sentHitTask Function from the first tracker. to kept the original hit sending function.
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">originalSendHitTask</span> <span class="o">=</span> <span class="nx">customTaskModel</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sendHitTask&#39;</span><span class="p">);</span>
    <span class="nx">customTaskModel</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;sendHitTask&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Let&#39;s send the original hit using the native functionality
</span><span class="c1"></span>      <span class="nx">originalSendHitTask</span><span class="p">(</span><span class="nx">model</span><span class="p">);</span>
      <span class="c1">// Grab the hit Payload
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">payload_lz</span> <span class="o">=</span> <span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;hitPayload&#39;</span><span class="p">);</span>
      <span class="c1">// Check if GA Endpoint is Ready
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
      <span class="nx">http</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.google-analytics.com/collect&#39;</span><span class="p">);</span>
      <span class="nx">http</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Google Analytics endpoint is not reachable, let&#39;s save the hit                
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">DONE</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">Lockr</span><span class="p">.</span><span class="nx">sadd</span><span class="p">(</span><span class="s1">&#39;hits&#39;</span><span class="p">,</span> <span class="nx">payload_lz</span> <span class="o">+</span> <span class="s2">&#34;&amp;qt=&#34;</span> <span class="o">+</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">// Google Analytics endpoint is available, let&#39;s check if there are any unsent hits
</span><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                        
            <span class="c1">// Process hits in queue
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">current_ts</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">hits</span> <span class="o">=</span> <span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">);</span>

            <span class="c1">// ./batch endpoint only allows 20 hits per batch, let&#39;s chunk the hits array. 
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">chunk_size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">chunked_hits</span> <span class="o">=</span> <span class="nx">Lockr</span><span class="p">.</span><span class="nx">smembers</span><span class="p">(</span><span class="s2">&#34;hits&#34;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">i</span> <span class="o">%</span> <span class="nx">chunk_size</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">hits</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">chunk_size</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}).</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
            <span class="p">});</span>
            <span class="c1">// Let&#39;s loop thru the chunks array and send the hits to GA
</span><span class="c1"></span>            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chunked_hits</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
              <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.google-analytics.com/batch&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
              <span class="c1">// Build the Batch Payload and Take care of calculating the Queue Time 
</span><span class="c1"></span>              <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">chunked_hits</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;&amp;qt=&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/qt=([^&amp;]*)/</span><span class="p">,</span> <span class="s2">&#34;qt=&#34;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">current_ts</span> <span class="o">-</span> <span class="nx">x</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/qt=([^&amp;]*)/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="nx">x</span><span class="p">;</span>
              <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;\n&#34;</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="c1">//Hits sent, flush the Storage
</span><span class="c1"></span>            <span class="nx">Lockr</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">http</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>

<p>Add this code to <strong>all your Universal Analytics tags</strong> by scrolling to <strong>More settings</strong> -&gt; <strong>Fields to set</strong>. Here you add a new field with:</p>

<p><strong>Field name:</strong> customTask<br />
<strong>Value:</strong> {{JS - customTask Offline Hit Tracker}}</p>



    <a href="https://www.simoahava.com/amp/images/2017/08/fields-to-set.jpg" title="Universal Analytics Fields to Set">
  
    <amp-img src="https://www.simoahava.com/amp/images/2017/08/fields-to-set.jpg" layout="responsive" alt="Universal Analytics Fields to Set" height="774" width="1772"></amp-img>
  
    </a>
  


<p>Once you&rsquo;ve done this, then all your tags with this <strong>customTask</strong> setting are protected against poor connectivity, and whenever the connection is restored, the batch queue is processed.</p>

<h3 id="4-4-about-batching">4.4. About batching</h3>

<p>Universal Analytics lets you send hits to its endpoint in <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide#batch">batches</a>. This is used mostly by the iOS and Android SDKs. The main point in using the batch endpoint (<code>/batch</code>) is to have as few HTTP requests dispatched as possible. Here, batching means that we can send multiple Universal Analytics payloads in a single HTTP request.</p>

<p>Batching does have some limitations we&rsquo;ll need to consider:</p>

<ul>
<li><p>A maximum of 20 hits can be specified per request.</p></li>

<li><p>The combined size of all hit payloads cannot be greater than 16K bytes.</p></li>

<li><p>No single hit payload can be greater than 8K bytes.</p></li>

<li><p>The request needs to be done using POST</p></li>
</ul>

<p>For our solution, each time the number of stored hits is more than 1, we send the payloads using the batch endpoint. In case there are too many hits stored in the queue, we&rsquo;re chunking them so that multiple batch requests are sent in succession until the entire queue is processed.</p>

<h2 id="5-improvements">5. Improvements</h2>

<p>Keep in mind that this current post is meant to show how to track the hits that may happen while the user is offline (due to a connectivity gap). At the same time, we&rsquo;ve taken the opportunity to showcase some cool and relatively little-known Google Analytics JavaScript API functionalities.</p>

<p>A solid improvement would be to skip the <code>originalSendTask</code> part, and just overwrite the <code>sendHitTask</code> task entirely. This way you can skip the HTTP HEAD request, because you can just check if the initial hit to Google Analytics is dispatched successfully.</p>

<p>The one thing you need to keep in mind if you want to overwrite the <code>sendHitTask</code> is that you&rsquo;ll need to replicate the <code>transport</code> logic for the request. The analytics.js library supports three different ways to dispatch the requests:</p>

<ol>
<li><p><code>'image'</code> - max 2K payload size sent with a GET request to a pixel endpoint</p></li>

<li><p><code>'xhr'</code> - max 8K payload size sent as an HTTP POST request</p></li>

<li><p><code>'beacon'</code> - POST request that uses the <code>navigator.sendBeacon()</code> to make sure your requests are sent even if the user has already navigated away from the page</p></li>
</ol>

<p>So you&rsquo;ll need to replicate this logic in your custom <code>sendHitTask</code> method. It&rsquo;s not exactly trivial to do, but an able developer should be able to do it, especially once the constraints (see previous paragraph) are known.</p>

<p>Another thing you might want to do is add a <strong>Custom Dimension</strong> to all the payloads that are stored in the queue. This Custom Dimension could be named something like <strong>Offline hit</strong>, and you should set the value to <code>true</code> if the hit was sent from the offline queue. Thus you can monitor how many hits in your data were initially aborted due to poor internet connectivity.</p>

<h2 id="6-summary">6. Summary</h2>

<p>I&rsquo;m really glad to have David guest star on this blog - it&rsquo;s been a long time coming! This solution is great for two reasons. First, it&rsquo;s actually very usable, especially if your site caters to mobile visitors. Second, it showcases a number of features of the web browser and the analytics.js library that can be extended to other purposes, too.</p>

<p>The Tasks API is really interesting, as it allows you to manipulate the payloads dispatched by the website. And with the introduction of <a href="https://www.simoahava.com/amp/gtm-tips/use-customtask-access-tracker-values-google-tag-manager/">customTask</a>, we finally have a very handy way of accessing tasks with Google Tag Manager.</p>

<p>Note that if you have a web application with offline capabilities, and you are using service workers to manage this functionality, Google has released a <a href="https://www.npmjs.com/package/sw-offline-google-analytics">useful library</a> for employing service workers to do precisely the same thing we&rsquo;re doing in this article.</p>

<p>We hope you enjoyed this solution! Let us know in the comments</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

