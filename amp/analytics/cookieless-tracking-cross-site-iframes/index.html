

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}.badge-primary{color:#fff;background-color:#007bff}.badge{display:inline-block;padding:.25em .4em;font-size:80%;font-weight:700;line-height:1;text-align:center;white-space:nowrap;vertical-align:middle;border-radius:.25rem}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/cookieless-tracking-cross-site-iframes/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Cookieless Tracking for Cross-Site Iframes | Simo Ahava's blog</title>
        <meta property="og:title" content="Cookieless Tracking for Cross-Site Iframes" />
<meta name="description" content="How to track Google Analytics traffic within a cross-site iframe without using cookies. This is useful due to how browser tracking protections prevent access to cookies in third-party (cross-site) context." />
<meta property="og:description" content="How to track Google Analytics traffic within a cross-site iframe without using cookies. This is useful due to how browser tracking protections prevent access to cookies in third-party (cross-site) context." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/cookieless-tracking-cross-site-iframes/" />

    
        
    



    
        <meta property="article:published_time" content="2020-02-19T07:00:38Z"/>
    
    
        <meta property="article:modified_time" content="2020-02-19T07:00:38Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="cross-domain tracking" />
        
            <meta property="article:tag" content="iframe" />
        
            <meta property="article:tag" content="postmessage" />
        
            <meta property="article:tag" content="cookie" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    



<meta itemprop="name" content="Cookieless Tracking For Cross-site Iframes">
<meta itemprop="description" content="How to track Google Analytics traffic within a cross-site iframe without using cookies. This is useful due to how browser tracking protections prevent access to cookies in third-party (cross-site) context.">
<meta itemprop="datePublished" content="2020-02-19T09:00:38&#43;02:00" />
<meta itemprop="dateModified" content="2020-02-19T09:00:38&#43;02:00" />
<meta itemprop="wordCount" content="4270">



<meta itemprop="keywords" content="google tag manager,cross-domain tracking,iframe,postmessage,cookie," />
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava\u0027s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https:\/\/www.simoahava.com\/amp\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Cookieless Tracking For Cross-site Iframes | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2020\/02\/iframe-postmessage.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/amp\/analytics\/cookieless-tracking-cross-site-iframes\/",
  "datePublished": "2020-02-19T09:00:38\u002b02:00",
  "dateModified": "2020-02-19T09:00:38\u002b02:00",
  "description": "How to track Google Analytics traffic within a cross-site iframe without using cookies. This is useful due to how browser tracking protections prevent access to cookies in third-party (cross-site) context.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/custom-templates/">Templates</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ab-testing/">ab-testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cname/">cname</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent/">consent</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tags/">custom-html-tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/experimentation/">experimentation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exploit/">exploit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag.js/">gtag.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/node.js/">node.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/parameter-reporting/">parameter-reporting</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/postmessage/">postmessage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview/">preview</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/queue-time/">queue-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/recaptcha/">recaptcha</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/samesite/">samesite</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/server-side-tagging/">server-side-tagging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/single-page-apps/">single-page-apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/still-running/">still-running</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Cookieless Tracking for Cross-Site Iframes</h1>
        <small>How to track Google Analytics traffic within a cross-site iframe without using cookies. This is useful due to how browser tracking protections prevent access to cookies in third-party (cross-site) context.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/cross-domain-tracking">#cross-domain tracking</a>
    
        , <a href="https://www.simoahava.com/amp/tags/iframe">#iframe</a>
    
        , <a href="https://www.simoahava.com/amp/tags/postmessage">#postmessage</a>
    
        , <a href="https://www.simoahava.com/amp/tags/cookie">#cookie</a>
    


<time class="post-date" datetime="2020-02-19T09:00:38&#43;02:00">
    19 February 2020
</time>



        </section>
    </header>

    <section class="post-content">
      <blockquote>
<p><strong>Updated 15 April 2020</strong>: Fix the message forwarder to properly clone objects before they are passed to <code>postMessage</code></p>
</blockquote>
<p>Here I am, back with <code>&lt;iframe&gt;</code> and <strong>cross-domain tracking</strong>. I&rsquo;ve published a couple of articles before on the topic, with <a href="https://www.simoahava.com/amp/analytics/tracking-cross-domain-iframes-upgraded-solution/">my upgraded solution</a> being the most recent one. These articles tackle the general problem of <strong>passing the Client ID from the parent to the <code>&lt;iframe&gt;</code></strong>.</p>
<p>By doing so, the <code>&lt;iframe&gt;</code> can take the Client ID from the frame URL and create the <code>_ga</code> cookie in the <code>&lt;iframe&gt;</code>, allowing hits from the parent <em>and</em> the <code>&lt;iframe&gt;</code> to use the same Client ID. Great.</p>
<p>However, there&rsquo;s a catch that&rsquo;s become more and more troubling with the increase of <a href="https://www.cookiestatus.com">browsers&rsquo; tracking protection mechanisms</a>: if the <code>&lt;iframe&gt;</code> loads content <strong>cross-site</strong>, the browser must <strong>allow cookie access in third-party context</strong>. In other words, if the browser blocks <em>third-party cookies</em>, the <code>&lt;iframe&gt;</code> will not be able to write the cookie, and Google Analytics tracking <strong>will fail</strong>.</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/iframe-postmessage.jpg" title="Iframe post message">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/iframe-postmessage.jpg" layout="responsive" alt="Iframe post message" height="472" width="1396"></amp-img>
  
    </a>
  

<p>This article offers <strong>two</strong> solutions to this problem.</p>
<p>The <strong>first</strong> is that it sends the Google Analytics Client ID from the parent to the <code>&lt;iframe&gt;</code> using <code>window.postMessage</code>, and the child frame can poll for this information on every page, meaning cookies are not needed to store the Client ID.</p>
<p>The <strong>second</strong> solution is that the child frame actually sends every single <code>dataLayer</code> message to the parent, so that the child frame doesn&rsquo;t have to track anything by itself. The parent handles the tracking for the child frame instead.</p>
<p>Using <code>window.postMessage</code> is more robust than the link decoration of my earlier proposals, because it doesn&rsquo;t force a reload of the frame, nor does it require the child frame to support cookies. It&rsquo;s a bit more elaborate to set up, however.</p>
<blockquote>
<p>Warning! I&rsquo;m not kidding about that last statement. Setting this up requires quite a bit of custom code, and you&rsquo;re working with bilateral communication between two windows. Please read this article carefully so that you understand what&rsquo;s going on before copy-pasting any code to your Google Tag Manager container(s).</p>
</blockquote>
<!-- raw HTML omitted -->
<h2 id="what-exactly-is-the-problem">What exactly is the problem?</h2>
<p>Glad you asked!</p>
<p>When a page loads an <code>&lt;iframe&gt;</code> from a <strong>cross-site</strong> origin, that frame is loaded in a third-party context, and any access to browser storage from within that <code>&lt;iframe&gt;</code> will require the browser to allow third-party cookies for the <code>&lt;iframe</code> site.</p>
<p>A key term here is <strong>cross-site</strong>. This means that the <strong>top privately-controlled domain name</strong> of the <code>&lt;iframe&gt;</code> is different from that of the parent page.</p>
<p>In the examples below, the top privately-controlled domain name is in italics.</p>
<ul>
<li>www.<em>simoahava.com</em></li>
<li>www.<em>gtmtools.com</em></li>
<li>www.<em>ebay.co.uk</em></li>
<li><em>sahava.github.io</em></li>
<li>analytics.<em>google.com</em></li>
</ul>
<p>If any one of the sites above loaded any other site from the list in an <code>&lt;iframe&gt;</code>, that content would be loaded cross-site, and any cookie operations within the embedded page would require third-party cookie access.</p>
<p>The following examples are all <strong>same-site</strong>, even if they are cross-origin:</p>
<ul>
<li>www.<em>simoahava.com</em></li>
<li><em>simoahava.com</em></li>
<li>blog.<em>simoahava.com</em></li>
<li>tracking.endpoint.<em>simoahava.com</em></li>
</ul>
<p>Any communication between pages from the list above would happen in a <strong>same-site</strong> (or first-party) context, and cookie access would not be restricted.</p>
<p>As I mention in the introduction, this is only going to spell doom for tracking within embedded content due to how browsers implement tracking protections.</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/tracking-protections.jpg" title="From www.cookiestatus.com">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/tracking-protections.jpg" layout="responsive" alt="From www.cookiestatus.com" height="1212" width="2878"></amp-img>
  
    </a>
  

<p>Even though Google recently made a veritable non-announcement by saying they&rsquo;ll <a href="https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html">phase out third-party cookies by 2022</a>, Google Chrome will actually make things harder for cross-site cookie access much, much sooner.</p>
<p>Chrome v80 (released on February 4, 2020), enforces <a href="https://web.dev/samesite-cookies-explained/">SameSite cookie restrictions</a>, which means that if a cookie should be accessible in third-party context, it requires the <code>SameSite=None</code> and <code>Secure</code> flags set. By default, these are <em>not</em> set. Unfortunately, the <code>_ga</code> cookie used by Google Analytics does <em>not</em> have these flags set, and currently there is no timeline for when support for these flags are added.</p>
<p>So that&rsquo;s the problem! On the majority of browsers, the <code>_ga</code> cookie does not (or will stop to) function in third-party context, which applies to all <strong>cross-site <code>&lt;iframe&gt;</code> embeds</strong>.</p>
<p>Luckily, there&rsquo;s a way around this.</p>
<p>We can ignore cookies altogether.</p>
<h2 id="solution-1-pass-the-client-id-from-the-parent-to-the-child">Solution 1: Pass the Client ID from the parent to the child</h2>
<p>Let&rsquo;s take a look at another celebrated illustration from yours truly:</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/postmessage-process.jpg" title="postMessage process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/postmessage-process.jpg" layout="responsive" alt="postMessage process" height="1612" width="2614"></amp-img>
  
    </a>
  

<p>There are many potential <strong>race conditions</strong> in the mix, so some precautions need to be taken. Here&rsquo;s how the parent page works:</p>
<ol>
<li>The parent page starts listening for messages from the <code>&lt;iframe&gt;</code> as soon as Google Tag Manager loads.</li>
<li>Once the parent page receives the <code>childReady</code> message, it starts polling for the Google Analytics tracker until a maximum timeout is reached.</li>
<li>As soon as the Google Analytics tracker is available, the parent page sends the Client ID back to the <code>&lt;iframe&gt;</code>.</li>
</ol>
<p>And here&rsquo;s how the <code>&lt;iframe&gt;</code> page reacts:</p>
<ol>
<li>The <code>&lt;iframe&gt;</code> page starts sending the <code>childReady</code> message as soon as Google Tag Manager loads.</li>
<li>Once the parent page responds with the Client ID (or a timeout is reached), the child page stops sending the message.</li>
<li>The child page writes the Client ID into <code>dataLayer</code>.</li>
</ol>
<p>So now we know how the Client ID will be passed to the <code>&lt;iframe&gt;</code>, but that&rsquo;s not enough, yet.</p>
<p><strong>Every single Google Analytics tag in the <code>&lt;iframe&gt;</code> must be configured to work with this setup!</strong></p>
<p>More specifically, they all need two <strong>fields</strong> set, preferably in a <a href="https://www.simoahava.com/amp/analytics/google-analytics-settings-variable-in-gtm/">Google Analytics Settings variable</a>:</p>
<ul>
<li><code>storage</code> set to <code>none</code> to avoid the tracker failing if it can&rsquo;t write the Client ID cookie.</li>
<li><code>clientId</code> set to the value from the <code>dataLayer</code>.</li>
</ul>
<p>We&rsquo;ll get to these <a href="#google-analytics-tags">shortly</a>, don&rsquo;t worry.</p>
<h2 id="solution-2-forward-all-data-layer-messages-from-child-to-parent">Solution 2: Forward all Data Layer messages from child to parent</h2>
<p>If you don&rsquo;t want to do any tracking within the <code>&lt;iframe&gt;</code> (I don&rsquo;t blame you), you can actually delegate tracking to the parent by sending all <code>dataLayer</code> messages to the parent for processing.</p>
<p>This means the parent page would manage tags for both the parent page&rsquo;s native interactions <em>as well as</em> those that happen within the <code>&lt;iframe&gt;</code>.</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/datalayer-listener.jpg" title="dataLayer message forwarder">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/datalayer-listener.jpg" layout="responsive" alt="dataLayer message forwarder" height="1932" width="3054"></amp-img>
  
    </a>
  

<p>The process is almost the same as with the first solution. Here&rsquo;s how the parent page works:</p>
<ol>
<li>The parent page starts listening for messages from the <code>&lt;iframe&gt;</code> as soon as Google Tag Manager loads.</li>
<li>Once the parent page receives the <code>childReady</code> message, it responds with a <code>parentReady</code> message.</li>
<li>If the child frame sends a message in <code>dataLayer</code>-compatible format, the parent page pushes this message into its own <code>dataLayer</code>.</li>
</ol>
<p>On the <code>&lt;iframe&gt;</code>, this is what happens:</p>
<ol>
<li>The <code>&lt;iframe&gt;</code> page starts sending the <code>childReady</code> message as soon as Google Tag Manager loads.</li>
<li>Once the parent page responds with <code>parentReady</code>, the child frame &ldquo;hijacks&rdquo; the <code>dataLayer.push()</code> method, and sends all the messages passed to it over to the parent page.</li>
</ol>
<p>The messages from the child frame are namespaced to keep them separate from the parent&rsquo;s &ldquo;native&rdquo; <code>dataLayer</code> messages, and they include some metadata about the <code>&lt;iframe&gt;</code> (mainly the URL and title).</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/parent-datalayer.jpg" title="Parent dataLayer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/parent-datalayer.jpg" layout="responsive" alt="Parent dataLayer" height="894" width="1278"></amp-img>
  
    </a>
  

<h2 id="the-parent-page-setup">The parent page setup</h2>
<p>This article combines <strong>both</strong> solutions into a single set of Custom HTML tags, one for the parent page and one for the child <code>&lt;iframe&gt;</code>.</p>
<p>On the parent page, i.e. the page sending the Client ID to the <code>&lt;iframe&gt;</code> and waiting for the messages sent from the child, you need to create a <strong>Custom HTML tag</strong> that fires on a <strong>Page View</strong> trigger. You can use the <em>All Pages</em> trigger if you wish, but you might as well create a <strong>Page View</strong> trigger that only fires on pages where you know the <code>&lt;iframe&gt;</code> to exist.</p>
<h3 id="the-custom-html-tag">The Custom HTML tag</h3>
<p>The Custom HTML tag itself should contain the following code:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Tracking ID whose _ga cookie to use
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">trackingId</span> <span class="o">=</span> <span class="s1">&#39;UA-40669554-1&#39;</span><span class="p">;</span>
    
    <span class="c1">// Maximum time in milliseconds to wait for GA tracker to load
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">maxGATime</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
    
    <span class="c1">// Set to the origin (&#34;https://www.domain.com&#34;) of the iframe you want to communicate with
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">childOrigin</span> <span class="o">=</span> <span class="s1">&#39;https://www.gtmtools.com&#39;</span><span class="p">;</span>
    
    <span class="c1">// Don&#39;t touch anything that follows
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">pollInterval</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">postCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="nx">childOrigin</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">!==</span> <span class="s1">&#39;childReady&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;childReady&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Send event that parent is ready
</span><span class="c1"></span>        <span class="nx">event</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;parentReady&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">pollCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="c1">// Stop polling if maxTime reached
</span><span class="c1"></span>          <span class="nx">maxGATime</span> <span class="o">-=</span> <span class="nx">pollInterval</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">maxGATime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
          
          <span class="c1">// Only proceed if GA loaded and tracker accessible
</span><span class="c1"></span>          <span class="kd">var</span> <span class="nx">ga</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nb">window</span><span class="p">[</span><span class="s1">&#39;GoogleAnalyticsObject&#39;</span><span class="p">]];</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ga</span> <span class="o">&amp;&amp;</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">getAll</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Get tracker that matches the Tracking ID you provided
</span><span class="c1"></span>            <span class="kd">var</span> <span class="nx">tracker</span> <span class="o">=</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> 
              <span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;trackingId&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">trackingId</span><span class="p">;</span> 
            <span class="p">}).</span><span class="nx">shift</span><span class="p">();</span>
            
            <span class="c1">// Send message back to frame with Client ID
</span><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="nx">tracker</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">event</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
                <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;clientId&#39;</span><span class="p">,</span>
                <span class="nx">clientId</span><span class="o">:</span> <span class="nx">tracker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;clientId&#39;</span><span class="p">)</span>
              <span class="p">},</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// Stop polling if not already done so
</span><span class="c1"></span>            <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">};</span>
        
        <span class="c1">// Start polling for Google Analytics tracker
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">poll</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">pollCallback</span><span class="p">,</span> <span class="nx">pollInterval</span><span class="p">)</span>
      <span class="p">}</span>
      
      <span class="c1">// Push dataLayer message from iframe to dataLayer of parent
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="c1">// Start listening for messages from child frame
</span><span class="c1"></span>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">postCallback</span><span class="p">);</span>
  <span class="p">})();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<p>There&rsquo;s quite a lot happening here, so let&rsquo;s walk through the code! If you don&rsquo;t care about this deep-dive, you can <a href="#configuring-the-message-forwarding-system">skip right to</a> how you might need to configure the parent page container to support the message forwarding setup.</p>
<h4 id="configuration">Configuration</h4>
<p>First, there&rsquo;s the configuration stuff:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Tracking ID whose _ga cookie to use
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">trackingId</span> <span class="o">=</span> <span class="s1">&#39;UA-40669554-1&#39;</span><span class="p">;</span>

<span class="c1">// Maximum time in milliseconds to wait for GA tracker to load
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">maxGATime</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>

<span class="c1">// Set to the origin (&#34;https://www.domain.com&#34;) of the iframe you want to communicate with
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">childOrigin</span> <span class="o">=</span> <span class="s1">&#39;https://www.gtmtools.com&#39;</span><span class="p">;</span>
</code></pre></div>
<p>The <code>trackingId</code> should be set to the Google Analytics tracking ID of the tracker whose <code>_ga</code> cookie you want to use. This is because there might be multiple GA cookies each storing the Client ID for a different Tracking ID. If you&rsquo;re unsure, just type your regular tracking ID as the value of the <code>trackingId</code> variable.</p>
<p>Set <code>maxGATime</code> to the maximum amount of time that the page waits for Google Analytics to load. You can certainly set this a lot higher than <em>2000</em> (2 seconds) if you want, but I would recommend against indefinite polling.</p>
<p>Set the <code>childOrigin</code> to the <strong>origin</strong> of the <code>&lt;iframe&gt;</code> you want to send the data to. The <strong>origin</strong> is everything in the URL up to the first <em>path</em> slash. So, if the URL is <code>https://www.simoahava.com/my-home-page/</code>, the <strong>origin</strong> would be <code>https://www.simoahava.com</code>.</p>
<blockquote>
<p>It&rsquo;s important to <strong>not</strong> have the trailing slash, as that&rsquo;s part of the <em>path</em> component and not the <em>origin</em>.</p>
</blockquote>
<h4 id="the-listener">The listener</h4>
<p>On the last line of the main code block, we add the <code>message</code> listener:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">postCallback</span><span class="p">);</span>
</code></pre></div>
<p>This means that when an <code>&lt;iframe&gt;</code> sends a <code>postMessage</code> to the parent page, the listener fires and executes the <code>postCallback</code> function.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">postCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="nx">childOrigin</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">!==</span> <span class="s1">&#39;childReady&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;childReady&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Send event that parent is ready
</span><span class="c1"></span>    <span class="nx">event</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;parentReady&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">pollCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Stop polling if maxTime reached
</span><span class="c1"></span>      <span class="nx">maxGATime</span> <span class="o">-=</span> <span class="nx">pollInterval</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">maxGATime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>

      <span class="c1">// Only proceed if GA loaded and tracker accessible
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">ga</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nb">window</span><span class="p">[</span><span class="s1">&#39;GoogleAnalyticsObject&#39;</span><span class="p">]];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ga</span> <span class="o">&amp;&amp;</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">getAll</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Get tracker that matches the Tracking ID you provided
</span><span class="c1"></span>        <span class="kd">var</span> <span class="nx">tracker</span> <span class="o">=</span> <span class="nx">ga</span><span class="p">.</span><span class="nx">getAll</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span> 
          <span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;trackingId&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">trackingId</span><span class="p">;</span> 
        <span class="p">}).</span><span class="nx">shift</span><span class="p">();</span>

        <span class="c1">// Send message back to frame with Client ID
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">tracker</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">event</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
            <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;clientId&#39;</span><span class="p">,</span>
            <span class="nx">clientId</span><span class="o">:</span> <span class="nx">tracker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;clientId&#39;</span><span class="p">)</span>
          <span class="p">},</span> <span class="nx">event</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// Stop polling if not already done so
</span><span class="c1"></span>        <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// Start polling for Google Analytics tracker
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">poll</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">pollCallback</span><span class="p">,</span> <span class="nx">pollInterval</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="c1">// Push dataLayer message from iframe to dataLayer of parent
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>First, if the message retrieved was not expected (e.g. coming from a different <code>&lt;iframe&gt;</code> or has the wrong content), the callback stops execution.</p>
<p>If the message <em>was</em> from the <code>&lt;iframe&gt;</code>, the first thing that&rsquo;s done is notify the child frame that the parent has received the message and is ready to start bilateral communication.</p>
<p>Next, a <code>window.setInterval</code> starts polling the parent page every 200 milliseconds up to the default of 2 full seconds. With each poll, the script checks if the Google Analytics tracker has been created. If it has, the script takes the <code>clientId</code> from the tracker, and sends it back to the <code>&lt;iframe&gt;</code> using <code>event.source.postMessage()</code>. After this is done, the polling is manually stopped to avoid having the Client ID being sent multiple times to the <code>&lt;iframe&gt;</code>.</p>
<p>In essence, the parent page needs to wait for two things:</p>
<ol>
<li>For the child page to signal it is ready to receive messages.</li>
<li>For the Google Analytics tracker to be available, so that the Client ID can be grabbed from it.</li>
</ol>
<p>The last code block checks if the message from the child frame contains an object with the <code>event</code> property, in which case it pushes this entire object into the parent page <code>dataLayer</code>.</p>
<h3 id="configuring-the-message-forwarding-system">Configuring the message forwarding system</h3>
<p>The parent page listens for <code>dataLayer</code> messages forwarded from the embedded <code>&lt;iframe&gt;</code>. You can create tags, triggers, and variables that react to these messages.</p>
<p>All triggers will be of type <strong>Custom Event trigger</strong>. That&rsquo;s because all the events sent from the frame will be appended with the <code>iframe.</code> prefix - even those without an <code>event</code> value (they&rsquo;ll be sent as <code>iframe.Message</code>). So, if you want to fire a tag when a link is clicked in the <code>&lt;iframe&gt;</code>, the trigger could look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/iframe-link-click.jpg" title="Iframe link click">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/iframe-link-click.jpg" layout="responsive" alt="Iframe link click" height="1092" width="2254"></amp-img>
  
    </a>
  

<p>It requires quite a bit of manual configuration to get the whole thing up and running. But it can make your whole setup run much smoother, as you won&rsquo;t need to embed any extra code within the <code>&lt;iframe&gt;</code>.</p>
<p>Each message sent from the <code>&lt;iframe&gt;</code> is automatically enhanced with some page-level information:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="nx">iframe</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">pageData</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://www.iframe-domain.com/iframe-page?iframequery=iframevalue#iframeHash&#39;</span><span class="p">,</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;The Iframe Page Title | Iframe Company&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>If you want to update your parent page tags to use the <code>&lt;iframe&gt;</code> page-level data, you need to create Data Layer variables for <strong>iframe.pageData.url</strong> (the URL of the <code>&lt;iframe&gt;</code> page) and <strong>iframe.pageData.title</strong> (the page title).</p>
<p>Once you have all these configured, you&rsquo;re ready to configure the <code>&lt;iframe&gt;</code> page!</p>
<h2 id="the-embedded-child-page-setup">The embedded (child) page setup</h2>
<p>This is where things get tricky. In this guide, we&rsquo;re covering a fairly typical use case where the <code>&lt;iframe&gt;</code> content is only ever interacted with as an embed. So there&rsquo;s no scenario where the user would visit the page loaded in the <code>&lt;iframe&gt;</code> in a first-party or top-frame context. I&rsquo;ll <a href="#multi-purpose-container">briefly discuss that scenario later</a> as well, but for now let&rsquo;s assume that the page in the <code>&lt;iframe&gt;</code> is only accessed as an embedded element.</p>
<p>You&rsquo;ll need to do <strong>three</strong> things in the Google Tag Manager container of the <code>&lt;iframe&gt;</code> page.</p>
<ol>
<li>Create a Custom HTML tag that communicates with the parent page.</li>
<li>Update the settings for <strong>all</strong> of your Universal Analytics (and App+Web while you&rsquo;re at it) tags.</li>
<li>Update the triggers for your Universal Analytics tags so they don&rsquo;t fire until they&rsquo;ve received the Client ID from the parent.</li>
</ol>
<h3 id="the-custom-html-tag-1">The Custom HTML tag</h3>
<p>Create a new Custom HTML tag, and set it to fire on the <strong>All Pages</strong> trigger. If the <code>&lt;iframe&gt;</code> is a single-page app, you should still only fire the Custom HTML tag on the All Pages trigger, and not with every SPA page change, for example.</p>
<p>Here&rsquo;s what you should copy-paste into the tag:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// If not in iframe, do nothing
</span><span class="c1"></span>    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">top</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nx">self</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
    
    <span class="c1">// Set to false to prevent dataLayer messages from being sent to parent
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">sendDataLayerMessages</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    
    <span class="c1">// Set the prefix that will be used in the event name, and under which all
</span><span class="c1"></span>    <span class="c1">// the dataLayer properties will be embedded
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">dataLayerMessagePrefix</span> <span class="o">=</span> <span class="s1">&#39;iframe&#39;</span><span class="p">;</span>
    
    <span class="c1">// Set to parent origin (&#34;https://www.domain.com&#34;)
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">parentOrigin</span> <span class="o">=</span> <span class="s1">&#39;https://www.simoahava.com&#39;</span><span class="p">;</span>

    <span class="c1">// Maximum time in milliseconds to poll the parent frame for ready signal
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">maxTime</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
    
    <span class="c1">// Don&#39;t touch anything that follows
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">pollInterval</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">parentReady</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">postCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="nx">parentOrigin</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">!==</span> <span class="s1">&#39;clientId&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">!==</span> <span class="s1">&#39;parentReady&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="s1">&#39;clientId&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;clientId&#39;</span><span class="p">,</span>
          <span class="nx">clientId</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">clientId</span>
        <span class="p">});</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;parentReady&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">parentReady</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sendDataLayerMessages</span><span class="p">)</span> <span class="nx">startDataLayerMessageCollection</span><span class="p">();</span>
        <span class="nx">parentReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">pollCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// If maximum time is reached, stop polling
</span><span class="c1"></span>      <span class="nx">maxTime</span> <span class="o">-=</span> <span class="nx">pollInterval</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">maxTime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
      <span class="c1">// Send message to parent that iframe is ready to retrieve Client ID
</span><span class="c1"></span>      <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;childReady&#39;</span><span class="p">,</span> <span class="nx">parentOrigin</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">createMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">flattenObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">));</span>
		<span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="c1">// Add metadata about the page into the message
</span><span class="c1"></span>        <span class="nx">message</span><span class="p">[</span><span class="nx">dataLayerMessagePrefix</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">pageData</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
            <span class="nx">title</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span>
          <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">flattenObj</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">flattenObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">prop</span> <span class="o">!==</span> <span class="s1">&#39;gtm.uniqueEventId&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">prop</span> <span class="o">===</span> <span class="s1">&#39;event&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">message</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">dataLayerMessagePrefix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">flattenObj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">message</span><span class="p">[</span><span class="nx">dataLayerMessagePrefix</span><span class="p">][</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">flattenObj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="nx">message</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">dataLayerMessagePrefix</span> <span class="o">+</span> <span class="s1">&#39;.Message&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">message</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">startDataLayerMessageCollection</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Send the current dataLayer content to top frame, flatten the object
</span><span class="c1"></span>      <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">parentOrigin</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="c1">// Create the push listener for future messages
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">oldPush</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">states</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">createMessage</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">parentOrigin</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">oldPush</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">,</span> <span class="nx">states</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
    
    <span class="c1">// Start polling the parent page with &#34;childReady&#34; message
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">poll</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">pollCallback</span><span class="p">,</span> <span class="nx">pollInterval</span><span class="p">);</span>
    
    <span class="c1">// Start listening for messages from the parent page
</span><span class="c1"></span>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">postCallback</span><span class="p">);</span>
  <span class="p">})();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span></code></pre></div>
<p>The following chapters will walk through this code. You can skip right to <a href="#google-analytics-tags">configuring the Google Analytics tags</a> if you don&rsquo;t care about the walkthrough.</p>
<h4 id="configuration-1">Configuration</h4>
<p>This is the first code block:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// If not in iframe, do nothing
</span><span class="c1"></span><span class="k">try</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">top</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nx">self</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// Set to false to prevent dataLayer messages from being sent to parent
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">sendDataLayerMessages</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="c1">// Set the prefix that will be used in the event name, and under which all
</span><span class="c1">// the dataLayer properties will be embedded
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">dataLayerMessagePrefix</span> <span class="o">=</span> <span class="s1">&#39;iframe&#39;</span><span class="p">;</span>

<span class="c1">// Set to parent origin (&#34;https://www.domain.com&#34;)
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">parentOrigin</span> <span class="o">=</span> <span class="s1">&#39;https://www.simoahava.com&#39;</span><span class="p">;</span>

<span class="c1">// Maximum time in milliseconds to poll the parent frame for ready signal
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">maxTime</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</code></pre></div>
<p>First of all, if the page is <strong>not</strong> loaded in an <code>&lt;iframe&gt;</code>, the code does not and should not execute at all. There&rsquo;s no parent page to communicate with, so executing any of the following code would be unnecessary.</p>
<p>You can set <code>sendDataLayerMessages</code> to <code>false</code> if you <strong>don&rsquo;t</strong> want to forward the <code>dataLayer</code> messages from the child to the parent. This is useful if you&rsquo;re comfortable with tracking everything within the <code>&lt;iframe&gt;</code> itself, and don&rsquo;t want to bother with setting up the corresponding tags in the parent page.</p>
<p>The <code>dataLayerMessagePrefix</code> value is what will be used to namespace the <code>dataLayer</code> messages that are forwarded from the child to the parent (if you haven&rsquo;t disabled forwarding per the previous paragraph).</p>
<p>The <code>parentOrigin</code> should be set to the <strong>origin</strong> of the parent page, i.e. the page to which the messages are sent. Remember, <strong>origin</strong> is everything from the protocol to the first slash of the path component. In other words, the <strong>origin</strong> of <code>https://www.simoahava.com/some-page</code> is <code>https://www.simoahava.com</code>.</p>
<p>Finally, the <code>maxTime</code> is how long the <code>&lt;iframe&gt;</code> tries to send the <code>childReady</code> message to the parent before it stops.</p>
<h4 id="the-poller">The poller</h4>
<p>The child frame polls the parent page with the <code>childReady</code> message to signal it&rsquo;s ready for the bilateral communication to start.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">pollCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// If maximum time is reached, stop polling
</span><span class="c1"></span>  <span class="nx">maxTime</span> <span class="o">-=</span> <span class="nx">pollInterval</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">maxTime</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
  <span class="c1">// Send message to parent that iframe is ready to retrieve Client ID
</span><span class="c1"></span>  <span class="nb">window</span><span class="p">.</span><span class="nx">top</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">&#39;childReady&#39;</span><span class="p">,</span> <span class="nx">parentOrigin</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Start polling the parent page with &#34;childReady&#34; message
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">poll</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">pollCallback</span><span class="p">,</span> <span class="nx">pollInterval</span><span class="p">);</span>
</code></pre></div>
<p>It runs every 200 milliseconds until the maximum poll time (2000 milliseconds by default) is reached.</p>
<h4 id="the-listener-1">The listener</h4>
<p>At the same time as it starts polling, a <code>postMessage</code> listener is also initiated. This listener waits for two things:</p>
<ol>
<li>The parent to signal <code>parentReady</code>, so that the <code>&lt;iframe&gt;</code> can start forwarding its <code>dataLayer messages to the parent</code>.</li>
<li>The parent to return a Client ID string, so that the <code>&lt;iframe&gt;</code> can use this in Google Analytics tags.</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">postCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="nx">parentOrigin</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">!==</span> <span class="s1">&#39;clientId&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">!==</span> <span class="s1">&#39;parentReady&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="s1">&#39;clientId&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">dataLayer</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;clientId&#39;</span><span class="p">,</span>
      <span class="nx">clientId</span><span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">clientId</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;parentReady&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">parentReady</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">poll</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sendDataLayerMessages</span><span class="p">)</span> <span class="nx">startDataLayerMessageCollection</span><span class="p">();</span>
    <span class="nx">parentReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Start listening for messages from the parent page
</span><span class="c1"></span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="nx">postCallback</span><span class="p">);</span>
</code></pre></div>
<p>If the parent sends a <code>clientId</code> message, then the page pushes this data into <code>dataLayer</code>, and Google Analytics tags firing in the <code>&lt;iframe&gt;</code> can utilize this information in their settings.</p>
<p>If the parent sends a <code>parentReady</code> message, the <code>&lt;iframe&gt;</code> stops sending the <code>childReady</code> message. Then, it fires up the <code>dataLayer</code> message forwarder (unless the user has chosen to prevent this).</p>
<h4 id="the-message-forwarder">The message forwarder</h4>
<p>The forwarder comprises two methods: <code>createMessage(obj)</code> and <code>startDataLayerMessageCollection()</code>.</p>
<p>Without going into too much detail, the basic setup is this:</p>
<ol>
<li>The <code>createMessage()</code> method is a utility that wraps the <code>dataLayer</code> message from the <code>&lt;iframe&gt;</code> page with the prefix configured in the beginning of the Custom HTML tag (<code>&quot;iframe&quot;</code>) by default. This prefix is used with the event name (so <code>gtm.js</code> becomes <code>iframe.gtm.js</code>) as well as with the object itself (so <code>{key: 'value'}</code> becomes <code>{iframe: {key: value}}</code>).</li>
<li>The <code>createMessage()</code> method also automatically adds a <code>pageData</code> object which contains the <code>url</code> and <code>title</code> of the page in the <code>&lt;iframe&gt;</code>.</li>
<li>The <code>startDataLayerMessageCollection()</code> method first sends everything in the <code>dataLayer</code> array collected thus far to the parent.</li>
<li>Then the method rewrites the <code>dataLayer.push</code> function to send everything pushed into <code>dataLayer</code> to the parent page as well.</li>
</ol>
<p>In other words, everything added to the <code>dataLayer</code> array within the <code>&lt;iframe&gt;</code> is forwarded to the parent page, so that the parent page can handle tracking of interactions and events within the <code>&lt;iframe&gt;</code> as well.</p>
<p>For example, here&rsquo;s how the forwarded transpiles and sends a <code>dataLayer</code> message to the parent page.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// This is what&#39;s pushed into dataLayer:
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;userLogin&#39;</span><span class="p">,</span>
  <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;abcd-1234&#39;</span><span class="p">,</span>
    <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;gold&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This is what&#39;s sent to the parent page
</span><span class="c1"></span><span class="p">{</span>
  <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;iframe.userLogin&#39;</span><span class="p">,</span>
  <span class="nx">iframe</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">pageData</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://www.iframe-domain.com/iframe-page/&#39;</span><span class="p">,</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Iframe Page Title&#39;</span>
    <span class="p">},</span>
    <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;abcd-1234&#39;</span><span class="p">,</span>
      <span class="nx">status</span><span class="o">:</span> <span class="s1">&#39;gold&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="google-analytics-tags">Google Analytics tags</h3>
<p>If you <strong>do</strong> want to collect data to Google Analytics from within the <code>&lt;iframe&gt;</code> page, you need to configure <strong>all</strong> your Google Analytics tags with the following settings:</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/iframe-google-analytics-settings.jpg" title="Iframe google analytics settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/iframe-google-analytics-settings.jpg" layout="responsive" alt="Iframe google analytics settings" height="1138" width="1786"></amp-img>
  
    </a>
  

<p>As the <code>&lt;iframe&gt;</code> will no longer use cookies to persist the Client ID, you need to set the <code>storage</code> field value to <code>none</code>.</p>
<p>Then, because the child frame uses the Client ID pushed into <code>dataLayer</code> by the message listener, you&rsquo;ll need to update the <code>clientId</code> field to use a Data Layer variable for <code>clientId</code>. It should look like this:</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/dlv-clientid.jpg" title="Client ID in Data Layer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/dlv-clientid.jpg" layout="responsive" alt="Client ID in Data Layer" height="1208" width="2354"></amp-img>
  
    </a>
  

<p>None of your tags should fire if the Client ID is not yet available. You can use the <code>clientId</code> in a Custom Event trigger to fire your tags when Client ID has been pushed to <code>dataLayer</code>.</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/custom-event-trigger.jpg" title="Custom Event trigger">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/custom-event-trigger.jpg" layout="responsive" alt="Custom Event trigger" height="1080" width="2258"></amp-img>
  
    </a>
  

<p>You can also update your existing triggers to not fire until <code>clientId</code> has a valid value.</p>


    <a href="https://www.simoahava.com/amp/images/2020/02/clientid-not-undefined.jpg" title="Client ID not undefined">
  
    <amp-img src="https://www.simoahava.com/amp/images/2020/02/clientid-not-undefined.jpg" layout="responsive" alt="Client ID not undefined" height="1126" width="1862"></amp-img>
  
    </a>
  

<h4 id="multi-purpose-container">Multi-purpose container</h4>
<p>One important caveat to note is that if you set up all your tags per the instructions in the previous chapter, then the container running in the <code>&lt;iframe&gt;</code> will not function properly if the page is visited directly as a top-level page, i.e. not as an embed.</p>
<p>I would generally recommend to avoid mixing too many use cases in a single container. It might be wiser to create a <em>different</em>  container for scenarios where the page is visited directly, and have the developers update the site code to load the correct container, depending on whether the page is embedded in an <code>&lt;iframe&gt;</code> or not.</p>
<p>However, if you do want the container to cater to different use cases, then a good idea is to create a separate set of tags for when the page is accessed in the top frame vs. when the page is accessed as an embed.</p>
<p>You can use a simple utility variable to check if the page is accessed as an <code>&lt;iframe&gt;</code> or not. This Custom JavaScript variable returns <code>true</code> if the page <strong>is NOT in an <code>&lt;iframe&gt;</code></strong> and <code>false</code> otherwise.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">top</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nx">self</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>You can then check for this variable value in your tags, triggers, and variables, to make sure that tracking is configured correctly depending on how the page is accessed.</p>
<h2 id="summary">Summary</h2>
<p>This has been a difficult article to write, and I feel a bit embarrassed to leave so much work to you, my noble reader.</p>
<p>The thing is - working with this type of a bilateral messaging setup requires both the parent page and the <code>&lt;iframe&gt;</code> page to be in sync. The Custom HTML tags I&rsquo;ve designed have been built to naturally reject race conditions, but it&rsquo;s possible you&rsquo;ll need to modify one or the other (or both) to make things work on your site.</p>
<p>Over the course of my career, and especially over the time I&rsquo;ve been blogging about Google Tag Manager, trying to perfect tracking of <code>&lt;iframe&gt;</code> elements has been my personal Mount Everest. Cross-site tracking of embedded content has take over my life to such an extent that I&rsquo;m losing sleep and seriously considering hunting down Ibrahim or Isabella Frame, or whoever the person is who thought the <code>&lt;iframe&gt;</code> is a great addition to the HTML spec.</p>
<p>Regardless, it&rsquo;s still <em>such a common use case</em> on the SaaS- and micro service -rich web to embed cross-site content. Naturally, there&rsquo;s an incentive to know what happens in these <code>&lt;iframe&gt;</code> blocks that I consider the time I&rsquo;ve spent trying to solve this particular riddle to be almost worthwhile.</p>
<p>Anyway, I expect <em>and hope</em> that you have comments and/or questions about this setup. Let&rsquo;s continue the discussion in the comments of this article, thank you!</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>





<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

