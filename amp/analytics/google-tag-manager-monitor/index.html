

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/google-tag-manager-monitor/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>How to Build a Google Tag Manager Monitor | Simo Ahava's blog</title>
        <meta property="og:title" content="How to Build a Google Tag Manager Monitor" />
<meta name="description" content="How to build a monitor system for Google Tag Manager, where the rate and success of tags firing on your website is logged into BigQuery for analysis and anomaly detection." />
<meta property="og:description" content="How to build a monitor system for Google Tag Manager, where the rate and success of tags firing on your website is logged into BigQuery for analysis and anomaly detection." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/google-tag-manager-monitor/" />

    
        
    



    
        <meta property="article:published_time" content="2019-07-07T08:49:15Z"/>
    
    
        <meta property="article:modified_time" content="2019-07-07T08:49:15Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="custom templates" />
        
            <meta property="article:tag" content="monitor" />
        
            <meta property="article:tag" content="google cloud platform" />
        
            <meta property="article:tag" content="bigquery" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    




<meta itemprop="name" content="How To Build A Google Tag Manager Monitor">
<meta itemprop="description" content="How to build a monitor system for Google Tag Manager, where the rate and success of tags firing on your website is logged into BigQuery for analysis and anomaly detection.">


<meta itemprop="datePublished" content="2019-07-07T11:49:15&#43;03:00" />
<meta itemprop="dateModified" content="2019-07-07T11:49:15&#43;03:00" />
<meta itemprop="wordCount" content="5334">



<meta itemprop="keywords" content="google tag manager,custom templates,monitor,google cloud platform,bigquery," />

<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https://www.simoahava.com/amp/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "How To Build A Google Tag Manager Monitor | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2019/07/google-tag-manager-monitor.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/amp/analytics/google-tag-manager-monitor/",
  "datePublished": "2019-07-07T11:49:15+03:00",
  "dateModified": "2019-07-07T11:49:15+03:00",
  "description": "How to build a monitor system for Google Tag Manager, where the rate and success of tags firing on your website is logged into BigQuery for analysis and anomaly detection.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">How to Build a Google Tag Manager Monitor</h1>
        <small>How to build a monitor system for Google Tag Manager, where the rate and success of tags firing on your website is logged into BigQuery for analysis and anomaly detection.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/custom-templates">#custom templates</a>
    
        , <a href="https://www.simoahava.com/amp/tags/monitor">#monitor</a>
    
        , <a href="https://www.simoahava.com/amp/tags/google-cloud-platform">#google cloud platform</a>
    
        , <a href="https://www.simoahava.com/amp/tags/bigquery">#bigquery</a>
    

<time class="post-date" datetime="2019-07-07T11:49:15&#43;03:00">
    7 July 2019
</time>


        </section>
    </header>

    <section class="post-content">
      

<p><a href="https://tagmanager.google.com/">Google Tag Manager</a> is strictly a <em>tag delivery system</em>, and it&rsquo;s very careful <a href="https://support.google.com/tagmanager/answer/9323295#data">not to collect any analytics data</a> on its own. This is most likely a deliberate choice, because if GTM was to start collecting data, it would introduce additional barriers to adoption.</p>

<p>Nevertheless, being a tool that consolidates the design, development, deployment, and testing of all the marketing and analytics pixels, code snippets, and utilities running on a website or a mobile app, lacking the necessary features for auditing and monitoring has always seemed like an oversight.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/google-tag-manager-monitor.jpg" title="Google Tag Mangager Monitor">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/google-tag-manager-monitor.jpg" layout="responsive" alt="Google Tag Mangager Monitor" height="395" width="1152"></amp-img>
  
    </a>
  


<p>Recently, Google Tag Manager introduced a new API for <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/">custom templates</a>: <a href="https://developers.google.com/tag-manager/templates/api#addEventCallback"><code>addEventCallback</code></a>. This API lets you create your own monitoring system for your container. With community effort and support from Google, the new API will introduce a number of solutions around tag monitoring and auditing in the near future.</p>

<p>In this article, <strong>Mark Edmondson</strong> and I will help you get started. Weâ€™ll introduce how the new API works and how you can use it to build the necessary tags and triggers in GTM for monitoring purposes. Weâ€™ll also show you how to use powerful, cheap, and scalable features of the <a href="https://cloud.google.com/">Google Cloud Platform</a> to create the backend for the monitoring system, and finally weâ€™ll give you some ideas for how to visualize the data in a <a href="https://datastudio.google.com/">Google Data Studio</a> report.</p>

<p>You can also check out <a href="https://youtu.be/OGvsFTEXFGc">this video</a>, where I go through (almost) the same steps in video format.</p>

<amp-youtube data-videoid="OGvsFTEXFGc" layout="responsive" height="720" width="1280"></amp-youtube>


<!-- toc -->

<h2 id="guest-author-mark-edmondson">Guest author: Mark Edmondson</h2>

<p><a href="https://twitter.com/holomarked">Mark Edmondson</a> is a former colleague of mine, a fellow <a href="https://google-developers.appspot.com/community/experts/directory/profile/profile-mark_edmondson">Google Developer Expert</a> for Google Analytics, and the owner of one of the most versatile skill sets in our industry. He&rsquo;s currently working as a data engineer at <a href="https://iihnordic.com/">IIH Nordic</a> (a great company full of nice folks in its own right!).</p>

<p>Mark is fluent in bridging together the worlds of marketing and analytics, and his reach extends far beyond, as evidenced by his <a href="https://github.com/MarkEdmondson1234/">prolific contributions to the open-source space</a>. Heâ€™s the author of the popular <a href="https://github.com/MarkEdmondson1234/googleAnalyticsR">googleAnalyticsR</a> library for R, and <a href="https://www.markedmondson.me/">his blog</a> is full of great walkthroughs for data engineering, data science, web analytics, and software development.</p>

<p>Being one of the most humble people Iâ€™ve met, heâ€™s probably royally embarrassed by this introduction. So Iâ€™ll just wrap up this introduction by making it clear how grateful I am for his contributions not just to this article but to our whole industry.</p>

<h2 id="what-we-ll-build-the-google-tag-manager-monitor">What we&rsquo;ll build: The Google Tag Manager Monitor</h2>

<p>The <strong>key deliverable</strong> of this little project is a <a href="https://cloud.google.com/bigquery/">BigQuery</a> view that collects data from your website. This data will be sent by way of a new Google Tag Manager custom template, and it will comprise statistics of all the tags that have fired on your site for any given <code>dataLayer</code> event.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/bigquery-view.jpg" title="BigQuery view">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/bigquery-view.jpg" layout="responsive" alt="BigQuery view" height="464" width="915"></amp-img>
  
    </a>
  


<p>In this proof-of-concept, the metadata collected from each <code>dataLayer</code> event includes:</p>

<ul>
<li><p>Event name and timestamp (to uniquely distinguish events with the same name from each other).</p></li>

<li><p>Tag ID, name, firing status, and execution time for every tag that fired for that event (or <code>null</code> if no tags fired for the event).</p></li>
</ul>

<p>It&rsquo;s extremely easy to extend this solution to include things like Container ID or tag categorization information - we&rsquo;ll explore these later in the guide.</p>

<h2 id="why-do-we-need-a-monitor">Why do we need a monitor?</h2>

<p>There arenâ€™t that many ways to monitor the consistency of tags firing in your containers. Obviously, you can run reports against the various endpoints, such as Google Analytics or Facebook, and detect anomalous data collection through their reporting interfaces.</p>

<p>But this has some problems:</p>

<ul>
<li><p>Not all endpoints have reports readily available.</p></li>

<li><p>With endpoints collecting data from multiple different sources, itâ€™s difficult to identify those that come from GTM and those that do not.</p></li>

<li><p>Itâ€™s difficult to know if the data issues in the endpoints are due to data collection or something else (e.g. a broken filter in Google Analytics).</p></li>
</ul>

<p>In other words, if you want to be alerted to issues in data collection, the best way to do this is to monitor the data collection itself.</p>

<p>For this to be possible, the data collection mechanism requires the possibility to introduce a <strong>side effect</strong>. The side effect in this case is the <code>addEventCallback</code> API, and its purpose is to collect metadata about the data collection preferably to an endpoint that is <strong>separated from the tags that are being monitored</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/process-flow.jpg" title="Process flow">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/process-flow.jpg" layout="responsive" alt="Process flow" height="728" width="1303"></amp-img>
  
    </a>
  


<p>Why have a separate endpoint for monitoring? Well, it wouldnâ€™t really make sense to collect data about Google Analyticsâ€™ data collection in Google Analytics itself (a custom reporting property, for example), because if the analytics data collection fails due to not being able to connect to the GA endpoint, then the monitoring data collection would fail as well.</p>

<p>That is why this article utilizes an endpoint in the Google Cloud Platform to collect the data. Itâ€™s not failsafe, either, since if the data collection fails due to a network outage, the collection to GCP would fail, too. Even though there are ways to tackle this problem as well, weâ€™ll try to keep things at an MVP (minimum viable product) level, and you can then extend the solution to fit your more elaborate needs.</p>

<h2 id="step-1-build-the-custom-template">Step 1: Build the custom template</h2>

<p>The custom <strong>tag</strong> template will create a <strong>callback</strong> that is called every time a <code>dataLayer</code> event reaches conclusion. This is basically the same thing as the <a href="https://www.simoahava.com/amp/gtm-tips/hitcallback-eventcallback/">eventCallback</a> of Google Tag Manager, just wrapped in a template API.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/data-object.jpg" title="The data object">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/data-object.jpg" layout="responsive" alt="The data object" height="209" width="611"></amp-img>
  
    </a>
  


<p>When the callback is invoked, an array of tags is passed to the callback in a data object. Each tag is reported with the following metadata:</p>

<ul>
<li><p><code>id</code>: Tag ID</p></li>

<li><p><code>status</code>: Firing status (e.g. success, failure)</p></li>

<li><p><code>executionTime</code>: Execution time in milliseconds</p></li>
</ul>

<p>Weâ€™ll augment this data set with these values:</p>

<ul>
<li><p><code>eventName</code> and <code>eventTimestamp</code> (to uniquely identify each event)</p></li>

<li><p><code>name</code>: Tag name</p></li>
</ul>

<p>Itâ€™s easiest to show by doing.</p>

<p>In Google Tag Manager, open up the <strong>Templates</strong> view, and create a new tag template.</p>

<p>You can also download the template from <a href="https://github.com/sahava/GoogleTagManagerTemplates/tree/master/tags/Utilities/GoogleTagManagerMonitor">here</a> and <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#importing-and-exporting">import</a> it directly into your container.</p>

<h3 id="1-1-fields">1.1. Fields</h3>

<p>Feel free to add whatever you want into the <strong>Info</strong> tab of template. We went with this:</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/info-tab.jpg" title="Info tab">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/info-tab.jpg" layout="responsive" alt="Info tab" height="402" width="455"></amp-img>
  
    </a>
  


<p>In the Fields tab, weâ€™re going with two default fields. One for the <strong>endpoint URL</strong>, and one to let the user decide whether to <strong>batch</strong> the hits or not.</p>

<p>There is a third field as well, which becomes available if the user decided to batch the hits.</p>

<h4 id="1-1-1-endpoint-field">1.1.1. <code>endPoint</code> field</h4>

<p>The first field is a <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#text-input">Text input</a> field named <code>endPoint</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/endpoint-field.jpg" title="Endpoint field">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/endpoint-field.jpg" layout="responsive" alt="Endpoint field" height="710" width="943"></amp-img>
  
    </a>
  


<p>It has the following <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration">Field configurations</a> toggled on:</p>

<ul>
<li><p><strong>Value hint</strong>: <code>e.g. https://track.com/collect</code></p></li>

<li><p><strong>Display name</strong>: <code>GET request endpoint</code></p></li>

<li><p><strong>Help text</strong>: <code>Provide the URL to which the GET request with tag data is sent.</code></p></li>

<li><p><strong>Always in summary</strong>: checked</p></li>

<li><p><strong>Validation rules</strong></p></li>
</ul>

<p>There are two <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#validation-rules">validation rules</a>:</p>

<ul>
<li><p><strong>This value cannot be empty</strong></p></li>

<li><p><strong>This value must match a regular expression</strong>: <code>^https://.+</code></p></li>
</ul>

<p>If you want, you can add some customized error messages to these validation rules by opening the Advanced settings for each rule.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/validation-rules-advanced-settings.jpg" title="Validation rules advanced settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/validation-rules-advanced-settings.jpg" layout="responsive" alt="Validation rules advanced settings" height="336" width="891"></amp-img>
  
    </a>
  


<h4 id="1-1-2-batchhits-field">1.1.2. <code>batchHits</code> field</h4>

<p>The second field is a <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#radio-buttons">Radio button</a> field named <code>batchHits</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/batchhits.jpg" title="Batch hits field">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/batchhits.jpg" layout="responsive" alt="Batch hits field" height="668" width="952"></amp-img>
  
    </a>
  


<p>It has the following Field configurations toggled on:</p>

<ul>
<li><p><strong>Display name</strong>: <code>Batch hits</code></p></li>

<li><p><strong>Help text</strong>: <code>If you select No, details of all the tags that fired for any given hit are sent in a single GET request. If you select Yes, you can choose the maximum number of tags per request, and the tag will automatically send multiple requests if necessary.</code></p></li>
</ul>

<p>There are two radio buttons.</p>

<p>The <strong>first</strong> one is named <code>No</code>, and has the value <code>no</code>.</p>

<p>The <strong>second</strong> one is named <code>Yes</code>, and has the value <code>yes</code>.</p>

<p>The Yes button has a nested field (found after showing advanced settings for the button), which is a <strong>Text input</strong> field named <code>maxTags</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/radio-yes-nested-field.jpg" title="Radio button nested field">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/radio-yes-nested-field.jpg" layout="responsive" alt="Radio button nested field" height="356" width="873"></amp-img>
  
    </a>
  


<h4 id="1-1-3-maxtags-field">1.1.3. <code>maxTags</code> field</h4>

<p>The <em>nested</em> <code>maxTags</code> field is a <strong>Text input</strong> field where the user can set a limit of tags sent per request.</p>

<p>This is useful if you have tags with long names or <code>dataLayer</code> events that can fire dozens of tags at a time. Sending the requests in batches should reduce the effort required in the endpoint to parse the data into the BigQuery table.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/maxtags-field.jpg" title="maxTags field">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/maxtags-field.jpg" layout="responsive" alt="maxTags field" height="562" width="858"></amp-img>
  
    </a>
  


<p>The field has the following Field configurations toggled on:</p>

<ul>
<li><p><strong>Display name</strong>: <code>Maximum number of tags per request</code></p></li>

<li><p><strong>Help text</strong>: <code>Enter the maximum number of tags per request that will be dispatched to the endpoint. If necessary, multiple requests will be made.</code></p></li>

<li><p><strong>Default value</strong>: <code>10</code></p></li>

<li><p><strong>Validation rules</strong></p></li>
</ul>

<p>The sole validation rule is <strong>This value must be a positive integer</strong>.</p>

<h3 id="1-2-code">1.2. Code</h3>

<p>In the <strong>Code</strong> tab, add the following code:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Require the necessary APIs
</span><span class="c1"></span><span class="k">const</span> <span class="nx">addEventCallback</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;addEventCallback&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">readFromDataLayer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copyFromDataLayer&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">sendPixel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sendPixel&#39;</span><span class="p">);</span>
<span class="k">const</span> <span class="nx">getTimestamp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;getTimestamp&#39;</span><span class="p">);</span>

<span class="c1">// Get the dataLayer event that triggered the tag
</span><span class="c1"></span><span class="k">const</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">readFromDataLayer</span><span class="p">(</span><span class="s1">&#39;event&#39;</span><span class="p">);</span>

<span class="c1">// Add a timestamp to separate events named the same way from each other
</span><span class="c1"></span><span class="k">const</span> <span class="nx">eventTimestamp</span> <span class="o">=</span> <span class="nx">getTimestamp</span><span class="p">();</span>

<span class="k">const</span> <span class="nx">endPoint</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">endPoint</span><span class="p">;</span>
<span class="k">const</span> <span class="nx">batchHits</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">batchHits</span> <span class="o">===</span> <span class="s1">&#39;yes&#39;</span><span class="p">;</span>
<span class="k">const</span> <span class="nx">maxTags</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">maxTags</span><span class="p">;</span>

<span class="c1">// Utility for splitting an array into multiple arrays of given size
</span><span class="c1"></span><span class="k">const</span> <span class="nx">splitToBatches</span> <span class="o">=</span> <span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">const</span> <span class="nx">newArr</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">newArr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="nx">size</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">newArr</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// The addEventCallback gets two arguments: container ID and a data object with an array of tags that fired
</span><span class="c1"></span><span class="nx">addEventCallback</span><span class="p">((</span><span class="nx">ctid</span><span class="p">,</span> <span class="nx">eventData</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>

  <span class="c1">// Filter out tags that have the &#34;exclude&#34; metadata set to true
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">tags</span> <span class="o">=</span> <span class="nx">eventData</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">t</span> <span class="p">=&gt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">exclude</span> <span class="o">!==</span> <span class="s1">&#39;true&#39;</span><span class="p">);</span>
  
  <span class="c1">// If batching is enabled, split the tags into batches of the given size
</span><span class="c1"></span>  <span class="k">const</span> <span class="nx">batches</span> <span class="o">=</span> <span class="nx">batchHits</span> <span class="o">?</span> <span class="nx">splitToBatches</span><span class="p">(</span><span class="nx">tags</span><span class="p">,</span> <span class="nx">maxTags</span><span class="p">)</span> <span class="o">:</span> <span class="p">[</span><span class="nx">tags</span><span class="p">];</span>
  
  <span class="c1">// For each batch, build a payload and dispatch to the endpoint as a GET request
</span><span class="c1"></span>  <span class="nx">batches</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">tags</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="s1">&#39;?eventName=&#39;</span> <span class="o">+</span> <span class="nx">event</span> <span class="o">+</span> <span class="s1">&#39;&amp;eventTimestamp=&#39;</span> <span class="o">+</span> <span class="nx">eventTimestamp</span><span class="p">;</span>
    <span class="nx">tags</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">const</span> <span class="nx">tagPrefix</span> <span class="o">=</span> <span class="s1">&#39;&amp;tag&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="nx">payload</span> <span class="o">+=</span>
        <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;id=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span>
        <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;nm=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span>
        <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;st=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span>
        <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;et=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">executionTime</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">sendPixel</span><span class="p">(</span><span class="nx">endPoint</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// After adding the callback, signal tag completion
</span><span class="c1"></span><span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">();</span>
</code></pre></div>

<p>The functionally most significant part of this code is the <code>addEventCallback()</code> method. This invokes the API of the same name.</p>

<p>The API checks the <code>dataLayer</code> event that triggered the tag created from this template, and then updates the <code>dataLayer</code> <code>eventCallback</code> with the function defined in the template.</p>

<p>In other words, when whatever event that triggers this monitor tag is fully resolved (i.e. all tags have signalled completion), the callback function will execute with data about each of the tags that fired on the event.</p>

<p>There&rsquo;s a provision in place to exclude any tags from the monitoring based on a tag metadata field you can set (more on this below). For some, it might make sense to exclude the monitoring tag itself from being monitored, even though there might be value in measuring its execution time along with all the other tags&rsquo;.</p>

<p>By far the most significant code is run when the payload is built:</p>

<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">batches</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">tags</span> <span class="p">=&gt;</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nx">payload</span> <span class="o">=</span> <span class="s1">&#39;?eventName=&#39;</span> <span class="o">+</span> <span class="nx">event</span> <span class="o">+</span> <span class="s1">&#39;&amp;eventTimestamp=&#39;</span> <span class="o">+</span> <span class="nx">eventTimestamp</span><span class="p">;</span>
   <span class="nx">tags</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">const</span> <span class="nx">tagPrefix</span> <span class="o">=</span> <span class="s1">&#39;&amp;tag&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="nx">payload</span> <span class="o">+=</span>
       <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;id=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span>
       <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;nm=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span>
       <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;st=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span>
       <span class="nx">tagPrefix</span> <span class="o">+</span> <span class="s1">&#39;et=&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">executionTime</span><span class="p">;</span>
   <span class="p">});</span>
   <span class="nx">sendPixel</span><span class="p">(</span><span class="nx">endPoint</span> <span class="o">+</span> <span class="nx">payload</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>Here, every tag that fired on the event is parsed and concatenated into a URL query string payload. For example, a <code>dataLayer</code> event named <code>gtm.js</code> that fired two tags might have the following payload:</p>

<pre>
?eventName=gtm.js
&eventTimestamp=1562402273899
&tag1id=12
&tag1nm=GA-PageView
&tag1st=success
&tag1et=124
&tag2id=29
&tag2nm=Facebook
&tag2st=failure
&tag2et=422
</pre>

<p>This is then joined with the endpoint URL, and a GET request is dispatched.</p>

<p>This is the payload that is captured by the endpoint in the Google Cloud, which Mark will show <a href="#step-3-creating-the-google-cloud-platform-endpoint">later</a> how to create.</p>

<p>It&rsquo;s easy to extend this with additional metadata. Just update the <code>payload +=</code> concatenation with each additional metadata key you want to access from the tags.</p>

<h3 id="1-3-permissions">1.3. Permissions</h3>

<p>If youâ€™ve added the code into the code editor without errors, you should see three permissions predefined in the <strong>Permissions</strong> tab.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/permissions-tab.jpg" title="Permissions tab">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/permissions-tab.jpg" layout="responsive" alt="Permissions tab" height="466" width="591"></amp-img>
  
    </a>
  


<ul>
<li><p><a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#reads-data-layer">Reads Data Layer</a>: Add the key <code>event</code> into the text area.</p></li>

<li><p><a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#reads-event-metadata">Reads Event Metadata</a>: No input necessary.</p></li>

<li><p><a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#sends-pixels">Sends Pixels</a>: Add the URL of the endpoint you will be sending the data to (you can use wildcards and partials matches, too).</p></li>
</ul>

<p>Naturally, you wonâ€™t know the endpoint until youâ€™ve created it, so if you want to test the template before creating the endpoint, you can just a placeholder in the permissions such as <code>https://placeholder.com/collect</code>.</p>

<p>You can <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#testing-the-template"><strong>Test</strong></a> the template if you wish, but it wonâ€™t really do anything, as the callback requires an event to be pushed into <code>dataLayer</code> to trigger.</p>

<p><strong>Save</strong> the template once youâ€™re done.</p>

<h2 id="step-2-tags-and-triggers">Step 2: Tags and triggers</h2>

<p>The first thing weâ€™ll need to do is create the <strong>monitor tag</strong> itself.</p>

<h3 id="2-1-create-the-monitor-tag">2.1. Create the monitor tag</h3>

<p>In GTM, go to <strong>Tags</strong> and create a new tag. Select the template you just created from the tag type selector.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/choose-tag-type.jpg" title="Choose tag type">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/choose-tag-type.jpg" layout="responsive" alt="Choose tag type" height="273" width="513"></amp-img>
  
    </a>
  


<p>The GET request endpoint field takes the endpoint youâ€™ll create in the next section, so you can just use the placeholder value of <code>https://placeholder.com/collect</code> there for now, weâ€™ll return to this shortly.</p>

<p>If you want to send the hits in batches, choose the <strong>Yes</strong> radio button, but you might want to start without batches and just use the default settings.</p>

<p>Next, expand <strong>Advanced Settings</strong> and scroll down to a new setting named <strong>Additional Tag Metadata</strong>.</p>

<p>Click it open, and check the box named <strong>Include tag name</strong>. Set the <strong>Key for tag name</strong> value to <code>name</code>.</p>

<p>Add a new metadata by clicking the <strong>+ Add Metadata</strong> button, and set these values:</p>

<ul>
<li><p>Key: <code>exclude</code></p></li>

<li><p>Value: <code>true</code></p></li>
</ul>



    <a href="https://www.simoahava.com/amp/images/2019/07/additional-tag-metadata.jpg" title="Additional tag metadata">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/additional-tag-metadata.jpg" layout="responsive" alt="Additional tag metadata" height="650" width="876"></amp-img>
  
    </a>
  


<p>Because this monitor should monitor every single event that fires in your container, add a new <strong>Custom Event Trigger</strong> to the tag that looks like this:</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/all-events.jpg" title="Custom event trigger for all events">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/all-events.jpg" layout="responsive" alt="Custom event trigger for all events" height="542" width="1175"></amp-img>
  
    </a>
  


<p>With that regular expression for the event name, the monitor tag will fire for every single <code>dataLayer</code> event.</p>

<p>Save the trigger and tag when ready.</p>

<h3 id="2-2-the-additional-tag-metadata-setting">2.2. The Additional Tag Metadata setting</h3>

<p>As you can see, thereâ€™s a <strong>new advanced setting</strong> for Google Tag Manager tags.</p>

<p>This <strong>Additional Tag Metadata</strong> setting lets you add metadata to every single tag in the container. This metadata is added to the tags passed to the <code>eventCallback</code> of the <code>dataLayer.push()</code> (such as the one added by the <code>addEventCallback</code> custom template API).</p>

<p>One predefined metadata is already given to you: the <strong>tag name</strong>. By checking the <strong>Include tag name</strong> box, the <code>eventCallback</code> data object will always include the <code>name</code> key (or whatever key you assign), automatically set to the tagâ€™s name.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/other-metadata.jpg" title="Other metadata">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/other-metadata.jpg" layout="responsive" alt="Other metadata" height="350" width="838"></amp-img>
  
    </a>
  


<p>You can add additional metadata too, such as category or type of tag.</p>

<p>Just remember that the solution as established in this article only makes use of the tag <code>name</code> and <code>exclude</code> metadata keys. Any other metadata you add will require a code change in the template, as the new metadata will need to be concatenated into the payload string as well.</p>

<h3 id="2-3-update-all-your-tags">2.3. Update all your tags</h3>

<p>The last thing youâ€™ll need to do in GTM (apart from updating the endpoint URL of the monitor tag when you have one), is to update <strong>every single one</strong> of your tags to include the tag <code>name</code> metadata. The tag name is easier to interpret than the tag ID when building your reports and visualizations.</p>

<p>For each tag, expand the <strong>Advanced Settings</strong> and check the <strong>Include tag name</strong> checkbox under <strong>Additional Tag Metadata</strong>. Remember to set the key name to <code>name</code> as well.</p>

<p>Hopefully, the tag name would be automatically included as a metadata in the future - it seems like a sensible feature to have always on. Or, at the very least, flip the checkbox around and require it to be checked if you want to <strong>exclude</strong> the tag name from the tagâ€™s metadata.</p>

<p>At this point, you should have your monitor tag with almost all the settings in place, and you should have now edited all your tags to include the tag name. The monitor tag should have a Custom Event trigger that fires it for every single <code>dataLayer</code> event.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/preview-and-network.jpg" title="Preview and network requests">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/preview-and-network.jpg" layout="responsive" alt="Preview and network requests" height="216" width="514"></amp-img>
  
    </a>
  


<p>Feel free to test in Preview mode to see if the endpoint is invoked with a proper query string. You should see something like this in the Network logs of your browser, assuming you used the placeholder URL of <code>https://placeholder.com/collect</code>.</p>

<p>Next up, <strong>Mark</strong> will show us how to get the Google Cloud Platform endpoint up and running!</p>

<h2 id="step-3-creating-the-google-cloud-platform-endpoint">Step 3: Creating the Google Cloud Platform endpoint</h2>

<p>The GCP endpoint needs to process the <strong>GET requests</strong> sent from the site, insert them into a <strong>BigQuery table</strong>, parse them into columns and rows, and finally connect the data to <strong>Google Data Studio</strong>.</p>

<h3 id="3-1-choosing-the-gcp-solution-for-the-endpoint">3.1. Choosing the GCP solution for the endpoint</h3>

<p>Boiling down the use case requirements here, we are looking to turn an API call containing the GTM tag data into useful data for analysis. There are many ways to solve this particular use case on GCP - we&rsquo;ll go through some and show why we eventually went for <a href="https://cloud.google.com/functions/">Cloud Functions</a>.</p>

<p>The general solution requirements were:</p>

<ul>
<li><p><strong>Serverless</strong>: so we don&rsquo;t babysit a server but are able to deal with high traffic and/or scale down to <em>zero cost</em> when no data is collected.</p></li>

<li><p><strong>Low-code</strong>: easy to deploy and maintain.</p></li>

<li><p><strong>Low-config</strong>: minimal maintenance so it can be generalized and can deal with varying data schemas easily.</p></li>
</ul>

<p>The final output is to be a dashboard in Data Studio, so the natural choice for the eventual destination was BigQuery due to the ability to connect via its native Data Studio connector.</p>

<blockquote>
<p><strong>Quick aside</strong>: We are wary of dashboards being a final solution for data flows since they rely on a human being to react to give you ROI. Itâ€™s fine for a proof-of-concept, but for your own project consider your actual use case - perhaps you could instead implement <strong>automatic alerts</strong> if certain thresholds on data quality were broken or something similar.</p>
</blockquote>

<p>With the above requirements in mind, some solutions included:</p>

<h4 id="3-1-1-pixel-tracking-via-a-load-balancer">3.1.1. Pixel tracking via a load balancer</h4>

<p>We thought about a <a href="https://cloud.google.com/solutions/serverless-pixel-tracking">Pixel Tracking Solution</a> first, since in theory the only steps needed are to upload a pixel to Cloud Storage, make it publicly available, and then stream the access logs into BigQuery.</p>

<p>However the resulting API endpoint is an HTTP IP address (e.g. <code>http://111.222.333.444</code>) and the Google Tag Manager API requires communication over HTTPS. Itâ€™s absolutely possible to assign a custom domain and SSL certificate to the load balancer, but to make the demo more accessible for everyone we wanted to find a solution that provided its own domain and HTTPS endpoint.</p>

<p>However, if you do have a custom domain name at hand, the load balancer is probably the <strong>most robust solution</strong> to utilize, since it doesnâ€™t require the overhead of running a programmed application.</p>

<h4 id="3-1-2-app-engine">3.1.2. App Engine</h4>

<p>The next stop was <a href="https://cloud.google.com/appengine/">App Engine</a>, which up to last year would have been the one weâ€™d pursue. In fact, here is some code on how to set up <a href="https://github.com/MarkEdmondson1234/ga-bq-stream">streaming from GTM to BigQuery</a> that Mark wrote three years ago.</p>

<p>However, since then <strong>Cloud Functions</strong> have arrived which have even less configuration and code required to set up the service. You may still want to consider App Engine if you have more requirements such as integration with Cloud Endpoints or other GCP APIs, for which Cloud Functions do not have support yet.</p>

<h4 id="3-1-3-technology-of-choice-cloud-functions">3.1.3. Technology of choice: Cloud Functions</h4>

<p>This is the one we went for. For getting something quickly up and running, it is hard to beat. If using Python, you only need to write code, create a <code>requirements.txt</code> file, set the function to trigger with a public endpoint (via HTTP requests), and you have everything we need - HTTPS, scalable infrastructure and almost no configuration necessary.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/website-to-bigquery.jpg" title="Website to BigQuery">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/website-to-bigquery.jpg" layout="responsive" alt="Website to BigQuery" height="230" width="955"></amp-img>
  
    </a>
  


<p>It may cost more per call than the solutions above, but it scales down to zero meaning you can deploy and wait for traffic without incurring any costs for downtime.</p>

<p>Note that Cloud Functions can take <a href="https://cloud.google.com/functions/quotas">100 million calls per 100 seconds</a> in hits, but BigQuery itself accepts only (!) up to <a href="https://cloud.google.com/bigquery/quotas#streaming_inserts">100,000 rows per second</a> per project which equates to 10 million calls per 100 seconds. If this is a limitation you might find yourself struggling with, you&rsquo;ll need to start batching the data to BigQuery instead of streaming it.</p>

<h3 id="3-2-bigquery-setup">3.2. BigQuery setup</h3>

<p>With the API endpoint technology selected, we turn to configuring <a href="https://console.cloud.google.com/bigquery/"><strong>BigQuery</strong></a>.</p>

<p>Loading data into BigQuery requires a <strong>schema</strong> for the data (<code>STRING</code>, <code>INT</code>, <code>TIMESTAMP</code>, etc.) which can be tricky if you are sending in a lot of data with untidy types (most data, that is) - one mistake and the data won&rsquo;t load. We&rsquo;re accepting data from an open HTTP endpoint so we are almost certain to get messy data and thus want to be able to modify sent data without reconfiguring everything.</p>

<p>To account for the above, we favor loading data into BigQuery with as few restrictions as possible, but then use BigQuery&rsquo;s SQL to parse or transform the raw data into tidier forms. If you don&rsquo;t know SQL but are better with JavaScript, you may prefer to do that data tidying logic in the Google Tag Manager code sending the data, or if better at Python perhaps in the Cloud Function collecting it. We still recommend to do this kind of data cleaning in BigQuery since otherwise changes need code updates in harder-to-reach places.</p>

<p>To achieve this, the BigQuery table accepting the GTM data will have as simple a data schema as possible: it will accept the entire URL as a string and not try to parse out the tag names or GTM events quite yet. We shall then create a <a href="https://cloud.google.com/bigquery/docs/views">BigQuery View</a> on top of that data which will split the URL into a workable, tidy format.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/bigquery-schema.jpg" title="bigquery schema">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/bigquery-schema.jpg" layout="responsive" alt="bigquery schema" height="160" width="500"></amp-img>
  
    </a>
  


<p>The final raw data schema then is simply the <strong>URI</strong> and a <strong>timestamp</strong>. We consider a timestamp always useful to have, and we will stream the data into a <a href="https://cloud.google.com/bigquery/docs/partitioned-tables">partitioned table</a> which automatically aligns the datasets with the date of data ingestion to make time-based analysis easier.</p>

<p>To create the table, you need a Google Cloud Platform project with billing enabled. Once you have that in place, browse to <a href="https://console.cloud.google.com/bigquery">the BigQuery web UI</a> and create a dataset for your project.</p>

<p>With the dataset in place, you can then create a table in it.</p>

<p>Putting all of the above into place, the BigQuery table settings look like this:</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/bigquery-table-settings.jpg" title="BigQuery table settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/bigquery-table-settings.jpg" layout="responsive" alt="BigQuery table settings" height="657" width="675"></amp-img>
  
    </a>
  


<p>The partition will put each hit&rsquo;s data into a partition of today&rsquo;s date, e.g. <code>20190703</code>, which you can use to query particular time periods via BigQuery&rsquo;s <code>_PARTITIONDATE</code> field.</p>

<p>Make note of the <strong>project</strong> name, <strong>dataset</strong> name, and <strong>table</strong> name. You are naturally free to choose whatever you want for these, but you need the values when configuring the Cloud Function code next.</p>

<h3 id="3-3-the-cloud-function-code">3.3. The Cloud Function Code</h3>

<p>Now let us get some data into the table. This is the Python code we&rsquo;ll use to update the Cloud Function with. You don&rsquo;t need to store any code locally - you can use the <a href="https://console.cloud.google.com/functions/add">web UI</a>. The code below is based on the examples given using the <a href="https://googlecloudplatform.github.io/google-cloud-python/latest/bigquery/index.html">Python SDK for BigQuery</a>.</p>

<p>See the next chapter for information on where to copy-paste this code.</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">PROJECT</span><span class="o">=</span><span class="s1">&#39;me-gtm-monitoring&#39;</span> <span class="c1"># Update to match your project name</span>
<span class="n">DATASET</span><span class="o">=</span><span class="s1">&#39;gtm_monitoring&#39;</span>    <span class="c1"># Update to match your dataset name</span>
<span class="n">TABLE</span><span class="o">=</span><span class="s1">&#39;raw_data&#39;</span>            <span class="c1"># Update to match your table name</span>

<span class="k">def</span> <span class="nf">stream_bq</span><span class="p">(</span><span class="n">uri</span><span class="p">):</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

    <span class="n">table_ref</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">DATASET</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_ref</span><span class="p">)</span>

    <span class="c1"># Stream the URI of the request</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">insert_rows</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;URI&#39;</span><span class="p">:</span><span class="n">uri</span><span class="p">,</span> 
                                         <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()}])</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">gtm_monitor</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">stream_bq</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span></code></pre></div>

<h4 id="3-3-1-code-walkthrough">3.3.1. Code walkthrough</h4>

<p>We first import the libraries for connecting to BigQuery (<code>google.cloud.bigquery</code>), creating the timestamp (<code>datetime</code>), and logging errors (<code>logging</code>).</p>

<p>Then you need to alter the code to set the project, dataset, and table for the destination BigQuery data.</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">bigquery</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">PROJECT</span><span class="o">=</span><span class="s1">&#39;your-project&#39;</span> <span class="c1"># Update to match your project name</span>
<span class="n">DATASET</span><span class="o">=</span><span class="s1">&#39;your_dataset&#39;</span> <span class="c1"># Update to match your dataset name</span>
<span class="n">TABLE</span><span class="o">=</span><span class="s1">&#39;your_table&#39;</span>     <span class="c1"># Update to match your table name</span></code></pre></div>

<p>As you can see, you actually need to create the table first - you can see the settings for the table in the previous chapter. Once you have the project, dataset, and table created, update the Cloud Function code above with the correct values.</p>

<p>Below is the function <code>stream_bq()</code> to stream data into BigQuery. As we are deploying the Cloud Function in the same project that hosts the BigQuery table, Cloud Functions will handle authentication for us. All we need is the <code>bigquery.Client()</code> call, and the Cloud Function will handle authentication and identity management using the default service account set for the project.</p>

<p>We then create the table object, and stream the data into the table using the <code>client.insert_rows()</code> method. This will return errors if it fails, in which case weâ€™ll log them.</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">stream_bq</span><span class="p">(</span><span class="n">uri</span><span class="p">):</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>

    <span class="n">table_ref</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">DATASET</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">table_ref</span><span class="p">)</span>

    <span class="c1"># Stream the URI of the request</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">insert_rows</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="p">[{</span><span class="s1">&#39;URI&#39;</span><span class="p">:</span><span class="n">uri</span><span class="p">,</span> 
                                         <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()}])</span>

    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></code></pre></div>

<p>Next, <code>gtm_monitor()</code> is the main function that will be the <strong>entry point</strong> to the Cloud Function. We define this in the web UI (see below). The function checks if the request had a URL, and if it did, it sends this to the <code>stream_bq()</code> method described above.</p>

<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">gtm_monitor</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">stream_bq</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span></code></pre></div>

<p>Finally we also need to modify the <code>requirements.txt</code> file in the Cloud Function - we can do this in the web UI as well. Cloud Functions automatically parses this file to install any necessary python libraries through <code>pip</code>.</p>

<p>The only external dependency we need is the BigQuery SDK. The beauty of Cloud Functions is that you don&rsquo;t need to install this locally and then deploy the whole project at once - you can simply edit the <code>requirements.txt</code> file in the online editor to have the Cloud Function automatically install the dependency before running any code.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/requirements-txt.jpg" title="Requirements.txt">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/requirements-txt.jpg" layout="responsive" alt="Requirements.txt" height="180" width="478"></amp-img>
  
    </a>
  


<p>The line you need to add is this:</p>

<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">google-cloud-bigquery==1.5.1</code></pre></div>

<h4 id="3-3-2-create-and-deploy-the-cloud-function">3.3.2. Create and deploy the Cloud Function</h4>

<p>With all the theory out of the way, we can now look how to actually write and deploy the code in the Cloud Function.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/create-gcf-setting.jpg" title="Google Cloud Function creation">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/create-gcf-setting.jpg" layout="responsive" alt="Google Cloud Function creation" height="365" width="472"></amp-img>
  
    </a>
  


<ol>
<li><p>From a Google Cloud Project (with <strong>billing enabled</strong>) go to <a href="https://console.cloud.google.com/functions/list">https://console.cloud.google.com/functions/add</a>.</p></li>

<li><p>Give the function a descriptive name.</p></li>

<li><p>Select <strong>HTTP</strong> as the trigger.</p></li>

<li><p>Untick the <code>Allow unauthenticated invocations</code> box to make it accessible from anywhere.</p></li>

<li><p>Select the <code>Python 3.7</code> runtime.</p></li>

<li><p>Paste in the main function code from the previous chapter into <code>main.py</code>, and make the appropriate changes where required (the project, dataset, and table names).</p></li>

<li><p>Copy-paste the BigQuery dependency into the <code>requirements.txt</code> tab of the online editor.</p></li>

<li><p>Set the <strong>Function to execute</strong> field to <code>gtm_monitor</code>, as this is the entry point of the Cloud Function.</p></li>

<li><p>Hit <strong>Create</strong> at the bottom of the screen.</p></li>
</ol>

<p>Note that you can expand the <strong>More</strong> link to change the region from <code>us-central-1</code> to something closer to where most of your traffic comes from. This should improve performance and decrease latency.</p>

<p>After hitting <strong>Create</strong>, you should be able to see the URL the Cloud Function has assigned to your new function. This would be something like <code>https://us-central1-my-project.cloudfunctions.net/my-function</code>.</p>

<p>After all that you should have a function that looks a little like this:</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/cloud-function-done-1.jpg" title="Cloud function done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/cloud-function-done-1.jpg" layout="responsive" alt="Cloud function done" height="396" width="474"></amp-img>
  
    </a>
  




    <a href="https://www.simoahava.com/amp/images/2019/07/cloud-function-done-2.jpg" title="Cloud function done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/cloud-function-done-2.jpg" layout="responsive" alt="Cloud function done" height="495" width="566"></amp-img>
  
    </a>
  


<h3 id="3-4-update-the-google-tag-manager-monitor-tag">3.4. Update the Google Tag Manager Monitor tag</h3>

<p>With your cloud function deployed, you should now have a URL endpoint for your Google Tag Manager Monitor tag looking something like <code>https://us-central1-your-project.cloudfunctions.net/your-function</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/get-request-endpoint.jpg" title="Get request endpoint">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/get-request-endpoint.jpg" layout="responsive" alt="Get request endpoint" height="265" width="517"></amp-img>
  
    </a>
  


<p>In your Google Tag Manager Monitor tag, update the <strong>GET request endpoint</strong> to reflect the correct Cloud Function HTTP endpoint and save the tag. You&rsquo;ll then need to <strong>edit the Custom Template</strong> and open its <strong>Permissions</strong> tab. Update the <strong>Sends Pixels</strong> permission with the correct endpoint URL.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/update-permission.jpg" title="Update permission">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/update-permission.jpg" layout="responsive" alt="Update permission" height="175" width="639"></amp-img>
  
    </a>
  


<p>Make sure to add the <code>*</code> at the end of the permission URL to account for query parameters.</p>

<p>You can continue in <strong>Preview mode</strong> for a while to ensure that everything works before <strong>publishing</strong> the container for all your visitors.</p>

<p>If everything works, you should see GCP logs of your Cloud Function (accessible in the Cloud Function UI) showing HTTP calls are being triggered.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/view-gcp-logs.jpg" title="View GCP Logs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/view-gcp-logs.jpg" layout="responsive" alt="View GCP Logs" height="191" width="938"></amp-img>
  
    </a>
  


<p>Within BigQuery, you should see data is being populated with the URI requested. Make sure to turn the <strong>cache</strong> off and query via <code>SELECT * FROM dataset.table_name</code> to test live data, as the Preview may show no data even when there is some. Nevertheless, after doing the <code>SELECT *</code> query, or after patiently waiting for the Preview to update, you should see your raw data being logged into BigQuery like this:</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/bigquery-preview-raw.jpg" title="BigQuery Preview Raw">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/bigquery-preview-raw.jpg" layout="responsive" alt="BigQuery Preview Raw" height="400" width="824"></amp-img>
  
    </a>
  


<p>If you got this far, congratulations! You now have a live stream of data from your Google Tag Manager setup into BigQuery. Just imagine all the other use cases for this pipeline!</p>

<h3 id="3-5-parsing-bigquery-raw-data-into-a-view">3.5. Parsing BigQuery raw data into a view</h3>

<p>Now we do the parsing of this data into something useful. Simo took a jab at writing the necessary SQL for the proof-of-concept (M: Good job, Simo! S: Why, thank you!).</p>

<p>There is probably some more elegant way to do this with arrays, but this is what we went with in that it uses regular expressions to parse out the URI string into usable columns. It is here you can do adjustments to the output data to put it in a format you want.</p>

<p>Make sure to update the <code>FROM</code> statement to pull the data from the correct project/dataset/table combination.</p>

<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
  <span class="k">timestamp</span><span class="p">,</span>
  <span class="n">eventName</span><span class="p">,</span>
  <span class="n">eventTimestamp</span><span class="p">,</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">tagString</span><span class="p">,</span> <span class="s2">&#34;&amp;tag\\d+id=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">tagId</span><span class="p">,</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">tagString</span><span class="p">,</span> <span class="s2">&#34;&amp;tag\\d+nm=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">tagName</span><span class="p">,</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">tagString</span><span class="p">,</span> <span class="s2">&#34;&amp;tag\\d+st=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">tagStatus</span><span class="p">,</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">tagString</span><span class="p">,</span> <span class="s2">&#34;&amp;tag\\d+et=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">tagExecutionTime</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span>
    <span class="k">timestamp</span><span class="p">,</span>
    <span class="n">eventName</span><span class="p">,</span>
    <span class="n">eventTimestamp</span><span class="p">,</span>
    <span class="n">tagStringUnnest</span> <span class="k">as</span> <span class="n">tagString</span><span class="p">,</span>
    <span class="n">pt</span>
  <span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span> 
      <span class="n">ts</span> <span class="k">as</span> <span class="k">timestamp</span><span class="p">,</span>
      <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">URI</span><span class="p">,</span> <span class="s2">&#34;eventName=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">eventName</span><span class="p">,</span>
      <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT</span><span class="p">(</span><span class="n">URI</span><span class="p">,</span> <span class="s2">&#34;eventTimestamp=([^&amp;]+)&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">eventTimestamp</span><span class="p">,</span>
      <span class="p">(</span><span class="k">SELECT</span> <span class="n">REGEXP_EXTRACT_ALL</span><span class="p">(</span><span class="n">URI</span><span class="p">,</span> <span class="s2">&#34;&amp;tag\\d+id=[^&amp;]+&amp;tag\\d+nm=[^&amp;]+&amp;tag\\d+st=[^&amp;]+&amp;tag\\d+et=[^&amp;]+&#34;</span><span class="p">))</span> <span class="k">as</span> <span class="n">tagStringRegex</span><span class="p">,</span>
      <span class="nb">DATE</span><span class="p">(</span><span class="n">_PARTITIONTIME</span><span class="p">)</span> <span class="k">as</span> <span class="n">pt</span>
    <span class="k">FROM</span>
      <span class="o">`</span><span class="n">your</span><span class="o">-</span><span class="n">project</span><span class="p">.</span><span class="n">gtm_monitoring</span><span class="p">.</span><span class="n">raw_data</span><span class="o">`</span>
  <span class="p">)</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="k">UNNEST</span><span class="p">(</span><span class="n">tagStringRegex</span><span class="p">)</span> <span class="k">as</span> <span class="n">tagStringUnnest</span>
<span class="p">)</span></code></pre></div>

<p>Once you have the SQL you want running in the <a href="https://console.cloud.google.com/bigquery">BigQuery Web UI</a>, select <strong>Save View</strong> to save the query as a table that will be used day-to-day.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/save-query-view.jpg" title="Save query view">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/save-query-view.jpg" layout="responsive" alt="Save query view" height="540" width="604"></amp-img>
  
    </a>
  


<p>Hereâ€™s what the data looks like when parsed into the view.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/query-the-view.jpg" title="Query the view">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/query-the-view.jpg" layout="responsive" alt="Query the view" height="567" width="925"></amp-img>
  
    </a>
  


<h2 id="step-4-visualize-the-data">Step 4: Visualize the data</h2>

<p>For most use cases, having the data in a BigQuery view is already more than enough. That&rsquo;s the data set you can query for anomaly detection, or plug into a pipeline for automated alerts.</p>

<p>Nevertheless, we can see how useful a proper visualization of the data could potentially be. For this purpose, Google&rsquo;s <a href="https://datastudio.google.com/">Data Studio</a> is an excellent project for quickly delivering useful visualizations. Best of all, it already has a built-in <a href="https://support.google.com/datastudio/answer/6370296?hl=en">BigQuery connector</a> for querying your BQ data with.</p>



    <a href="https://www.simoahava.com/amp/images/2019/07/data-studio-dashboard.jpg" title="Data Studio Dashboard">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/07/data-studio-dashboard.jpg" layout="responsive" alt="Data Studio Dashboard" height="486" width="1200"></amp-img>
  
    </a>
  


<p>As a demo, we&rsquo;ve created a <strong>starter</strong> dashboard for you to check out. Feel free to copy it and modify it to suit your own purposes.</p>

<p><a href="https://datastudio.google.com/u/0/reporting/1qcyKjq_44_VIeIxL4BTQm6kKnBaH5a7p/page/xsws">Visit the dashboard here.</a></p>

<h2 id="summary">Summary</h2>

<p>Maybe we haven&rsquo;t said this enough yet, but this is a <strong>proof-of-concept</strong>. This article serves a number of purposes:</p>

<ul>
<li><p>You&rsquo;ll learn how to set up a pipeline of data collection from the website, via Google Tag Manager, to a data warehouse located in the Google Cloud.</p></li>

<li><p>You&rsquo;ll learn about the new <code>addEventCallback</code> API in Google Tag Manager&rsquo;s custom templates.</p></li>

<li><p>You&rsquo;ll learn about the new <strong>Additional Tag Metadata</strong> field in GTM&rsquo;s tags.</p></li>

<li><p>You&rsquo;ll learn how to efficiently monitor the success rates and execution times of your Google Tag Manager tags.</p></li>
</ul>

<p>We can only hope that others build much cooler and more useful solutions than this simple MVP. Some features we considered useful but not in the scope of this introductory article:</p>

<ol>
<li><p>Report that compares data from the respective end points with that of GTM&rsquo;s monitor system to see if tags are firing but not sending the correct data.</p></li>

<li><p>Utilize a pixel file stored in Google Cloud Storage, behind a load balancer, to achieve a zero-code setup with superior performance compared to a Cloud Function.</p></li>

<li><p>Training a machine learning model on the data set to identify anomalies and automatically alert to them when detected.</p></li>
</ol>

<p>Let us know in the comments what you think of this, and how you would improve it if you had the chance!</p>

<p><strong>Final note from Simo</strong>: I am truly grateful to get the great Mark Edmondson to co-author this article and design the monitor solution with me. As the editor, I take full responsibility for any errors and mistakes in the final draft of the article.</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

