<!doctype html><html ⚡ lang=en-us class=no-js><head><meta charset=utf-8><script async custom-element=amp-youtube src=https://cdn.ampproject.org/v0/amp-youtube-0.1.js></script><script async custom-element=amp-accordion src=https://cdn.ampproject.org/v0/amp-accordion-0.1.js></script><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-sidebar src=https://cdn.ampproject.org/v0/amp-sidebar-0.1.js></script><script async custom-element=amp-social-share src=https://cdn.ampproject.org/v0/amp-social-share-0.1.js></script><script async custom-element=amp-twitter src=https://cdn.ampproject.org/v0/amp-twitter-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script><script async src=https://cdn.ampproject.org/v0.js></script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>.type-simmer{padding:8px;background:rgba(179,138,197,.2);box-shadow:2px 2px 1px #ccc;border-radius:5px}/*!normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css*/html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{display:none;text-indent:-9999px;visibility:hidden}.inner{margin:0 auto;max-width:710px;position:relative;width:80%}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{background:#fff;min-height:100%;position:relative;transition:transform .5s ease;z-index:10}html{font-size:62.5%;-webkit-tap-highlight-color:transparent}body,html{height:100%;max-height:100%}body{color:#3a4145;font-family:Merriweather,serif;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-size:1.8rem;letter-spacing:.01rem;line-height:1.75em;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{color:#2e2e2e;font-family:Open Sans,sans-serif;-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;line-height:1.15em;margin:0 0 .4em;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{clear:left;float:left;font-weight:700;overflow:hidden;text-align:right;text-overflow:ellipsis;white-space:nowrap;width:180px}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{border:0;border-top:1px solid #efefef;display:block;height:1px;margin:3.2em 0;padding:0}blockquote{border-left:.4em solid #4a4a4a;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em}blockquote p{font-style:italic;margin:.8em 0}blockquote small{color:#ccc;display:inline-block;font-size:.9em;margin:.8em 0 .8em 1.5em}blockquote small:before{content:"— "}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{border:1px solid #e3edf3;border-radius:2px;font-size:.85em;padding:1px 3px;white-space:pre-wrap}code,pre,tt{background:#f7fafb;font-family:Inconsolata,monospace,sans-serif}pre{border:1px solid #e3edf3;border-radius:3px;box-sizing:border-box;font-size:.9em;margin:0 0 1.75em;overflow:auto;padding:10px;white-space:pre;width:100%}pre code,pre tt{background:0 0;border:none;font-size:inherit;padding:0;white-space:pre-wrap}kbd{background:#f4f4f4;border:1px solid #ccc;border-radius:4px;box-shadow:0 1px rgba(0,0,0,.2),inset 0 1px #fff;color:#666;display:inline-block;font-size:.9em;font-weight:700;margin-bottom:.4em;padding:1px 8px;text-shadow:#fff 0 1px 0}table{background-color:transparent;box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%}table td,table th{border-top:1px solid #efefef;line-height:20px;padding:8px;text-align:left;vertical-align:top}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:0 0}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{background:#222 no-repeat 50%;background-size:cover;display:table;height:100vh;margin-bottom:5rem;overflow:hidden;position:relative;text-align:center;width:100%}.main-header.cover{background-image:url(https://www.simoahava.com/images/maisema.jpg)}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{margin:0 0 30px;padding:35px 40px;position:relative}.main-nav a{font-family:Open Sans,sans-serif;text-decoration:none}.scroll-down{animation:bounce 4s 2s infinite;bottom:45px;display:block;font-size:1.5em;left:50%;position:absolute;text-align:center;z-index:100}.scroll-down:hover{animation:none;color:#fff}.home-template .main-header:after{background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%);border-radius:100%;bottom:0;content:" ";display:block;height:130px;left:50%;margin-left:-75px;position:absolute;width:150px}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover .scroll-down,.no-cover.main-header:after{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{box-sizing:border-box;height:38px}.menu-button{background:rgba(0,0,0,.1);border:1px solid #bfc8cd;border-radius:3px;color:#9eabb3;display:inline-block;float:right;font-size:12px;line-height:35px;opacity:1;padding:0 15px;text-align:center;text-transform:uppercase;transition:all .5s ease;white-space:nowrap}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent);border:none;height:70px;left:0;position:absolute;right:0;top:0}.no-cover .main-nav.overlay,.no-cover .menu-button{background:0 0}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{background:#fff;border-color:#fff;color:#222}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{color:#fff;font-family:Open Sans,sans-serif;font-size:5rem;font-weight:700;letter-spacing:-1px;margin:10px 0}.page-description{color:hsla(0,0%,100%,.8);font-family:Merriweather,serif;font-size:2rem;font-weight:400;letter-spacing:.01rem;line-height:1.5em;margin:0}.no-cover.main-header{background:#f5f8fa;max-height:40vh;min-height:160px}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{border-color:rgba(0,0,0,.3);color:rgba(0,0,0,.4)}.main-header-content .page-title{animation:fade-in-down .6s;animation-delay:.2s}.main-header-content .page-description{animation:fade-in-down .9s;animation-delay:.1s}.post{border-bottom:1px solid #ebf2f6;margin:4rem auto;max-width:710px;padding-bottom:4rem;position:relative;width:80%;word-wrap:break-word;hyphens:auto}.post-header{padding-bottom:10px}.post:after{background:#fff;border:1px solid #e7eef2;border-radius:100%;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";display:block;height:7px;left:50%;margin-left:-5px;position:absolute;width:7px}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{font-size:.9em;line-height:1.7em;margin:0}.read-more{font-size:.8em;font-style:italic;text-decoration:none}.post-meta{color:#9eabb3;display:block;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;margin:1.75rem 0 0}.author-thumb{border-radius:100%;float:left;height:24px;margin-right:9px;width:24px}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{min-height:77px;padding:.3rem 40px 0 100px;position:relative}.post-date{border-left:1px solid #d5dbde;display:inline-block;font-size:1.3rem;margin-left:8px;padding-left:12px;text-transform:uppercase;white-space:nowrap}.user-image{left:0;position:absolute;top:0}.user-name{display:block;font-weight:700}.user-bio{display:block;font-size:1.4rem;line-height:1.5em;max-width:440px}.publish-meta{padding:4.3rem 0 4rem;position:absolute;right:0;text-align:right;top:0}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{font-size:.8em;text-align:center}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{bottom:10px;box-shadow:0 15px 10px rgba(0,0,0,.7);content:"";height:20%;max-width:480px;position:absolute;width:50%;z-index:-2}figure.polaroid:after{left:auto;right:10px;transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;transform:rotate(-3deg)}figure.polaroid{background:#fff;border:none;border-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);margin-bottom:1.5em;max-width:100%;padding:15px;position:relative;width:450px}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;margin:0;outline:1px solid #ccc;padding:0}figure.polaroid figcaption{font-family:Kaushan Script,cursive;font-size:1.3em;font-weight:400;padding:.8em .5em .4em;text-align:right}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{border-bottom:1px solid #d3d3d3;border-top:1px solid #d3d3d3;font-size:.8em;font-style:italic;margin-top:.5em;padding:.2em;text-align:center}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{font-size:2em;text-decoration:none}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{color:#a2a2a2;font-size:2em;text-decoration:none}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{border:none;margin:0;padding:0}.post-template .content{overflow:hidden}.post-template .post{border-bottom:none;margin-top:0;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{border-top:1px solid #ebf2f6;margin:6rem 0 0;padding:6rem 0 0;position:relative}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{font-size:1.4rem;line-height:1.75em;margin:1rem 0}.author-meta{font-size:1.4rem;font-style:italic;line-height:1;list-style:none;margin:0;padding:0}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;right:0;top:6rem;width:180px}.post-footer .share a{color:#bbc7cc;display:inline-block;font-size:1.8rem;margin:1rem 1.6rem 1.6rem 0;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{background:0 0;height:85px;margin-bottom:0;min-height:0}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{background:0 0;height:10vh;min-height:100px}.author-profile{border-bottom:1px solid #ebf2f6;padding:0 15px 5rem;text-align:center}.author-profile:after{border:1px solid #e7eef2;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";height:7px;margin-left:-5px;width:7px}.author-image,.author-profile:after{background:#fff;border-radius:100%;display:block;left:50%;position:absolute}.author-image{box-shadow:0 0 0 1px #e7eef2;box-sizing:border-box;height:80px;margin-left:-40px;overflow:hidden;padding:6px;top:-56px;width:80px;z-index:2}.author-image .img{background-image:url(https://www.simoahava.com/images/simo.png);background-position:50%;background-size:cover;border-radius:100%;display:block;height:100%;position:relative;width:100%}.author-profile .author-image{box-shadow:none;height:120px;left:auto;margin:-100px auto 0;padding:3px;position:relative;top:auto;width:120px}.author-title{margin:1.5rem 0 1rem}.author-bio{color:#50585d;font-size:1.8rem;font-weight:200;letter-spacing:0;line-height:1.5em;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{font-family:Merriweather,serif;font-size:1.7rem;letter-spacing:.01rem;margin:2rem 0}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);color:#909090;font-family:Open Sans,Verdana,sans-serif;font-size:11px;font-weight:700;overflow-y:auto;text-align:left;width:400px}#sidebar .nav-title{color:#fff;font-size:1.5em;font-weight:100;left:30px;position:absolute;text-transform:uppercase;top:45px}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{font-size:10px;height:20px;padding:0;position:absolute;right:25px;top:38px;width:20px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{background:#969696;content:"";height:1px;position:absolute;top:0;top:15px;transition:background .15s ease;width:20px}#sidebar .nav-close:before{transform:rotate(45deg)}#sidebar .nav-close:after{transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{background:0 0;border:none;font-size:2rem;margin:.4em 0 .2em}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open,#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{counter-reset:item;list-style:none;padding:90px 9% 5%}#sidebar li:before{color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item;display:block;float:right;font-size:1.2rem;padding-left:5px;padding-right:4%;text-align:right;vertical-align:bottom}#sidebar li{margin:0}#sidebar li a{display:block;font-size:1.4rem;line-height:1.4;overflow:hidden;padding:.6rem 4%;text-decoration:none;text-overflow:ellipsis;white-space:nowrap}#sidebar li a:after{color:hsla(0,0%,100%,.2);content:" ...............................................................";display:inline-block;margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{border-bottom:1px solid hsla(0,0%,100%,.5);content:" ";height:1px;width:100%}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{background:#fff;border-radius:3px;bottom:30px;box-sizing:border-box;display:block;font-family:Open Sans,sans-serif;font-size:12px;height:38px;left:30px;line-height:35px;padding:0 20px;position:absolute;right:30px;text-align:center;text-decoration:none;text-transform:uppercase;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{color:#9eabb3;font-family:Open Sans,sans-serif;font-size:1.3rem;margin:4rem auto;max-width:710px;position:relative;text-align:center;width:80%}.pagination a{color:#9eabb3;transition:all .2s ease}.newer-posts,.older-posts{border:1px solid #bfc8cd;border-radius:4px;display:inline-block;padding:0 15px;position:absolute;text-decoration:none;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;min-width:100px;padding:2px 0}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{border-color:#98a0a4;color:#889093}.extra-pagination{border-bottom:1px solid #ebf2f6;display:none}.extra-pagination:after{background:#fff;border:1px solid #e7eef2;border-radius:100%;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";display:block;height:7px;left:50%;margin-left:-5px;position:absolute;width:7px}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{color:#bbc7cc;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;margin:8rem 0 0;padding:.5rem 15px;position:relative}.site-footer a{color:#bbc7cc;font-weight:700;text-decoration:none}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{box-sizing:border-box;height:auto;height:60vh;min-height:240px;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{height:40vh;margin-bottom:15px}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{background:0 0;border-radius:0;padding:0 5px}.menu-button,.menu-button:hover{border-color:transparent;color:#2e2e2e}.menu-button:hover{background:0 0}body.nav-opened .menu-button{background:0 0;border:transparent}.main-nav.overlay a:hover{background:0 0;border-color:transparent;color:#fff}.no-cover .main-nav.overlay{background:0 0}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{margin:2rem auto;width:auto}.post{line-height:1.65em;margin:2rem 16px;padding-bottom:2rem;width:auto}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{margin-bottom:0;padding-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{border-bottom:1px dashed #ebf2f6;margin:0 0 2rem;padding:0 0 1.6rem}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;line-height:1.75em;margin:0}.author-meta li:before{display:none}.newer-posts,.older-posts{margin:10px 0;position:static}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{border:1px solid #777;box-shadow:5px 5px 2px rgba(0,0,0,.4);height:auto;margin-bottom:20px;max-width:100%}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}.badge-primary{background-color:#007bff;color:#fff}.badge{border-radius:.25rem;display:inline-block;font-size:80%;font-weight:700;line-height:1;padding:.25em .4em;text-align:center;vertical-align:middle;white-space:nowrap}</style><link rel=canonical href=https://www.simoahava.com/analytics/simple-way-measure-a-b-test-flicker-impact/><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin=anonymous referrerpolicy=no-referrer><meta name=theme-color content="#ffffff"><title>Simple Way to Measure a/B Test Flicker Impact | Simo Ahava's blog</title>
<meta property="og:title" content="Simple Way to Measure a/B Test Flicker Impact"><meta name=description content="This article shares a method with which you can measure how much flicker time there is between the base element being added to the page and the A/B test changing its appearance."><meta property="og:description" content="This article shares a method with which you can measure how much flicker time there is between the base element being added to the page and the A/B test changing its appearance."><meta property="og:type" content="article"><meta property="og:url" content="https://www.simoahava.com/amp/analytics/simple-way-measure-a-b-test-flicker-impact/"><meta name=twitter:image content="https://www.simoahava.com/images/2020/05/flicker-test-hero.jpg"><meta property="og:image" content="https://www.simoahava.com/images/2020/05/flicker-test-hero.jpg"><meta property="article:published_time" content="2020-05-19T06:00:00Z"><meta property="article:modified_time" content="2020-05-19T06:00:00Z"><meta property="og:site_name" content="Simo Ahava's blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development."><meta property="article:section" content="Analytics"><meta property="article:tag" content="google tag manager"><meta property="article:tag" content="ab testing"><meta property="article:tag" content="experimentation"><meta property="article:tag" content="google-optimize"><meta name=twitter:card content="summary"><meta itemprop=name content="Simple Way To Measure A/B Test Flicker Impact"><meta itemprop=description content="This article shares a method with which you can measure how much flicker time there is between the base element being added to the page and the A/B test changing its appearance."><meta itemprop=datePublished content="2020-05-19T09:00:00+03:00"><meta itemprop=dateModified content="2020-05-19T09:00:00+03:00"><meta itemprop=wordCount content="3328"><meta itemprop=keywords content="Google Tag Manager,Ab Testing,Experimentation,Google-Optimize"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Simo Ahava\u0027s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.","url":"https:\/\/www.simoahava.com\/amp\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Simple Way To Measure A\/B Test Flicker Impact | Simo Ahava's blog","image":"https:\/\/www.simoahava.com\/images\/2020\/05\/flicker-test-hero.jpg","editor":"Simo Ahava","publisher":{"@type":"Organization","name":"Simo Ahava's blog","logo":{"@type":"ImageObject","url":"https:\/\/www.simoahava.com\/amp\/","height":"393","width":"407"}},"url":"https:\/\/www.simoahava.com\/amp\/analytics\/simple-way-measure-a-b-test-flicker-impact\/","datePublished":"2020-05-19T09:00:00\u002b03:00","dateModified":"2020-05-19T09:00:00\u002b03:00","description":"This article shares a method with which you can measure how much flicker time there is between the base element being added to the page and the A\/B test changing its appearance.","author":{"@type":"Person","name":"Simo Ahava"}}</script></head><body><amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials=include></amp-analytics><amp-sidebar id=sidebar layout=nodisplay side=right><h3 class=nav-title>Menu</h3><a href=# class=nav-close on=tap:sidebar.close role=button tabindex=1><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/>Home</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/gtm-tips/>GTM Tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/about-simo-ahava/>About</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tools/>Tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/blog-statistics/>Blog Statistics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/upcoming-talks/>Upcoming Talks</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/custom-templates/>Templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/newsletter/>Newsletter</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/>Full (non-AMP) site</a></li><amp-accordion><section><h3 class=nav-section><i class="fa fa-caret-down section-open" aria-hidden=true></i>
<i class="fa fa-caret-right section-close" aria-hidden=true></i>
Categories</h3><div><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/analytics/>analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/content-management/>content management</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/digital-marketing/>digital marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/google-cloud/>google cloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/gtm-tips/>gtm tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/personal/>personal</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/privacy/>privacy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/seo/>seo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/web-design/>web design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/web-development/>web development</a></li></div></section><section><h3 class=nav-section><i class="fa fa-caret-down section-open" aria-hidden=true></i>
<i class="fa fa-caret-right section-close" aria-hidden=true></i>
Tags</h3><div><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ab-testing/>ab testing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/accelerated-mobile-pages/>accelerated mobile pages</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ad-blocker/>ad blocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/adblocker/>adblocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/add-on/>add-on</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/adwords/>adwords</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/agile/>agile</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/amazon/>amazon</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/amp/>amp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/analytics/>analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/android/>android</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/api/>api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app/>app</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app-engine/>app engine</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app+web/>app+web</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/approval/>approval</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/apps/>apps</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/apps-script/>apps script</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/array/>array</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/attribution/>attribution</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/audience-design/>audience design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/audit/>audit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/auto-event-tracking/>auto-event tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/auto-link-domains/>auto-link domains</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/aws/>aws</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/azure/>azure</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/basketball/>basketball</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/beforeunload/>beforeunload</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/best-practices/>best practices</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/big-data/>big data</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/bigquery/>bigquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/blogger/>blogger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/bounce-rate/>bounce rate</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/built-in-variables/>built-in variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/calculated-metrics/>calculated metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/callback/>callback</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/campaign-tracking/>campaign tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/celebration/>celebration</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/change-history/>change history</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/chrome/>chrome</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/chrome-extension/>chrome extension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/click-tracking/>click tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/click-variables/>click variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/clickstream/>clickstream</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/client-id/>client id</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/client-template/>client template</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/clientid/>clientid</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cloud-functions/>cloud functions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cloud-run/>cloud run</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cms/>cms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cname/>cname</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conferences/>conferences</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/consent/>consent</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/consent-mode/>consent mode</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container/>container</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container-export/>container export</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container-snippet/>container snippet</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content/>content</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-analysis/>content analysis</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-blocker/>content blocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-engagement/>content engagement</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-grouping/>content grouping</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-management/>content management</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-management-system/>content management system</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-security-policy/>content security policy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-strategy/>content strategy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/context/>context</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conversion/>conversion</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conversions-api/>conversions api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookie/>cookie</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookiedomain/>cookiedomain</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookies/>cookies</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/core-web-vitals/>core web vitals</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/creative/>creative</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cross-domain/>cross-domain</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cross-domain-tracking/>cross-domain tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/csp/>csp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/css/>css</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/css-selectors/>css selectors</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom/>custom</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-dimension/>custom dimension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-dimensions/>custom dimensions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html/>custom html</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html-tag/>custom html tag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html-tags/>custom html tags</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-javascript/>custom javascript</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-metrics/>custom metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-templates/>custom templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/customtask/>customtask</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dan-wilkerson/>dan wilkerson</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dashboard/>dashboard</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data/>data</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-collection/>data collection</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-engineering/>data engineering</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-layer/>data layer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-layer-variable/>data layer variable</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-model/>data model</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-quality/>data quality</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/datalayer/>datalayer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/debug/>debug</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/debugging/>debugging</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/definition-of-success/>definition of success</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/developer/>developer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/developer-tools/>developer tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/development/>development</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/digital-marketing/>digital marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/docker/>docker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/document.write/>document.write</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dom/>dom</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/duplicate/>duplicate</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dynamic-content/>dynamic content</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/easter-egg/>easter egg</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ecomemrce/>ecomemrce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ecommerce/>ecommerce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/education/>education</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/element-visibility/>element visibility</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/engagement/>engagement</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/enhanced-ecommerce/>enhanced ecommerce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/enrichment/>enrichment</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/environments/>environments</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/errors/>errors</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event/>event</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event-listener/>event listener</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event-listeners/>event listeners</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/eventcallback/>eventcallback</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/events/>events</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/excel/>excel</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/exceptions/>exceptions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/experimentation/>experimentation</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/exploit/>exploit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/extension/>extension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/facebook/>facebook</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/false/>false</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/family/>family</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/fields-to-set/>fields to set</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firebase/>firebase</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firestore/>firestore</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firing-rules/>firing rules</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/folders/>folders</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/form/>form</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/form-tracking/>form tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/format-value/>format value</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/forms/>forms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/fpid/>fpid</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ga-spy/>ga spy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ga4/>ga4</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gcp/>gcp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gdpr/>gdpr</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google/>google</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-ads/>google ads</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics/>google analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics-4/>google analytics 4</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics-settings/>google analytics settings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-bigquery/>google bigquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-cloud/>google cloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-cloud-platform/>google cloud platform</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-sheets/>google sheets</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-tag/>google tag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-tag-manager/>google tag manager</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-trends/>google trends</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-optimize/>google-optimize</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/googletagmanager/>googletagmanager</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/governance/>governance</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtag/>gtag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtag.js/>gtag.js</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm/>gtm</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm-sonar/>gtm sonar</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm-tools/>gtm tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm360/>gtm360</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtmtips/>gtmtips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/guest-post/>guest post</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/guide/>guide</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/hack/>hack</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history/>history</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history-change-trigger/>history change trigger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history-listener/>history listener</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/hugo/>hugo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/iframe/>iframe</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/intelligent-tracking-prevention/>intelligent tracking prevention</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/internal-traffic/>internal traffic</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ios/>ios</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ip/>ip</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/it-department/>it department</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/itp/>itp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/javascript/>javascript</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/jquery/>jquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/klipfolio/>klipfolio</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/learning/>learning</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/lighthouse/>lighthouse</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/links/>links</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/listeners/>listeners</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/local/>local</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/localstorage/>localstorage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/lookup-table/>lookup table</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/macros/>macros</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/marketer/>marketer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/marketing/>marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/measurement-protocol/>measurement protocol</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/meta-description/>meta description</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/metrics/>metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/migration/>migration</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/mixcloud/>mixcloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/mobile/>mobile</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/modern-cms/>modern cms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/modular-architecture/>modular architecture</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/monitor/>monitor</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/navigation/>navigation</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/netbooster/>netbooster</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/new-ui/>new ui</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/node.js/>node.js</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/nodejs/>nodejs</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/non-technical/>non-technical</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/open-source/>open source</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/opt-out/>opt-out</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/owasp/>owasp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/page-load-time/>page load time</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/page-timings/>page timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/parameter-reporting/>parameter reporting</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/penguin/>penguin</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/performance/>performance</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/permissions/>permissions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/persistence/>persistence</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/personal/>personal</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/personal-experience/>personal experience</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/php/>php</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/pii/>pii</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/pitch/>pitch</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/piwik-pro/>piwik pro</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/plugins/>plugins</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/poetry/>poetry</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/postmessage/>postmessage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ppc/>ppc</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/preview/>preview</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/preview-mode/>preview mode</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/privacy/>privacy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/process/>process</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/proxy/>proxy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/public-speaking/>public speaking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/query-string/>query string</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/queue-time/>queue time</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/r/>r</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/race-condition/>race condition</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/reaktor/>reaktor</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/recaptcha/>recaptcha</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/referral/>referral</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/regular-expression/>regular expression</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/release/>release</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/resources/>resources</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/rules/>rules</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/safari/>safari</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sales/>sales</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/samesite/>samesite</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/schema/>schema</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/score-card/>score card</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/scroll-depth/>scroll depth</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search/>search</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-api/>search api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-engine-optimization/>search engine optimization</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-trends/>search trends</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/security/>security</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/selection/>selection</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/seo/>seo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/seo-report/>seo report</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/serp/>serp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/server-side/>server-side</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/server-side-tagging/>server-side tagging</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/session/>session</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sessions/>sessions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sgtm/>sgtm</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/shopify/>shopify</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/simmer/>simmer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/single-page-apps/>single-page apps</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/site-search/>site search</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/site-speed/>site speed</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/slack/>slack</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/snippet/>snippet</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/snowplow/>snowplow</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/social-interactions/>social interactions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/soundcloud/>soundcloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/spa/>spa</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/splash-page/>splash page</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/static-site/>static site</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/still-running/>still running</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/storage/>storage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/support/>support</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/swift/>swift</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/syntax-highlight/>syntax highlight</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-management-solution/>tag management solution</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-management-solutions/>tag management solutions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-sequencing/>tag sequencing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-templates/>tag templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tags/>tags</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tasks/>tasks</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/technical-marketing/>technical marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/technique/>technique</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/test/>test</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/testing/>testing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/timer/>timer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/timings/>timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tips/>tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tools/>tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracker/>tracker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracker-object/>tracker object</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracking-protections/>tracking protections</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/training/>training</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/transformations/>transformations</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/trigger/>trigger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/trigger-groups/>trigger groups</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/triggers/>triggers</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/troubleshoot/>troubleshoot</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/undefined/>undefined</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/universal-analytics/>universal analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-id/>user id</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-interface/>user interface</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-permissions/>user permissions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-timings/>user timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/v2/>v2</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variable/>variable</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variable-templates/>variable templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variables/>variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/videos/>videos</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/visibility/>visibility</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/wcag/>wcag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/weather/>weather</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/web-design/>web design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/web-development/>web development</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/webkit/>webkit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/website-redesign/>website redesign</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/workflow/>workflow</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/workspaces/>workspaces</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/youtube/>youtube</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/zones/>zones</a></li></div></section></amp-accordion></ul></amp-sidebar><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=menu-button on=tap:sidebar.toggle role=button><i class="fa fa-bars" aria-hidden=true></i><span class=menu-button-label>Menu</span></a></nav></header><main class=content role=main><article class="post type-post"><header class=post-header><h1 class=post-title>Simple Way to Measure a/B Test Flicker Impact</h1><small>This article shares a method with which you can measure how much flicker time there is between the base element being added to the page and the A/B test changing its appearance.</small><section class=post-meta><amp-img class=author-thumb src=https://www.simoahava.com/images/simo.png layout=fixed width=24 height=24 alt="Author image"></amp-img>Simo Ahava
in
<a href=https://www.simoahava.com/amp/categories/analytics>Analytics</a>
on
<a href=https://www.simoahava.com/amp/tags/google-tag-manager>#google tag manager</a>
, <a href=https://www.simoahava.com/amp/tags/ab-testing>#ab testing</a>
, <a href=https://www.simoahava.com/amp/tags/experimentation>#experimentation</a>
, <a href=https://www.simoahava.com/amp/tags/google-optimize>#google-optimize</a>
<time class=post-date datetime=2020-05-19T09:00:00+03:00>19 May 2020
</time><span class=post-date><a href=https://www.simoahava.com/analytics/simple-way-measure-a-b-test-flicker-impact/>Non-AMP version</a></span></section></header><section class=post-content><p>&ldquo;Flickering&rdquo; or &ldquo;Flash Of Original Content&rdquo; (<a href=https://reflectivedata.com/what-is-fooc-flicker-how-to-get-rid-of-it/>FOOC</a>) is a phenomenon where there&rsquo;s a (typically) slight but observable delay in the browser updating the site or element layout if the user is included in a variant group for experimentation. This manifests in the original, unmodified element being rendered in the visible portion of the page before the experiment library updates it with the variant.</p><p>There are ways to mitigate the flicker:</p><ol><li>Add the A/B testing library directly into the page template and don&rsquo;t load it via some other, asynchronously loaded dependency (e.g. <a href=https://tagmanager.google.com/>Google Tag Manager</a>).</li><li>Load the A/B testing library synchronously, and have it hide the element that is being tested until the library is loaded.</li><li>Utilize some kind of <a href="https://support.google.com/optimize/answer/7100284?hl=en">anti-flicker tech</a>.</li><li>Run the experiments server-side, and render content with the variant in place.</li></ol><a href=https://www.simoahava.com/amp/images/2020/05/flicker-test-hero.jpg title="Flicker test"><amp-img src=https://www.simoahava.com/amp/images/2020/05/flicker-test-hero.jpg layout=responsive alt="Flicker test" height=1244 width=2584></amp-img></a><p>Typically, the only non-intrusive and consistent way to avoid the flicker is to look into server-side rendering for your experiments. For example, tools like <a href=https://console.conductrics.com/docs/demo/api-reference>Conductrics</a> offer a robust set of APIs to do all the decision-making logic in your server. Then there are tools like <a href=https://developers.google.com/optimize/devguides/experiments>Google Optimize</a> that require you to do the variant selection and assignment manually, but the tool can then handle the data collection and reporting.</p><p>However, the reason you&rsquo;ve read thus far is probably because you&rsquo;re worried about <strong>client-side testing</strong>.</p><article class="post type-simmer"><header class=post-header><h2 class=post-title><a href=https://www.simoahava.com/amp/newsletter/>The Simmer Newsletter</a></h2></header><section class=post-excerpt><p>Follow <a href=https://www.teamsimmer.com/newsletter/>this link</a> to subscribe to the <strong>Simmer Newsletter</strong>! Stay up-to-date with the latest content from Simo Ahava and the <a href=https://www.teamsimmer.com/>Simmer online course platform</a>.</p></section></article><h2 id=introducing-the-problem>Introducing the problem</h2><p>With JavaScript-based experimentation libraries, you&rsquo;re subject to the rules and limitations of the page render in the browser. The <strong>flicker</strong> happens because the page with the modified element is being rendered from the page HTML source, but the experimentation library needs to wait for an opening to allow the browser to process the experiment data.</p><p>This is most often a problem when you&rsquo;re running scripts <strong>asynchronously</strong>. Async load means that once the browser starts to download the library, it doesn&rsquo;t wait for the download to complete. Instead, it proceeds with the page render. Once the download is complete, and as soon as the browser has an available slot in its single thread of execution, it will start parsing and executing the JavaScript within the library.</p><p>By moving from asynchronous to synchronous loading, you solve part of this issue. However, it&rsquo;s not like synchronous loading actually fixes anything automatically. Since the library is loaded at the top of <code>&lt;head></code>, a synchronously loaded library doesn&rsquo;t have access to the elements it&rsquo;s designed to modify (since those elements are created in the <code>&lt;body></code>, which hasn&rsquo;t yet been generated).</p><p>Instead, libraries like Google Optimize, when loaded synchronously, actually <strong>hide</strong> the element that&rsquo;s being tested. They inject a <strong>style declaration</strong> that sets the visibility of all elements matching the CSS selector of the experimentation targets to <code>hidden</code>. Only once the element has been actually added to the page, can Optimize then modify it and unhide it. This is fairly elegant but it might introduce a slight flicker of another kind, where the element seems to &ldquo;pop&rdquo; into place out of sequence with the rest of the render.</p><a href=https://www.simoahava.com/amp/images/2020/05/optimize-hides.jpg title=optimize-hides.jpg><amp-img src=https://www.simoahava.com/amp/images/2020/05/optimize-hides.jpg layout=responsive alt=optimize-hides.jpg height=114 width=1520></amp-img></a><p>A similar solution is <strong>anti-flicker</strong> JavaScript. The purpose here is to actually <strong>hide the entire page</strong> until the experimentation library has loaded. This is, and has been, my biggest objection about how A/B-testing tools are implemented. I simply can&rsquo;t fathom the logic behind potentially sacrificing the usability of the entire page just to get better data quality for your experimentation.</p><blockquote><p>Considering how crucial page performance and <em>perceived</em> page performance is these days, I steer clear of anti-flicker snippets that hide the entire page. It doesn&rsquo;t matter if there are mitigations in place for ad blockers and download errors. If the endpoint is unresponsive or lags, <a href="https://support.google.com/optimize/answer/7100284?hl=en">Google Optimize&rsquo;s default anti-flicker snippet</a> has the page wait for a maximum of <strong>4 seconds</strong> (this is adjustable) before revealing the content. Naturally, if the container loads before that, the page is revealed faster. But still, OUCH!</p></blockquote><h2 id=measuring-the-impact-of-flicker>Measuring the impact of flicker</h2><p>So, let&rsquo;s assume the situation is as follows:</p><p>You&rsquo;ve got an experiment running that treats a home page element, which is visible above the fold if the page is loaded without a scroll threshold in place.</p><p>You&rsquo;ve deployed Google Optimize using the <a href="https://support.google.com/optimize/answer/7513085?hl=en">new snippet</a>. You&rsquo;ve deployed the <strong>asynchronous</strong> snippet, and you are <strong>not</strong> using the anti-flicker JavaScript, so there&rsquo;s a visible and measurable flicker in place.</p><a href=https://www.simoahava.com/amp/images/2020/05/animated-flicker.gif title="Flicker of the original (grey background) before the variant (red background)"><amp-img src=https://www.simoahava.com/amp/images/2020/05/animated-flicker.gif layout=responsive alt="Flicker of the original (grey background) before the variant (red background)" height=100 width=960></amp-img></a><p>In order to <strong>measure</strong> the severity of this flicker, we need to collect a number of timings:</p><ol><li>Time when the original element was added to the page,</li><li>Time when the original element became visible in the viewport,</li><li>Time when the experimentation library was loaded,</li><li>Time when the experiment change was applied to the page.</li></ol><p>The <strong>flicker</strong> is the time delta between (2) and (4). If the element isn&rsquo;t visible in the viewport, or if the experiment is applied <em>before</em> the base element becomes visible, the flicker is not a problem. (3) is interesting metadata about how the experimentation library itself works, and how fast it manages to apply the change after loading.</p><h3 id=introduction-to-the-javascript-well-need>Introduction to the JavaScript we&rsquo;ll need</h3><p>The solution will rely on two pieces of <strong>JavaScript</strong> code running <strong>directly in the page template</strong>. You <strong>can&rsquo;t</strong> execute this code reliably through a dependency like Google Tag Manager, because Google Tag Manager in many cases loads <em>after</em> all steps (1)-(4) have already happened, meaning you won&rsquo;t get accurate measurements.</p><p>The first bit of JavaScript is run at the very top of <code>&lt;head></code>, even before the Optimize snippet. This script uses the <a href="https://support.google.com/optimize/answer/9059383?hl=en"><code>optimize.callback</code></a> API to collect the timestamp of the experimentation library load. This is timing number (3) in the list above.</p><p>The second JavaScript snippet is added to the <strong>top of <code>&lt;body></code></strong>, because the observers need access to <code>document.body</code>. Here&rsquo;s what it does:</p><ul><li>A <a href=https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver><strong>MutationObserver</strong></a> waits on the page and reacts to two changes: when the element is first added to the page, and when the element is updated with the variant. These are timings (1) and (4), respectively, in the list above.</li><li>An <a href=https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API><strong>IntersectionObserver</strong></a> is added to the page as soon as the original element is rendered. The purpose of the IntersectionObserver is to fire a callback as soon as the original element is visible in the viewport. This is timing (2) in the list above.</li></ul><p>Once the timings have been collected, they are pushed into <code>dataLayer</code> to be used in Google Tag Manager.</p><h3 id=other-preparations>Other preparations</h3><p>To best measure the application of the experiment element, I have added the <strong>data attribute</strong> <code>data-test="true"</code> to the variant. This makes it easier for me to locate the element using CSS selectors.</p><p>The attribute is added via the Optimize editor, and is thus only present on the element after it&rsquo;s modified by Google Optimize.</p><a href=https://www.simoahava.com/amp/images/2020/05/data-test-true.jpg title="data-test attribute on the element"><amp-img src=https://www.simoahava.com/amp/images/2020/05/data-test-true.jpg layout=responsive alt="data-test attribute on the element" height=140 width=1220></amp-img></a><p>Finally, I&rsquo;m collecting all this data using Google Tag Manager, and I&rsquo;m sending it to <a href=https://www.simoahava.com/amp/analytics/getting-started-with-google-analytics-app-web/>App + Web</a> because I want to collect it in <a href=https://www.simoahava.com/amp/analytics/enable-bigquery-export-google-analytics-app-web/>BigQuery</a> for more granular analysis.</p><blockquote><p>You could just as well calculate the delta directly in the client and send it to, for example, Universal Analytics as an event. This is entirely up to you. I opted for the BigQuery approach - I justify this <a href=#things-to-note>later</a> in the article.</p></blockquote><h2 id=installing-the-optimize-library-and-callback>Installing the Optimize library and callback</h2><p>To install the Optimize library, I&rsquo;m adding the <code>&lt;script></code> element with the <code>async</code> attribute to the top of <code>&lt;head></code>.</p><a href=https://www.simoahava.com/amp/images/2020/05/optimize-snippet.jpg title="Optimize snippet"><amp-img src=https://www.simoahava.com/amp/images/2020/05/optimize-snippet.jpg layout=responsive alt="Optimize snippet" height=178 width=1644></amp-img></a><p>By adding it to the top of <code>&lt;head></code>, I&rsquo;m not eliminating the flicker (because it&rsquo;s still loaded <em>asynchronously</em>), but I am making sure that the download of the library begins as soon as the page render starts. This helps mitigate the flicker a <strong>great</strong> deal.</p><p>Then, to add the Optimize callback, I&rsquo;m running the following script <strong>before</strong> the Optimize snippet at the very beginning of <code>&lt;head></code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en-us&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;generator&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;Hugo 0.61.0&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=kd>function</span> <span class=nx>gtag</span><span class=p>()</span> <span class=p>{</span> <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span> <span class=o>||</span> <span class=p>[];</span> <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>arguments</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>gtag</span><span class=p>(</span><span class=s1>&#39;event&#39;</span><span class=p>,</span> <span class=s1>&#39;optimize.callback&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nx>callback</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	      <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>||</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>          <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span><span class=p>.</span><span class=nx>experimentLoaded</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	    <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span></span></span></code></pre></div><p>Here, we first create the <code>gtag</code> queue (because that&rsquo;s what Optimize uses for its API control). Then, we push a callback in the shape of a gtag event. I&rsquo;m passing an anonymous function to the callback argument. This function references a global object which we&rsquo;ll use to collect the milestones. The only milestone we populate in this callback is <code>experimentLoaded</code>, and we attach the current timestamp to it.</p><p>The callback is invoked as soon as the experiment library has loaded and Optimize has established to which variant the user belongs (and thus which version of the element to show to them).</p><h2 id=installing-the-observer-scripts>Installing the observer scripts</h2><p>Here&rsquo;s the tricky bit. You need to install <strong>two</strong> observers (a <code>MutationObserver</code> and an <code>IntersectionObserver</code>). The first checks if an element has been added to the page, and the second checks if an element is in the viewport. I&rsquo;ll show you the code first and then explain what it does.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>ftm</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>||</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>testState</span> <span class=o>=</span> <span class=s1>&#39;success&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>dpush</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>testState</span> <span class=o>!==</span> <span class=s1>&#39;noObservers&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// If milestones are incomplete and it&#39;s not because of lack of support, do nothing
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>ftm</span><span class=p>.</span><span class=nx>experimentLoaded</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                <span class=o>!</span><span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementAddedToPage</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                <span class=o>!</span><span class=nx>ftm</span><span class=p>.</span><span class=nx>testElementAddedToPage</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// If all other milestones are in place, but baseElementVisible is not,
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// send the other timings and make note that base element was not visible.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementVisible</span><span class=p>)</span> <span class=p>{</span> <span class=nx>testState</span> <span class=o>=</span> <span class=s1>&#39;baseNotVisible&#39;</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=c1>// Push everything to dataLayer
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>          <span class=nb>window</span><span class=p>.</span><span class=nx>dataLayer</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>event</span><span class=o>:</span> <span class=s1>&#39;optimize_flicker_test&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>testMilestones</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>baseElementAddedToPage</span><span class=o>:</span> <span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementAddedToPage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>baseElementVisible</span><span class=o>:</span> <span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementVisible</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>experimentLoaded</span><span class=o>:</span> <span class=nx>ftm</span><span class=p>.</span><span class=nx>experimentLoaded</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>testElementAddedToPage</span><span class=o>:</span> <span class=nx>ftm</span><span class=p>.</span><span class=nx>testElementAddedToPage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=nx>testState</span><span class=o>:</span> <span class=nx>testState</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          
</span></span><span class=line><span class=cl>          <span class=c1>// Reset the test
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Only run if observers are supported by the browser
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>MutationObserver</span> <span class=o>&amp;&amp;</span> <span class=nb>window</span><span class=p>.</span><span class=nx>IntersectionObserver</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kd>var</span> <span class=nx>observer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MutationObserver</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>mutations</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>mutations</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>mutation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kd>var</span> <span class=nx>node</span> <span class=o>=</span> <span class=o>!!</span><span class=nx>mutation</span><span class=p>.</span><span class=nx>addedNodes</span><span class=p>.</span><span class=nx>length</span> <span class=o>&amp;&amp;</span> <span class=nx>mutation</span><span class=p>.</span><span class=nx>addedNodes</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=nx>node</span> <span class=o>&amp;&amp;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>matches</span> <span class=o>&amp;&amp;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>matches</span><span class=p>(</span><span class=s1>&#39;span.talks&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>matches</span><span class=p>(</span><span class=s1>&#39;[data-test]&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>ftm</span><span class=p>.</span><span class=nx>testElementAddedToPage</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                  <span class=nx>dpush</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementAddedToPage</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                  <span class=nx>dpush</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                  <span class=kd>var</span> <span class=nx>intersectionObserver</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntersectionObserver</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>entries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=nx>entries</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=nx>e</span><span class=p>.</span><span class=nx>intersectionRatio</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                      <span class=p>}))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=nx>ftm</span><span class=p>.</span><span class=nx>baseElementVisible</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                      <span class=nx>dpush</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                  <span class=p>});</span>
</span></span><span class=line><span class=cl>                  <span class=nx>intersectionObserver</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nx>node</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>          <span class=nx>observer</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>childList</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>subtree</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// Make note that there was no support for observers
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestMilestones</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>          <span class=nx>testState</span> <span class=o>=</span> <span class=s1>&#39;noObservers&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=nx>dpush</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})();</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  ...
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span></span></span></code></pre></div><p>This script runs at the very top of <code>&lt;body></code> so that the observers can be primed as fast as possible.</p><p>First thing to check is whether the browser supports both <a href="https://caniuse.com/#feat=mutationobserver"><code>MutationObserver</code></a> and <a href="https://caniuse.com/#feat=intersectionobserver"><code>IntersectionObserver</code></a>. We don&rsquo;t have to support all browsers for this - we just need a representative sample. If there is no support, then the <code>dataLayer.push()</code> includes the <code>testState</code> key with the value <code>noObservers</code>, and we can use that in our analyses.</p><blockquote><p>I did not opt for a fallback to just polling the page until the element is found. It would have made the code more complex than it already is, and it could have potentially introduced performance issues that I&rsquo;d rather avoid when experimenting with data.</p></blockquote><p>The script then inserts the <strong>MutationObserver</strong>. This observer pattern can be used to detect things like DOM elements being added to the page or attributes changing for individual elements.</p><p>I&rsquo;m only interested in child nodes being added to the page, because the original element (by the browser engine parsing the HTML source) and the variant (by the Optimize library) are added as new elements to the page. The observer is primed like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>observer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MutationObserver</span><span class=p>(</span><span class=nx>callback</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>observer</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>childList</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>subtree</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>We&rsquo;re attaching the observer to <code>document.body</code>, and we&rsquo;re reacting to any changes in the child nodes, regardless of how deep they are in the subtree. If a change is detected, the callback function is executed.</p><p>In this case, I&rsquo;m making sure that the observer callback only reacts to when the element I&rsquo;m currently testing is added to the page:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>node</span> <span class=o>&amp;&amp;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>matches</span> <span class=o>&amp;&amp;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>matches</span><span class=p>(</span><span class=s1>&#39;span.talks&#39;</span><span class=p>))</span> <span class=p>{</span></span></span></code></pre></div><p>Next, the code checks if the node that was added is the experiment element:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>matches</span><span class=p>(</span><span class=s1>&#39;[data-test]&#39;</span><span class=p>))</span> <span class=p>{</span></span></span></code></pre></div><p>If you remember, above I mentioned that I add the <code>data-test="true"</code> attribute to the test element to make debugging easier.</p><p>If the added element was the experiment element, I update the milestone for <code>testElementAddedToPage</code> with the current timestamp. This is the moment when Optimize added the modified element to the page, and will serve as the endpoint of our delta measurement.</p><p>If the element was <strong>not</strong> the experiment element, it <em>has</em> to be the base element, so I update the milestone <code>baseElementAddedToPage</code> together with the timestamp.</p><p>Since I want to know the moment the base element became <strong>visible</strong> in the viewport, in the callback where I process the non-experiment element, I attach an <code>IntersectionObserver</code> to it as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>intersectionObserver</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntersectionObserver</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>entries</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>entries</span><span class=p>.</span><span class=nx>some</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>e</span><span class=p>.</span><span class=nx>intersectionRatio</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}))</span> <span class=p>{</span> <span class=p>...</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>intersectionObserver</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nx>node</span><span class=p>);</span></span></span></code></pre></div><p>The <code>IntersectionObserver</code> activates whenever the element that is being observed enters the viewport of the browser. I can then check if the element is visible even the tiniest bit (<code>intersectionRatio > 0</code>), and then update the milestone for <code>baseElementVisible</code> with the timestamp.</p><p>After every milestone, I check if at least <code>baseElementAddedToPage</code>, <code>experimentLoaded</code>, and <code>testElementAddedToPage</code> milestones have been updated. If they have, the milestones and the test state are pushed into <code>dataLayer</code>.</p><a href=https://www.simoahava.com/amp/images/2020/05/test-milestones.jpg title="Test milestones"><amp-img src=https://www.simoahava.com/amp/images/2020/05/test-milestones.jpg layout=responsive alt="Test milestones" height=308 width=854></amp-img></a><p>There are two reasons I&rsquo;m not waiting around for <code>baseElementVisible</code>:</p><ul><li>Sometimes the experiment loads the updated element so fast that the base element is already removed from the page when the IntersectionObserver is supposed to go off.</li><li>Sometimes the user has scrolled beyond the fold, and the <code>baseElementVisible</code> simply does not fire (because the base element is not, well, visible).</li></ul><p>Both of these mean that the flicker is basically a non-issue, so it&rsquo;s OK for me to just collect a <code>null</code> in these cases. I update <code>testState</code> with <code>"baseNotVisible"</code> to make it easier to parse these in the analysis.</p><h2 id=setting-up-the-google-tag-manager-assets>Setting up the Google Tag Manager assets</h2><p>In GTM, the <strong>trigger</strong> I need looks like this:</p><a href=https://www.simoahava.com/amp/images/2020/05/optimize-custom-event-trigger.jpg title="Optimize Custom Event Trigger"><amp-img src=https://www.simoahava.com/amp/images/2020/05/optimize-custom-event-trigger.jpg layout=responsive alt="Optimize Custom Event Trigger" height=764 width=1846></amp-img></a><p>You&rsquo;ll need <em>five</em> Data Layer variables. Each is setup like this:</p><a href=https://www.simoahava.com/amp/images/2020/05/experiment-time-data-layer-variable.jpg title="Experiment time data layer variable"><amp-img src=https://www.simoahava.com/amp/images/2020/05/experiment-time-data-layer-variable.jpg layout=responsive alt="Experiment time data layer variable" height=584 width=988></amp-img></a><p>The variable names you&rsquo;ll need are:</p><ul><li><code>testMilestones.baseElementAddedToPage</code></li><li><code>testMilestones.baseElementVisible</code></li><li><code>testMilestones.experimentLoaded</code></li><li><code>testMilestones.testElementAddedToPage</code></li><li><code>testMilestones.testState</code></li></ul><p>And this is what the <strong>App + Web</strong> event tag looks like:</p><a href=https://www.simoahava.com/amp/images/2020/05/app-web-event-tag.jpg title="App+Web event tag"><amp-img src=https://www.simoahava.com/amp/images/2020/05/app-web-event-tag.jpg layout=responsive alt="App+Web event tag" height=1874 width=1790></amp-img></a><p>As you can see, I&rsquo;m also sending a &ldquo;page ID&rdquo;. I can use this to group all the timings for any given user/session/page combination a bit more easily. It&rsquo;s not strictly necessary, but might make some analyses a bit easier.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestPageId</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestPageId</span> <span class=o>||</span> <span class=p>{{</span><span class=nx>Random</span> <span class=nx>GUID</span><span class=p>}};</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>window</span><span class=p>.</span><span class=nx>__flickerTestPageId</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><blockquote><p>The &ldquo;Random GUID&rdquo; variable is <a href=https://www.simoahava.com/amp/analytics/13-useful-custom-dimensions-for-google-analytics/#12-session-id>another Custom JavaScript variable</a> that returns a random, and fairly unique, identifier.</p></blockquote><p>By setting a global variable, we make sure the same ID is used for all the events that are being measured.</p><p>When I now load the home page of my site, this is what I see being sent to App + Web:</p><a href=https://www.simoahava.com/amp/images/2020/05/request-payload.jpg title="Request payload"><amp-img src=https://www.simoahava.com/amp/images/2020/05/request-payload.jpg layout=responsive alt="Request payload" height=206 width=3466></amp-img></a><h2 id=bigquery-output>BigQuery output</h2><p>In BigQuery, our event parameters are added into the <code>event_parameters</code> record. It&rsquo;s not the classiest way to pass key-value pairs, especially since values are distributed as columns with one column per (potential) type. However, it is the only supported way of exporting custom parameters for now.</p><h3 id=full-table-output>Full table output</h3><p>Here&rsquo;s what those <code>optimize_flicker_test</code> hits look like in our event table:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>project</span><span class=p>.</span><span class=n>dataset</span><span class=p>.</span><span class=n>events_yyyymmdd</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;optimize_flicker_test&#34;</span></span></span></code></pre></div><a href=https://www.simoahava.com/amp/images/2020/05/sql-full-table.jpg title="SQL full table"><amp-img src=https://www.simoahava.com/amp/images/2020/05/sql-full-table.jpg layout=responsive alt="SQL full table" height=930 width=2466></amp-img></a><h3 id=count-of-test-states>Count of test states</h3><p>We can drill down and count the respective number of each test state:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ep</span><span class=p>.</span><span class=n>value</span><span class=p>.</span><span class=n>string_value</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>test_state</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>count</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>project</span><span class=p>.</span><span class=n>dataset</span><span class=p>.</span><span class=n>events_yyyymmdd</span><span class=o>`</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>UNNEST</span><span class=p>(</span><span class=n>event_params</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>ep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>event_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;optimize_flicker_test&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=n>ep</span><span class=p>.</span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;testState&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=k>DESC</span></span></span></code></pre></div><a href=https://www.simoahava.com/amp/images/2020/05/sql-count-of-test-states.jpg title="Count of test states"><amp-img src=https://www.simoahava.com/amp/images/2020/05/sql-count-of-test-states.jpg layout=responsive alt="Count of test states" height=508 width=1246></amp-img></a><h3 id=table-with-deltas>Table with deltas</h3><p>We can also build a query that returns all the milestones with the calculated deltas:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>milestones</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;baseElementAddedToPage&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>baseElementAddedToPage</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;baseElementVisible&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>baseElementVisible</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;experimentLoaded&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>experimentLoaded</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;testElementAddedToPage&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>testElementAddedToPage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>project</span><span class=p>.</span><span class=n>dataset</span><span class=p>.</span><span class=n>events_yyyymmdd</span><span class=o>`</span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>t</span><span class=p>.</span><span class=n>event_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;optimize_flicker_test&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>baseElementAddedToPage</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>testElementAddedToPage</span><span class=o>-</span><span class=n>baseElementAddedToPage</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>injection_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>baseElementVisible</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>testElementAddedToPage</span><span class=o>-</span><span class=n>baseElementVisible</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>flicker_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>experimentLoaded</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>experimentLoaded</span><span class=o>-</span><span class=n>baseElementAddedToPage</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>experiment_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>testElementAddedToPage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>milestones</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>flicker_delta</span><span class=w> </span><span class=k>DESC</span></span></span></code></pre></div><a href=https://www.simoahava.com/amp/images/2020/05/sql-calculated-milestones.jpg title="Calculated milestones"><amp-img src=https://www.simoahava.com/amp/images/2020/05/sql-calculated-milestones.jpg layout=responsive alt="Calculated milestones" height=986 width=1778></amp-img></a><p>This is just one way to approach the data.</p><p>Here, I&rsquo;m calculating <code>injection_delta</code> as the time it takes for the test element to be added to the page <em>after</em> the base element has been added. This could be used as a stand-in to measure the <em>potential</em> flicker.</p><p>The <code>flicker_delta</code> is the elapsed time from the base element becoming visible to it being replaced with the variant.</p><p>Finally, <code>experiment_delta</code> is the elapsed time from the base element being added to the page to the experiment loading. This value can be <em>negative</em>, meaning the experiment library loaded <em>before</em> the base element was added to the page. This is possible especially if the experiment library loads really fast after being, for example, cached by the browser.</p><h3 id=simple-calculations>Simple calculations</h3><p>Once you have the milestones, you can do simple calculations:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>milestones</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;baseElementAddedToPage&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>baseElementAddedToPage</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;baseElementVisible&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>baseElementVisible</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;experimentLoaded&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>experimentLoaded</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>int_value</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>event_params</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;testElementAddedToPage&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>testElementAddedToPage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>project</span><span class=p>.</span><span class=n>dataset</span><span class=p>.</span><span class=n>event_yyyymmdd</span><span class=o>`</span><span class=w> </span><span class=n>t</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>t</span><span class=p>.</span><span class=n>event_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;optimize_flicker_test&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AVG</span><span class=p>(</span><span class=n>injection_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>average_injection_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>MIN</span><span class=p>(</span><span class=n>injection_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>minimum_injection_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>MAX</span><span class=p>(</span><span class=n>injection_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>maximum_injection_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AVG</span><span class=p>(</span><span class=n>flicker_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>average_flicker_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>MIN</span><span class=p>(</span><span class=n>flicker_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>minimum_flicker_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>MAX</span><span class=p>(</span><span class=n>flicker_delta</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>maximum_flicker_delta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>SELECT</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>baseElementAddedToPage</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>testElementAddedToPage</span><span class=o>-</span><span class=n>baseElementAddedToPage</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>injection_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>baseElementVisible</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>testElementAddedToPage</span><span class=o>-</span><span class=n>baseElementVisible</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>flicker_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>experimentLoaded</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>experimentLoaded</span><span class=o>-</span><span class=n>baseElementAddedToPage</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>experiment_delta</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>testElementAddedToPage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>milestones</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span></span></span></code></pre></div><a href=https://www.simoahava.com/amp/images/2020/05/sql-averages.jpg title="SQL Averages"><amp-img src=https://www.simoahava.com/amp/images/2020/05/sql-averages.jpg layout=responsive alt="SQL Averages" height=430 width=1856></amp-img></a><p>Nothing ground-breaking analysis-wise, but this shows what you could do with the data.</p><h2 id=things-to-note>Things to note</h2><p>OK, so I misled you a bit with the title of this article. The purpose wasn&rsquo;t to show you how to measure the <strong>impact</strong> of the flicker, but rather how to collect the data that <em>allows</em> you to measure the impact of the flicker.</p><p>With the raw data about element visibility and element injection, you can measure what the delta is and how it impacts conversions, for example. However, this analysis is left for you to calibrate against your unique data set and your unique experiments.</p><p>You probably also wondered when reading the setup, &ldquo;Why isn&rsquo;t this guy just calculating the delta in the client and sending <em>that</em> to App+Web? Or, better yet, why isn&rsquo;t he just sending it to Google Analytics?&rdquo;. Totally valid questions.</p><p>I decided to build this experiment around <strong>raw, uncalculated data</strong>. Many analytics tools have happily promoted the idea that calculated metrics don&rsquo;t need to be reverse engineerable. This has led to confusion around things like the <a href=https://www.simoahava.com/amp/analytics/the-schema-conspiracy/>sessionization schema</a> of Google Analytics, and the weird, quantum fluctuations that seem to govern any data set when you zoom in close enough.</p><p>With App+Web, <em>everybody</em> has access to the raw data dump in BigQuery, so I want to start pushing forward the approach where the <strong>data you collect is as raw as possible</strong>, so that you have <strong>full freedom</strong> for parsing the data as you wish in BQ.</p><p>You are, of course, free to modify the solution however you wish.</p><h2 id=summary>Summary</h2><p>There are some <strong>caveats</strong> to this experiment. <a href="https://caniuse.com/#feat=intersectionobserver">Not all browsers support Mutation- and IntersectionObservers</a>.</p><p>There might also be cases where the <code>baseElementVisible</code> simply refuses to fire in time, even if there was a flicker. The single-threadedness of JavaScript has the tendency to mess with callbacks. That&rsquo;s why I opted to throw the <code>baseElementVisible</code> baby out with the bathwater - if this metric hasn&rsquo;t been collected by the time all the other metrics have, I&rsquo;d rather not send it at all rather than send confusing values where the base element became visible <em>after</em> the test element was added.</p><p>When setting up this test, just remember these key points:</p><ol><li><p>The JavaScript snippets <em>must</em> be added in the page template. If you&rsquo;re firing Optimize through Google Tag Manager, you <em>could</em> add the Optimize callback in a Custom HTML tag, but there&rsquo;s still the risk of a race condition ruining everything.</p></li><li><p>You need to update the CSS selectors in the observers to match the element you are measuring. Adding the <code>data-test="true"</code> (or something similar) to the element in the Optimize editor makes it easier to adjust the observer pattern.</p></li></ol><p>Let me know in the comments if you have additional insights to setting up the test or the subsequent analysis.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://www.simoahava.com/amp/></a></figure><section class=author><h4>Simo Ahava</h4><p>Husband | Father | Analytics developer</p><div class=author-meta><span class="author-location icon-location">Espoo, Finland</span>
<span class="author-link icon-link"><a href=https://www.simoahava.com/>https://www.simoahava.com/</a></span></div></section><div class=social><amp-social-share type=twitter width=60 height=44></amp-social-share><amp-social-share type=linkedin width=60 height=44></amp-social-share><amp-social-share type=facebook width=60 height=44></amp-social-share></div></footer></article></main></div></body></html>