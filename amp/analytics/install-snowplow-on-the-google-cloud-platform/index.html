

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:b 4s 2s infinite;animation:b 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:a .6s;animation:a .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:a .9s;animation:a .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{content:"";width:7px;height:7px;border:1px solid #e7eef2;bottom:-5px;margin-left:-5px;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image,.author-profile:after{display:block;position:absolute;left:50%;background:#fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;top:-56px;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes a{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes a{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes b{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes b{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open,#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:a}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(a,lower-roman);counter-increment:a}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;background:transparent}.menu-button,.menu-button:hover{border-color:transparent;color:#2e2e2e}.menu-button:hover{background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/analytics/install-snowplow-on-the-google-cloud-platform/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Install Snowplow on the Google Cloud Platform | Simo Ahava's blog</title>
        <meta property="og:title" content="Install Snowplow on the Google Cloud Platform" />
<meta name="description" content="A walkthrough for deploying the Snowplow Analytics pipeline in the Google Cloud Platform environment." />
<meta property="og:description" content="A walkthrough for deploying the Snowplow Analytics pipeline in the Google Cloud Platform environment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/analytics/install-snowplow-on-the-google-cloud-platform/" />

    
        
    



    
        <meta property="article:published_time" content="2018-12-06T05:00:22Z"/>
    
    
        <meta property="article:modified_time" content="2018-12-06T05:00:22Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Analytics" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="snowplow" />
        
            <meta property="article:tag" content="google cloud" />
        
            <meta property="article:tag" content="gcp" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    




<meta itemprop="name" content="Install Snowplow On The Google Cloud Platform">
<meta itemprop="description" content="A walkthrough for deploying the Snowplow Analytics pipeline in the Google Cloud Platform environment.">


<meta itemprop="datePublished" content="2018-12-06T07:00:22&#43;02:00" />
<meta itemprop="dateModified" content="2018-12-06T07:00:22&#43;02:00" />
<meta itemprop="wordCount" content="7782">



<meta itemprop="keywords" content="google tag manager,snowplow,google cloud,gcp," />

<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https://www.simoahava.com/amp/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Install Snowplow On The Google Cloud Platform | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2018/11/snowplow-gcp.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/amp/analytics/install-snowplow-on-the-google-cloud-platform/",
  "datePublished": "2018-12-06T07:00:22+02:00",
  "dateModified": "2018-12-06T07:00:22+02:00",
  "description": "A walkthrough for deploying the Snowplow Analytics pipeline in the Google Cloud Platform environment.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Install Snowplow on the Google Cloud Platform</h1>
        <small>A walkthrough for deploying the Snowplow Analytics pipeline in the Google Cloud Platform environment.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/analytics">Analytics</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/snowplow">#snowplow</a>
    
        , <a href="https://www.simoahava.com/amp/tags/google-cloud">#google cloud</a>
    
        , <a href="https://www.simoahava.com/amp/tags/gcp">#gcp</a>
    

<time class="post-date" datetime="2018-12-06T07:00:22&#43;02:00">
    6 December 2018
</time>


        </section>
    </header>

    <section class="post-content">
      

<p>I&rsquo;m (still) a huge fan of <a href="https://snowplowanalytics.com/">Snowplow Analytics</a>. Their open-source, modular approach to DIY analytics pipelines has inspired me two write <a href="https://www.simoahava.com/amp/tags/snowplow/">articles</a> about them, and to host a <a href="https://www.meetup.com/Snowplow-Analytics-Helsinki/">meetup</a> in Helsinki. In my previous <a href="https://www.simoahava.com/amp/analytics/snowplow-full-setup-with-google-analytics-tracking/">Snowplow with Amazon Web Services guide</a>, I walked you through setting up a Snowplow pipeline using <a href="https://aws.amazon.com/">Amazon Web Services</a>. This time around, I&rsquo;m looking at the wondrous <a href="https://cloud.google.com">Google Cloud Platform</a>, for which Snowplow introduced support in an <a href="https://snowplowanalytics.com/blog/2018/03/21/snowplow-r101-neapolis-with-initial-gcp-support/">early 2018 release</a>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/snowplow-gcp.jpg" title="Snowplow on the Google Cloud Platform">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/snowplow-gcp.jpg" layout="responsive" alt="Snowplow on the Google Cloud Platform" height="1610" width="3838"></amp-img>
  
    </a>
  


<p>I won&rsquo;t be offering a comprehensive comparison between GCP and AWS, nor will I walk you through every single possible customization you could do when firing up the instances and building the pipeline. Those are left for you to discover by yourself, or to consult a data engineer who can help you with scale.</p>

<p>In fact, the setup I&rsquo;ll walk you through will be suboptimal in many places. It won&rsquo;t be the most robust setup for a large flow of data through the pipeline, but what it will provide you is the comprehensive list of steps you need to make to get things running.</p>

<p>Note that Snowplow also offers their own <a href="https://snowplowanalytics.com/products/snowplow-insights/">Snowplow Insights</a> service for setting up and managing the pipeline so that you can jump straight into data collection and analysis. I <strong>really</strong> recommend this service especially if you are unsure about how to set up the pipeline in an economical and scalable way. You might accrue a lot of extra costs if you don&rsquo;t know how to scale the required resources to suit what you actually need for efficient analysis.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/snowplow-insights.jpg" title="Snowplow insights">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/snowplow-insights.jpg" layout="responsive" alt="Snowplow insights" height="293" width="1371"></amp-img>
  
    </a>
  


<p>You can also follow the official <a href="https://github.com/snowplow/snowplow/wiki/GCP:-Getting-Started">Snowplow wiki</a>, if you wish. The steps are similar to what I go through in this guide, though I do think this guide will be better suited for you in case you are unfamiliar with how GCP works.</p>

<!-- toc -->



    <a href="https://www.simoahava.com/amp/images/2018/12/full-process.jpg" title="Full process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/full-process.jpg" layout="responsive" alt="Full process" height="612" width="1364"></amp-img>
  
    </a>
  


<p>My Powerpoint visualization skills just get better and better each passing year!</p>

<h2 id="word-of-warning">Word of warning</h2>

<p>This probably won&rsquo;t come as a surprise to you, but working with a cloud platform is <strong>not free of charge</strong>. If you&rsquo;re a first-time user, you should be eligible for the <a href="https://cloud.google.com/free/">free trial</a> of $300 to be spent during the first 12 months. This is more than enough to build a pipeline and test it out over a number of days, but it won&rsquo;t get you far.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/billing-dashboard.jpg" title="Billing dashboard">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/billing-dashboard.jpg" layout="responsive" alt="Billing dashboard" height="863" width="1917"></amp-img>
  
    </a>
  


<p>You&rsquo;ll need to keep a close eye on the <a href="https://console.cloud.google.com/billing/">billing dashboard</a> of your project. It helps you get an idea of how much cost you have factually accumulated to this day, and what the projected cost for the whole month will be.</p>

<h2 id="what-you-ll-need">What you&rsquo;ll need</h2>

<p>To follow this guide, you will need:</p>

<ul>
<li><p><strong>A Google account</strong> - something to log into Google services with, such as your Google Mail ID.</p></li>

<li><p><strong>A credit card</strong> - you&rsquo;ll need to enable billing in your Google Cloud account to fire up some of the services we need.</p></li>

<li><p><strong>A custom domain name</strong> - this is optional, but it&rsquo;s necessary if you want to set up the tracker as a secure HTTPS endpoint. Without a custom domain name, you&rsquo;re forced to use HTTP only. You can get a cheap domain name from <a href="https://domains.google/">Google Domains</a>. You <em>might</em> be able to set something up for free using <a href="https://cloud.google.com/endpoints/">Cloud Endpoints</a>, but this guide will not cover this.</p></li>
</ul>

<p>Good luck! Let me know in the comments if some part of this guide was particularly unclear.</p>

<h2 id="first-steps">First steps</h2>

<p>Here we&rsquo;ll setup the GCP project, make sure you have the necessary resources enabled, and we&rsquo;ll also install the Google Cloud SDK so that you can interact with your project via your local terminal, too.</p>

<h3 id="step-1-set-up-a-new-project">Step 1: Set up a new project</h3>

<p>The first thing you&rsquo;ll need to do is set up a new Google Cloud project.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/cloud-resource-manager/">https://console.cloud.google.com/cloud-resource-manager/</a>. Remember to login with the Google ID which you&rsquo;ll use to manage this project. Click <strong>CREATE PROJECT</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/gcp-create-project.jpg" title="Create GCP project">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/gcp-create-project.jpg" layout="responsive" alt="Create GCP project" height="730" width="1738"></amp-img>
  
    </a>
  


<blockquote>
<p>If this is the first time you use GCP with this account, you might see an offer for <strong>free credit</strong>. Take it!</p>
</blockquote>

<p><strong>(2)</strong> Give the project a name.</p>

<p>For convenience, it might be good to change the <strong>Project ID</strong> to something more legible and easy to understand.</p>

<p>If you have <strong>Organizations</strong> and <strong>Locations</strong> (such as folders) set up for your Google Cloud account, choose the appropriate ones from the menu.</p>

<p>Also, if you already have a <strong>Billing Account</strong> set up, choose that as well from the respective drop-down menu.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-new-project.jpg" title="Create new project">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-new-project.jpg" layout="responsive" alt="Create new project" height="1278" width="1102"></amp-img>
  
    </a>
  


<p>Choose <strong>CREATE</strong> when you&rsquo;re done.</p>

<p>After clicking the button, GCP will do some loading and spinning for a while, after which you should see your new project dashboard. If you don&rsquo;t, make sure to select it from the project selector menu.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/gcp-dashboard.jpg" title="GCP dashboard">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/gcp-dashboard.jpg" layout="responsive" alt="GCP dashboard" height="1600" width="3394"></amp-img>
  
    </a>
  


<p>Congratulations! You&rsquo;ve created the project.</p>

<h3 id="step-2-enable-billing">Step 2: Enable Billing</h3>

<p>You&rsquo;ll need to create a <strong>billing account</strong> so that GCP can invoice you if necessary (sucks, I know).</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/billing">https://console.cloud.google.com/billing</a>.</p>

<p><strong>(2)</strong> Click <strong>Add billing account</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/add-billing-account.jpg" title="Add billing account">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/add-billing-account.jpg" layout="responsive" alt="Add billing account" height="464" width="864"></amp-img>
  
    </a>
  


<p>Here, follow the steps to add your credit card, or, if you&rsquo;re eligible for the <strong>free trial</strong>, to activate your free trial.</p>

<p>Make sure you follow the prompts to link your Snowpow project to the Billing account you just created.</p>

<h3 id="step-3-enable-the-required-services">Step 3: Enable the required services</h3>

<p>Next, you need to enable the services and APIs we&rsquo;ll need to get started. These steps let you set up the collector. When you move to the <a href="#prepare-the-etl-step">enrich and BigQuery load steps</a>, you&rsquo;ll need to enable additional services.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/apis/library">https://console.cloud.google.com/apis/library</a>.</p>

<p>You should see a search bar, so start by searching for <strong>Compute Engine API</strong> and click the relevant result. We&rsquo;ll need the Compute Engine to fire up our virtual machines on which the Snowplow collector will reside.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/compute-engine-api.jpg" title="Compute Engine API">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/compute-engine-api.jpg" layout="responsive" alt="Compute Engine API" height="918" width="2088"></amp-img>
  
    </a>
  


<p>Upon entering the Compute Engine API page, simply click the blue <strong>ENABLE</strong> button at the top.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/compute-engine-api-enable.jpg" title="Enable the Compute Engine API">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/compute-engine-api-enable.jpg" layout="responsive" alt="Enable the Compute Engine API" height="1068" width="1758"></amp-img>
  
    </a>
  


<p>Once it&rsquo;s done, you should see something like this where the <strong>Enable</strong> button used to be:</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/compute-engine-api-enabled.jpg" title="Compute Engine API enabled">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/compute-engine-api-enabled.jpg" layout="responsive" alt="Compute Engine API enabled" height="774" width="1478"></amp-img>
  
    </a>
  


<p>Now, follow these exact same steps for the <strong>Cloud Pub/Sub API</strong>. Pub/Sub (for <strong>Pub</strong>lisher/<strong>Sub</strong>scriber) is a real-time message queue we&rsquo;ll use to process the data fed into the Snowplow pipeline.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/enable-pub-sub-api.jpg" title="Enable the Pub/Sub API">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/enable-pub-sub-api.jpg" layout="responsive" alt="Enable the Pub/Sub API" height="932" width="1962"></amp-img>
  
    </a>
  


<p>Once you&rsquo;re done enabling these services, you&rsquo;re ready to move onto the next step!</p>

<h3 id="step-4-install-the-google-cloud-sdk">Step 4: Install the Google Cloud SDK</h3>

<p>The next thing you&rsquo;ll want to do is to install the Google Cloud SDK locally in your machine. It&rsquo;s very convenient because it lets you access your GCP project from the command line, and it lets you test some of the services from your local machine rather than having to find the appropriate paths through the often confusing UI.</p>

<p>To install the SDK, follow the steps for your platform, starting from <a href="https://cloud.google.com/sdk/">here</a>.</p>

<p>Once you&rsquo;ve installed the SDK, you should be able to run these commands in your terminal / shell:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gcloud auth login
$ gcloud config <span class="nb">set</span> project PROJECT_ID</code></pre></div>

<p>The first command logs you in with Google Cloud using the Google Account you choose in the web prompt. The second command points the current <code>gcloud</code> setup to the project ID you&rsquo;ll give (replace <code>PROJECT_ID</code> with the ID you configured when you created the project). The end result should be something like this:</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/gcloud-set-project.jpg" title="Gcloud SDK setup">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/gcloud-set-project.jpg" layout="responsive" alt="Gcloud SDK setup" height="578" width="1704"></amp-img>
  
    </a>
  


<h3 id="step-5-setup-a-service-account">Step 5: Setup a service account</h3>

<p>The final initialization step is to setup a <strong>service account</strong>. A service account is basically a Google Cloud account which has full access to your GCP services and resources. It&rsquo;s a necessary step if you want to run services on GCP programmatically rather than with your own, personal Google account.</p>

<blockquote>
<p>Note that when you enable <strong>Compute Engine API</strong> for your project, a <strong>Compute Engine default service account</strong> is created for you automatically. the steps below really only apply if you wanted to create a different service account for your pipeline.</p>
</blockquote>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials</a>.</p>

<p><strong>(2)</strong> Make sure you have the correct project selected in the project selector menu.</p>

<p><strong>(3)</strong> Click the blue <strong>Create credentials</strong> selector, and choose <strong>Service account key</strong> from the menu.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-credentials.jpg" title="Create credentials">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-credentials.jpg" layout="responsive" alt="Create credentials" height="746" width="1766"></amp-img>
  
    </a>
  


<p>Since you&rsquo;ve enabled the <strong>Compute Engine API</strong>, you should be able to choose the default GCE service account from the drop-down.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/default-service-account.jpg" title="Default service account">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/default-service-account.jpg" layout="responsive" alt="Default service account" height="724" width="1108"></amp-img>
  
    </a>
  


<p>Keep the <strong>JSON</strong> option selected, and choose <strong>Create</strong>.</p>

<p>The browser should automatically download the JSON file, so make sure you find it in your local files and <strong>store it securely</strong>.</p>

<blockquote>
<p>At this point, it would be a good idea <strong>to create a local folder for this entire Snowplow experiment</strong>. In that local folder, you can store this service account key and any temporary configuration files you&rsquo;ll work on, and other stuff such as executables and binaries you&rsquo;ll eventually upload to the GCP, if necessary.</p>
</blockquote>

<p>Once you&rsquo;ve created the service account you are ready to move on. All the initial steps have now been completed, congratulations!</p>

<h2 id="setting-up-the-pub-sub-topics">Setting up the Pub/Sub topics</h2>



    <a href="https://www.simoahava.com/amp/images/2018/12/pubsub-process.jpg" title="Pub/sub process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/pubsub-process.jpg" layout="responsive" alt="Pub/sub process" height="612" width="1364"></amp-img>
  
    </a>
  


<p>Snowplow uses a <strong>collector</strong> as the endpoint of your tracker requests. This collector resides in a Compute Engine instance (a virtual machine, basically), and it processes the requests you send to the endpoint.</p>

<p>These requests are then published into <strong>Pub/Sub topics</strong>, from where they are then passed on further down the pipeline for enrichment and parsing. Pub/Sub is essentially a real-time messaging pipeline, which collects messages in <strong>topics</strong>, which are then available for <strong>subscriptions</strong> to access.</p>

<p>Make sure you check out Snowplow&rsquo;s official <a href="https://github.com/snowplow/snowplow/wiki/GCP:-Setting-up-the-Scala-Stream-Collector">wiki</a> for more information on this part of the pipeline.</p>

<h3 id="step-1-create-the-pub-sub-topics">Step 1: Create the Pub/Sub topics</h3>

<p>The first thing you&rsquo;ll need to do is create <strong>topics</strong> in the Pub/Sub you&rsquo;ve enabled for your project.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/cloudpubsub/topicList">https://console.cloud.google.com/cloudpubsub/topicList</a>.</p>

<p><strong>(2)</strong> Make sure you have the correct project selected in the project selector.</p>

<p><strong>(3)</strong> Click the blue <strong>Create a topic</strong> button.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-a-pubsub-topic.jpg" title="create a topic">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-a-pubsub-topic.jpg" layout="responsive" alt="create a topic" height="1014" width="2702"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> Type <code>good</code> after the project path as in the screenshot below, and click <strong>CREATE</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/good-topic.jpg" title="Good topic">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/good-topic.jpg" layout="responsive" alt="Good topic" height="496" width="1054"></amp-img>
  
    </a>
  


<p><strong>(5)</strong> Click <strong>CREATE TOPIC</strong> and type <code>bad</code> as the name of the new topic, and then click <strong>CREATE</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-bad-topic.jpg" title="Bad topic">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-bad-topic.jpg" layout="responsive" alt="Bad topic" height="504" width="1076"></amp-img>
  
    </a>
  


<p>Snowplow uses these two topics to filter out hits and requests that validate (<code>good</code> stream) and those that have issues and errors (<code>bad</code> stream).</p>

<h3 id="step-2-create-a-subscription-optional">Step 2: Create a subscription (optional)</h3>

<p>Next, you can create a <strong>subscription</strong> with which you can test the stream. This is optional, but might be a good idea if you want to see how the pipeline is working.</p>

<p><strong>(6)</strong> Click the <code>good</code> topic to enter its configuration page.</p>

<p><strong>(7)</strong> Choose <strong>CREATE SUBSCRIPTION</strong> from the top navigation.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-subscription.jpg" title="Create subscription">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-subscription.jpg" layout="responsive" alt="Create subscription" height="534" width="1884"></amp-img>
  
    </a>
  


<p><strong>(8)</strong> Give the subscription a name (<code>test-good</code>).</p>

<p><strong>(9)</strong> Leave the other settings as they are, and click <strong>CREATE</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/test-good-subscription.jpg" title="Test good subscription">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/test-good-subscription.jpg" layout="responsive" alt="Test good subscription" height="830" width="992"></amp-img>
  
    </a>
  


<p>Now that you&rsquo;ve created the Pub/Sub topics, it&rsquo;s time to step into one of the more complicated steps of this guide: <strong>setting up the collector itself</strong>.</p>

<h2 id="create-an-http-endpoint-with-the-scala-stream-collector">Create an HTTP endpoint with the Scala Stream Collector</h2>



    <a href="https://www.simoahava.com/amp/images/2018/12/collector-process.jpg" title="Pub/sub process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/collector-process.jpg" layout="responsive" alt="Pub/sub process" height="612" width="1364"></amp-img>
  
    </a>
  


<p>Snowplow uses a collector written in <strong>Scala</strong> for processing the requests sent from your website. These records are parsed by the <strong>Scala Stream Collector</strong> and then distributed into the Pub/Sub topics you created in the previous chapter.</p>

<p>We&rsquo;ll start with a simple <strong>HTTP endpoint</strong> using the default IP address assigned to the Compute Engine instance you&rsquo;ll spin up. This is only to test that the whole pipeline works. You&rsquo;ll want to configure your <a href="#create-an-https-endpoint-with-a-custom-domain-name">own custom domain name with an <strong>HTTPS endpoint</strong></a> for the actual tracker!</p>

<h3 id="step-1-create-the-config-file">Step 1: Create the config file</h3>

<p>In the local directory where you&rsquo;re storing all your project files (such as the service account credentials you created earlier), create a new file named <code>application.config</code>, and copy-paste the contents of <a href="https://gist.githubusercontent.com/sahava/1484fc64231f01deb66329bd777fb40d/raw/a946da40eb6d9b5c48cedb7411c1b6dc89678dd1/snowplow-application-config">this sample config</a> within.</p>

<p>At this time, the only line you need to edit is the one with <code>googleProjectId = your-project-id</code>. Change <code>your-project-id</code> to your actual Google Cloud project ID.</p>

<p>Keep this file at hand, because you&rsquo;ll need to make some changes to it soon.</p>

<h3 id="step-2-fire-up-a-gce-instance">Step 2: Fire up a GCE instance</h3>

<p>You are now ready to start a Compute Engine instance.</p>

<blockquote>
<p>NOTE! Because this is just a test - remember to shut down the instance as soon as you&rsquo;re done so that you don&rsquo;t accumulate extra costs.</p>
</blockquote>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/compute/instances">https://console.cloud.google.com/compute/instances</a> and make sure your project is selected in the project selector.</p>

<p><strong>(2)</strong> Click <strong>Create</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-gce-instance.jpg" title="Create GCE instance">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-gce-instance.jpg" layout="responsive" alt="Create GCE instance" height="930" width="2624"></amp-img>
  
    </a>
  


<p>Next, you&rsquo;ll be transported to the configuration screen.</p>

<p><strong>(3)</strong> Give the instance a <strong>name</strong>.</p>

<p><strong>(4)</strong> Choose a region (somewhere close by, preferably) - you can use the default zone.</p>

<p><strong>(5)</strong> Make sure the service account you&rsquo;ve created (or the default Compute Engine service account) is selected in the relevant list.</p>

<p><strong>(6)</strong> Choose <strong>Set access for each API</strong> from the scope selector.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-initial-settings.jpg" title="Initial instance settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-initial-settings.jpg" layout="responsive" alt="Initial instance settings" height="1244" width="2526"></amp-img>
  
    </a>
  


<p><strong>(7)</strong> Scroll down the list of APIs, and choose <strong>Enabled</strong> for the <strong>Cloud Pub/Sub</strong> API.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/cloud-pubsub-enabled.jpg" title="Cloud pub/sub scope enabled">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/cloud-pubsub-enabled.jpg" layout="responsive" alt="Cloud pub/sub scope enabled" height="310" width="1202"></amp-img>
  
    </a>
  


<p><strong>(8)</strong> Scroll down to <strong>Firewall</strong> and check <strong>Allow HTTP traffic</strong>. Next, click the <strong>Management, security, disks, networking, sole tenancy</strong> link.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/firewall-rule.jpg" title="Firewall rule">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/firewall-rule.jpg" layout="responsive" alt="Firewall rule" height="368" width="1186"></amp-img>
  
    </a>
  


<p><strong>(9)</strong> Select the <strong>Networking</strong> tab, and type <code>collector</code> into the <strong>Network tags</strong> field.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/network-tag.jpg" title="Network tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/network-tag.jpg" layout="responsive" alt="Network tag" height="590" width="1496"></amp-img>
  
    </a>
  


<p>Once you&rsquo;ve done these changes, click <strong>Create</strong> to fire up the instance!</p>

<h3 id="step-3-create-a-firewall-rule">Step 3: Create a firewall rule</h3>

<p>You&rsquo;ll need to create a firewall rule which accepts incoming connections from your website.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/networking/firewalls/list">https://console.cloud.google.com/networking/firewalls/list</a> and make sure the correct project is selected.</p>

<p><strong>(2)</strong> Click <strong>CREATE FIREWALL RULE</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-firewall-rule.jpg" title="Create firewall rule">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-firewall-rule.jpg" layout="responsive" alt="Create firewall rule" height="760" width="1920"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> In the configuration that opens, give the rule some name, e.g. <code>snowplow-firewall-rule</code>.</p>

<p><strong>(4)</strong> Scroll down to <strong>Target tags</strong> and type in the tag name you gave in the end of the <a href="#step-2-fire-up-a-gce-instance">previous step</a> (<code>collector</code> if you used my example).</p>

<p><strong>(5)</strong> Make sure <strong>IP ranges</strong> is selected in the <strong>Source filter</strong> menu, and type <code>0.0.0.0/0</code> into the <strong>Source IP ranges</strong> field.</p>

<p><strong>(6)</strong> Under <strong>Protocols and ports</strong>, check <strong>tcp</strong> and type <code>8080</code> as the port value.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/firewall-configuration.jpg" title="Firewall configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/firewall-configuration.jpg" layout="responsive" alt="Firewall configuration" height="1212" width="964"></amp-img>
  
    </a>
  


<p>When ready, click <strong>Create</strong> to finalize the firewall setup.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/snowplow-firewall-rule-created.jpg" title="Snowplow firewall rule created">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/snowplow-firewall-rule-created.jpg" layout="responsive" alt="Snowplow firewall rule created" height="488" width="1778"></amp-img>
  
    </a>
  


<h3 id="step-4-create-a-storage-bucket-for-your-configuration-file">Step 4: Create a storage bucket for your configuration file</h3>

<p>Next thing you&rsquo;ll need to do is upload the configuration file for the collector into a Cloud Storage bucket. This is because the file needs to be available for your instance to use, and it&rsquo;s extremely convenient to have the file available in Google Cloud, because the service account can simply pull the file directly from the bucket.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/storage/browser">https://console.cloud.google.com/storage/browser</a>, and, as always, make sure you have the right project selected before clicking <strong>Create bucket</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-storage-bucket.jpg" title="Create storage bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-storage-bucket.jpg" layout="responsive" alt="Create storage bucket" height="465" width="1320"></amp-img>
  
    </a>
  


<p><strong>(2)</strong> Give the bucket a descriptive (and unique) name, such as <code>snowplow-yourname-collector-bucket</code>.</p>

<p><strong>(3)</strong> You can leave the rest of the settings with their default values, then click <strong>Create</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-storage-bucket-done.jpg" title="Create storage bucket done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-storage-bucket-done.jpg" layout="responsive" alt="Create storage bucket done" height="622" width="947"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> In the view that opens up, click <strong>Upload files</strong>, find the <code>application.config</code> file you downloaded earlier, and upload it to the bucket.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/upload-file-to-storage.jpg" title="Upload file to storage">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/upload-file-to-storage.jpg" layout="responsive" alt="Upload file to storage" height="682" width="1659"></amp-img>
  
    </a>
  


<p>Good job! You are now ready to connect your GCE instance and fire up the collector!</p>

<h3 id="step-5-ssh-into-the-compute-engine-instance">Step 5: SSH into the Compute Engine instance</h3>

<p>Now that you have the virtual machine running in the cloud, and you have the configuration file uploaded to a Cloud Storage bucket, the next step is to connect to the virtual machine, download all the remaining files, and start the collector.</p>

<blockquote>
<p>It&rsquo;s very simple and trivial to do the following steps using the Google Cloud SDK on your local machine, too. If you want to try it out, follow the relevant steps in <a href="https://github.com/snowplow/snowplow/wiki/GCP:-Setting-up-the-Scala-Stream-Collector#4b-2-via-the-command-line">Snowplow&rsquo;s wiki</a>.</p>
</blockquote>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/compute/instances">https://console.cloud.google.com/compute/instances</a>.</p>

<p><strong>(2)</strong> Click the <strong>SSH</strong> option next to your instance.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/ssh-to-instance.jpg" title="SSH to cloud instance">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/ssh-to-instance.jpg" layout="responsive" alt="SSH to cloud instance" height="251" width="829"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Visit <a href="https://dl.bintray.com/snowplow/snowplow-generic/">https://dl.bintray.com/snowplow/snowplow-generic/</a> and find the file that starts with <code>snowplow_scala_stream_collector_google_pubsub_</code> and check what the latest version number is that doesn&rsquo;t have the <code>rcl</code> suffix. Make note of this version number (e.g. <code>0.14.0</code>), no need to download the file.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/latest-collector.jpg" title="Latest collector version">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/latest-collector.jpg" layout="responsive" alt="Latest collector version" height="309" width="637"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> Next, in the SSH window, run the following commands in order, pressing enter after each command.</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ sudo apt-get update
$ sudo apt-get -y install default-jre
$ sudo apt-get -y install unzip
$ wget https://dl.bintray.com/snowplow/snowplow-generic/snowplow_scala_stream_collector_google_pubsub_&lt;VERSION&gt;.zip
$ gsutil cp gs://&lt;YOUR-BUCKET-NAME&gt;/application.conf .
$ unzip snowplow_scala_stream_collector_google_pubsub_&lt;VERSION&gt;.zip
$ java -jar snowplow-stream-collector-google-pubsub-&lt;VERSION&gt;.jar --config application.conf</code></pre></div>

<p>Replace all instances of <code>&lt;VERSION&gt;</code> with the latest version of the collector ZIP file which you checked in (3).</p>

<p>Replace <code>&lt;YOUR-BUCKET-NAME&gt;</code> with the name you gave the cloud storage bucket in the <a href="#step-4-create-a-storage-bucket-for-your-configuration-file">previous step</a> (e.g. <code>snowplow-yourname-collector-bucket</code>).</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-commands.jpg" title="commands in the cloud instance">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-commands.jpg" layout="responsive" alt="commands in the cloud instance" height="632" width="900"></amp-img>
  
    </a>
  


<p>After running the last command, if all has been configured correctly, you should see the following output in the instance shell:</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/collector-started.jpg" title="Collector started">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/collector-started.jpg" layout="responsive" alt="Collector started" height="105" width="898"></amp-img>
  
    </a>
  


<p>You are now ready to send a test request to the endpoint, after which you can check your Pub/Sub subscription if it received the message!</p>

<h3 id="step-6-send-a-test-request-and-verify-it-was-published-into-pub-sub">Step 6: Send a test request and verify it was published into Pub/Sub</h3>

<p>To send the request, you&rsquo;ll first need to check what the external IP of your Cloud instance is.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/compute/instances">https://console.cloud.google.com/compute/instances</a> and click the Snowplow instance name.</p>

<p><strong>(2)</strong> Copy the IP address from the <strong>External IP</strong> field.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/external-ip.jpg" title="External IP">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/external-ip.jpg" layout="responsive" alt="External IP" height="187" width="938"></amp-img>
  
    </a>
  


<p>The next step requires you to send an HTTP POST request with a specific payload to this IP endpoint. There are many ways to do it - you could use the JavaScript console of the web browser, for example.</p>

<p>My preference for testing HTTP endpoints quickly is to use <a href="https://curl.haxx.se/">curl</a>, which is a command-line tool available in almost any terminal. If you&rsquo;re using an operating system that doesn&rsquo;t come equipped with curl, I recommend downloading and installing it from <a href="https://curl.haxx.se/download.html">here</a>.</p>

<p><strong>(3)</strong> Open the terminal on your local machine, and copy-paste the following command, switching <code>&lt;EXTERNAL_IP&gt;</code> with the actual external IP you copied from the GCE instance settings.</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ curl -d <span class="s2">&#34;&amp;e=pv&amp;page=curl-test&amp;url=http%3A%2F%2Fjust-testing.com&amp;aid=snowplow-test&#34;</span> -X POST http://&lt;EXTERNAL_IP&gt;:8080/com.snowplowanalytics.iglu/v1</code></pre></div>

<p>The payload is very simple - it basically has only four parameters:</p>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>e</code></td>
<td><code>pv</code></td>
<td>Event type, Pageview in this case.</td>
</tr>

<tr>
<td><code>page</code></td>
<td><code>curl-test</code></td>
<td>Page name.</td>
</tr>

<tr>
<td><code>url</code></td>
<td><code>http://just-testing.com</code></td>
<td>Source URL.</td>
</tr>

<tr>
<td><code>aid</code></td>
<td><code>snowplow-test</code></td>
<td>Application ID.</td>
</tr>
</tbody>
</table>

<p>The endpoint is suffixed with <code>/com.snowplowanalytics.iglu/v1</code> to denote the <a href="https://github.com/snowplow/iglu">schema</a> you&rsquo;ll be using for processing and validating the incoming data. Since we&rsquo;re working with the most out-of-the-box solution available for testing purposes, you can use this default schema for now.</p>

<p>Later, we&rsquo;ll use the Google Analytics plugin to simplify things and to send a more complete payload, but for the purposes of testing this will do.</p>

<p><strong>(4)</strong> If everything worked, you should see a status code OK as a response.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/post-response.jpg" title="POST response">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/post-response.jpg" layout="responsive" alt="POST response" height="123" width="995"></amp-img>
  
    </a>
  


<p>Now you can test if your record was published in the <code>good</code> <strong>Pub/Sub topic</strong>. To test this, you need to <strong>pull</strong> the recent records from the topic by using the subscription you created earlier. The easiest way to do this is by using the Google Cloud SDK that you should now have installed and configured on your local machine.</p>

<p><strong>(5)</strong> The command you&rsquo;ll need to use is:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gcloud pubsub subscriptions pull --auto-ack test-good</code></pre></div>

<p>Where <code>test-good</code> is the name you gave to the subscription when you created it. If it worked, you should see the following output:</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/thrift-record.jpg" title="Thrift record">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/thrift-record.jpg" layout="responsive" alt="Thrift record" height="460" width="1450"></amp-img>
  
    </a>
  


<p>Don&rsquo;t worry about the fact that it looks all garbled. This is the request stored in binary <a href="https://github.com/snowplow/snowplow/wiki/Collector-logging-formats#thrift">Thrift</a> format. You should see all sorts of interesting bits and pieces such as your local machine IP address, the User-Agent string (just <code>curl</code> for now), and the data payload itself. If you see all this in the <code>good</code> Pub/Sub topic, it means everything is working!</p>

<p>You have now successfully created a collector behind an HTTP endpoint. You could proceed to the <a href="#prepare-the-etl-step">enrichment stage</a>, but I urge you to first <strong>stop</strong> the GCE instance so you don&rsquo;t accumulate extra costs for having it running.</p>

<p>I also recommend you continue with the next chapter, where you&rsquo;ll learn how to use your own custom domain as an HTTPS-secured endpoint for the collector. Using HTTP is crippling, and you can&rsquo;t really create a production-ready endpoint with a single GCE instance behind the HTTP protocol.</p>

<h2 id="create-an-https-endpoint-with-a-custom-domain-name">Create an HTTPS endpoint with a custom domain name</h2>

<p>This step replaces the previous chapter, effectively. Instead of using an ephemeral, external IP behind the HTTP protocol, we&rsquo;ll assign a <strong>static</strong> IP address to our virtual machine instance. On top of that, we&rsquo;ll configure a custom domain name to point to this static IP, and we&rsquo;ll have everything work behind the HTTPS protocol.</p>

<p>You&rsquo;ll still want to read the previous chapter, though. We&rsquo;ll be doing a lot of similar things here.</p>

<p><strong>IMPORTANT!</strong> If you want to skip reading the previous chapter, then please note that you <strong>must</strong> do steps <a href="#step-1-create-the-config-file">(1)</a> and <a href="#step-4-create-a-storage-bucket-for-your-configuration-file">(4)</a> from the previous chapter before moving on with the HTTPS endpoint.</p>

<p>This is, basically, what the final collector product should look like. You&rsquo;re using a <strong>load balancing</strong> system to automatically scale the instances with incoming traffic, AND you&rsquo;ll be able to avoid pesky cross-protocol errors due to using HTTPS as the sole endpoint. There&rsquo;s the added security, too.</p>

<h3 id="step-1-create-an-instance-template">Step 1: Create an instance template</h3>

<p>Instead of working with a single GCE instance, we&rsquo;ll use a <strong>cluster</strong> of instances that will be scaled up and down automatically with traffic. This will, naturally, reflect on the cost structure of your monthly GCP invoices, so keep an eye on the <a href="https://console.cloud.google.com/home/dashboard">estimated charges in your dashboard</a>.</p>

<p><strong>(1)</strong> If you followed the previous chapter, you can go ahead and delete the GCE instance and the Firewall Rule. You&rsquo;ll start from scratch here.</p>

<p><strong>(2)</strong> You can keep the <code>application.conf</code> file as it is in the storage bucket. The same settings you used in the previous chapter apply here.</p>

<p><strong>(3)</strong> Go to <a href="https://console.cloud.google.com/compute/instanceTemplates/list">https://console.cloud.google.com/compute/instanceTemplates/list</a> and click <strong>Create instance template</strong>.</p>

<p>The <strong>instance template</strong> is what each new virtual machine will use as its &ldquo;template&rdquo;, meaning it will inherit the settings from this template as well as the startup script that will fire up the collector itself.</p>

<p>The steps for the instance template are almost the same as for a single GCE instance from the previous chapter, but let&rsquo;s go over them anyway.</p>

<p><strong>(4)</strong> Give a descriptive name for the instance.</p>

<p><strong>(5)</strong> Make sure the default Compute Engine service account is selected.</p>

<p><strong>(6)</strong> Choose <strong>Set access for each API</strong> in the <strong>Access Scopes</strong> list.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/snowplow-instance-template.jpg" title="Snowplow instance template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/snowplow-instance-template.jpg" layout="responsive" alt="Snowplow instance template" height="546" width="907"></amp-img>
  
    </a>
  


<p><strong>(7)</strong> Scroll down the list to <strong>Cloud Pub/Sub</strong> and choose <strong>Enable</strong>.</p>

<p><strong>(8)</strong> Under <strong>Firewall</strong>, select <strong>Allow HTTP traffic</strong>.</p>

<p><strong>(9)</strong> Expand the <strong>Management, security, disks, networking, sole tenancy</strong> accordion.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-template-settings-2.jpg" title="Instance template settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-template-settings-2.jpg" layout="responsive" alt="Instance template settings" height="165" width="549"></amp-img>
  
    </a>
  


<p><strong>(10)</strong> Scroll down to <strong>Startup script</strong>, and copy-paste the following code within:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#! /bin/bash
</span><span class="cp"></span>sudo apt-get update
sudo apt-get -y install default-jre
sudo apt-get -y install unzip
<span class="nv">archive</span><span class="o">=</span>snowplow_scala_stream_collector_google_pubsub_&lt;VERSION&gt;.zip
wget https://dl.bintray.com/snowplow/snowplow-generic/<span class="nv">$archive</span>
gsutil cp gs://&lt;YOUR-BUCKET-NAME&gt;/application.conf .
unzip <span class="nv">$archive</span>
java -jar snowplow-stream-collector-google-pubsub-&lt;VERSION&gt;.jar --config application.conf <span class="p">&amp;</span></code></pre></div>

<p><strong>(11)</strong> Edit the two instances of <code>&lt;VERSION&gt;</code> with the latest version number you can find for the <code>snowplow_scala_stream_collector_google_pubsub_</code> prefix <a href="https://dl.bintray.com/snowplow/snowplow-generic/">here</a> (don&rsquo;t use the version with the <code>_rcl</code> prefix). At the time of writing, the latest version was <code>0.14.0</code>.</p>

<p><strong>(12)</strong> Replace <code>&lt;YOUR-BUCKET-NAME&gt;</code> with the name of the <a href="https://console.cloud.google.com/storage/browser">Cloud Storage bucket</a> that stores the <code>application.conf</code> file.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/startup-script.jpg" title="Startup script">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/startup-script.jpg" layout="responsive" alt="Startup script" height="316" width="542"></amp-img>
  
    </a>
  


<p>This startup script is run whenever a new instance is built with this template. It loads all the dependencies and the runs the collector Java file.</p>

<p><strong>(13)</strong> Click open the <strong>Networking</strong> tab, scroll to <strong>Network tags</strong>, and add <code>collector</code> as a tag.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/collector-tag.jpg" title="collector tag">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/collector-tag.jpg" layout="responsive" alt="collector tag" height="343" width="515"></amp-img>
  
    </a>
  


<p><strong>(14)</strong> Click <strong>Create</strong> when done.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-template-created.jpg" title="Instance template created">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-template-created.jpg" layout="responsive" alt="Instance template created" height="233" width="1002"></amp-img>
  
    </a>
  


<h3 id="step-2-create-a-firewall-rule">Step 2: Create a firewall rule</h3>

<p>You&rsquo;ll need to create a <strong>Firewall rule</strong> to allow external connections to your GCE instances.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/networking/firewalls/list">https://console.cloud.google.com/networking/firewalls/list</a>, and click <strong>CREATE FIREWALL RULE</strong>.</p>

<p><strong>(2)</strong> Give the rule a name.</p>

<p><strong>(3)</strong> Scroll down to <strong>Target tags</strong>, and type <code>collector</code> in the field.</p>

<p><strong>(4)</strong> In <strong>Source IP ranges</strong>, type <code>0.0.0.0/0</code>.</p>

<p><strong>(5)</strong> Check the box next to <strong>TCP</strong> in the Protocols and ports selection (with <strong>Specified protocols and ports selected</strong>), and type in <code>8080</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/new-firewall-rule.jpg" title="New firewall rule">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/new-firewall-rule.jpg" layout="responsive" alt="New firewall rule" height="556" width="695"></amp-img>
  
    </a>
  


<p><strong>(6)</strong> Click <strong>Create</strong> when ready.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/snowplow-firewall-rule.jpg" title="new snowplow firewall rule">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/snowplow-firewall-rule.jpg" layout="responsive" alt="new snowplow firewall rule" height="265" width="913"></amp-img>
  
    </a>
  


<h3 id="step-2-create-an-instance-group">Step 2: Create an instance group</h3>

<p>Next, we&rsquo;ll need to create an <strong>instance group</strong>, which is used by the load balancer to automatically create new instances when necessary (for scaling reasons or when a previous instance fails for some reason).</p>

<p><strong>(1)</strong> Scroll to <a href="https://console.cloud.google.com/compute/instanceGroups/list">https://console.cloud.google.com/compute/instanceGroups/list</a>, and click <strong>Create instance group</strong>.</p>

<p><strong>(2)</strong> Give the group a descriptive name.</p>

<p><strong>(3)</strong> Feel free to set the <strong>Location</strong> closer to home, if you wish.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-group-settings.jpg" title="Instance group settings">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-group-settings.jpg" layout="responsive" alt="Instance group settings" height="559" width="472"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> Select the instance template you created in the previous step from the <strong>Instance template</strong> selector.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/instance-group-template-selection.jpg" title="Select template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/instance-group-template-selection.jpg" layout="responsive" alt="Select template" height="276" width="615"></amp-img>
  
    </a>
  


<p><strong>(5)</strong> Scroll down to <strong>Health check</strong>, click the menu, and select <strong>Create a health check</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-health-check.jpg" title="Create a health check">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-health-check.jpg" layout="responsive" alt="Create a health check" height="197" width="675"></amp-img>
  
    </a>
  


<p><strong>(6)</strong> Set the following options:</p>

<ul>
<li><strong>Name</strong>: a descriptive name<br /></li>
<li><strong>Protocol</strong>: HTTP<br /></li>
<li><strong>Port</strong>: 8080<br /></li>
<li><strong>Request path</strong>: /health</li>
<li><strong>Check interval</strong>: 10 seconds<br /></li>
<li><strong>Unhealthy threshold</strong>: 3 consecutive failures</li>
</ul>

<p>You can leave the rest of the settings to their default values.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-health-check-new.jpg" title="create new health check">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-health-check-new.jpg" layout="responsive" alt="create new health check" height="484" width="623"></amp-img>
  
    </a>
  


<p><strong>(7)</strong> Click <strong>Save and continue</strong> once finished with the health check settings.</p>

<p><strong>(8)</strong> Click <strong>Create</strong> to finish creating the instance group.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-instance-group.jpg" title="Create a new instance group">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-instance-group.jpg" layout="responsive" alt="Create a new instance group" height="317" width="517"></amp-img>
  
    </a>
  


<p>Once you create the group, you should see it loading for a while, after which you will see that the group has been created and a new instance has already been fired up!</p>

<p>At this point, you can quickly test if the instance is working.</p>

<p><strong>(9)</strong> Browse to <a href="https://console.cloud.google.com/compute/instances">https://console.cloud.google.com/compute/instances</a>, and copy the IP address from the <strong>External IP</strong> field next to the instance created from your instance group.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/external-ip-copy.jpg" title="External IP address copied">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/external-ip-copy.jpg" layout="responsive" alt="External IP address copied" height="247" width="1010"></amp-img>
  
    </a>
  


<p><strong>(10)</strong> Open your terminal software and run the following command:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ curl http://&lt;EXTERNAL_IP_HERE&gt;:8080/health</code></pre></div>

<p>Replace <code>&lt;EXTERNAL_IP_HERE&gt;</code> with the IP address you copied.</p>

<p>You should see a <code>OK</code> message as the response.</p>

<p>Next, try:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ curl http://&lt;EXTERNAL_IP_HERE&gt;:8080/i</code></pre></div>

<p>You should see a garbled GIF response (something like <code>GIF89a????!?,D;</code>).</p>

<p>If you see those two, your instance is working, and you&rsquo;ve successfully created an HTTP endpoint.</p>

<p>Huh? That&rsquo;s exactly what you did in the previous chapter!</p>

<p>But by using <strong>Instance groups</strong> you are now ready for the biggest step here: creating a load balancer.</p>

<h3 id="step-3-create-a-load-balancer">Step 3: Create a load balancer</h3>

<p>The purpose of the load balancer is to automatically scale your system up and down, depending on things like traffic spikes and CPU usage. It works by establishing a single IP address in the public-facing internet, which then tunnels/proxies the traffic to all the necessary internal IP addresses (your GCE instances, basically), without the outside world knowing this.</p>

<p>The other benefit of the load balancer is that we can use it to assign a <strong>static IP address</strong> to the balancer, and with a static IP we can apply our <strong>custom domain name</strong> so that a <strong>Google-managed SSL certificate</strong> can be applied to the endpoint.</p>

<p>So, there&rsquo;s a lot of stuff in this step, pay attention!</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/net-services/loadbalancing/loadBalancers/list">https://console.cloud.google.com/net-services/loadbalancing/loadBalancers/list</a>, and click <strong>Create load balancer</strong>.</p>

<p><strong>(2)</strong> Click <strong>Start configuration</strong> in the <strong>HTTP(S) Load Balancing</strong> panel.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/start-configuration-load-balancer.jpg" title="Load balancer start configuration">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/start-configuration-load-balancer.jpg" layout="responsive" alt="Load balancer start configuration" height="473" width="1061"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Give the load balancer a name, click <strong>Backend configuration</strong>, then <strong>Create or select backend services &amp; backend buckets</strong>, then choose <strong>Backend services -&gt; Create a backend service</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-a-backend-service.jpg" title="Create a backend service">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-a-backend-service.jpg" layout="responsive" alt="Create a backend service" height="391" width="1148"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> Give the backend service a name.</p>

<p><strong>(5)</strong> Leave all the other settings to their default values, but choose the <strong>Instance group</strong> you created earlier from the respective menu. Set <code>8080</code> in the <strong>Port numbers</strong> field, and select the <strong>Health check</strong> you&rsquo;ve also created earlier in the <strong>Health check</strong> menu.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/backend-service-settings.jpg" title="Backend service">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/backend-service-settings.jpg" layout="responsive" alt="Backend service" height="871" width="479"></amp-img>
  
    </a>
  


<p><strong>(6)</strong> Click <strong>Create</strong> when ready.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/load-balancer-backend-ready.jpg" title="Backend configuration ready">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/load-balancer-backend-ready.jpg" layout="responsive" alt="Backend configuration ready" height="391" width="949"></amp-img>
  
    </a>
  


<p><strong>(7)</strong> Click open <strong>Host and path rules</strong>, and make sure the backend service you created is visible in the rule.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/host-and-path-rules.jpg" title="Host and path rules">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/host-and-path-rules.jpg" layout="responsive" alt="Host and path rules" height="284" width="693"></amp-img>
  
    </a>
  


<p><strong>(8)</strong> Next, click <strong>Frontend configuration</strong>.</p>

<p><strong>(9)</strong> Give the frontend service a name.</p>

<p><strong>(10)</strong> Choose <strong>HTTPS</strong> as the <strong>Protocol</strong>.</p>

<p><strong>(11)</strong> Select the <strong>IP Address</strong> list, and click <strong>create IP address</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-ip-address.jpg" title="Create static ip address">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-ip-address.jpg" layout="responsive" alt="Create static ip address" height="462" width="958"></amp-img>
  
    </a>
  


<p><strong>(12)</strong> Choose a name for the IP address and click <strong>RESERVE</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-static-ip.jpg">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-static-ip.jpg" layout="responsive"  height="277" width="527"></amp-img>
  
    </a>
  


<p><strong>(13)</strong> Make sure the new IP address is selected in the frontend configuration, and <strong>copy the IP address to a text editor or something</strong>. You&rsquo;ll need it when configuring the DNS of your custom domain name!</p>

<p><strong>(14)</strong> Make sure <code>443</code> is set as the <strong>Port</strong>.</p>

<p><strong>(15)</strong> In the <strong>Certificates</strong> menu, choose <strong>Create a new certificate</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-a-new-certificate.jpg" title="Create new certificate">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-a-new-certificate.jpg" layout="responsive" alt="Create new certificate" height="297" width="1066"></amp-img>
  
    </a>
  


<p><strong>(16)</strong> Give the new certificate a name.</p>

<p><strong>(17)</strong> Choose <strong>Create Google-managed certificate</strong>.</p>

<p><strong>(18)</strong> Type the name of the domain you will set to point to your collector in the <strong>Domains</strong> field.</p>

<p><strong>(19)</strong> When ready, click <strong>Create</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/create-certificate.jpg" title="Create a certificate">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/create-certificate.jpg" layout="responsive" alt="Create a certificate" height="496" width="680"></amp-img>
  
    </a>
  


<p><strong>(20)</strong> When finished with the frontend configuration, click <strong>Done</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/click-done.jpg" title="Click done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/click-done.jpg" layout="responsive" alt="Click done" height="416" width="991"></amp-img>
  
    </a>
  


<p><strong>(21)</strong> Click <strong>Review and finalize</strong> to see all the changes. You&rsquo;ll probably see that your certificate is still in the <code>PROVISIONING</code> status, because you haven&rsquo;t updated your domain DNS yet.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/review-and-finalize.jpg" title="Review and finalize">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/review-and-finalize.jpg" layout="responsive" alt="Review and finalize" height="561" width="1381"></amp-img>
  
    </a>
  


<p><strong>(22)</strong> When satisfied, click <strong>Create</strong> to create the load balancer.</p>

<h3 id="step-4-configure-your-dns">Step 4: Configure your DNS</h3>

<p>At this point, you need to go to your DNS settings for the custom domain name you want to point to your load balancing collector.</p>

<p>You need to create an <code>A</code> record for the domain name, which points to the <strong>static IP address</strong> you created for the load balancer frontend above. You can set the <code>TTL</code> to something like 600 seconds to see the change quicker.</p>

<p>This is what it would look like in <a href="https://www.godaddy.com/">GoDaddy</a>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/a-record-godaddy.jpg" title="A record Godaddy">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/a-record-godaddy.jpg" layout="responsive" alt="A record Godaddy" height="294" width="878"></amp-img>
  
    </a>
  


<p>Once you&rsquo;ve configured the DNS, it will take a while for the new name to resolve. You can check what the status is by running this in your terminal:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ host tracker.gtmtools.com</code></pre></div>

<p>Replace <code>tracker.gtmtools.com</code> with the domain name you configured in the DNS. If it works, you should see a response with the IP address you configured.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/host-command.jpg" title="Host command run">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/host-command.jpg" layout="responsive" alt="Host command run" height="56" width="344"></amp-img>
  
    </a>
  


<h3 id="step-5-testing-everything">Step 5: Testing everything</h3>

<p>Once you&rsquo;ve configured the domain name and it resolves to the correct IP, you might still need to wait a while for the SSL certificate to be provisioned for the domain name. This might take anywhere from a couple of minutes to some hours, so be patient.</p>

<p>You can check the status of your system by browsing to the <a href="https://console.cloud.google.com/net-services/loadbalancing/loadBalancers/list">load balancer list</a> and clicking the load balancer you created.</p>

<p>The frontend should show a green checkmark next to your certificate name to indicate that the certificate has been assigned.</p>

<p>In the backend service, you should see one healthy instance created.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/check-load-balancer.jpg" title="Check load balancer">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/check-load-balancer.jpg" layout="responsive" alt="Check load balancer" height="556" width="1039"></amp-img>
  
    </a>
  


<p>If all is fine, the next step is to test the endpoint itself. Open the terminal and run the following command:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ curl -d <span class="s2">&#34;&amp;e=pv&amp;page=https-test&amp;url=https%3A%2F%2Fjust-testing.com&amp;aid=snowplow-test&#34;</span> -X POST https://&lt;CUSTOM_DOMAIN&gt;/com.snowplowanalytics.iglu/v1</code></pre></div>

<p>Replace <code>&lt;CUSTOM_DOMAIN&gt;</code> with the domain name you&rsquo;ve configured to point to the load balancer.</p>

<p>If it worked, you should see an <code>OK</code> response.</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/ok-response.jpg" title="OK Response">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/ok-response.jpg" layout="responsive" alt="OK Response" height="63" width="1147"></amp-img>
  
    </a>
  


<p>Next, you can try and retrieve the payload from the Pub/Sub topic with:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ gcloud pubsub subscriptions pull --auto-ack test-good</code></pre></div>

<p>You should see something like this as the response:</p>



    <a href="https://www.simoahava.com/amp/images/2018/11/pubsub-test.jpg" title="Pubsub test">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/11/pubsub-test.jpg" layout="responsive" alt="Pubsub test" height="384" width="1514"></amp-img>
  
    </a>
  


<p>If you see that, then congratulations, you now have an HTTPS endpoint for your collector!</p>

<p>If something&rsquo;s wrong, then you&rsquo;ll need to start narrowing down where the problem is. Check your Google Compute Engine pages, make sure there&rsquo;s a healthy GCE instance running. You can even SSH into the instance, browse to the <code>/var/log/</code> directory, and open the <code>daemon.log</code> file for editing to see if there was a problem with the startup script.</p>

<p>Other than that, it&rsquo;s very difficult to say what the likely source of the problem is. Personally, I made many mistakes initially with port configurations and setting up the individual components. But if you follow this guide to the letter, you should be fine.</p>

<p>Sometimes the problem is that you just need to wait for the DNS to resolve and the certificate to be assigned to the new domain name. This might take a while.</p>

<p>Next up, <strong>enrichment</strong> and loading the data into <strong>BigQuery</strong>!</p>

<blockquote>
<p>Note! If you&rsquo;re going to take a break now, remember to <strong>STOP</strong> your GCE instance. You can always restart it when ready to go on. You don&rsquo;t want to accumulate any unwanted costs from having the instance running for no purpose!</p>
</blockquote>

<h2 id="set-up-the-google-analytics-tracker">Set up the Google Analytics tracker</h2>



    <a href="https://www.simoahava.com/amp/images/2018/12/tracker-process.jpg" title="Pub/sub process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/tracker-process.jpg" layout="responsive" alt="Pub/sub process" height="612" width="1364"></amp-img>
  
    </a>
  


<p>Before we go on to enrichment, now is a good time to set up the <strong>tracker</strong>. For this purpose, we&rsquo;ll be using the <a href="https://www.simoahava.com/amp/analytics/automatically-fork-google-analytics-hits-snowplow/">Snowplow Google Analytics plugin</a>, because it&rsquo;s an easy way to leverage existing tracking on your site. If you want, feel free to use the regular <a href="https://github.com/snowplow/snowplow/wiki/javascript-tracker-setup">Snowplow JavaScript tracker</a>.</p>

<p>To begin with, head on over to my <a href="https://www.simoahava.com/amp/tools/customtask-builder/#the-customtask-builder-tool">customTask Builder Tool</a>.</p>

<p><strong>(1)</strong> Click the option labelled <code>Copy Hits to Snowplow Collector Endpoint</code>.</p>

<p><strong>(2)</strong> Click <strong>Copy to clipboard</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/customtask-builder.jpg" title="customtask builder">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/customtask-builder.jpg" layout="responsive" alt="customtask builder" height="1018" width="1936"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Next, in <a href="https://tagmanager.google.com/">Google Tag Manager</a>, create a new <strong>Custom JavaScript variable</strong>, and paste the contents of the clipboard there.</p>

<p><strong>(4)</strong> In the beginning of the code block, remove <code>var _customTask =</code>, so that the first characters of the block are <code>function() {</code>.</p>

<p><strong>(5)</strong> In the end of the block, remove the semicolon that is the very last character of the block.</p>

<p><strong>(6)</strong> Edit the line starting with <code>var snowplowEndpoint = '...';</code> so that the string contains the URL to your collector endpoint.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/snowplow-customtask.jpg" title="Snowplow customtask">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/snowplow-customtask.jpg" layout="responsive" alt="Snowplow customtask" height="646" width="2110"></amp-img>
  
    </a>
  


<p><strong>(7)</strong> Save the variable with some name, e.g. <code>JS - Snowplow duplicator</code>.</p>

<p><strong>(8)</strong> Next, open your <strong>Page View tag</strong>, check <strong>Enable overriding settings in this tag</strong>, scroll down to <strong>More Settings</strong> &gt; <strong>Fields to set</strong>, and add a new field:</p>

<p><strong>Field name</strong>: customTask<br />
<strong>Value</strong>: {{JS - Snowplow duplicator}}</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/fields-to-set.jpg" title="Fields to set">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/fields-to-set.jpg" layout="responsive" alt="Fields to set" height="752" width="2034"></amp-img>
  
    </a>
  


<p>That&rsquo;s it for the tracker. The way it works now is that whenever your Page View tag fires, it will copy the payload to the Snowplow collector endpoint.</p>

<p>If you want, you can publish your container now, after which every visitor to your website will start sending those Page Views to your collector. However, I recommend you use Preview mode for now, so that only <strong>your</strong> Page Views are sent to the collector.</p>

<p>Once the pipeline is up and running, you can start collecting more comprehensive data from your visitors.</p>

<h2 id="prepare-the-etl-step">Prepare the ETL step</h2>



    <a href="https://www.simoahava.com/amp/images/2018/12/etl-process.jpg" title="Pub/sub process">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/etl-process.jpg" layout="responsive" alt="Pub/sub process" height="612" width="1364"></amp-img>
  
    </a>
  


<p>Before moving forward to the extract, transform, and load (ETL) of your collector data, we&rsquo;ll need to do some preparations.</p>

<h3 id="step-1-enable-the-dataflow-api">Step 1: Enable the Dataflow API</h3>

<p>The enrichment process and the BigQuery loader require a new service to be enabled.</p>

<p><strong>(1)</strong> Browse to the <a href="https://console.cloud.google.com/apis/library">API library</a>.</p>

<p><strong>(2)</strong> Search for <code>dataflow</code>, and click the <strong>Dataflow API</strong> selector.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/dataflow-api.jpg" title="Dataflow API">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/dataflow-api.jpg" layout="responsive" alt="Dataflow API" height="904" width="1646"></amp-img>
  
    </a>
  


<p><strong>Cloud Dataflow</strong> lets you enrich a data stream with minimal latency. This is exactly what we need. We need the enricher to pull in events for the <strong>Pub/Sub</strong> topic to which the collector writes them, enrich and shred them to proper format, and write them back into a Pub/Sub topic for BigQuery loading.</p>

<p><strong>(3)</strong> Click the <strong>ENABLE</strong> button in the API page to enable this service.</p>

<h3 id="step-2-create-the-necessary-pub-sub-topics-and-subscriptions">Step 2: Create the necessary Pub/Sub topics and subscriptions</h3>

<p>By now, you should have two <strong>Pub/Sub</strong> topics, <code>good</code> and <code>bad</code> for hits processed by your collector.</p>

<p>We&rsquo;ll need to create a bunch of additional topics and subscriptions for the remaining steps of the pipeline.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/cloudpubsub/topicList">https://console.cloud.google.com/cloudpubsub/topicList</a>.</p>

<p><strong>(2)</strong> Click open the <code>good</code> topic, and click <strong>Create Subscription</strong>. Give the subscription the name <code>good-sub</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/good-sub.jpg" title="good subscription">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/good-sub.jpg" layout="responsive" alt="good subscription" height="686" width="1158"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Next, create the following topics:</p>

<ol>
<li><code>bq-bad-rows</code></li>
<li><code>bq-failed-inserts</code></li>
<li><code>bq-types</code></li>
<li><code>enriched-bad</code></li>
<li><code>enriched-good</code></li>
</ol>

<p><strong>(4)</strong> Then, click open <code>bq-types</code> and create a new subscription for it named <code>bq-types-sub</code>.</p>

<p><strong>(5)</strong> Finally, click open <code>enriched-good</code> and create a new subscription for it named <code>enriched-good-sub</code>.</p>

<p>This is what the <a href="https://console.cloud.google.com/cloudpubsub/topicList">topic list</a> should look like:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/pubsub-topics.jpg" title="pubsub topics">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/pubsub-topics.jpg" layout="responsive" alt="pubsub topics" height="1046" width="1926"></amp-img>
  
    </a>
  


<p>This is what the <a href="https://console.cloud.google.com/cloudpubsub/subscriptions">subscription list</a> should look like:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/subscription-list.jpg" title="Subscription list">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/subscription-list.jpg" layout="responsive" alt="Subscription list" height="546" width="2990"></amp-img>
  
    </a>
  


<p>You can, of course, create additional subscriptions for testing and debugging, but these are what the following steps of the pipeline specifically need.</p>

<h3 id="step-3-create-a-new-storage-bucket-for-temporary-files">Step 3: Create a new storage bucket for temporary files</h3>

<p>You&rsquo;ll need to create a new storage bucket for temporary files created by the enrichment process. But this is a good place to also store some files required by the enrich and load stages.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/storage/browser/">https://console.cloud.google.com/storage/browser/</a>.</p>

<p><strong>(2)</strong> Click <strong>CREATE BUCKET</strong> and create a new bucket with the name <code>snowplow-yourname-temp</code> like so:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/snowplow-temp-bucket.jpg" title="Snowplow temp bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/snowplow-temp-bucket.jpg" layout="responsive" alt="Snowplow temp bucket" height="1080" width="2052"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Click into that bucket and click <strong>Create folder</strong>, and name the new folder <code>temp-files</code>:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/files-folder-bucket.jpg" title="Files folder bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/files-folder-bucket.jpg" layout="responsive" alt="Files folder bucket" height="1088" width="2624"></amp-img>
  
    </a>
  


<h3 id="step-4-create-the-iglu-resolver-json-configuration">Step 4: Create the iglu_resolver.json configuration</h3>

<p>Snowplow uses something called <strong>resolvers</strong> to automatically identify the parameters of each incoming hit. This is necessary for many reasons, the main being hit validation (to identify valid requests from invalid ones), for enriching and shredding the hits to the proper data format, and for mutating and loading the data into BigQuery tables.</p>

<p><strong>(1)</strong> Download the <code>iglu_resolver.json</code> file from <a href="https://raw.githubusercontent.com/snowplow/snowplow/master/3-enrich/config/iglu_resolver.json">here</a> and open it for editing.</p>

<p><strong>(2)</strong> Change the two <code>vendorPrefixes</code> parameters to also include the Google Analytics namespace (<strong>Note!</strong> You don&rsquo;t have to do this if you&rsquo;re using the vanilla Snowplow JavaScript tracker).</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/google-analytics-schema.jpg" title="Google Analytics schema">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/google-analytics-schema.jpg" layout="responsive" alt="Google Analytics schema" height="924" width="1674"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Save the file locally.</p>

<p><strong>(4)</strong> Browse to <a href="https://console.cloud.google.com/storage/browser/">https://console.cloud.google.com/storage/browser/</a>, click open the temporary file bucket you just created, and upload the modified <code>iglu_resolver.json</code> to the root of that bucket (so <strong>not</strong> in the <code>temp-files</code> folder).</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/iglu-resolver.jpg" title="Iglu resolver">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/iglu-resolver.jpg" layout="responsive" alt="Iglu resolver" height="948" width="2424"></amp-img>
  
    </a>
  


<p>With this resolver configuration, you&rsquo;re instructing the enricher and loader that hits using the Google Analytics namespace <em>might</em> be coming in.</p>

<h3 id="step-5-create-a-new-bigquery-dataset">Step 5: Create a new BigQuery dataset</h3>

<p>Before moving on, you&rsquo;ll need to create a new dataset in BigQuery that will hold the table where your data will end up.</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/bigquery">https://console.cloud.google.com/bigquery</a>, and choose your project from the selector to the left. Click <strong>CREATE DATASET</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/create-dataset.jpg" title="Create new dataset">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/create-dataset.jpg" layout="responsive" alt="Create new dataset" height="1230" width="3668"></amp-img>
  
    </a>
  


<p><strong>(2)</strong> Give the dataset an ID, such as <code>snowplow_yourname_dataset</code>, and click <strong>Create dataset</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/dataset-id.jpg" title="Dataset ID">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/dataset-id.jpg" layout="responsive" alt="Dataset ID" height="660" width="1894"></amp-img>
  
    </a>
  


<p><strong>NOTE!</strong> At this point you might want to just create a new table manually and <a href="https://cloud.google.com/bigquery/docs/partitioned-tables">partition</a> that table on the <code>derived_tstamp</code> column. This way the BigQuery table is automatically partitioned by date of the hit, making it easier to manage and query by date.</p>

<p>This guide proceeds without creating a partitioned table just so that you can see how the mutator works.</p>

<h3 id="step-6-create-the-bigquery-configuration-file">Step 6: Create the BigQuery configuration file</h3>

<p><strong>(1)</strong> Open a new file for editing in a <strong>plain text editor</strong>.</p>

<p><strong>(2)</strong> Copy-paste the following within:</p>

<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;schema&#34;</span><span class="p">:</span> <span class="s2">&#34;iglu:com.snowplowanalytics.snowplow.storage/bigquery_config/jsonschema/1-0-0&#34;</span><span class="p">,</span>
    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Snowplow Page View Data&#34;</span><span class="p">,</span>
        <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;Random UUID&gt;&#34;</span><span class="p">,</span>

        <span class="nt">&#34;projectId&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;Your GCP project name&gt;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;datasetId&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;The BigQuery dataset ID&gt;&#34;</span><span class="p">,</span>
        <span class="nt">&#34;tableId&#34;</span><span class="p">:</span> <span class="s2">&#34;pageviews&#34;</span><span class="p">,</span>

        <span class="nt">&#34;input&#34;</span><span class="p">:</span> <span class="s2">&#34;enriched-good-sub&#34;</span><span class="p">,</span>
        <span class="nt">&#34;typesTopic&#34;</span><span class="p">:</span> <span class="s2">&#34;bq-types&#34;</span><span class="p">,</span>
        <span class="nt">&#34;typesSubscription&#34;</span><span class="p">:</span> <span class="s2">&#34;bq-types-sub&#34;</span><span class="p">,</span>
        <span class="nt">&#34;badRows&#34;</span><span class="p">:</span> <span class="s2">&#34;bq-bad-rows&#34;</span><span class="p">,</span>
        <span class="nt">&#34;failedInserts&#34;</span><span class="p">:</span> <span class="s2">&#34;bq-failed-inserts&#34;</span><span class="p">,</span>

        <span class="nt">&#34;load&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;STREAMING_INSERTS&#34;</span><span class="p">,</span>
            <span class="nt">&#34;retry&#34;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>

        <span class="nt">&#34;purpose&#34;</span><span class="p">:</span> <span class="s2">&#34;ENRICHED_EVENTS&#34;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><strong>(3)</strong> Change the value of <code>&quot;id&quot;</code> to a random UUID which you can generate <a href="https://www.uuidgenerator.net/">here</a>. A valid value would be e.g. <code>&quot;3a27d47f-aeaf-4034-84b6-b1e82ca711d6&quot;</code>.</p>

<p><strong>(4)</strong> Change the value of <code>&quot;projectId&quot;</code> to your GCP project ID (e.g. <code>&quot;snowplow-production-simoahava&quot;</code>).</p>

<p><strong>(5)</strong> Change the value of <code>&quot;datasetId&quot;</code> to the ID you just gave your BigQuery dataset, e.g. <code>&quot;snowplow_simoahava_dataset&quot;</code>.</p>

<p><strong>(6)</strong> Make sure the Pub/Sub topic and subscription names correspond with those you created earlier in this chapter.</p>

<p><strong>(7)</strong> Save the file locally as <code>bigquery_config.json</code>.</p>

<p><strong>(8)</strong> Upload it to the temporary file bucket, where you already uploaded <code>iglu_resolver.json</code> to:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/config-uploaded.jpg" title="Config uploaded">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/config-uploaded.jpg" layout="responsive" alt="Config uploaded" height="994" width="2464"></amp-img>
  
    </a>
  


<p><strong>PHEW!</strong> That&rsquo;s all the prep work done. Now you&rsquo;ll need to just get the enricher and the BQ loader up and running in a new virtual instance group!</p>

<h2 id="finalize-the-etl-process">Finalize the ETL process</h2>

<p>For ETL (extraction, transformation, and loading of your collector data), we&rsquo;ll create a new <strong>instance template</strong> for an auto-scaling <strong>instance group</strong>.</p>

<p>You <em>could</em> use the same instance group as your collector, but this is not a sustainable way to run the pipeline, because the data streams from your site to the collector, from your collector to the enricher, and from the enriched stream to the BigQuery loader are vastly asymmetrical.</p>

<p>It will lead to a lot of redundancy and overhead if you have all your eggs in one basket.</p>

<p>Optimally, you&rsquo;d run the enrichment and the BQ loader in their own groups, too, but for the sake of this exercise I&rsquo;ll bunch them together for now.</p>

<h3 id="step-1-create-the-instance-template">Step 1: Create the instance template</h3>

<p>Since you&rsquo;ve done all the preparations in the previous chapter, this final step of the ETL is actually pretty simple. All you&rsquo;ll need to do is create the instance template and fire an instance group off of it.</p>

<p>Well, it&rsquo;s simple <em>to you</em>. It took me hours and hours and hours to get the thing working, so you&rsquo;re welcome!</p>

<p><strong>(1)</strong> Browse to <a href="https://console.cloud.google.com/compute/instanceTemplates/list">https://console.cloud.google.com/compute/instanceTemplates/list</a>, and click <strong>CREATE INSTANCE TEMPLATE</strong>.</p>

<p><strong>(2)</strong> Give the template a name, e.g. <code>snowplow-etl-template</code>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/create-etl-template.jpg" title="Create ETL template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/create-etl-template.jpg" layout="responsive" alt="Create ETL template" height="840" width="2050"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Make sure the <strong>Compute Engine default service account</strong> is selected, and choose <strong>Set access for each API</strong> in the Access scopes list.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/etl-template-api.jpg" title="ETL template API access">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/etl-template-api.jpg" layout="responsive" alt="ETL template API access" height="634" width="1714"></amp-img>
  
    </a>
  


<p><strong>(4)</strong> Change the following API scopes:</p>

<ul>
<li>BigQuery: <strong>Enabled</strong><br /></li>
<li>Cloud Pub/Sub: <strong>Enabled</strong><br /></li>
<li>Compute Engine: <strong>Read Write</strong><br /></li>
<li>Storage: <strong>Read Write</strong></li>
</ul>

<p>Leave the other options with their default values.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/api-scopes.jpg" title="API scopes">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/api-scopes.jpg" layout="responsive" alt="API scopes" height="2002" width="1514"></amp-img>
  
    </a>
  


<p><strong>(5)</strong> Scroll down and click the <strong>Management, security, disks, networking, sole tenancy</strong> accordion heading.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/management-accordion.jpg" title="Management accordion">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/management-accordion.jpg" layout="responsive" alt="Management accordion" height="584" width="1706"></amp-img>
  
    </a>
  


<p><strong>(6)</strong> Under <strong>Automation</strong>, copy-paste the following code into <strong>Startup script</strong>:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#! /bin/bash
</span><span class="cp"></span><span class="nv">enrich_version</span><span class="o">=</span><span class="s2">&#34;0.1.0&#34;</span>
<span class="nv">bq_version</span><span class="o">=</span><span class="s2">&#34;0.1.0&#34;</span>
<span class="nv">bucket_name</span><span class="o">=</span><span class="s2">&#34;&lt;cloud storage bucket name&gt;&#34;</span>
<span class="nv">project_id</span><span class="o">=</span><span class="s2">&#34;&lt;gcp project id&gt;&#34;</span>
<span class="nv">region</span><span class="o">=</span><span class="s2">&#34;&lt;region where to run the dataflow instances&gt;&#34;</span>

sudo apt-get update
sudo apt-get -y install default-jre
sudo apt-get -y install unzip

wget https://dl.bintray.com/snowplow/snowplow-generic/snowplow_beam_enrich_<span class="nv">$enrich_version</span>.zip
unzip snowplow_beam_enrich_<span class="nv">$enrich_version</span>.zip

wget https://dl.bintray.com/snowplow/snowplow-generic/snowplow_bigquery_loader_<span class="nv">$bq_version</span>.zip
unzip snowplow_bigquery_loader_<span class="nv">$bq_version</span>.zip

wget https://dl.bintray.com/snowplow/snowplow-generic/snowplow_bigquery_mutator_<span class="nv">$bq_version</span>.zip
unzip snowplow_bigquery_mutator_<span class="nv">$bq_version</span>.zip

gsutil cp gs://<span class="nv">$bucket_name</span>/iglu_resolver.json .
gsutil cp gs://<span class="nv">$bucket_name</span>/bigquery_config.json .

./beam-enrich-<span class="nv">$enrich_version</span>/bin/beam-enrich --runner<span class="o">=</span>DataFlowRunner --project<span class="o">=</span><span class="nv">$project_id</span> --streaming<span class="o">=</span><span class="nb">true</span> --region<span class="o">=</span><span class="nv">$region</span> --gcpTempLocation<span class="o">=</span>gs://<span class="nv">$bucket_name</span>/temp-files --job-name<span class="o">=</span>beam-enrich --raw<span class="o">=</span>projects/<span class="nv">$project_id</span>/subscriptions/good-sub --enriched<span class="o">=</span>projects/<span class="nv">$project_id</span>/topics/enriched-good --bad<span class="o">=</span>projects/<span class="nv">$project_id</span>/topics/enriched-bad --resolver<span class="o">=</span>iglu_resolver.json

./snowplow-bigquery-mutator-<span class="nv">$bq_version</span>/bin/snowplow-bigquery-mutator create --config <span class="k">$(</span>cat bigquery_config.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span> --resolver <span class="k">$(</span>cat iglu_resolver.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span>

./snowplow-bigquery-mutator-<span class="nv">$bq_version</span>/bin/snowplow-bigquery-mutator listen --config <span class="k">$(</span>cat bigquery_config.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span> --resolver <span class="k">$(</span>cat iglu_resolver.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span> <span class="p">&amp;</span>

./snowplow-bigquery-loader-<span class="nv">$bq_version</span>/bin/snowplow-bigquery-loader --config<span class="o">=</span><span class="k">$(</span>cat bigquery_config.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span> --resolver<span class="o">=</span><span class="k">$(</span>cat iglu_resolver.json <span class="p">|</span> base64 -w <span class="m">0</span><span class="k">)</span> --runner<span class="o">=</span>DataFlowRunner --project<span class="o">=</span><span class="nv">$project_id</span> --region<span class="o">=</span><span class="nv">$region</span> --gcpTempLocation<span class="o">=</span>gs://<span class="nv">$bucket_name</span>/temp-files</code></pre></div>

<p>You&rsquo;ll need to populate the five variables in the beginning of the code block before saving the instance template.</p>

<ul>
<li><code>enrich_version</code>: Get the latest Beam Enrich version number from <a href="https://bintray.com/snowplow/snowplow-generic/snowplow-beam-enrich">here</a>.<br /></li>
<li><code>bq_version</code>: Get the latest BigQuery Loader version number from <a href="https://bintray.com/snowplow/snowplow-generic/snowplow-bigquery-loader">here</a>.<br /></li>
<li><code>bucket_name</code>: Type the name of the storage bucket for temporary files you created earlier.<br /></li>
<li><code>project_id</code>: Type your GCE project ID.<br /></li>
<li><code>region</code>: Choose a region for the Dataflow instances to run in (you need to choose from <a href="https://cloud.google.com/dataflow/docs/concepts/regional-endpoints">this</a> list).</li>
</ul>

<p>Once you&rsquo;ve made the changes to the startup script, click <strong>Create</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/create-etl-instance-template.jpg" title="Create ETL instance template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/create-etl-instance-template.jpg" layout="responsive" alt="Create ETL instance template" height="872" width="918"></amp-img>
  
    </a>
  


<h3 id="step-2-start-up-a-new-instance-group">Step 2: Start up a new instance group</h3>

<p>Now that you have the template created, it&rsquo;s time to create and start an auto-scaling instance group using this template. The idea is that when requests start flooding in, you&rsquo;ll want to fire up new instances for your enrichment and loading steps so that your data collection won&rsquo;t be impacted too severely by latency.</p>

<p><strong>(1)</strong> While still in the <strong>instance template list</strong>, click open the template you just created.</p>

<p><strong>(2)</strong> In the top of the page, click <strong>CREATE INSTANCE GROUP</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/create-instance-group.jpg" title="Create instance group">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/create-instance-group.jpg" layout="responsive" alt="Create instance group" height="316" width="1088"></amp-img>
  
    </a>
  


<p><strong>(3)</strong> Give the new group a descriptive name, such as <code>snowplow-etl-group</code>.</p>

<p><strong>(4)</strong> Choose a region, e.g. <code>europe-west1</code>.</p>

<p><strong>(5)</strong> Make sure the instance template you just created is selected in the <strong>Instance template</strong> menu.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/etl-instance-group.jpg" title="ETL instance group">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/etl-instance-group.jpg" layout="responsive" alt="ETL instance group" height="692" width="1024"></amp-img>
  
    </a>
  


<p><strong>(6)</strong> You can keep the rest of the options with their default values, but if you like, you can set the health check to what you use for the collector instance, too.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/snowplow-health-check.jpg" title="Snowplow health check">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/snowplow-health-check.jpg" layout="responsive" alt="Snowplow health check" height="345" width="863"></amp-img>
  
    </a>
  


<p>When ready, click <strong>Create</strong>.</p>

<h2 id="test-everything">Test everything</h2>

<p>When you create the instance group, it runs the startup script from beginning to end. These are the steps it takes, in order:</p>

<ol>
<li><p>Beam Enrich is started as a new Dataflow job, using <code>iglu_resolver.json</code> for configuration. The Dataflow job essentially starts a new GCE instance group for the job.</p></li>

<li><p>The BigQuery Mutator is run with the <code>create</code> command, and this creates the <code>pageviews</code> table with a simple atomic structure in your BigQuery dataset.</p></li>

<li><p>The Mutator is next run in its own thread with the <code>listen</code> command. This is basically a Java program which listens for incoming, enriched requests being populated in the <code>enriched-good</code> Pub/Sub topic. Each request is parsed for values and data types, and if the <code>pageviews</code> table in BigQuery doesn&rsquo;t have a corresponding column for some value in the request (validated against a schema resolved by the Iglu Resolver), a new column is created.</p></li>

<li><p>Finally, the BigQuery Loader starts up as its own Dataflow GCE instance, and this will load your enriched data into the corresponding columns and rows in your BigQuery table.</p></li>
</ol>

<p><strong>Before starting the debugging</strong>, make sure you&rsquo;re sending some hits from your site to the collector. So browse around, visit different pages, and check the network requests to make sure the requests to your collector are completing successfully.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/tracker-success.jpg" title="Tracker success">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/tracker-success.jpg" layout="responsive" alt="Tracker success" height="359" width="1267"></amp-img>
  
    </a>
  


<h3 id="step-1-check-that-beam-enrich-is-running">Step 1: Check that Beam Enrich is running</h3>

<p>To check if Beam Enrich is running, go to the <a href="https://console.cloud.google.com/dataflow">Dataflow job list</a>. You should see <code>beam-enrich</code> in the list with the status <strong>Running</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/dataflow-jobs.jpg" title="Dataflow jobs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/dataflow-jobs.jpg" layout="responsive" alt="Dataflow jobs" height="254" width="1312"></amp-img>
  
    </a>
  


<h3 id="step-2-check-that-the-mutator-created-the-table">Step 2: Check that the mutator created the table</h3>

<p>To check if the mutator&rsquo;s <code>create</code> command worked, go to your <a href="https://console.cloud.google.com/bigquery">BigQuery dataset</a>, and expand it. You should see a table named <code>pageviews</code> under it, and the table should be populated with a number of columns, such as <code>app_id</code>, <code>etl_tstamp</code>, etc. These columns are the &ldquo;default&rdquo; atomic data columns Snowplow uses.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/bigquery-columns.jpg" title="BigQuery columns">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/bigquery-columns.jpg" layout="responsive" alt="BigQuery columns" height="442" width="1278"></amp-img>
  
    </a>
  


<h3 id="step-3-check-that-the-mutator-creates-additional-columns-where-necessary">Step 3: Check that the mutator creates additional columns where necessary</h3>

<p>Since you are collecting data with the Google Analytics tracker, you should shortly see a bunch of new columns added to the table description.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/google-analytics-columns.jpg" title="Google Analytics columns">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/google-analytics-columns.jpg" layout="responsive" alt="Google Analytics columns" height="285" width="1113"></amp-img>
  
    </a>
  


<h3 id="step-4-check-that-the-bigquery-loader-dataflow-job-started">Step 4: Check that the BigQuery loader Dataflow job started</h3>

<p>Visit the <a href="https://console.cloud.google.com/dataflow">Dataflow job list</a> again. You should see something like <code>main-root-XXXXX-YYYYY</code> in the list with the status <strong>Running</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/dataflow-jobs.jpg" title="Dataflow jobs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/dataflow-jobs.jpg" layout="responsive" alt="Dataflow jobs" height="254" width="1312"></amp-img>
  
    </a>
  


<h3 id="step-5-check-that-data-is-flowing-into-your-bigquery-table">Step 5: Check that data is flowing into your BigQuery table</h3>

<p>Visit your <a href="https://console.cloud.google.com/bigquery">BigQuery dataset/table</a> again, and select the <code>pageviews</code> table.</p>

<p>In the Query editor, type the following query and press <strong>Run query</strong>:</p>

<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">your_dataset_name</span><span class="p">.</span><span class="n">pageviews</span><span class="o">`</span></code></pre></div>

<p>Where <code>your_dataset_name</code> should be replaced with the name of your dataset. You should see a bunch of results returned after the query is complete.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/sql-query.jpg" title="BigQuery sample query">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/sql-query.jpg" layout="responsive" alt="BigQuery sample query" height="654" width="1157"></amp-img>
  
    </a>
  


<h3 id="troubleshooting">Troubleshooting</h3>

<p>You can visit the <a href="https://console.cloud.google.com/compute/instances">VM instances</a> list and SSH directly into the ETL instance.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/instance-ssh.jpg" title="SSH into instance">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/instance-ssh.jpg" layout="responsive" alt="SSH into instance" height="231" width="1281"></amp-img>
  
    </a>
  


<p>There, you can visit <code>/var/log/</code>, and open the file <code>daemon.log</code> for editing with e.g.</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ pico /var/log/daemon.log</code></pre></div>

<p>It&rsquo;s a full log of the the instance&rsquo;s processes. You&rsquo;ll need to run through the log and see where the error is.</p>

<p>There are many things that might have gone wrong, but the most common (in my own experience) are:</p>

<ol>
<li><p>Incorrect access scopes in the instance template - double-check <a href="#step-1-create-the-instance-template">here</a>.</p></li>

<li><p>Typo in <code>iglu_resolver.json</code> or <code>bigquery_config.json</code>, or forgot to add them to the correct cloud storage bucket - double-check <a href="#step-4-create-the-iglu-resolver-json-configuration">resolver here</a> and BigQuery config <a href="#step-6-create-the-bigquery-configuration-file">here</a>.</p></li>

<li><p>Typo in the startup script - double-check <a href="#step-1-create-the-instance-template">here</a>.</p></li>

<li><p>Collector not running - double-check <a href="#step-5-testing-everything">here</a>.</p></li>

<li><p>Impatience - wait 10-15 minutes before trying all the steps above again. It&rsquo;s possible you&rsquo;re just too hasty and the virtual machine instance hasn&rsquo;t started up properly yet.</p></li>
</ol>

<h2 id="final-thoughts">Final thoughts</h2>

<p>It&rsquo;s a long guide, but I still worry if it&rsquo;s detailed enough. I&rsquo;m a bit ashamed at not being able to tell you exactly how you should scale and group your instances, or how you should optimize your load balancing system. But these are things you need to experiment with by yourself, or with the help of a seasoned data engineer. Remember that you can also utilize the <a href="https://snowplowanalytics.com/products/snowplow-insights/">Snowplow Insights service</a> to help you set things up and manage the pipeline!</p>

<p>I very much prefer the GCP user interface over AWS - there&rsquo;s a <strong>flow</strong> to things, and related resources are grouped and linked together in a logical way. It makes moving from one service to another much smoother.</p>

<p>Setting up the pipeline is fun (if you&rsquo;re into that kind of thing), but it does result in a huge data table full of columns and rows of often undecipherable data. One thing I tend to forget is that the real work begins after the pipeline is created. Making sense of the data requires, at the very least, visualization in a tool such as Data Studio, but you might want to look at what Snowplow has to say about data modelling, too.</p>

<p>I think Snowplow&rsquo;s done an impressive job of making it possible create your own analytics pipeline with a fairly manageable cost. There are things that could have been done far more smoothly, such as utilizing <a href="https://cloud.google.com/cloud-build/docs/quickstart-docker">Docker</a> containers <a href="https://github.com/snowplow-incubator/snowplow-bigquery-loader/wiki/Setup-guide#docker-support">offered by Snowplow</a>.</p>

<p>There are many moving parts in the pipeline. For me, personally, the race between different services enriching, shredding, mutating, and loading each incoming request is still a bit of a mystery. Snowplow has services (such as the <a href="https://github.com/snowplow-incubator/snowplow-bigquery-loader/wiki/Setup-guide#forwarder">BigQuery forwarder</a>) that handle these problems, but setting it up was beyond the scope of this guide.</p>

<p>There&rsquo;s also the whole world of enrichments that I deliberately skipped. It&rsquo;s painful to see the columns for e.g. geographical data showing <code>null</code>, but I&rsquo;ll leave those for another guide.</p>

<p>One thing to note is that you should keep a keen eye on projected and actualized costs. Once you&rsquo;ve managed to build the pipeline itself, your next job as a data engineer is to look for optimization opportunities. With a scalable cloud infrastructure, it&rsquo;s important to understand the often strenuous relationship between latency, scale, and cost.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/cost.jpg">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/cost.jpg" layout="responsive"  height="527" width="1297"></amp-img>
  
    </a>
  


<p>I hope this guide has been useful. I also hope it doesn&rsquo;t become outdated too soon.</p>

<p>Huge thanks to <strong>Snowplow</strong> for providing me with help and resources throughout writing this guide. I&rsquo;m especially grateful to <strong>Yali Sassoon</strong> and <strong>Joao Luis</strong> for their support.</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

