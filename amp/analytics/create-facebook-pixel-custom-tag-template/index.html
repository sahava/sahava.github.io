<!doctype html><html ⚡ lang=en-us class=no-js><head><meta charset=utf-8><script async custom-element=amp-youtube src=https://cdn.ampproject.org/v0/amp-youtube-0.1.js></script><script async custom-element=amp-accordion src=https://cdn.ampproject.org/v0/amp-accordion-0.1.js></script><script async custom-element=amp-analytics src=https://cdn.ampproject.org/v0/amp-analytics-0.1.js></script><script async custom-element=amp-sidebar src=https://cdn.ampproject.org/v0/amp-sidebar-0.1.js></script><script async custom-element=amp-social-share src=https://cdn.ampproject.org/v0/amp-social-share-0.1.js></script><script async custom-element=amp-twitter src=https://cdn.ampproject.org/v0/amp-twitter-0.1.js></script><script async custom-element=amp-iframe src=https://cdn.ampproject.org/v0/amp-iframe-0.1.js></script><script async src=https://cdn.ampproject.org/v0.js></script><style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom>.type-simmer{padding:8px;background:rgba(179,138,197,.2);box-shadow:2px 2px 1px #ccc;border-radius:5px}/*!normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css*/html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{display:none;text-indent:-9999px;visibility:hidden}.inner{margin:0 auto;max-width:710px;position:relative;width:80%}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{background:#fff;min-height:100%;position:relative;transition:transform .5s ease;z-index:10}html{font-size:62.5%;-webkit-tap-highlight-color:transparent}body,html{height:100%;max-height:100%}body{color:#3a4145;font-family:Merriweather,serif;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-size:1.8rem;letter-spacing:.01rem;line-height:1.75em;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{color:#2e2e2e;font-family:Open Sans,sans-serif;-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;line-height:1.15em;margin:0 0 .4em;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{clear:left;float:left;font-weight:700;overflow:hidden;text-align:right;text-overflow:ellipsis;white-space:nowrap;width:180px}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{border:0;border-top:1px solid #efefef;display:block;height:1px;margin:3.2em 0;padding:0}blockquote{border-left:.4em solid #4a4a4a;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em}blockquote p{font-style:italic;margin:.8em 0}blockquote small{color:#ccc;display:inline-block;font-size:.9em;margin:.8em 0 .8em 1.5em}blockquote small:before{content:"— "}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{border:1px solid #e3edf3;border-radius:2px;font-size:.85em;padding:1px 3px;white-space:pre-wrap}code,pre,tt{background:#f7fafb;font-family:Inconsolata,monospace,sans-serif}pre{border:1px solid #e3edf3;border-radius:3px;box-sizing:border-box;font-size:.9em;margin:0 0 1.75em;overflow:auto;padding:10px;white-space:pre;width:100%}pre code,pre tt{background:0 0;border:none;font-size:inherit;padding:0;white-space:pre-wrap}kbd{background:#f4f4f4;border:1px solid #ccc;border-radius:4px;box-shadow:0 1px rgba(0,0,0,.2),inset 0 1px #fff;color:#666;display:inline-block;font-size:.9em;font-weight:700;margin-bottom:.4em;padding:1px 8px;text-shadow:#fff 0 1px 0}table{background-color:transparent;box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%}table td,table th{border-top:1px solid #efefef;line-height:20px;padding:8px;text-align:left;vertical-align:top}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:0 0}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{background:#222 no-repeat 50%;background-size:cover;display:table;height:100vh;margin-bottom:5rem;overflow:hidden;position:relative;text-align:center;width:100%}.main-header.cover{background-image:url(https://www.simoahava.com/images/maisema.jpg)}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{margin:0 0 30px;padding:35px 40px;position:relative}.main-nav a{font-family:Open Sans,sans-serif;text-decoration:none}.scroll-down{animation:bounce 4s 2s infinite;bottom:45px;display:block;font-size:1.5em;left:50%;position:absolute;text-align:center;z-index:100}.scroll-down:hover{animation:none;color:#fff}.home-template .main-header:after{background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%);border-radius:100%;bottom:0;content:" ";display:block;height:130px;left:50%;margin-left:-75px;position:absolute;width:150px}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover .scroll-down,.no-cover.main-header:after{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{box-sizing:border-box;height:38px}.menu-button{background:rgba(0,0,0,.1);border:1px solid #bfc8cd;border-radius:3px;color:#9eabb3;display:inline-block;float:right;font-size:12px;line-height:35px;opacity:1;padding:0 15px;text-align:center;text-transform:uppercase;transition:all .5s ease;white-space:nowrap}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent);border:none;height:70px;left:0;position:absolute;right:0;top:0}.no-cover .main-nav.overlay,.no-cover .menu-button{background:0 0}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{background:#fff;border-color:#fff;color:#222}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{color:#fff;font-family:Open Sans,sans-serif;font-size:5rem;font-weight:700;letter-spacing:-1px;margin:10px 0}.page-description{color:hsla(0,0%,100%,.8);font-family:Merriweather,serif;font-size:2rem;font-weight:400;letter-spacing:.01rem;line-height:1.5em;margin:0}.no-cover.main-header{background:#f5f8fa;max-height:40vh;min-height:160px}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{border-color:rgba(0,0,0,.3);color:rgba(0,0,0,.4)}.main-header-content .page-title{animation:fade-in-down .6s;animation-delay:.2s}.main-header-content .page-description{animation:fade-in-down .9s;animation-delay:.1s}.post{border-bottom:1px solid #ebf2f6;margin:4rem auto;max-width:710px;padding-bottom:4rem;position:relative;width:80%;word-wrap:break-word;hyphens:auto}.post-header{padding-bottom:10px}.post:after{background:#fff;border:1px solid #e7eef2;border-radius:100%;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";display:block;height:7px;left:50%;margin-left:-5px;position:absolute;width:7px}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{font-size:.9em;line-height:1.7em;margin:0}.read-more{font-size:.8em;font-style:italic;text-decoration:none}.post-meta{color:#9eabb3;display:block;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;margin:1.75rem 0 0}.author-thumb{border-radius:100%;float:left;height:24px;margin-right:9px;width:24px}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{min-height:77px;padding:.3rem 40px 0 100px;position:relative}.post-date{border-left:1px solid #d5dbde;display:inline-block;font-size:1.3rem;margin-left:8px;padding-left:12px;text-transform:uppercase;white-space:nowrap}.user-image{left:0;position:absolute;top:0}.user-name{display:block;font-weight:700}.user-bio{display:block;font-size:1.4rem;line-height:1.5em;max-width:440px}.publish-meta{padding:4.3rem 0 4rem;position:absolute;right:0;text-align:right;top:0}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{font-size:.8em;text-align:center}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{bottom:10px;box-shadow:0 15px 10px rgba(0,0,0,.7);content:"";height:20%;max-width:480px;position:absolute;width:50%;z-index:-2}figure.polaroid:after{left:auto;right:10px;transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;transform:rotate(-3deg)}figure.polaroid{background:#fff;border:none;border-radius:4px;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);margin-bottom:1.5em;max-width:100%;padding:15px;position:relative;width:450px}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;margin:0;outline:1px solid #ccc;padding:0}figure.polaroid figcaption{font-family:Kaushan Script,cursive;font-size:1.3em;font-weight:400;padding:.8em .5em .4em;text-align:right}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{border-bottom:1px solid #d3d3d3;border-top:1px solid #d3d3d3;font-size:.8em;font-style:italic;margin-top:.5em;padding:.2em;text-align:center}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{font-size:2em;text-decoration:none}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{color:#a2a2a2;font-size:2em;text-decoration:none}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{border:none;margin:0;padding:0}.post-template .content{overflow:hidden}.post-template .post{border-bottom:none;margin-top:0;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{border-top:1px solid #ebf2f6;margin:6rem 0 0;padding:6rem 0 0;position:relative}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{font-size:1.4rem;line-height:1.75em;margin:1rem 0}.author-meta{font-size:1.4rem;font-style:italic;line-height:1;list-style:none;margin:0;padding:0}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;right:0;top:6rem;width:180px}.post-footer .share a{color:#bbc7cc;display:inline-block;font-size:1.8rem;margin:1rem 1.6rem 1.6rem 0;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{background:0 0;height:85px;margin-bottom:0;min-height:0}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{background:0 0;height:10vh;min-height:100px}.author-profile{border-bottom:1px solid #ebf2f6;padding:0 15px 5rem;text-align:center}.author-profile:after{border:1px solid #e7eef2;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";height:7px;margin-left:-5px;width:7px}.author-image,.author-profile:after{background:#fff;border-radius:100%;display:block;left:50%;position:absolute}.author-image{box-shadow:0 0 0 1px #e7eef2;box-sizing:border-box;height:80px;margin-left:-40px;overflow:hidden;padding:6px;top:-56px;width:80px;z-index:2}.author-image .img{background-image:url(https://www.simoahava.com/images/simo.png);background-position:50%;background-size:cover;border-radius:100%;display:block;height:100%;position:relative;width:100%}.author-profile .author-image{box-shadow:none;height:120px;left:auto;margin:-100px auto 0;padding:3px;position:relative;top:auto;width:120px}.author-title{margin:1.5rem 0 1rem}.author-bio{color:#50585d;font-size:1.8rem;font-weight:200;letter-spacing:0;line-height:1.5em;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{font-family:Merriweather,serif;font-size:1.7rem;letter-spacing:.01rem;margin:2rem 0}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);color:#909090;font-family:Open Sans,Verdana,sans-serif;font-size:11px;font-weight:700;overflow-y:auto;text-align:left;width:400px}#sidebar .nav-title{color:#fff;font-size:1.5em;font-weight:100;left:30px;position:absolute;text-transform:uppercase;top:45px}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{font-size:10px;height:20px;padding:0;position:absolute;right:25px;top:38px;width:20px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{background:#969696;content:"";height:1px;position:absolute;top:0;top:15px;transition:background .15s ease;width:20px}#sidebar .nav-close:before{transform:rotate(45deg)}#sidebar .nav-close:after{transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{background:0 0;border:none;font-size:2rem;margin:.4em 0 .2em}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open,#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{counter-reset:item;list-style:none;padding:90px 9% 5%}#sidebar li:before{color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item;display:block;float:right;font-size:1.2rem;padding-left:5px;padding-right:4%;text-align:right;vertical-align:bottom}#sidebar li{margin:0}#sidebar li a{display:block;font-size:1.4rem;line-height:1.4;overflow:hidden;padding:.6rem 4%;text-decoration:none;text-overflow:ellipsis;white-space:nowrap}#sidebar li a:after{color:hsla(0,0%,100%,.2);content:" ...............................................................";display:inline-block;margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{border-bottom:1px solid hsla(0,0%,100%,.5);content:" ";height:1px;width:100%}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{background:#fff;border-radius:3px;bottom:30px;box-sizing:border-box;display:block;font-family:Open Sans,sans-serif;font-size:12px;height:38px;left:30px;line-height:35px;padding:0 20px;position:absolute;right:30px;text-align:center;text-decoration:none;text-transform:uppercase;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{color:#9eabb3;font-family:Open Sans,sans-serif;font-size:1.3rem;margin:4rem auto;max-width:710px;position:relative;text-align:center;width:80%}.pagination a{color:#9eabb3;transition:all .2s ease}.newer-posts,.older-posts{border:1px solid #bfc8cd;border-radius:4px;display:inline-block;padding:0 15px;position:absolute;text-decoration:none;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;min-width:100px;padding:2px 0}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{border-color:#98a0a4;color:#889093}.extra-pagination{border-bottom:1px solid #ebf2f6;display:none}.extra-pagination:after{background:#fff;border:1px solid #e7eef2;border-radius:100%;bottom:-5px;box-shadow:0 0 0 5px #fff;content:"";display:block;height:7px;left:50%;margin-left:-5px;position:absolute;width:7px}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{color:#bbc7cc;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;margin:8rem 0 0;padding:.5rem 15px;position:relative}.site-footer a{color:#bbc7cc;font-weight:700;text-decoration:none}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{box-sizing:border-box;height:auto;height:60vh;min-height:240px;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{height:40vh;margin-bottom:15px}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{background:0 0;border-radius:0;padding:0 5px}.menu-button,.menu-button:hover{border-color:transparent;color:#2e2e2e}.menu-button:hover{background:0 0}body.nav-opened .menu-button{background:0 0;border:transparent}.main-nav.overlay a:hover{background:0 0;border-color:transparent;color:#fff}.no-cover .main-nav.overlay{background:0 0}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{margin:2rem auto;width:auto}.post{line-height:1.65em;margin:2rem 16px;padding-bottom:2rem;width:auto}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{margin-bottom:0;padding-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{border-bottom:1px dashed #ebf2f6;margin:0 0 2rem;padding:0 0 1.6rem}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;line-height:1.75em;margin:0}.author-meta li:before{display:none}.newer-posts,.older-posts{margin:10px 0;position:static}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{border:1px solid #777;box-shadow:5px 5px 2px rgba(0,0,0,.4);height:auto;margin-bottom:20px;max-width:100%}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}.badge-primary{background-color:#007bff;color:#fff}.badge{border-radius:.25rem;display:inline-block;font-size:80%;font-weight:700;line-height:1;padding:.25em .4em;text-align:center;vertical-align:middle;white-space:nowrap}</style><link rel=canonical href=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/><meta name=viewport content="width=device-width,minimum-scale=1,initial-scale=1"><link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin=anonymous referrerpolicy=no-referrer><meta name=theme-color content="#ffffff"><title>#GTMTips: Create Facebook Pixel Custom Tag Template | Simo Ahava's blog</title>
<meta property="og:title" content="#GTMTips: Create Facebook Pixel Custom Tag Template"><meta name=description content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager."><meta property="og:description" content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager."><meta property="og:type" content="article"><meta property="og:url" content="https://www.simoahava.com/amp/analytics/create-facebook-pixel-custom-tag-template/"><meta name=twitter:image content="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg"><meta property="og:image" content="https://www.simoahava.com/images/2019/05/create-facebook-pixel-template.jpg"><meta property="article:published_time" content="2019-05-23T15:05:00Z"><meta property="article:modified_time" content="2019-05-23T15:05:00Z"><meta property="og:site_name" content="Simo Ahava's blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development."><meta property="article:section" content="GTM Tips"><meta property="article:tag" content="google tag manager"><meta property="article:tag" content="gtmtips"><meta property="article:tag" content="custom templates"><meta property="article:tag" content="tag templates"><meta name=twitter:card content="summary"><meta itemprop=name content="#GTMTips: Create Facebook Pixel Custom Tag Template"><meta itemprop=description content="How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager."><meta itemprop=datePublished content="2019-05-23T18:05:00+03:00"><meta itemprop=dateModified content="2019-05-23T18:05:00+03:00"><meta itemprop=wordCount content="2532"><meta itemprop=keywords content="Google Tag Manager,Gtmtips,Custom Templates,Tag Templates"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Simo Ahava\u0027s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.","url":"https:\/\/www.simoahava.com\/amp\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"#GTMTips: Create Facebook Pixel Custom Tag Template | Simo Ahava's blog","image":"https:\/\/www.simoahava.com\/images\/2019\/05\/create-facebook-pixel-template.jpg","editor":"Simo Ahava","publisher":{"@type":"Organization","name":"Simo Ahava's blog","logo":{"@type":"ImageObject","url":"https:\/\/www.simoahava.com\/amp\/","height":"393","width":"407"}},"url":"https:\/\/www.simoahava.com\/amp\/analytics\/create-facebook-pixel-custom-tag-template\/","datePublished":"2019-05-23T18:05:00\u002b03:00","dateModified":"2019-05-23T18:05:00\u002b03:00","description":"How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.","author":{"@type":"Person","name":"Simo Ahava"}}</script></head><body><amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials=include></amp-analytics><amp-sidebar id=sidebar layout=nodisplay side=right><h3 class=nav-title>Menu</h3><a href=# class=nav-close on=tap:sidebar.close role=button tabindex=1><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/>Home</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/gtm-tips/>GTM Tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/about-simo-ahava/>About</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tools/>Tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/blog-statistics/>Blog Statistics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/upcoming-talks/>Upcoming Talks</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/custom-templates/>Templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/newsletter/>Newsletter</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/>Full (non-AMP) site</a></li><amp-accordion><section><h3 class=nav-section><i class="fa fa-caret-down section-open" aria-hidden=true></i>
<i class="fa fa-caret-right section-close" aria-hidden=true></i>
Categories</h3><div><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/analytics/>analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/content-management/>content management</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/digital-marketing/>digital marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/google-cloud/>google cloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/gtm-tips/>gtm tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/personal/>personal</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/privacy/>privacy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/seo/>seo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/web-design/>web design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/categories/web-development/>web development</a></li></div></section><section><h3 class=nav-section><i class="fa fa-caret-down section-open" aria-hidden=true></i>
<i class="fa fa-caret-right section-close" aria-hidden=true></i>
Tags</h3><div><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ab-testing/>ab testing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/accelerated-mobile-pages/>accelerated mobile pages</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ad-blocker/>ad blocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/adblocker/>adblocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/add-on/>add-on</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/adwords/>adwords</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/agile/>agile</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/amazon/>amazon</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/amp/>amp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/analytics/>analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/android/>android</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/api/>api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app/>app</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app-engine/>app engine</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/app+web/>app+web</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/approval/>approval</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/apps/>apps</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/apps-script/>apps script</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/array/>array</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/attribution/>attribution</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/audience-design/>audience design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/audit/>audit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/auto-event-tracking/>auto-event tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/auto-link-domains/>auto-link domains</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/aws/>aws</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/azure/>azure</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/basketball/>basketball</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/beforeunload/>beforeunload</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/best-practices/>best practices</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/big-data/>big data</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/bigquery/>bigquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/blogger/>blogger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/bounce-rate/>bounce rate</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/built-in-variables/>built-in variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/calculated-metrics/>calculated metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/callback/>callback</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/campaign-tracking/>campaign tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/celebration/>celebration</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/change-history/>change history</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/chrome/>chrome</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/chrome-extension/>chrome extension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/click-tracking/>click tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/click-variables/>click variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/clickstream/>clickstream</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/client-id/>client id</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/client-template/>client template</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/clientid/>clientid</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cloud-functions/>cloud functions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cloud-run/>cloud run</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cms/>cms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cname/>cname</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conferences/>conferences</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/consent/>consent</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/consent-mode/>consent mode</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container/>container</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container-export/>container export</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/container-snippet/>container snippet</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content/>content</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-analysis/>content analysis</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-blocker/>content blocker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-engagement/>content engagement</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-grouping/>content grouping</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-management/>content management</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-management-system/>content management system</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-security-policy/>content security policy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/content-strategy/>content strategy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/context/>context</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conversion/>conversion</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/conversions-api/>conversions api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookie/>cookie</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookiedomain/>cookiedomain</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cookies/>cookies</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/core-web-vitals/>core web vitals</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/creative/>creative</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cross-domain/>cross-domain</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/cross-domain-tracking/>cross-domain tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/csp/>csp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/css/>css</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/css-selectors/>css selectors</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom/>custom</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-dimension/>custom dimension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-dimensions/>custom dimensions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html/>custom html</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html-tag/>custom html tag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-html-tags/>custom html tags</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-javascript/>custom javascript</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-metrics/>custom metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/custom-templates/>custom templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/customtask/>customtask</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dan-wilkerson/>dan wilkerson</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dashboard/>dashboard</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data/>data</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-collection/>data collection</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-engineering/>data engineering</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-layer/>data layer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-layer-variable/>data layer variable</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-model/>data model</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/data-quality/>data quality</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/datalayer/>datalayer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/debug/>debug</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/debugging/>debugging</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/definition-of-success/>definition of success</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/developer/>developer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/developer-tools/>developer tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/development/>development</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/digital-marketing/>digital marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/docker/>docker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/document.write/>document.write</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dom/>dom</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/duplicate/>duplicate</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/dynamic-content/>dynamic content</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/easter-egg/>easter egg</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ecomemrce/>ecomemrce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ecommerce/>ecommerce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/education/>education</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/element-visibility/>element visibility</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/engagement/>engagement</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/enhanced-ecommerce/>enhanced ecommerce</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/enrichment/>enrichment</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/environments/>environments</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/errors/>errors</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event/>event</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event-listener/>event listener</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/event-listeners/>event listeners</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/eventcallback/>eventcallback</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/events/>events</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/excel/>excel</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/exceptions/>exceptions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/experimentation/>experimentation</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/exploit/>exploit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/extension/>extension</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/facebook/>facebook</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/false/>false</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/family/>family</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/fields-to-set/>fields to set</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firebase/>firebase</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firestore/>firestore</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/firing-rules/>firing rules</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/folders/>folders</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/form/>form</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/form-tracking/>form tracking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/format-value/>format value</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/forms/>forms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/fpid/>fpid</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ga-spy/>ga spy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ga4/>ga4</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gcp/>gcp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gdpr/>gdpr</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google/>google</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-ads/>google ads</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics/>google analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics-4/>google analytics 4</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-analytics-settings/>google analytics settings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-bigquery/>google bigquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-cloud/>google cloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-cloud-platform/>google cloud platform</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-sheets/>google sheets</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-tag/>google tag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-tag-manager/>google tag manager</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-trends/>google trends</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/google-optimize/>google-optimize</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/googletagmanager/>googletagmanager</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/governance/>governance</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtag/>gtag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtag.js/>gtag.js</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm/>gtm</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm-sonar/>gtm sonar</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm-tools/>gtm tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtm360/>gtm360</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/gtmtips/>gtmtips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/guest-post/>guest post</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/guide/>guide</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/hack/>hack</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history/>history</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history-change-trigger/>history change trigger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/history-listener/>history listener</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/hugo/>hugo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/iframe/>iframe</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/intelligent-tracking-prevention/>intelligent tracking prevention</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/internal-traffic/>internal traffic</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ios/>ios</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ip/>ip</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/it-department/>it department</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/itp/>itp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/javascript/>javascript</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/jquery/>jquery</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/klipfolio/>klipfolio</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/learning/>learning</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/lighthouse/>lighthouse</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/links/>links</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/listeners/>listeners</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/local/>local</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/localstorage/>localstorage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/lookup-table/>lookup table</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/macros/>macros</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/marketer/>marketer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/marketing/>marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/measurement-protocol/>measurement protocol</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/meta-description/>meta description</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/metrics/>metrics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/migration/>migration</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/mixcloud/>mixcloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/mobile/>mobile</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/modern-cms/>modern cms</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/modular-architecture/>modular architecture</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/monitor/>monitor</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/navigation/>navigation</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/netbooster/>netbooster</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/new-ui/>new ui</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/node.js/>node.js</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/nodejs/>nodejs</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/non-technical/>non-technical</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/open-source/>open source</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/opt-out/>opt-out</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/owasp/>owasp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/page-load-time/>page load time</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/page-timings/>page timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/parameter-reporting/>parameter reporting</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/penguin/>penguin</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/performance/>performance</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/permissions/>permissions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/persistence/>persistence</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/personal/>personal</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/personal-experience/>personal experience</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/php/>php</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/pii/>pii</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/pitch/>pitch</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/piwik-pro/>piwik pro</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/plugins/>plugins</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/poetry/>poetry</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/postmessage/>postmessage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/ppc/>ppc</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/preview/>preview</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/preview-mode/>preview mode</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/privacy/>privacy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/process/>process</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/proxy/>proxy</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/public-speaking/>public speaking</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/query-string/>query string</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/queue-time/>queue time</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/r/>r</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/race-condition/>race condition</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/reaktor/>reaktor</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/recaptcha/>recaptcha</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/referral/>referral</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/regular-expression/>regular expression</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/release/>release</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/resources/>resources</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/rules/>rules</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/safari/>safari</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sales/>sales</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/samesite/>samesite</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/schema/>schema</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/score-card/>score card</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/scroll-depth/>scroll depth</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search/>search</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-api/>search api</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-engine-optimization/>search engine optimization</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/search-trends/>search trends</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/security/>security</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/selection/>selection</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/seo/>seo</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/seo-report/>seo report</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/serp/>serp</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/server-side/>server-side</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/server-side-tagging/>server-side tagging</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/session/>session</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sessions/>sessions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/sgtm/>sgtm</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/shopify/>shopify</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/simmer/>simmer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/single-page-apps/>single-page apps</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/site-search/>site search</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/site-speed/>site speed</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/slack/>slack</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/snippet/>snippet</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/snowplow/>snowplow</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/social-interactions/>social interactions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/soundcloud/>soundcloud</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/spa/>spa</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/splash-page/>splash page</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/static-site/>static site</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/still-running/>still running</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/storage/>storage</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/support/>support</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/swift/>swift</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/syntax-highlight/>syntax highlight</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-management-solution/>tag management solution</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-management-solutions/>tag management solutions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-sequencing/>tag sequencing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tag-templates/>tag templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tags/>tags</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tasks/>tasks</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/technical-marketing/>technical marketing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/technique/>technique</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/test/>test</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/testing/>testing</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/timer/>timer</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/timings/>timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tips/>tips</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tools/>tools</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracker/>tracker</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracker-object/>tracker object</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/tracking-protections/>tracking protections</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/training/>training</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/transformations/>transformations</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/trigger/>trigger</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/trigger-groups/>trigger groups</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/triggers/>triggers</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/troubleshoot/>troubleshoot</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/undefined/>undefined</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/universal-analytics/>universal analytics</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-id/>user id</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-interface/>user interface</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-permissions/>user permissions</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/user-timings/>user timings</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/v2/>v2</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variable/>variable</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variable-templates/>variable templates</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/variables/>variables</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/videos/>videos</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/visibility/>visibility</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/wcag/>wcag</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/weather/>weather</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/web-design/>web design</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/web-development/>web development</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/webkit/>webkit</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/website-redesign/>website redesign</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/workflow/>workflow</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/workspaces/>workspaces</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/youtube/>youtube</a></li><li class=nav-opened role=presentation><a href=https://www.simoahava.com/amp/tags/zones/>zones</a></li></div></section></amp-accordion></ul></amp-sidebar><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=menu-button on=tap:sidebar.toggle role=button><i class="fa fa-bars" aria-hidden=true></i><span class=menu-button-label>Menu</span></a></nav></header><main class=content role=main><article class="post type-post"><header class=post-header><h1 class=post-title>#GTMTips: Create Facebook Pixel Custom Tag Template</h1><small>How to create a Facebook Pixel template in Google Tag Manager. This guide uses the Templates feature of Google Tag Manager.</small><section class=post-meta><amp-img class=author-thumb src=https://www.simoahava.com/images/simo.png layout=fixed width=24 height=24 alt="Author image"></amp-img>Simo Ahava
in
<a href=https://www.simoahava.com/amp/categories/gtm-tips>GTM Tips</a>
on
<a href=https://www.simoahava.com/amp/tags/google-tag-manager>#google tag manager</a>
, <a href=https://www.simoahava.com/amp/tags/gtmtips>#gtmtips</a>
, <a href=https://www.simoahava.com/amp/tags/custom-templates>#custom templates</a>
, <a href=https://www.simoahava.com/amp/tags/tag-templates>#tag templates</a>
<time class=post-date datetime=2019-05-23T18:05:00+03:00>23 May 2019
</time><span class=post-date><a href=https://www.simoahava.com/analytics/create-facebook-pixel-custom-tag-template/>Non-AMP version</a></span></section></header><section class=post-content><p>After the recent release of <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/>Custom Templates</a> for <a href=https://tagmanager.google.com/>Google Tag Manager</a>, my mind has been occupied by very little else. However, I have a nagging feeling that due to how involved the feature set is, there&rsquo;s still a lot of demystifying that needs to take place before templates are fully embraced by the GTM user base.</p><p>In this article, I want to show you a concrete example of template creation. It&rsquo;s going to be much more ambitious than the simple <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#tag-template-walkthrough>walkthrough</a> I explored in the <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/>main guide</a>. This time, we&rsquo;ll step through creating an actual, functional template that caters to a very specific use case: the <a href=https://developers.facebook.com/docs/facebook-pixel/implementation/>Facebook Pixel</a>.</p><blockquote><p>This article is <strong>not</strong> endorsed by Facebook or supported by them in any capacity, official or unofficial.</p></blockquote><p>We&rsquo;ll stop short of having a perfect representation of the Facebook pixel. However, you&rsquo;ll have all the tools necessary to extend the template to cover all the features you might need and to replicate it with some other third-party vendor code.</p><p>To sweeten the deal, I&rsquo;ve also created <a href=https://youtu.be/5ESEtwq7fxc>a video</a> that goes through the motions, in case it&rsquo;s easier to follow the steps that way.</p><amp-youtube data-videoid=5ESEtwq7fxc layout=responsive height=720 width=1280></amp-youtube><p>I want to give special thanks <strong>Eric Burley</strong> from Google for walking me through some of the intricacies of template APIs.</p><blockquote><p>OK, OK, I <strong>have</strong> actually created the full, feature-ready Facebook Pixel Template for you to enjoy. You can find it in <a href=https://github.com/sahava/GoogleTagManagerTemplates>this GitHub repository</a>.</p></blockquote><article class="post type-simmer"><header class=post-header><h2 class=post-title><a href=https://www.simoahava.com/amp/newsletter/>The Simmer Newsletter</a></h2></header><section class=post-excerpt><p>Follow <a href=https://www.teamsimmer.com/newsletter/>this link</a> to subscribe to the <strong>Simmer Newsletter</strong>! Stay up-to-date with the latest content from Simo Ahava and the <a href=https://www.teamsimmer.com/>Simmer online course platform</a>.</p></section></article><h2 id=tip-99-create-a-facebook-pixel-template>Tip 99: Create a Facebook Pixel template</h2><a href=https://www.simoahava.com/amp/images/2019/05/create-facebook-pixel-template.jpg title="Create Facebook Pixel template"><amp-img src=https://www.simoahava.com/amp/images/2019/05/create-facebook-pixel-template.jpg layout=responsive alt="Create Facebook Pixel template" height=540 width=960></amp-img></a><p><strong>You can download the template export file <a href=https://gist.github.com/sahava/212fdbb6cd4d250fa97eeaa8ba693913>here</a></strong>. Read <a href=https://gist.github.com/sahava/212fdbb6cd4d250fa97eeaa8ba693913>this</a> to find out how to import it into your custom templates. You don&rsquo;t <strong>have</strong> to use the export file, but it might make it easier to walk through the rest of the article.</p><h3 id=what-youll-end-up-with>What you&rsquo;ll end up with</h3><a href=https://www.simoahava.com/amp/images/2019/05/facebook-pixel-template.jpg title="Facebook pixel template"><amp-img src=https://www.simoahava.com/amp/images/2019/05/facebook-pixel-template.jpg layout=responsive alt="Facebook pixel template" height=1398 width=1798></amp-img></a><p>The template has the following features:</p><ol><li><p>Ability to add multiple Pixel IDs, comma-separated. The tag hit will be sent to all the Pixel IDs you specify in the list.</p></li><li><p>Support for four events: <strong>PageView</strong>, <strong>Lead</strong>, <strong>CompleteRegistration</strong>, and <strong>Custom</strong> (the Custom event will let you specify the event name in a text field that appears).</p></li><li><p>Possibility to add any Object Properties to the hit.</p></li><li><p>You can check a box to disable the <a href=https://developers.facebook.com/docs/facebook-pixel/advanced#automatic-configuration>Automatic Configuration</a> of the pixel.</p></li></ol><h3 id=step-1-add-template-information>Step 1: Add template information</h3><p>After creating a new template, this is what the <strong>Info</strong> screen looks like. Remember to enable <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#advanced-settings><strong>Advanced Settings</strong></a> for the editor so that you can edit the <strong>Brand Name</strong> field.</p><a href=https://www.simoahava.com/amp/images/2019/05/facebook-info.jpg title="Facebook info screen"><amp-img src=https://www.simoahava.com/amp/images/2019/05/facebook-info.jpg layout=responsive alt="Facebook info screen" height=752 width=862></amp-img></a><h3 id=step-2-add-fields>Step 2: Add fields</h3><p>The template will have <strong>four</strong> fields.</p><h4 id=field-1-text-input-named-pixelid>Field 1: Text Input named <code>pixelId</code></h4><a href=https://www.simoahava.com/amp/images/2019/05/pixelid-field.jpg title="Pixel ID field"><amp-img src=https://www.simoahava.com/amp/images/2019/05/pixelid-field.jpg layout=responsive alt="Pixel ID field" height=1004 width=1882></amp-img></a><p>Make sure the following <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration>field configurations</a> are enabled for the <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#text-input><strong>Text Input</strong></a> field:</p><ol><li><p><strong>Always in summary</strong>: Checked</p></li><li><p><strong>Display name</strong>: <code>Facebook Pixel ID(s)</code></p></li><li><p><strong>Validation rules</strong>: (see below)</p></li><li><p><strong>Value hint</strong>: <code>e.g. 12345678910</code></p></li></ol><p>For the <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#validation-rules>validation rules</a>, add two different rules:</p><ol><li><p><strong>This value cannot be empty</strong>, with Error message <code>You must provide a Pixel ID</code>.</p></li><li><p><strong>This value must match a regular expression</strong>, with value <code>^[0-9,]+$</code>, and Error message <code>Invalid Pixel ID format</code>.</p></li></ol><p>You can find the Error message by clicking to show <strong>Advanced Settings</strong> for each Validation rule.</p><h4 id=field-2-drop-down-menu-named-eventname>Field 2: Drop-down Menu named <code>eventName</code></h4><a href=https://www.simoahava.com/amp/images/2019/05/eventname-field.jpg title="Eventname field"><amp-img src=https://www.simoahava.com/amp/images/2019/05/eventname-field.jpg layout=responsive alt="Eventname field" height=712 width=1896></amp-img></a><p>Make sure the following <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration>field configurations</a> are enabled for the <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#drop-down-menu><strong>Text Input</strong></a> field:</p><ol><li><p><strong>Always in summary</strong>: Checked</p></li><li><p><strong>Display name</strong>: <code>Event Name</code></p></li><li><p><strong>Nested fields</strong>: (see below)</p></li></ol><p>Add the following menu items:</p><ol><li><p>Item name: <strong>PageView</strong>, Value: <strong>PageView</strong></p></li><li><p>Item name: <strong>Lead</strong>, Value: <strong>Lead</strong></p></li><li><p>Item name: <strong>CompleteRegistration</strong>, Value: <strong>CompleteRegistration</strong></p></li><li><p>Item name: <strong>Custom</strong>, Value: <strong>Custom</strong></p></li></ol><p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <strong>Text Input</strong> field. Name the field <code>customEventName</code>, and choose the <strong>Display name</strong> and <strong>Enabling conditions</strong> field configurations for it.</p><ol><li><p><strong>Display name</strong>: Custom Event Name</p></li><li><p><strong>Enabling conditions</strong>: <code>eventName</code> equals <code>Custom</code></p></li></ol><a href=https://www.simoahava.com/amp/images/2019/05/enabling-conditions.jpg title="enabling conditions"><amp-img src=https://www.simoahava.com/amp/images/2019/05/enabling-conditions.jpg layout=responsive alt="enabling conditions" height=668 width=1812></amp-img></a><p>The enabling condition ensures the Custom Event Name is only shown in case &ldquo;Custom&rdquo; is chosen from the drop-down menu. Cool, huh?</p><h4 id=field-3-group-named-objectproperties>Field 3: Group named <code>objectProperties</code></h4><a href=https://www.simoahava.com/amp/images/2019/05/group-field.jpg title="Group field"><amp-img src=https://www.simoahava.com/amp/images/2019/05/group-field.jpg layout=responsive alt="Group field" height=742 width=1902></amp-img></a><p>The default field configurations should be all you need for this Group field.</p><ol><li><p><strong>Group style</strong>: Collapsible section - Collapsed</p></li><li><p><strong>Display name</strong>: Object Properties</p></li><li><p><strong>Nested fields</strong>: (see below)</p></li></ol><p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#simple-table><strong>Simple Table</strong></a> field. Name the field <code>propertyList</code> and make sure the <strong>&ldquo;New row&rdquo; button text</strong> field configuration is toggled on.</p><p>Add <strong>two</strong> columns to the table. Both should be <strong>Text field</strong> columns.</p><p>The first column should have the following settings:</p><ol><li><p><strong>Column name</strong>: <code>Property Name</code></p></li><li><p><strong>Internal name</strong>: <code>name</code></p></li><li><p><strong>Require column values to be unique</strong>: Checked (this option becomes available when you choose to show <strong>Advanced Settings</strong> for this column)</p></li></ol><p>The second column should have the following settings:</p><ol><li><p><strong>Column name</strong>: <code>Property Value</code></p></li><li><p><strong>Internal name</strong>: <code>value</code></p></li></ol><a href=https://www.simoahava.com/amp/images/2019/05/propertylist-field.jpg title="Property List field"><amp-img src=https://www.simoahava.com/amp/images/2019/05/propertylist-field.jpg layout=responsive alt="Property List field" height=770 width=1628></amp-img></a><p>Finally, set the <strong>&ldquo;New row&rdquo; button text</strong> option to <code>Add property</code>, and leave the <strong>Display name</strong> setting blank.</p><h4 id=field-4-group-named-moresettings>Field 4: Group named <code>moreSettings</code></h4><a href=https://www.simoahava.com/amp/images/2019/05/moresettings-field.jpg title="More settings field"><amp-img src=https://www.simoahava.com/amp/images/2019/05/moresettings-field.jpg layout=responsive alt="More settings field" height=1076 width=1892></amp-img></a><p>Set the following settings for the group:</p><ol><li><p><strong>Group style</strong>: Collapsible section - Collapsed</p></li><li><p><strong>Display name</strong>: <code>More Settings</code></p></li><li><p><strong>Nested fields</strong>: (see below)</p></li></ol><p>Click <strong>Add field</strong> under <strong>Nested fields</strong>, and choose a <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#checkbox><strong>Checkbox</strong></a> field. Name the field <code>disableAutoConfig</code> and make sure the <strong>Help text</strong> field configuration is toggled on.</p><ol><li><p><strong>Checkbox text</strong>: <code>Disable Automatic Configuration</code></p></li><li><p><strong>Help text</strong>: Facebook collects some metadata (e.g. structured data) and user interactions (e.g. clicks) automatically. Check this box to disable this automatic configuration of the pixel.</p></li></ol><h3 id=step-3-edit-code>Step 3: Edit code</h3><p>Step on over to the <strong>Code editor</strong> tab, and replace the contents with the following JavaScript:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>createQueue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;createQueue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>callInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;callInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>aliasInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;aliasInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>copyFromWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;copyFromWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>setInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;setInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>injectScript</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;injectScript&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>makeTableMap</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;makeTableMap&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>initIds</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;_fbq_gtm_ids&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pixelIds</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>pixelId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Utility function to use either fbq.queue[]
</span></span></span><span class=line><span class=cl><span class=c1>// (if the FB SDK hasn&#39;t loaded yet), or fbq.callMethod()
</span></span></span><span class=line><span class=cl><span class=c1>// if the SDK has loaded.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>getFbq</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Return the existing &#39;fbq&#39; global method if available
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>fbq</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>fbq</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fbq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Initialize the &#39;fbq&#39; global method to either use
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// fbq.callMethod or fbq.queue)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>setInWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>callMethod</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq.callMethod.apply&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>callMethod</span><span class=p>)</span> <span class=p>{</span>           
</span></span><span class=line><span class=cl>      <span class=nx>callInWindow</span><span class=p>(</span><span class=s1>&#39;fbq.callMethod.apply&#39;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>       
</span></span><span class=line><span class=cl>      <span class=nx>callInWindow</span><span class=p>(</span><span class=s1>&#39;fbq.queue.push&#39;</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>aliasInWindow</span><span class=p>(</span><span class=s1>&#39;_fbq&#39;</span><span class=p>,</span> <span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Create the fbq.queue
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>createQueue</span><span class=p>(</span><span class=s1>&#39;fbq.queue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>  <span class=c1>// Return the global &#39;fbq&#39; method, created above
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Get reference to the global method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fbq</span> <span class=o>=</span> <span class=nx>getFbq</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Build the fbq() command arguments
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>propertyList</span> <span class=o>?</span> <span class=nx>makeTableMap</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>propertyList</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>!==</span> <span class=s1>&#39;Custom&#39;</span> <span class=o>?</span> <span class=s1>&#39;trackSingle&#39;</span> <span class=o>:</span> <span class=s1>&#39;trackSingleCustom&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>eventName</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>!==</span> <span class=s1>&#39;Custom&#39;</span> <span class=o>?</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>customEventName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Handle multiple, comma-separated pixel IDs,
</span></span></span><span class=line><span class=cl><span class=c1>// and initialize each ID if not done already.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pixelIds</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>pixelId</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>initIds</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>pixelId</span><span class=p>)</span> <span class=o>===</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// If the user has chosen to disable automatic configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>disableAutoConfig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fbq</span><span class=p>(</span><span class=s1>&#39;set&#39;</span><span class=p>,</span> <span class=s1>&#39;autoConfig&#39;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Initialize pixel and store in global array
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fbq</span><span class=p>(</span><span class=s1>&#39;init&#39;</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>initIds</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setInWindow</span><span class=p>(</span><span class=s1>&#39;_fbq_gtm_ids&#39;</span><span class=p>,</span> <span class=nx>initIds</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// Call the fbq() method with the parameters defined earlier
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>fbq</span><span class=p>(</span><span class=nx>command</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>,</span> <span class=nx>eventName</span><span class=p>,</span> <span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>injectScript</span><span class=p>(</span><span class=s1>&#39;https://connect.facebook.net/en_US/fbevents.js&#39;</span><span class=p>,</span> <span class=nx>data</span><span class=p>.</span><span class=nx>gtmOnSuccess</span><span class=p>,</span> <span class=nx>data</span><span class=p>.</span><span class=nx>gtmOnFailure</span><span class=p>,</span> <span class=s1>&#39;fbPixel&#39;</span><span class=p>);</span></span></span></code></pre></div><p>At this point, it&rsquo;s a good idea to take a short breather.</p><p>If you take a close look at the code, you&rsquo;ll see that it&rsquo;s far more complex than what the Facebook pixel snippet is. The reason for this is the <a href=https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#sandboxed-javascript>sandboxed JavaScript</a> that custom templates use. For example, the Facebook snippet creates the global <code>fbq()</code> method with something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>fbq</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>fbq</span><span class=p>.</span><span class=nx>callMethod</span> <span class=o>?</span> 
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>fbq</span><span class=p>.</span><span class=nx>callMethod</span><span class=p>.</span><span class=nx>apply</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>fbq</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>)</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>fbq</span><span class=p>.</span><span class=nx>queue</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>It&rsquo;s a very simple piece of code, which simply passes the arguments you provide to <code>fbq()</code> (e.g. <code>'track', 'PageView'</code>) to one of two places, depending on whether the SDK has loaded yet or not.</p><p>To do this in a custom template is far more complicated. You can&rsquo;t just set a global variable, you need to use an API for that. You can&rsquo;t just check if a global method exists, you need an API for that. And you can&rsquo;t just create the <code>queue</code> property for the <code>fbq()</code> method, you need an API for that.</p><p>So, let&rsquo;s go over block by block to understand what the code does.</p><h4 id=initialize-the-necessary-apis>Initialize the necessary APIs</h4><p>This script needs a handful of APIs, which are initialized with the <code>require()</code> API:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>createQueue</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;createQueue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>callInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;callInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>aliasInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;aliasInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>copyFromWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;copyFromWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>setInWindow</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;setInWindow&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>injectScript</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;injectScript&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>makeTableMap</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;makeTableMap&#39;</span><span class=p>);</span></span></span></code></pre></div><p>I&rsquo;ll explain how they function when we encounter them in the code.</p><h4 id=fetch-list-of-initialized-ids>Fetch list of initialized IDs</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>initIds</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;_fbq_gtm_ids&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pixelIds</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>pixelId</span><span class=p>;</span></span></span></code></pre></div><p>Here we fetch the list of initialized IDs (stored in a custom <code>_fbq_gtm_ids</code> global array), and we also pull in the value, input by the user, of the <code>pixelId</code> field from the template itself.</p><h4 id=utility-to-fetch-the-proper-global-fbq-method>Utility to fetch the proper global <code>fbq</code> method</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>getFbq</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Return the existing &#39;fbq&#39; global method if available
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>fbq</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>fbq</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>fbq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span></span></span></code></pre></div><blockquote><p>NOTE! The <strong>arrow function</strong> is a feature of <a href=https://www.w3schools.com/js/js_es6.asp>ES6</a> supported by Custom Templates. <code>const getFbq = () => {</code> translates to <code>var getFbq = function() {</code> in the older flavor of JavaScript.</p></blockquote><p>The purpose of <code>getFbq</code> is to return a representation of the global <code>fbq</code> method, which passes the arguments to the correct place, similar to how the regular Facebook snippet works.</p><p>The first lines check if <code>fbq</code> has already been created globally, and returns the global method in that case.</p><p>In case the global method does <strong>not</strong> exist, it needs to be created.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=nx>setInWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>callMethod</span> <span class=o>=</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq.callMethod.apply&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>callMethod</span><span class=p>)</span> <span class=p>{</span>           
</span></span><span class=line><span class=cl>      <span class=nx>callInWindow</span><span class=p>(</span><span class=s1>&#39;fbq.callMethod.apply&#39;</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>       
</span></span><span class=line><span class=cl>      <span class=nx>callInWindow</span><span class=p>(</span><span class=s1>&#39;fbq.queue.push&#39;</span><span class=p>,</span> <span class=nx>arguments</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>aliasInWindow</span><span class=p>(</span><span class=s1>&#39;_fbq&#39;</span><span class=p>,</span> <span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span></span></span></code></pre></div><p>Here, the global <code>fbq</code> method is initialized as a new function. This function first checks if the <code>fbq.callMethod</code> method already exists (which means the FB SDK has loaded), and if it does, it passes the arguments sent to the <code>fbq</code> method (e.g. <code>'track', 'PageView'</code>) to this built-in method.</p><p>If the <code>callMethod</code> method has <strong>not</strong> been created yet, then the method passes its arguments to <code>fbq.queue</code> as an array push. The queue is basically a waiting list for pixel request, queued up for the Facebook SDK as it loads over the network. Once the SDK has loaded, it processes the messages in this queue and dispatches them to Facebook.</p><p>The last line makes an alias of the <code>fbq</code> method in another global variable, <code>_fbq</code>. I&rsquo;m not certain why this is necessary, but it is what the Facebook snippet does as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=nx>createQueue</span><span class=p>(</span><span class=s1>&#39;fbq.queue&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>copyFromWindow</span><span class=p>(</span><span class=s1>&#39;fbq&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div><p>The last lines of the <code>setInWindow</code> API call create the <code>fbq.queue</code> global array, before finally returning the current content of the global <code>fbq</code> variable, which is the function you created above.</p><h4 id=prepare-the-fbq-command>Prepare the <code>fbq</code> command</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fbq</span> <span class=o>=</span> <span class=nx>getFbq</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>propertyList</span> <span class=o>?</span> <span class=nx>makeTableMap</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>propertyList</span><span class=p>,</span> <span class=s1>&#39;name&#39;</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>)</span> <span class=o>:</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>command</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>!==</span> <span class=s1>&#39;Custom&#39;</span> <span class=o>?</span> <span class=s1>&#39;trackSingle&#39;</span> <span class=o>:</span> <span class=s1>&#39;trackSingleCustom&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>eventName</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>!==</span> <span class=s1>&#39;Custom&#39;</span> <span class=o>?</span> <span class=nx>data</span><span class=p>.</span><span class=nx>eventName</span> <span class=o>:</span> <span class=nx>data</span><span class=p>.</span><span class=nx>customEventName</span><span class=p>;</span></span></span></code></pre></div><p>These lines first fetch the latest representation of the <code>fbq</code> global method by invoking the <code>getFbq</code> function you <em>just</em> created.</p><p>Next, the contents of the <code>fbq</code> command are built. The <code>makeTableMap</code> API takes your <code>propertyList</code> Simple Table field, and converts each row to a key-value pair, where the key is the first column value (e.g. <code>content_ids</code>), and the value is the second column value (e.g. <code>123456</code>). It&rsquo;s a really handy API for converting the template table format into what many JavaScript libraries expect.</p><p>The <code>command</code> variable depends on whether you&rsquo;re using a standard event (e.g. PageView or Lead), in which case it is set to <code>trackSingle</code>, or whether you&rsquo;re using the Custom event, in which case it&rsquo;s set to <code>trackSingleCustom</code>.</p><p>The <code>eventName</code> takes either the value of the drop-down menu selection if a standard event is selected, or the value of the <code>customEventName</code> text input field if a Custom event is selected.</p><h4 id=cycle-through-all-pixel-ids-defined-in-tag-and-dispatch-the-commands>Cycle through all Pixel IDs defined in tag, and dispatch the commands</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>pixelIds</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>).</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>pixelId</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>initIds</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>pixelId</span><span class=p>)</span> <span class=o>===</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>disableAutoConfig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fbq</span><span class=p>(</span><span class=s1>&#39;set&#39;</span><span class=p>,</span> <span class=s1>&#39;autoConfig&#39;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>fbq</span><span class=p>(</span><span class=s1>&#39;init&#39;</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>initIds</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>pixelId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>setInWindow</span><span class=p>(</span><span class=s1>&#39;_fbq_gtm_ids&#39;</span><span class=p>,</span> <span class=nx>initIds</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>fbq</span><span class=p>(</span><span class=nx>command</span><span class=p>,</span> <span class=nx>pixelId</span><span class=p>,</span> <span class=nx>eventName</span><span class=p>,</span> <span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>The whole command process is wrapped in an iterator, which loops through all the Pixel IDs the user has added to the tag. The commands are run identically for every single Pixel ID in the tag.</p><p>First, the code checks if the Pixel ID has already been initialized by looking at the contents of the <code>initIds</code> array you created at the very beginning of the code. You don&rsquo;t want to initialize any Pixel ID more than once, or you&rsquo;ll risk running into problems with Facebook&rsquo;s SDK.</p><p>If the pixel hasn&rsquo;t been initialized, then first the <code>autoConfig</code> parameter is set to <code>false</code>, if the user has checked the respective checkbox in the template.</p><p>Next, the <code>fbq('init', pixelId)</code> command is run, after which the Pixel ID is pushed into the array of initialized pixels.</p><p>Finally, the <code>fbq()</code> command is run with the parameters you created previously.</p><h4 id=load-the-facebook-sdk>Load the Facebook SDK</h4><p>The very last line in the code editor loads the Facebook SDK, and signals either <code>data.gtmOnSuccess()</code> or <code>data.gtmOnFailure</code>, depending on whether the SDK load was successful or not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>injectScript</span><span class=p>(</span><span class=s1>&#39;https://connect.facebook.net/en_US/fbevents.js&#39;</span><span class=p>,</span> <span class=nx>data</span><span class=p>.</span><span class=nx>gtmOnSuccess</span><span class=p>,</span> <span class=nx>data</span><span class=p>.</span><span class=nx>gtmOnFailure</span><span class=p>,</span> <span class=s1>&#39;fbPixel&#39;</span><span class=p>);</span></span></span></code></pre></div><h3 id=step-4-permissions>Step 4: Permissions</h3><p>Because you use all these APIs and mess so much with the global namespace, you&rsquo;ll need to add some permissions if you want the template code to run.</p><a href=https://www.simoahava.com/amp/images/2019/05/facebook-permissions.jpg title="Facebook permissions"><amp-img src=https://www.simoahava.com/amp/images/2019/05/facebook-permissions.jpg layout=responsive alt="Facebook permissions" height=1302 width=1914></amp-img></a><p>As you can see, every single global variable you interact with, either directly (via <code>copyFromWindow</code>, <code>callInWindow</code>, etc.) or indirectly (via <code>aliasFromWindow</code>) must be specified in the Permissions list.</p><p>Similarly, the script injection of the SDK itself must be allowed using the appropriate permission.</p><h3 id=test-it>Test it!</h3><p>To test it, <strong>save</strong> the template, then browse to your container&rsquo;s tags, and create a new tag. You should see the Facebook Pixel in the tag menu.</p><a href=https://www.simoahava.com/amp/images/2019/05/choose-facebook-pixel.jpg title="Choose new pixel"><amp-img src=https://www.simoahava.com/amp/images/2019/05/choose-facebook-pixel.jpg layout=responsive alt="Choose new pixel" height=802 width=2082></amp-img></a><p>Next, fill in the fields. Try a couple of different things, such as passing various object properties, using custom events, and adding more than one Pixel ID.</p><a href=https://www.simoahava.com/amp/images/2019/05/test-facebook-pixel.jpg title="test pixel"><amp-img src=https://www.simoahava.com/amp/images/2019/05/test-facebook-pixel.jpg layout=responsive alt="test pixel" height=1224 width=1778></amp-img></a><p>Try also creating more than one tag with the same Pixel ID, to make sure the initialization is done just once per ID.</p><p>Using GTM Preview mode and <a href="https://chrome.google.com/webstore/detail/facebook-pixel-helper/fdgfkebogiimcoedlicjlajpkdmockpc?hl=en">Facebook&rsquo;s Pixel Helper</a>, you should be able to verify that everything is working as it should.</p><a href=https://www.simoahava.com/amp/images/2019/05/facebook-pixel-helper.jpg title="Facebook pixel helper"><amp-img src=https://www.simoahava.com/amp/images/2019/05/facebook-pixel-helper.jpg layout=responsive alt="Facebook pixel helper" height=1200 width=1432></amp-img></a><h2 id=final-thoughts>Final thoughts</h2><p>I hope this article has helped demystify custom templates.</p><p>As you can see, working with the sandboxed JavaScript isn&rsquo;t just a question of copy-pasting some original code and rewriting some method calls. It calls for a different approach completely, especially when working with global variables.</p><p>There are some things I think custom templates should do to improve flexibility. For example, the function wrapper that GTM automatically adds whenever you create a global function is problematic, since there are use cases where you might want to be able to add properties to the global function itself. In its current format, custom templates do not permit this, so you need to use an API like <code>createQueue</code> to establish <code>fbq.queue</code> as an array.</p><p>It would be better if I could just run something like <code>setInWindow('fbq.queue', [])</code>, but right now, <code>setInWindow</code> only allows you to set the variable and not its individual properties.</p><p>Other than that, the benefit of using this over a Custom HTML tag is huge: you&rsquo;re minimizing the risk of code errors due to operating through the template, and you don&rsquo;t need the problematic <code>unsafe-eval</code> directive in your <a href=https://www.simoahava.com/amp/analytics/google-tag-manager-content-security-policy/>Content Security Policy</a>.</p><p>Thanks for reading, and perhaps watching! Let me know in the comments if you have questions about how this whole thing works.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://www.simoahava.com/amp/></a></figure><section class=author><h4>Simo Ahava</h4><p>Husband | Father | Analytics developer</p><div class=author-meta><span class="author-location icon-location">Espoo, Finland</span>
<span class="author-link icon-link"><a href=https://www.simoahava.com/>https://www.simoahava.com/</a></span></div></section><div class=social><amp-social-share type=twitter width=60 height=44></amp-social-share><amp-social-share type=linkedin width=60 height=44></amp-social-share><amp-social-share type=facebook width=60 height=44></amp-social-share></div></footer></article></main></div></body></html>