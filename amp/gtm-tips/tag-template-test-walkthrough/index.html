

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
  .type-simmer {
      padding: 8px;
      background: rgba(179,138,197,0.2);
      box-shadow: 2px 2px 1px #ccc;
      border-radius: 5px;
  }
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}.badge-primary{color:#fff;background-color:#007bff}.badge{display:inline-block;padding:.25em .4em;font-size:80%;font-weight:700;line-height:1;text-align:center;white-space:nowrap;vertical-align:middle;border-radius:.25rem}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/gtm-tips/tag-template-test-walkthrough/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>#GTMTips: Walkthrough of Custom Template Tests | Simo Ahava's blog</title>
        



  

<meta property="og:title" content="#GTMTips: Walkthrough of Custom Template Tests" />
<meta name="description" content="Walkthrough of how to build custom template unit tests for tag templates and for variable templates in Google Tag Manager." />
<meta property="og:description" content="Walkthrough of how to build custom template unit tests for tag templates and for variable templates in Google Tag Manager." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/gtm-tips/tag-template-test-walkthrough/" />

      <meta name="twitter:image" content="https://www.simoahava.com/images/2019/11/walkthrough-custom-template-tests.jpg">  
      <meta property="og:image" content="https://www.simoahava.com/images/2019/11/walkthrough-custom-template-tests.jpg">
    


    
        <meta property="article:published_time" content="2019-11-20T05:00:00Z"/>
    
    
        <meta property="article:modified_time" content="2019-11-20T05:00:00Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="GTM Tips" />
        
    
    
        
            <meta property="article:tag" content="google tag manager" />
        
            <meta property="article:tag" content="gtmtips" />
        
            <meta property="article:tag" content="custom templates" />
        
            <meta property="article:tag" content="testing" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    



<meta itemprop="name" content="#GTMTips: Walkthrough Of Custom Template Tests">
<meta itemprop="description" content="Walkthrough of how to build custom template unit tests for tag templates and for variable templates in Google Tag Manager.">
<meta itemprop="datePublished" content="2019-11-20T07:00:00&#43;02:00" />
<meta itemprop="dateModified" content="2019-11-20T07:00:00&#43;02:00" />
<meta itemprop="wordCount" content="3098">



<meta itemprop="keywords" content="google tag manager,gtmtips,custom templates,testing," />
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava\u0027s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https:\/\/www.simoahava.com\/amp\/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "#GTMTips: Walkthrough Of Custom Template Tests | Simo Ahava's blog",
  "image": "https:\/\/www.simoahava.com\/images\/2019\/11\/walkthrough-custom-template-tests.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.simoahava.com\/images\/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https:\/\/www.simoahava.com\/amp\/gtm-tips\/tag-template-test-walkthrough\/",
  "datePublished": "2019-11-20T07:00:00\u002b02:00",
  "dateModified": "2019-11-20T07:00:00\u002b02:00",
  "description": "Walkthrough of how to build custom template unit tests for tag templates and for variable templates in Google Tag Manager.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/custom-templates/">Templates</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/newsletter/">Newsletter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ab-testing/">ab-testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ad-blocker/">ad-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/azure/">azure</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-template/">client-template</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-run/">cloud-run</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cname/">cname</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent/">consent</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/consent-mode/">consent-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-export/">container-export</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversions-api/">conversions-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/core-web-vitals/">core-web-vitals</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tags/">custom-html-tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer-tools/">developer-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/experimentation/">experimentation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exploit/">exploit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/false/">false</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firestore/">firestore</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fpid/">fpid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga4/">ga4</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-ads/">google-ads</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-4/">google-analytics-4</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag.js/">gtag.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/intelligent-tracking-prevention/">intelligent-tracking-prevention</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/node.js/">node.js</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/parameter-reporting/">parameter-reporting</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/postmessage/">postmessage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview/">preview</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/proxy/">proxy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/queue-time/">queue-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/recaptcha/">recaptcha</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/samesite/">samesite</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/server-side-tagging/">server-side-tagging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/simmer/">simmer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/single-page-apps/">single-page-apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/still-running/">still-running</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/webkit/">webkit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">#GTMTips: Walkthrough of Custom Template Tests</h1>
        <small>Walkthrough of how to build custom template unit tests for tag templates and for variable templates in Google Tag Manager.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/gtm-tips">GTM Tips</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-tag-manager">#google tag manager</a>
    
        , <a href="https://www.simoahava.com/amp/tags/gtmtips">#gtmtips</a>
    
        , <a href="https://www.simoahava.com/amp/tags/custom-templates">#custom templates</a>
    
        , <a href="https://www.simoahava.com/amp/tags/testing">#testing</a>
    


<time class="post-date" datetime="2019-11-20T07:00:00&#43;02:00">
    20 November 2019
</time>


<span class="post-date"><a href="https://www.simoahava.com/gtm-tips/tag-template-test-walkthrough/">Non-AMP version</a></span>


        </section>
    </header>

    <section class="post-content">
      
        
        
          <p><a href="https://tagmanager.google.com/">Google Tag Manager</a> now lets you add <strong>unit tests</strong> directly to your <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/">custom templates</a>. This is useful, since it allows you to control the code stability of your templates, especially if you&rsquo;ve decided to <a href="https://www.simoahava.com/amp/analytics/introducing-tag-manager-template-gallery/">share those templates with the public</a>.</p>
<p>I recently shared <a href="https://www.simoahava.com/amp/analytics/writing-tests-for-custom-templates-google-tag-manager/">a general guide</a> for how template tests work, but I wanted to expand the topic a little, and share with you two walkthroughs of custom template tests: one for a <strong>variable template</strong> and one for a <strong>tag template</strong>.</p>
<p>There&rsquo;s a <a href="https://youtu.be/UZ8vyFbYJcY">video</a> if you prefer a more visual way to walk through these steps.</p>
<amp-youtube data-videoid="UZ8vyFbYJcY" layout="responsive" height="720" width="1280"></amp-youtube>


        
        <article class="post type-simmer">
    <header class="post-header">
        <h2 class="post-title"><a href="https://www.simoahava.com/amp/newsletter/">The Simmer Newsletter</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
	Follow <a href="https://www.teamsimmer.com/newsletter/">this link</a> to subscribe to the <strong>Simmer Newsletter</strong>! Stay up-to-date with the latest content from Simo Ahava and the <a href="https://www.teamsimmer.com/">Simmer online course platform</a>.
      </p>
      </section>
</article>

        
          <h2 id="tip-107-how-to-build-tag-and-variable-template-tests">Tip 107: How to build tag and variable template tests</h2>


    <a href="https://www.simoahava.com/amp/images/2019/11/walkthrough-custom-template-tests.jpg" title="Walkthrough of custom template tests">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/11/walkthrough-custom-template-tests.jpg" layout="responsive" alt="Walkthrough of custom template tests" height="540" width="960"></amp-img>
  
    </a>
  

<p>Let&rsquo;s get started. We&rsquo;ll kick things off with a <strong>variable template</strong>.</p>
<h3 id="variable-template-string-from-array-of-objects">Variable template: String from array of objects</h3>
<p>This walkthrough will utilize my <a href="https://tagmanager.google.com/gallery/#/owners/gtm-templates-simo-ahava/templates/string-from-array-of-objects">String from array of objects</a> template.</p>


    <a href="https://www.simoahava.com/amp/images/2019/11/string-from-array-objects.jpg" title="String from array of templates">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/11/string-from-array-objects.jpg" layout="responsive" alt="String from array of templates" height="572" width="926"></amp-img>
  
    </a>
  

<p>The template is very simple. It takes a GTM variable as an input, where the variable must return an <strong>array of objects</strong> (e.g. <code>[{id: '123'},{id: '234'}]</code>).</p>
<p>Then, the user specifies which property from the objects they want to concatenate the values of into a string (e.g. <code>id</code>), and finally they can specify a <strong>delimiter</strong> other than <code>,</code>. The end result would be something like <code>'123,234'</code> if following the example from the previous paragraph.</p>
<p>Here is the template code in all its simplicity:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">callInWindow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;callInWindow&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">getType</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;getType&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">inputArray</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">inputArray</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">keyToConcatenate</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">keyToConcatenate</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">delimiter</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">delimiter</span><span class="p">;</span>

<span class="c1">// If not an array, return undefined
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">getType</span><span class="p">(</span><span class="nx">inputArray</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;array&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">return</span> <span class="nx">inputArray</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">obj</span> <span class="p">=&gt;</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">keyToConcatenate</span><span class="p">])</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">obj</span> <span class="p">=&gt;</span> <span class="nx">obj</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">delimiter</span><span class="p">);</span>
</code></pre></div>
<p>When we deconstruct the variable code, there are <strong>four</strong> different things that can happen.</p>
<ol>
<li><strong>The input is not an array</strong>, in which case the <code>getType()</code> check succeeds and the variable returns <code>undefined</code>.</li>
<li><strong>The array does not have any objects within</strong>, in which case the <code>.map()</code> and <code>.filter()</code> calls end up returning an empty array, which is then turned into an <strong>empty string</strong> by <code>.join()</code>.</li>
<li><strong>The array has objects but none of them has the specified key</strong>, in which case the <code>.map()</code> and <code>.filter()</code> calls end up returning an empty array, which is then turned into an <strong>empty string</strong> by <code>.join()</code>.</li>
<li><strong>The array has at least one object with the given key</strong>, in which case the variable returns a string where the key values are concatenated into a string using the delimiter.</li>
</ol>
<p>In other words, we need <strong>four tests</strong>.</p>
<h4 id="test-1-return-undefined-if-not-array">Test 1: Return undefined if not array</h4>
<p>If the variable is not an array, the variable returns <code>undefined</code>. To test this, we create a <strong>mock</strong> data object, where we pass a non-array as the input.</p>
<p>This is what the test looks like:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mockData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">inputArray</span><span class="o">:</span> <span class="s1">&#39;notAnArray&#39;</span><span class="p">,</span>
  <span class="nx">keyToConcatenate</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;,&#39;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">variableResult</span> <span class="o">=</span> <span class="nx">runCode</span><span class="p">(</span><span class="nx">mockData</span><span class="p">);</span>

<span class="c1">// Verify that the variable returns a result.
</span><span class="c1"></span><span class="nx">assertThat</span><span class="p">(</span><span class="nx">variableResult</span><span class="p">).</span><span class="nx">isUndefined</span><span class="p">();</span>
</code></pre></div>
<p>The <code>mockData</code> object has the <code>inputArray</code> set to a <strong>string</strong>, which is not an array. This object is passed to <code>runCode()</code>, which executes the variable template <em>as if</em> the user had created the template with the non-array as the input.</p>
<p>Finally, the result of <code>runCode()</code> is asserted by passing the test if the return value of the variable is <code>undefined</code>, by using the <code>isUndefined()</code> assertion.</p>
<h4 id="test-2-return-empty-string-if-no-objects-in-array">Test 2: Return empty string if no objects in array</h4>
<p>In the next test, we need to create a scenario where the user does provide an array (so the <code>getType()</code> check doesn&rsquo;t catch it), but this array will have no objects within. In that case, the variable would return an empty string.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mockData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">inputArray</span><span class="o">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
  <span class="nx">keyToConcatenate</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;,&#39;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">expected</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">variableResult</span> <span class="o">=</span> <span class="nx">runCode</span><span class="p">(</span><span class="nx">mockData</span><span class="p">);</span>

<span class="c1">// Verify that the variable returns a result.
</span><span class="c1"></span><span class="nx">assertThat</span><span class="p">(</span><span class="nx">variableResult</span><span class="p">).</span><span class="nx">isEqualTo</span><span class="p">(</span><span class="nx">expected</span><span class="p">);</span>
</code></pre></div>
<p>Here we use the <code>expected</code> constant to make it easier to manage and read the code. Again, the mock data object is passed to <code>runCode()</code>, and the variable result is then asserted with the <code>isEqualTo()</code> check, this time passing the test if the variable result is exactly an empty string.</p>
<h4 id="test-3-return-empty-string-if-objects-in-array-do-not-have-the-key">Test 3: Return empty string if objects in array do not have the key</h4>
<p>To be fair, this could be bundled up with the previous test, because they test the same lines of code and the end result is the same.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mockData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">inputArray</span><span class="o">:</span> <span class="p">[{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;123&#39;</span><span class="p">},{</span><span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;shoes&#39;</span><span class="p">}],</span>
  <span class="nx">keyToConcatenate</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;,&#39;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">expected</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">variableResult</span> <span class="o">=</span> <span class="nx">runCode</span><span class="p">(</span><span class="nx">mockData</span><span class="p">);</span>

<span class="c1">// Verify that the variable returns a result.
</span><span class="c1"></span><span class="nx">assertThat</span><span class="p">(</span><span class="nx">variableResult</span><span class="p">).</span><span class="nx">isEqualTo</span><span class="p">(</span><span class="nx">expected</span><span class="p">);</span>
</code></pre></div>
<p>As you can see from the mock object, we are looking for the key <code>name</code> in the objects of the array. Neither one of the objects in the <code>inputArray</code> has that key.</p>
<p>Once this mock object is passed to <code>runCode()</code>, the variable code is executed, and the variable ends up returning an empty string. This is asserted by checking the result against the <code>expected</code> value of <code>''</code>.</p>
<h4 id="test-4-return-concatenated-string-with-delimiter-for-valid-object-keys">Test 4: Return concatenated string with delimiter for valid object keys</h4>
<p>The last test is the only <strong>positive</strong> check we need to do.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">mockData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">inputArray</span><span class="o">:</span> <span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;firstName&#39;</span><span class="p">},{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;secondName&#39;</span><span class="p">}],</span>
  <span class="nx">keyToConcatenate</span><span class="o">:</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span>
  <span class="nx">delimiter</span><span class="o">:</span> <span class="s1">&#39;,&#39;</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">expected</span> <span class="o">=</span> <span class="s1">&#39;firstName,secondName&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">variableResult</span> <span class="o">=</span> <span class="nx">runCode</span><span class="p">(</span><span class="nx">mockData</span><span class="p">);</span>

<span class="c1">// Verify that the variable returns a result.
</span><span class="c1"></span><span class="nx">assertThat</span><span class="p">(</span><span class="nx">variableResult</span><span class="p">).</span><span class="nx">isEqualTo</span><span class="p">(</span><span class="nx">expected</span><span class="p">);</span>
</code></pre></div>
<p>This time, the mock data array has two objects, where both have the key <code>name</code>. Thus the <code>expected</code> constant is set to <code>'firstName,secondName'</code>, because that is what we expect the variable to return.</p>
<p>This is asserted with the <code>isEqualTo()</code> check again.</p>
<h3 id="tag-template-user-distributor">Tag template: User distributor</h3>
<p>The second walkthrough will utilize my <a href="https://tagmanager.google.com/gallery/#/owners/gtm-templates-simo-ahava/templates/user-distributor">user distributor</a> template. I wrote about how the template works <a href="https://www.simoahava.com/amp/analytics/user-distributor-tag-template/">here</a>.</p>


    <a href="https://www.simoahava.com/amp/images/2019/11/user-distributor-template.jpg" title="User distributor template">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/11/user-distributor-template.jpg" layout="responsive" alt="User distributor template" height="786" width="924"></amp-img>
  
    </a>
  

<p>The tag template is quite a bit more complex than the variable template above. For one, we have <strong>branching decisions</strong>, and we also have collective <strong>catch-alls</strong> that apply to all branches.</p>
<p>The <strong>user distributor</strong> lets you choose whether to isolate a <strong>single</strong> group or <strong>multiple</strong> groups of users. If a random number matches the distribution you set for either option, the user can be assigned to a group, which is designated by writing a cookie in the browser.</p>
<p>In case the user is already in a group, the code is not executed, and in case the random number does not match a distribution range, the cookie is not written.</p>
<p>So, the scenarios we need to test for are these:</p>
<ol>
<li>If <strong>cookie exists</strong>, i.e. the user has already been assigned to a group, <strong>do nothing</strong>.</li>
<li>If using a <strong>single</strong> distribution, set cookie to <strong>true</strong> if the user is assigned to the group.</li>
<li>If using a <strong>single</strong> distribution, set cookie to <strong>false</strong> if the user is not assigned to the group.</li>
<li>Make sure the <strong>single</strong> distribution cookie is written with the <strong>correct options</strong>.</li>
<li>If using a <strong>multi</strong> distribution, set cookie to the <strong>first group</strong> when the randomizer is within the range.</li>
<li>If using a <strong>multi</strong> distribution, set cookie to the <strong>second group</strong> when the randomizer is within the range.</li>
<li>If using a <strong>multi</strong> distribution, <strong>do not set cookie</strong> if the randomizer is outside all group ranges.</li>
<li>Make sure the <strong>multi</strong> distribution cookie is written with the <strong>correct options</strong>.</li>
</ol>
<p>These eight tests should get 100% coverage for the tag template. And for reference, here is the full tag template code:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">setCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">readCookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">generateRandom</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">makeInteger</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;logToConsole&#39;</span><span class="p">);</span>

<span class="c1">// Percentage accumulation for multi
</span><span class="c1"></span><span class="kd">let</span> <span class="nx">acc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Randomizer
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">rand</span> <span class="o">=</span> <span class="nx">generateRandom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="c1">// User data
</span><span class="c1"></span><span class="kr">const</span> <span class="nx">cookieName</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cookieName</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">cookieDomain</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cookieDomain</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">cookieMaxAge</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cookieExpires</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">single</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">singlePercent</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">multi</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">multiPercent</span><span class="p">;</span>

<span class="c1">// Only run if cookie is not set
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">readCookie</span><span class="p">(</span><span class="nx">cookieName</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// If single distribution
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">single</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">setCookie</span><span class="p">(</span>
      <span class="nx">cookieName</span><span class="p">,</span>
      <span class="p">(</span><span class="nx">rand</span> <span class="o">&lt;=</span> <span class="nx">single</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">),</span>
      <span class="p">{</span>
        <span class="nx">domain</span><span class="o">:</span> <span class="nx">cookieDomain</span><span class="p">,</span>
        <span class="s1">&#39;max-age&#39;</span><span class="o">:</span> <span class="nx">cookieMaxAge</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// If multi distribution
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">multi</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">multi</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">obj</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">acc</span> <span class="o">+=</span> <span class="nx">makeInteger</span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">probability</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">rand</span> <span class="o">&lt;=</span> <span class="nx">acc</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setCookie</span><span class="p">(</span>
          <span class="nx">cookieName</span><span class="p">,</span>
          <span class="nx">obj</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nx">domain</span><span class="o">:</span> <span class="nx">cookieDomain</span><span class="p">,</span>
            <span class="s1">&#39;max-age&#39;</span><span class="o">:</span> <span class="nx">cookieMaxAge</span>
          <span class="p">}</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="nx">data</span><span class="p">.</span><span class="nx">gtmOnSuccess</span><span class="p">();</span>
</code></pre></div>
<p>Let&rsquo;s start with a <strong>test setup</strong>.</p>
<h4 id="setup-initialize-the-mock-objects">Setup: initialize the mock objects</h4>
<p>This time around, we&rsquo;ll be running multiple tests to check different aspects of the same mock data setups. Thus, instead of always initializing the mock objects for each test with (almost) identical values, we can instead create the mock objects in the <strong>Setup</strong> of the test, after which they will be in the scope of all test cases.</p>


    <a href="https://www.simoahava.com/amp/images/2019/11/distributor-test-setup.jpg" title="test setup">
  
    <amp-img src="https://www.simoahava.com/amp/images/2019/11/distributor-test-setup.jpg" layout="responsive" alt="test setup" height="314" width="776"></amp-img>
  
    </a>
  

<p>This is what the setup code looks like:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">mockSingleData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cookieName</span><span class="o">:</span> <span class="s1">&#39;userDistributor&#39;</span><span class="p">,</span>
  <span class="nx">cookieDomain</span><span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
  <span class="nx">cookieExpires</span><span class="o">:</span> <span class="mi">365</span><span class="p">,</span>
  <span class="nx">singlePercent</span><span class="o">:</span> <span class="mi">50</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">mockMultiData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">cookieName</span><span class="o">:</span> <span class="s1">&#39;userDistributor&#39;</span><span class="p">,</span>
  <span class="nx">cookieDomain</span><span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
  <span class="nx">cookieExpires</span><span class="o">:</span> <span class="mi">365</span><span class="p">,</span>
  <span class="nx">multiPercent</span><span class="o">:</span> <span class="p">[{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
    <span class="nx">probability</span><span class="o">:</span> <span class="mi">33</span>
  <span class="p">},{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span>
    <span class="nx">probability</span><span class="o">:</span> <span class="mi">33</span>
  <span class="p">}]</span>
<span class="p">};</span>
</code></pre></div>
<p>The <strong>single</strong> distribution mock sets the cookie <code>userDistributor</code> to <code>'true'</code> if the randomizer generates a number between <strong>1</strong> and <strong>50</strong>. Numbers between <strong>51</strong> and <strong>100</strong> set the cookie value to <code>'false'</code>.</p>
<p>The <strong>multi</strong> distribution mock sets the cookie <code>userDistributor</code> to <code>'A'</code> if the randomizer generates a number between <strong>1</strong> and <strong>33</strong>, to <code>'B'</code> for values between <strong>34</strong> and <strong>66</strong>, and does not set the cookie for values between <strong>67</strong> and <strong>100</strong>.</p>
<p>In both cases, the cookie is written with the <code>'auto'</code> domain, and the expiration is set to <strong>365 days</strong>.</p>
<h4 id="test-1-do-nothing-if-cookie-exists">Test 1: Do nothing if cookie exists</h4>
<p>The first scenario we&rsquo;ll test is what happens if the cookie named <code>userDistributor</code> has already been set. In this case, the template shouldn&rsquo;t really do anything - at least, it shouldn&rsquo;t reset the cookie with a new value.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">true</span><span class="p">]);</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockSingleData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>We use the <code>mock()</code> API here, which lets us fake the result of a custom template API. In this case, we&rsquo;re instructing the template to return the value <code>[true]</code> whenever the <code>getCookieValues</code> API is invoked. The value within the array is inconsequential - all it has to do is return an array with a positive length for the template to believe that the cookie has been set.</p>
<p>Next, the <strong>single</strong> mock data object is passed to <code>runCode()</code>.</p>
<p>After that, we simply check if the code has run by checking which custom template APIs have been called. We can see from the code that <code>generateRandom()</code> and <code>getCookieValues()</code> are called before any checks are done, but <code>makeInteger()</code> and <code>setCookie()</code> are only called if the cookie has not been set yet.</p>
<p>Thus, we can use the <code>wasCalled()</code> and <code>wasNotCalled()</code> APIs to check which branch of the template code was executed.</p>
<p>Finally, we ensure that <code>gtmOnSuccess()</code> was called, since otherwise the tag would stall.</p>
<h4 id="test-2-set-single-cookie-to-true-when-in-distribution">Test 2: Set single cookie to true when in distribution</h4>
<p>The next case we&rsquo;ll test is that the cookie is set to value <code>'true'</code> when the randomizer generates a value that is within the range of the single distribution group probability.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie not called with &#34;true&#34;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockSingleData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>Check out the <code>mock()</code> calls. The first one is similar to the one in the previous test, except this time we have it return an empty array to signify the cookie has <strong>not</strong> been set.</p>
<p>Then, we mock the <code>generateRandom()</code> API to have it return the value <code>50</code>, just to test the upper bound of the distribution range of <code>1...50</code> as set in the mock object within the <strong>Setup</strong> of the test.</p>
<p>The third <code>mock()</code> is interesting! We are mocking <code>setCookie()</code> because a) we don&rsquo;t want it to actually set a cookie, and b) we can use this patch to check what <code>setCookie()</code> was called <em>with</em>. In case <code>setCookie()</code> was not called with the value <code>'true'</code>, we <strong>fail</strong> the test.</p>
<p>You can use the <code>mock()</code> together with <code>fail()</code> to check what APIs have been called with - it&rsquo;s a nice workaround while we wait for <code>wasCalledWith()</code> for the <code>assertApi()</code> API.</p>
<p>Then, we run the code with the mock data object again.</p>
<p>The list of APIs we expect to be called is almost the same as in the previous test, with the exception that now we <strong>expect <code>setCookie()</code></strong> to be called, since the <code>userDistributor</code> cookie does not exist in this scenario.</p>
<p>This test succeeds if the <code>setCookie()</code> API is called with the expected value of <code>'true'</code> for the cookie.</p>
<h4 id="test-3-set-single-cookie-to-false-when-not-in-distribution">Test 3: Set single cookie to false when not in distribution</h4>
<p>This test is basically a mirror of the previous one, except we set a different return value for the <code>generateRandom()</code> mock to ensure the cookie is set with the value <code>'false'</code>. We&rsquo;re using the lower bound of the range (<code>51</code>) just to test the extremes of the algorithm.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">51</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie not called with &#34;false&#34;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockSingleData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>Other than those two changes, the test code is identical to the previous one.</p>
<h4 id="test-4-set-single-cookie-with-correct-options">Test 4: Set single cookie with correct options</h4>
<p>This test is a simple check to make sure that the cookie settings (name, value, domain, and expiration) correspond with those set in the template configuration. It&rsquo;s a solid test to write, because often the little configuration mistakes that don&rsquo;t really break the code are the ones that slip through the cracks when creating incremental updates.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">99</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!==</span> <span class="nx">mockSingleData</span><span class="p">.</span><span class="nx">cookieName</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect cookie name&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie not called with &#34;false&#34;&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">domain</span> <span class="o">!==</span> <span class="nx">mockSingleData</span><span class="p">.</span><span class="nx">cookieDomain</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect cookie domain&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">[</span><span class="s1">&#39;max-age&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">mockSingleData</span><span class="p">.</span><span class="nx">cookieExpires</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect max-age&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockSingleData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>The magic happens in the <code>setCookie()</code> mock. Basically, we fail the test if the <code>setCookie()</code> API is called with values that do not correspond to those we set in the mock data object.</p>
<h4 id="test-5-set-multi-cookie-to-a-when-equal-to-33">Test 5: Set multi cookie to A when equal to 33</h4>
<p>When we start testing the <strong>multi</strong> distribution options, we are basically checking if the randomized number falls into the distributions established in the tag settings.</p>
<p>We&rsquo;ll first test the simplest scenario: the randomizer picks the first group the user defined. We use this by setting it to the upper bound of the first group.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">33</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie not called with &#34;A&#34;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockMultiData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>The setup is very similar to the previous single distribution tests, with the difference that the cookie <strong>value</strong> is now established in the mock data object, and we expect the <code>makeInteger()</code> API to be called for the template test to succeed.</p>
<h4 id="test-6-set-multi-cookie-to-b-when-equal-to-34">Test 6: Set multi cookie to B when equal to 34</h4>
<p>This test is practically identical to the previous one, with the exception that we set the <code>generateRandom()</code> API to return a value that sits within the lower bound of the second group of the mock object, and we modify the <code>setCookie()</code> API to check for the corresponding value (<code>'B'</code>) instead.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">34</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;B&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie not called with &#34;B&#34;&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockMultiData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<h4 id="test-7-do-not-set-multi-cookie-if-not-within-distributions">Test 7: Do not set multi cookie if not within distributions</h4>
<p>In case the randomizer does not fall into any of the probability ranges established in the <strong>multi</strong> distribution settings, the cookie should not be set.</p>
<p>The easiest way to check this is by making sure the <code>setCookie()</code> API was not called. You can do this with <code>assertApi('setCookie').wasNotCalled()</code>, but you can also mock the <code>setCookie()</code> API to <strong>fail</strong> if called. I&rsquo;ve opted to do both just for giggles.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">67</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie should not have been called&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockMultiData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasNotCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>
<p>Here, we generate a random number that is above <strong>66</strong> to make sure the number doesn&rsquo;t belong to any group. Then, we mock <code>setCookie()</code> to fail the test if ever called (regardless of what values it was called with), and we also use <code>assertApi()</code> to pass the test only if the API was not called.</p>
<h4 id="test-8-set-multi-cookie-with-correct-options">Test 8: Set multi cookie with correct options</h4>
<p>This is similar to <strong>Test 4</strong>, since we are just checking that the cookie is set with options that correspond with those configured in the template settings (or in the mock data object as in this case). The test will fail if there are any differences.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">!==</span> <span class="nx">mockMultiData</span><span class="p">.</span><span class="nx">cookieName</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect cookie name&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nx">mockMultiData</span><span class="p">.</span><span class="nx">multiPercent</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect cookie value&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">domain</span> <span class="o">!==</span> <span class="nx">mockMultiData</span><span class="p">.</span><span class="nx">cookieDomain</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect cookie domain&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">[</span><span class="s1">&#39;max-age&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">mockMultiData</span><span class="p">.</span><span class="nx">cookieExpires</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="nx">fail</span><span class="p">(</span><span class="s1">&#39;setCookie called with incorrect max-age&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Call runCode to run the template&#39;s code.
</span><span class="c1"></span><span class="nx">runCode</span><span class="p">(</span><span class="nx">mockMultiData</span><span class="p">);</span>

<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;generateRandom&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;getCookieValues&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;makeInteger&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
<span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;setCookie&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>

<span class="c1">// Verify that the tag finished successfully.
</span><span class="c1"></span><span class="nx">assertApi</span><span class="p">(</span><span class="s1">&#39;gtmOnSuccess&#39;</span><span class="p">).</span><span class="nx">wasCalled</span><span class="p">();</span>
</code></pre></div>

        
          <h2 id="summary">Summary</h2>
<p>In this article, I showed you two walkthroughs for how to write tests for your variable and tag templates.</p>
<p>A good way to get started is to figure out all the branches of your code, and then write tests that check for all the permutations.</p>
<p>To reduce the number of tests you need, make sure you utilize the <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#field-configuration-reference">field configurations</a> (particularly the <a href="https://www.simoahava.com/amp/analytics/custom-templates-guide-for-google-tag-manager/#validation-rules">validation rules</a>) efficiently. By blocking invalid input before the tag or variable can even be saved you&rsquo;re reducing the number of validation checks you need to write (and test for) in the code.</p>
<p>Hopefully we&rsquo;ll get some <strong>test coverage</strong> details into the UI, so that you can plan your tests to cover all possible branches and features of the template code.</p>
<p>Finally, <strong>remember to update the tests when you update the template itself</strong>. Writing and updating tests should become part and parcel of your quality assurance process when writing templates. You owe it to the users who end up installing your template into their Google Tag Manager containers!</p>

        
      
    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>





<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

