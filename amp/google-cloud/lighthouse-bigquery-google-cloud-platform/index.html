

  
    
  


  

<!doctype html>



<html âš¡ lang="en-us" class="no-js">
    <head>

      <meta charset="utf-8">
        <script async custom-element="amp-youtube" src="https://cdn.ampproject.org/v0/amp-youtube-0.1.js"></script><script async custom-element="amp-accordion" src="https://cdn.ampproject.org/v0/amp-accordion-0.1.js"></script><script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script><script async custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js"></script><script async custom-element="amp-social-share" src="https://cdn.ampproject.org/v0/amp-social-share-0.1.js"></script><script async custom-element="amp-twitter" src="https://cdn.ampproject.org/v0/amp-twitter-0.1.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

<script async src="https://cdn.ampproject.org/v0.js"></script>


<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom>
    /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{-webkit-box-sizing:border-box;box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.hidden{text-indent:-9999px;visibility:hidden;display:none}.inner{position:relative;width:80%;max-width:710px;margin:0 auto}.vertical{display:table-cell;vertical-align:middle}.site-wrapper{position:relative;z-index:10;min-height:100%;background:#fff;-webkit-transition:-webkit-transform .5s ease;transition:-webkit-transform .5s ease;transition:transform .5s ease;transition:transform .5s ease,-webkit-transform .5s ease}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body,html{height:100%;max-height:100%}body{font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.8rem;line-height:1.75em;color:#3a4145;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;text-rendering:geometricPrecision}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;color:#2e2e2e;line-height:1.15em;margin:0 0 .4em;font-family:Open Sans,sans-serif;text-rendering:geometricPrecision}h1{font-size:5rem;letter-spacing:-2px;text-indent:-3px}h2{font-size:3.6rem;letter-spacing:-1px}h3{font-size:3rem}h4{font-size:2.5rem}h5,h6{font-size:2rem}a,a:active,a:hover,a:visited{color:#4a4a4a;-webkit-transition:color .3s ease;transition:color .3s ease}a:active,a:hover{color:#111}dl,ol,p,ul{-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;margin:0 0 1.75em;text-rendering:geometricPrecision}ol,ul{padding-left:3rem}ol ol,ol ul,ul ol,ul ul{margin:0 0 .4em;padding-left:2em}dl dt{float:left;width:180px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd,dl dt{margin-bottom:1em}dl dd{margin-left:200px}li{margin:.4em 0}li li{margin:0}hr{display:block;height:1px;border:0;border-top:1px solid #efefef;margin:3.2em 0;padding:0}blockquote{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0 1.75em -2.2em;padding:0 0 0 1.75em;border-left:.4em solid #4a4a4a}blockquote p{margin:.8em 0;font-style:italic}blockquote small{display:inline-block;margin:.8em 0 .8em 1.5em;font-size:.9em;color:#ccc}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:400}mark{background-color:#ffc336}code,tt{padding:1px 3px;font-size:.85em;white-space:pre-wrap;border:1px solid #e3edf3;border-radius:2px}code,pre,tt{font-family:Inconsolata,monospace,sans-serif;background:#f7fafb}pre{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0 0 1.75em;border:1px solid #e3edf3;width:100%;padding:10px;font-size:.9em;white-space:pre;overflow:auto;border-radius:3px}pre code,pre tt{font-size:inherit;white-space:pre-wrap;background:transparent;border:none;padding:0}kbd{display:inline-block;margin-bottom:.4em;padding:1px 8px;border:1px solid #ccc;color:#666;text-shadow:#fff 0 1px 0;font-size:.9em;font-weight:700;background:#f4f4f4;border-radius:4px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 1px 0 0 #fff inset;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 1px 0 0 #fff}table{-webkit-box-sizing:border-box;box-sizing:border-box;margin:1.75em 0;width:100%;max-width:100%;background-color:transparent}table td,table th{padding:8px;line-height:20px;text-align:left;vertical-align:top;border-top:1px solid #efefef}table th{color:#000}table caption+thead tr:first-child td,table caption+thead tr:first-child th,table colgroup+thead tr:first-child td,table colgroup+thead tr:first-child th,table thead:first-child tr:first-child td,table thead:first-child tr:first-child th{border-top:0}table tbody+tbody{border-top:2px solid #efefef}table table table{background-color:#fff}table tbody>tr:nth-child(odd)>td,table tbody>tr:nth-child(odd)>th{background-color:#f6f6f6}table.plain tbody>tr:nth-child(odd)>td,table.plain tbody>tr:nth-child(odd)>th{background:transparent}.fluid-width-video-wrapper,iframe{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe{margin:0}.main-header{position:relative;display:table;width:100%;height:100vh;margin-bottom:5rem;text-align:center;background:#222 no-repeat 50%;background-size:cover;overflow:hidden}.main-header.cover{background-image:url("https://www.simoahava.com/images/maisema.jpg")}.main-header.list-cover{background-image:url("/")}.main-header .inner{width:80%}.main-header a.bloglogo{text-decoration:none}.main-header a.bloglogo .icon-facebook,.main-header a.bloglogo .icon-github,.main-header a.bloglogo .icon-google-plus,.main-header a.bloglogo .icon-instagram,.main-header a.bloglogo .icon-linkedin,.main-header a.bloglogo .icon-pinterest,.main-header a.bloglogo .icon-twitter{color:#fff;font-size:2em}.main-nav{position:relative;padding:35px 40px;margin:0 0 30px}.main-nav a{text-decoration:none;font-family:Open Sans,sans-serif}.scroll-down{display:block;position:absolute;z-index:100;bottom:45px;left:50%;font-size:1.5em;text-align:center;-webkit-animation:bounce 4s 2s infinite;animation:bounce 4s 2s infinite}.scroll-down:hover{color:#fff;-webkit-animation:none;animation:none}.home-template .main-header:after{display:block;content:" ";width:150px;height:130px;border-radius:100%;position:absolute;bottom:0;left:50%;margin-left:-75px;background:radial-gradient(ellipse at center,rgba(0,0,0,.15) 0,transparent 70%,transparent 100%)}.archive-template .main-header:after,.archive-template .scroll-down,.no-cover.main-header:after,.no-cover .scroll-down{display:none}.blog-logo{display:block;float:left}.blog-logo img{display:block;padding:1px 0 5px;width:auto}.blog-logo img,.menu-button{-webkit-box-sizing:border-box;box-sizing:border-box;height:38px}.menu-button{display:inline-block;float:right;padding:0 15px;border:1px solid #bfc8cd;opacity:1;color:#9eabb3;text-align:center;font-size:12px;text-transform:uppercase;line-height:35px;white-space:nowrap;border-radius:3px;background:rgba(0,0,0,.1);-webkit-transition:all .5s ease;transition:all .5s ease}.menu-button:focus{outline:0}.menu-button .fa-bars{font-size:12px;margin-right:6px}.main-nav.overlay{position:absolute;top:0;left:0;right:0;height:70px;border:none;background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.2)),to(transparent));background:linear-gradient(180deg,rgba(0,0,0,.2) 0,transparent)}.no-cover .main-nav.overlay,.no-cover .menu-button{background:none}.main-nav.overlay a{color:#fff}.main-nav.overlay .menu-button{border-color:hsla(0,0%,100%,.6)}.cover .main-nav.overlay a.menu-button:hover{color:#222;border-color:#fff;background:#fff}.menu-button:hover,.no-cover .main-nav.overlay .menu-button:hover{border-color:#555;color:#555}.page-title{margin:10px 0;font-size:5rem;letter-spacing:-1px;font-weight:700;font-family:Open Sans,sans-serif;color:#fff}.page-description{margin:0;font-size:2rem;line-height:1.5em;font-weight:400;font-family:Merriweather,serif;letter-spacing:.01rem;color:hsla(0,0%,100%,.8)}.no-cover.main-header{min-height:160px;max-height:40vh;background:#f5f8fa}.no-cover .page-title{color:rgba(0,0,0,.8)}.no-cover .page-description{color:rgba(0,0,0,.5)}.no-cover .main-nav.overlay .menu-button{color:rgba(0,0,0,.4);border-color:rgba(0,0,0,.3)}.main-header-content .page-title{-webkit-animation:fade-in-down .6s;animation:fade-in-down .6s;-webkit-animation-delay:.2s;animation-delay:.2s}.main-header-content .page-description{-webkit-animation:fade-in-down .9s;animation:fade-in-down .9s;-webkit-animation-delay:.1s;animation-delay:.1s}.post{position:relative;width:80%;max-width:710px;margin:4rem auto;padding-bottom:4rem;border-bottom:1px solid #ebf2f6;word-wrap:break-word;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.post-header{padding-bottom:10px}.post:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}body:not(.post-template) .post-title{font-size:3.6rem}.post-title a{text-decoration:none}.post-excerpt p{margin:0;font-size:.9em;line-height:1.7em}.read-more{font-size:.8em;text-decoration:none;font-style:italic}.post-meta{display:block;margin:1.75rem 0 0;font-family:Open Sans,sans-serif;font-size:1.5rem;line-height:2.2rem;color:#9eabb3}.author-thumb{width:24px;height:24px;float:left;margin-right:9px;border-radius:100%}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.user-meta{position:relative;padding:.3rem 40px 0 100px;min-height:77px}.post-date{display:inline-block;margin-left:8px;padding-left:12px;border-left:1px solid #d5dbde;text-transform:uppercase;font-size:1.3rem;white-space:nowrap}.user-image{position:absolute;top:0;left:0}.user-name{display:block;font-weight:700}.user-bio{display:block;max-width:440px;font-size:1.4rem;line-height:1.5em}.publish-meta{position:absolute;top:0;right:0;padding:4.3rem 0 4rem;text-align:right}.publish-heading{display:block;font-weight:700}.publish-date{display:block;font-size:1.4rem;line-height:1.5em}figure.no-margin{margin:0}figure.center{margin-left:auto;margin-right:auto}.amp-image-lightbox-caption{text-align:center;font-size:.8em}@media only screen and (min-width:501px){figure.polaroid:after,figure.polaroid:before{content:"";position:absolute;z-index:-2;bottom:10px;width:50%;height:20%;max-width:480px;-webkit-box-shadow:0 15px 10px rgba(0,0,0,.7);box-shadow:0 15px 10px rgba(0,0,0,.7)}figure.polaroid:after{right:10px;left:auto;-webkit-transform:rotate(3deg);transform:rotate(3deg)}figure.polaroid:before{left:10px;right:auto;-webkit-transform:rotate(-3deg);transform:rotate(-3deg)}figure.polaroid{width:450px;position:relative;padding:15px;border:none;background:#fff;-webkit-box-shadow:0 1px 4px rgba(0,0,0,.3),0 0 40px rgba(0,0,0,.1) inset;box-shadow:0 1px 4px rgba(0,0,0,.3),inset 0 0 40px rgba(0,0,0,.1);border-radius:4px;margin-bottom:1.5em;max-width:100%}figure.polaroid div[fallback]{border:none;margin:0;padding:0}figure.polaroid amp-img{display:block;outline:1px solid #ccc;padding:0;margin:0}figure.polaroid figcaption{font-size:1.3em;font-weight:400;font-family:Kaushan Script,cursive;text-align:right;padding:.8em .5em .4em}}@media only screen and (max-width:501px){figure.polaroid{background:#fff;border-radius:1px;margin-bottom:1em}figure.polaroid figcaption{font-size:.8em;font-style:italic;text-align:center;border-top:1px solid #d3d3d3;border-bottom:1px solid #d3d3d3;margin-top:.5em;padding:.2em}}.main-header.cover .main-header-content .social-link a,.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.main-header.cover .main-header-content .social-link a:visited,.scroll-down a,.scroll-down a:active,.scroll-down a:hover,.scroll-down a:visited{text-decoration:none;font-size:2em}.main-header.cover .main-header-content .social-link a:active,.main-header.cover .main-header-content .social-link a:hover,.scroll-down a:active,.scroll-down a:hover{color:#fff}.main-header.no-cover .main-header-content .social-link a,.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover,.main-header.no-cover .main-header-content .social-link a:visited{text-decoration:none;font-size:2em;color:#a2a2a2}.main-header.no-cover .main-header-content .social-link a:active,.main-header.no-cover .main-header-content .social-link a:hover{color:#000}.post-template .post-header{margin-bottom:3.4rem}.post-template .post-title{margin-bottom:0}.post-template .post-meta{margin:0}.post-template .post-date{padding:0;margin:0;border:none}.post-template .content{overflow:hidden}.post-template .post{margin-top:0;border-bottom:none;padding-bottom:0}.post-template .post:after{display:none}.post-content{text-align:justify}.post-footer{position:relative;margin:6rem 0 0;padding:6rem 0 0;border-top:1px solid #ebf2f6}.post-footer h4{font-size:1.8rem;margin:0}.post-footer p{margin:1rem 0;font-size:1.4rem;line-height:1.75em}.author-meta{padding:0;margin:0;list-style:none;font-size:1.4rem;line-height:1;font-style:italic}.author-meta,.author-meta a{color:#9eabb3}.author-meta a:hover{color:#111}.post-footer .author{margin-right:180px}.post-footer h4 a{color:#2e2e2e;text-decoration:none}.post-footer h4 a:hover{text-decoration:underline}.post-footer .share{position:absolute;top:6rem;right:0;width:180px}.post-footer .share a{font-size:1.8rem;display:inline-block;margin:1rem 1.6rem 1.6rem 0;color:#bbc7cc;text-decoration:none}.post-footer .share a:hover{color:#50585d}.post-head.main-header{height:65vh;min-height:180px}.no-cover.post-head.main-header{height:85px;min-height:0;margin-bottom:0;background:transparent}.author-head.main-header,.tag-head.main-header{height:40vh;min-height:180px}.no-cover.author-head.main-header{height:10vh;min-height:100px;background:transparent}.author-profile{padding:0 15px 5rem;border-bottom:1px solid #ebf2f6;text-align:center}.author-profile:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.author-image{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-56px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;background:#fff;z-index:2;-webkit-box-shadow:#e7eef2 0 0 0 1px;box-shadow:0 0 0 1px #e7eef2}.author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:50%;border-radius:100%;background-image:url("https://www.simoahava.com/images/simo.png")}.author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0;-webkit-box-shadow:none;box-shadow:none}.author-title{margin:1.5rem 0 1rem}.author-bio{font-size:1.8rem;line-height:1.5em;font-weight:200;color:#50585d;letter-spacing:0;text-indent:0}.author-meta{margin:1.6rem 0}.author-profile .author-meta{margin:2rem 0;font-family:Merriweather,serif;letter-spacing:.01rem;font-size:1.7rem}.author-meta span{display:inline-block;margin:0 2rem 1rem 0;word-wrap:break-word}.author-meta a{text-decoration:none}.archive-template .author-profile .author-meta{display:none}@-webkit-keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@keyframes fade-in-down{0%{opacity:0;transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}to{opacity:1;transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}}@-webkit-keyframes bounce{0%,10%,25%,40%,50%{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}20%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}30%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}@keyframes bounce{0%,20%,50%,80%,to{transform:translateY(0);-webkit-transform:translateY(0);-ms-transform:translateY(0)}40%{transform:translateY(-10px);-webkit-transform:translateY(-10px);-ms-transform:translateY(-10px)}60%{transform:translateY(-5px);-webkit-transform:translateY(-5px);-ms-transform:translateY(-5px)}}#sidebar{background:rgba(0,0,0,.7);text-align:left;overflow-y:auto;font-family:Open Sans,Verdana,sans-serif;font-weight:700;font-size:11px;color:#909090;width:400px}#sidebar .nav-title{position:absolute;top:45px;left:30px;font-size:1.5em;font-weight:100;text-transform:uppercase;color:#fff}#sidebar .nav-section{color:#d8d8d8}#sidebar .nav-close{position:absolute;top:38px;right:25px;width:20px;height:20px;padding:0;font-size:10px}#sidebar .nav-close:focus{outline:0}#sidebar .nav-close:after,#sidebar .nav-close:before{content:"";position:absolute;top:0;width:20px;height:1px;background:#969696;top:15px;-webkit-transition:background .15s ease;transition:background .15s ease}#sidebar .nav-close:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}#sidebar .nav-close:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}#sidebar .nav-close:hover:after,#sidebar .nav-close:hover:before{background:#fff}#sidebar amp-accordion .nav-section{margin:.4em 0 .2em;background:none;border:none;font-size:2rem}#sidebar amp-accordion section[expanded] .nav-section .fa{width:1ch}#sidebar amp-accordion section[expanded] .nav-section .section-open{display:inline-block}#sidebar amp-accordion section[expanded] .nav-section .section-close{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-open{display:none}#sidebar amp-accordion section:not([expanded]) .nav-section .section-close{display:inline-block}#sidebar ul{padding:90px 9% 5%;list-style:none;counter-reset:item}#sidebar li:before{display:block;float:right;padding-right:4%;padding-left:5px;text-align:right;font-size:1.2rem;vertical-align:bottom;color:#b8b8b8;content:counter(item,lower-roman);counter-increment:item}#sidebar li{margin:0}#sidebar li a{text-decoration:none;line-height:1.4;font-size:1.4rem;display:block;padding:.6rem 4%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#sidebar li a:after{display:inline-block;content:" ...............................................................";color:hsla(0,0%,100%,.2);margin-left:5px}#sidebar .nav-current:before{color:#fff}#sidebar .nav-current a:after{content:" ";border-bottom:1px solid hsla(0,0%,100%,.5);width:100%;height:1px}#sidebar a,#sidebar a:active,#sidebar a:hover,#sidebar a:visited{color:#b8b8b8}#sidebar a:active,#sidebar a:hover,#sidebar li.nav-current a{color:#fff}.subscribe-button{-webkit-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;bottom:30px;left:30px;right:30px;height:38px;padding:0 20px;text-align:center;font-size:12px;font-family:Open Sans,sans-serif;text-transform:uppercase;text-decoration:none;line-height:35px;border-radius:3px;background:#fff;-webkit-transition:all .3s ease;transition:all .3s ease}.subscribe-button:before{font-size:9px;margin-right:6px}.pagination{position:relative;width:80%;max-width:710px;margin:4rem auto;font-family:Open Sans,sans-serif;font-size:1.3rem;color:#9eabb3;text-align:center}.pagination a{color:#9eabb3;-webkit-transition:all .2s ease;transition:all .2s ease}.newer-posts,.older-posts{position:absolute;display:inline-block;padding:0 15px;border:1px solid #bfc8cd;text-decoration:none;border-radius:4px;-webkit-transition:border .3s ease;transition:border .3s ease}.older-posts{right:0}.page-number{display:inline-block;padding:2px 0;min-width:100px}.newer-posts{left:0}.newer-posts:hover,.older-posts:hover{color:#889093;border-color:#98a0a4}.extra-pagination{display:none;border-bottom:1px solid #ebf2f6}.extra-pagination:after{display:block;content:"";width:7px;height:7px;border:1px solid #e7eef2;position:absolute;bottom:-5px;left:50%;margin-left:-5px;background:#fff;border-radius:100%;-webkit-box-shadow:#fff 0 0 0 5px;box-shadow:0 0 0 5px #fff}.extra-pagination .pagination{width:auto}.archive-template .main-header{max-height:30vh}.archive-template .extra-pagination{display:block}.site-footer{position:relative;margin:8rem 0 0;padding:.5rem 15px;font-family:Open Sans,sans-serif;font-size:1rem;line-height:1.75em;color:#bbc7cc}.site-footer a{color:#bbc7cc;text-decoration:none;font-weight:700}.site-footer a:hover{color:#50585d}.poweredby{float:right;text-align:right}.copyright,.poweredby{display:block;width:45%}.copyright{float:left}@media only screen and (max-width:900px){blockquote{margin-left:0}.main-header{-webkit-box-sizing:border-box;box-sizing:border-box;height:auto;min-height:240px;height:60vh;padding:15% 0}.home-template .main-header:after,.scroll-down{display:none}.archive-template .main-header{min-height:180px;padding:10% 0}.blog-logo img{padding:4px 0}.page-title{font-size:4rem;letter-spacing:-1px}.page-description{font-size:1.8rem;line-height:1.5em}.post{font-size:.95em}body:not(.post-template) .post-title{font-size:3.2rem}hr{margin:2.4em 0}ol,ul{padding-left:2em}h1{font-size:4.5rem;text-indent:-2px}h2{font-size:3.6rem}h3{font-size:3.1rem}h4{font-size:2.5rem}h5{font-size:2.2rem}h6{font-size:1.8rem}.author-profile{padding-bottom:4rem}.author-profile .author-bio{font-size:1.6rem}.author-meta span{display:block;margin:1.5rem 0}.author-profile .author-meta span{font-size:1.6rem}.post-head.main-header{height:45vh}.author-head.main-header,.tag-head.main-header{height:30vh}.no-cover.post-head.main-header{height:55px;padding:0}.no-cover.author-head.main-header{padding:0}}@media only screen and (max-width:500px){.main-header{margin-bottom:15px;height:40vh}.no-cover.main-header{height:30vh}.archive-template .main-header{max-height:20vh;min-height:160px;padding:10% 0}.main-nav{margin-bottom:2rem}.blog-logo,.main-nav{padding:5px}.blog-logo img{height:30px}.menu-button{padding:0 5px;border-radius:0;border-color:transparent;color:#2e2e2e;background:transparent}.menu-button:hover{color:#2e2e2e;border-color:transparent;background:none}body.nav-opened .menu-button{background:none;border:transparent}.main-nav.overlay a:hover{color:#fff;border-color:transparent;background:transparent}.no-cover .main-nav.overlay{background:none}.no-cover .main-nav.overlay .menu-button{border:none}.main-nav.overlay .menu-button{border-color:transparent}.nav-title{top:25px}.nav-close{position:absolute;top:18px}.nav ul{padding:60px 9% 5%}.inner,.pagination{width:auto;margin:2rem auto}.post{width:auto;margin:2rem 16px;padding-bottom:2rem;line-height:1.65em}.post-template .post-header{margin-bottom:2rem}.post-template .post-date{display:inline-block}hr{margin:1.75em 0}dl,ol,p,ul{font-size:.95em;margin:0 0 2.5rem}.page-title{font-size:3rem}.post-excerpt p{font-size:.85em}.page-description{font-size:1.6rem}h1,h2,h3,h4,h5,h6{margin:0 0 .3em}h1{font-size:2.8rem;letter-spacing:-1px}h2{font-size:2.4rem;letter-spacing:0}h3{font-size:2.1rem}h4{font-size:1.9rem}h5,h6{font-size:1.8rem}body:not(.post-template) .post-title{font-size:2.5rem}.post-template .post{padding-bottom:0;margin-bottom:0}.post-template .site-footer{margin-top:0}.post-meta{font-size:1.3rem;margin-top:1rem}.post-footer{padding:5rem 0 3rem;text-align:center}.post-footer .author{margin:0 0 2rem;padding:0 0 1.6rem;border-bottom:1px dashed #ebf2f6}.post-footer .share{position:static;width:auto}.post-footer .share a{margin:1.4rem .8rem 0}.author-meta li{float:none;margin:0;line-height:1.75em}.author-meta li:before{display:none}.newer-posts,.older-posts{position:static;margin:10px 0}.page-number{display:block}.site-footer{margin-top:3rem}.author-profile{padding-bottom:2rem}.post-head.main-header{height:30vh}.author-head.main-header,.tag-head.main-header{height:20vh}.author-profile .author-image{margin-top:-70px}.author-profile .author-meta span{font-size:1.4rem}.archive-template .main-header .page-description{display:none}}header.post-header{line-height:1.1em}.post-content amp-img{max-width:100%;height:auto;border:1px solid #777;-webkit-box-shadow:5px 5px 2px rgba(0,0,0,.4);box-shadow:5px 5px 2px rgba(0,0,0,.4);margin-bottom:20px}.social-link a{color:#dfdfdf}pre.chroma{text-align:left}
    

</style>

        <link rel="canonical" href="https://www.simoahava.com/google-cloud/lighthouse-bigquery-google-cloud-platform/">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

        

        <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i|Open+Sans:400,700|Kaushan+Script" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

        <meta name="theme-color" content="#ffffff" />

        
        <title>Audit Multiple Sites With Lighthouse and Write Results to BigQuery | Simo Ahava's blog</title>
        <meta property="og:title" content="Audit Multiple Sites With Lighthouse and Write Results to BigQuery" />
<meta name="description" content="Set up a simple GCP Cloud Function that uses Lighthouse to periodically audit a set of URLs and writes the audit results to BigQuery and Google Cloud Storage." />
<meta property="og:description" content="Set up a simple GCP Cloud Function that uses Lighthouse to periodically audit a set of URLs and writes the audit results to BigQuery and Google Cloud Storage." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/" />

    
        
    



    
        <meta property="article:published_time" content="2018-12-18T07:03:08Z"/>
    
    
        <meta property="article:modified_time" content="2018-12-18T07:03:08Z"/>
    




    


    <meta property="og:site_name" content="Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development." />









    
        
        
            
        
        
        
    
    
    
        
            <meta property="article:section" content="Google Cloud" />
        
    
    
        
            <meta property="article:tag" content="google cloud" />
        
            <meta property="article:tag" content="cloud functions" />
        
            <meta property="article:tag" content="bigquery" />
        
            <meta property="article:tag" content="nodejs" />
        
            <meta property="article:tag" content="lighthouse" />
        
    







    
        <meta name="twitter:card" content="summary"/>
    

    
        
        
            
        
        
        
    




<meta itemprop="name" content="Audit Multiple Sites With Lighthouse And Write Results To BigQuery">
<meta itemprop="description" content="Set up a simple GCP Cloud Function that uses Lighthouse to periodically audit a set of URLs and writes the audit results to BigQuery and Google Cloud Storage.">


<meta itemprop="datePublished" content="2018-12-18T09:03:08&#43;02:00" />
<meta itemprop="dateModified" content="2018-12-18T09:03:08&#43;02:00" />
<meta itemprop="wordCount" content="4039">



<meta itemprop="keywords" content="google cloud,cloud functions,bigquery,nodejs,lighthouse," />

<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Simo Ahava&#39;s blog :: Simo Ahava is a Google Developer Expert for Google Analytics and Google Tag Manager. This is a blog all about web analytics development.",
    
    "url": "https://www.simoahava.com/amp/"
}
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Audit Multiple Sites With Lighthouse And Write Results To BigQuery | Simo Ahava's blog",
  "image": "https://www.simoahava.com/images/2018/12/lighthouse.jpg",
  "editor": "Simo Ahava",
  "publisher": {
    "@type": "Organization",
    "name": "Simo Ahava's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.simoahava.com/images/simo.png",
      "height": "393",
      "width": "407"
    }
  },
  "url": "https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/",
  "datePublished": "2018-12-18T09:03:08+02:00",
  "dateModified": "2018-12-18T09:03:08+02:00",
  "description": "Set up a simple GCP Cloud Function that uses Lighthouse to periodically audit a set of URLs and writes the audit results to BigQuery and Google Cloud Storage.",
  "author": {
    "@type": "Person",
    "name": "Simo Ahava"
  }
}
</script>












    </head>
<body>

<amp-analytics config="https://www.googletagmanager.com/amp.json?id=GTM-5BH2HM&gtm.url=SOURCE_URL" data-credentials="include"></amp-analytics>
  <amp-sidebar id="sidebar" layout="nodisplay" side="right">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close" on="tap:sidebar.close" role="button" tabindex="1">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/">Home</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/categories/gtm-tips/">GTM Tips</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/about-simo-ahava/">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/tools/">Tools</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/blog-statistics/">Blog Statistics</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/amp/upcoming-talks/">Upcoming Talks</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
                <a href="https://www.simoahava.com/">Full (non-AMP) site</a>
            </li>
        
        <amp-accordion>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Categories
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/gtm-tips/">gtm-tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/categories/web-development/">web-development</a></li>
                
                </div>
            </section>
        
            <section>
                <h3 class="nav-section">
                    <i class="fa fa-caret-down section-open" aria-hidden="true"></i>
                    <i class="fa fa-caret-right section-close" aria-hidden="true"></i>
                    Tags
                </h3>
                <div>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/accelerated-mobile-pages/">accelerated-mobile-pages</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adblocker/">adblocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/add-on/">add-on</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/adwords/">adwords</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/agile/">agile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amazon/">amazon</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/amp/">amp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/analytics/">analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/android/">android</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/api/">api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app/">app</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app&#43;web/">app&#43;web</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/app-engine/">app-engine</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/approval/">approval</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps/">apps</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/apps-script/">apps-script</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/array/">array</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/attribution/">attribution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audience-design/">audience-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/audit/">audit</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-event-tracking/">auto-event-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/auto-link-domains/">auto-link-domains</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/aws/">aws</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/basketball/">basketball</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/beforeunload/">beforeunload</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/best-practices/">best-practices</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/big-data/">big-data</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bigquery/">bigquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/blogger/">blogger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/bounce-rate/">bounce-rate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/built-in-variables/">built-in-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/calculated-metrics/">calculated-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/callback/">callback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/campaign-tracking/">campaign-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/celebration/">celebration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/change-history/">change-history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome/">chrome</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/chrome-extension/">chrome-extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-tracking/">click-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/click-variables/">click-variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clickstream/">clickstream</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/client-id/">client-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/clientid/">clientid</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cloud-functions/">cloud-functions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cms/">cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conferences/">conferences</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container/">container</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/container-snippet/">container-snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content/">content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-blocker/">content-blocker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-engagement/">content-engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-grouping/">content-grouping</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management/">content-management</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-management-system/">content-management-system</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-security-policy/">content-security-policy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/content-strategy/">content-strategy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/context/">context</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/conversion/">conversion</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookie/">cookie</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookiedomain/">cookiedomain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cookies/">cookies</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/creative/">creative</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain/">cross-domain</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/cross-domain-tracking/">cross-domain-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/csp/">csp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css/">css</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/css-selectors/">css-selectors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom/">custom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimension/">custom-dimension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-dimensions/">custom-dimensions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html/">custom-html</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-html-tag/">custom-html-tag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-javascript/">custom-javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-metrics/">custom-metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/custom-templates/">custom-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/customtask/">customtask</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dan-wilkerson/">dan-wilkerson</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dashboard/">dashboard</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-collection/">data-collection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer/">data-layer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-layer-variable/">data-layer-variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-model/">data-model</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/data-quality/">data-quality</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/datalayer/">datalayer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debug/">debug</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/debugging/">debugging</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/definition-of-success/">definition-of-success</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/developer/">developer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/development/">development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/digital-marketing/">digital-marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/document.write/">document.write</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dom/">dom</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/duplicate/">duplicate</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/dynamic-content/">dynamic-content</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/easter-egg/">easter-egg</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ecommerce/">ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/education/">education</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/element-visibility/">element-visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/engagement/">engagement</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/enhanced-ecommerce/">enhanced-ecommerce</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/environments/">environments</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/errors/">errors</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event/">event</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listener/">event-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/event-listeners/">event-listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/eventcallback/">eventcallback</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/events/">events</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/excel/">excel</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/exceptions/">exceptions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/extension/">extension</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/facebook/">facebook</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/fields-to-set/">fields-to-set</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firebase/">firebase</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/firing-rules/">firing-rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/folders/">folders</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form/">form</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/form-tracking/">form-tracking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/format-value/">format-value</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/forms/">forms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ga-spy/">ga-spy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gcp/">gcp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gdpr/">gdpr</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google/">google</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics/">google-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-analytics-settings/">google-analytics-settings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud/">google-cloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-cloud-platform/">google-cloud-platform</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-optimize/">google-optimize</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-sheets/">google-sheets</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-tag-manager/">google-tag-manager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/google-trends/">google-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/googletagmanager/">googletagmanager</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/governance/">governance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtag/">gtag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-sonar/">gtm-sonar</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm-tools/">gtm-tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtm360/">gtm360</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/gtmtips/">gtmtips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guest-post/">guest-post</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/guide/">guide</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hack/">hack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history/">history</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-change-trigger/">history-change-trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/history-listener/">history-listener</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/hugo/">hugo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/iframe/">iframe</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/internal-traffic/">internal-traffic</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ios/">ios</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ip/">ip</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/it-department/">it-department</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/itp/">itp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/javascript/">javascript</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/jquery/">jquery</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/klipfolio/">klipfolio</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/learning/">learning</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lighthouse/">lighthouse</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/links/">links</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/listeners/">listeners</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/local/">local</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/localstorage/">localstorage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/lookup-table/">lookup-table</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/macros/">macros</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketer/">marketer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/marketing/">marketing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/measurement-protocol/">measurement-protocol</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/meta-description/">meta-description</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/metrics/">metrics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/migration/">migration</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mixcloud/">mixcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/mobile/">mobile</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modern-cms/">modern-cms</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/modular-architecture/">modular-architecture</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/monitor/">monitor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/navigation/">navigation</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/netbooster/">netbooster</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/new-ui/">new-ui</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/nodejs/">nodejs</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/non-technical/">non-technical</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/open-source/">open-source</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/opt-out/">opt-out</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/owasp/">owasp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-load-time/">page-load-time</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/page-timings/">page-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/penguin/">penguin</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/performance/">performance</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/permissions/">permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/persistence/">persistence</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal/">personal</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/personal-experience/">personal-experience</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/php/">php</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pii/">pii</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/pitch/">pitch</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/plugins/">plugins</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/poetry/">poetry</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/ppc/">ppc</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/preview-mode/">preview-mode</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/privacy/">privacy</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/process/">process</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/public-speaking/">public-speaking</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/query-string/">query-string</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/r/">r</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/race-condition/">race-condition</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/reaktor/">reaktor</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/referral/">referral</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/regular-expression/">regular-expression</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/release/">release</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/resources/">resources</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/rules/">rules</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/safari/">safari</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sales/">sales</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/schema/">schema</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/score-card/">score-card</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/scroll-depth/">scroll-depth</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search/">search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-api/">search-api</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-engine-optimization/">search-engine-optimization</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/search-trends/">search-trends</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/security/">security</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/selection/">selection</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo/">seo</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/seo-report/">seo-report</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/serp/">serp</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/session/">session</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/sessions/">sessions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-search/">site-search</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/site-speed/">site-speed</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/slack/">slack</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snippet/">snippet</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/snowplow/">snowplow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/social-interactions/">social-interactions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/soundcloud/">soundcloud</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/spa/">spa</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/splash-page/">splash-page</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/static-site/">static-site</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/storage/">storage</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/support/">support</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/swift/">swift</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/syntax-highlight/">syntax-highlight</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solution/">tag-management-solution</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-management-solutions/">tag-management-solutions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-sequencing/">tag-sequencing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tag-templates/">tag-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tags/">tags</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tasks/">tasks</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/technique/">technique</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/test/">test</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/testing/">testing</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timer/">timer</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/timings/">timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tips/">tips</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tools/">tools</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker/">tracker</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/tracker-object/">tracker-object</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/training/">training</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger/">trigger</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/trigger-groups/">trigger-groups</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/triggers/">triggers</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/troubleshoot/">troubleshoot</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/undefined/">undefined</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/universal-analytics/">universal-analytics</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-id/">user-id</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-interface/">user-interface</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-permissions/">user-permissions</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/user-timings/">user-timings</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/v2/">v2</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable/">variable</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variable-templates/">variable-templates</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/variables/">variables</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/videos/">videos</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/visibility/">visibility</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/wcag/">wcag</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/weather/">weather</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-design/">web-design</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/web-development/">web-development</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/website-redesign/">website-redesign</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workflow/">workflow</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/workspaces/">workspaces</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/youtube/">youtube</a></li>
                
                    <li class="nav-opened" role="presentation"><a href="https://www.simoahava.com/amp/tags/zones/">zones</a></li>
                
                </div>
            </section>
        
        </amp-accordion>
    </ul>
</amp-sidebar>

<div class="site-wrapper">



    <header class="main-header post-head no-cover">
    <nav class="main-nav clearfix">


    <a class="menu-button" on="tap:sidebar.toggle" role="button" href="#"><i class="fa fa-bars" aria-hidden="true"></i><span class="menu-button-label">Menu</span></a>


  </nav>
</header>



<main class="content" role="main">

  <article class="post type-post">

    <header class="post-header">
        <h1 class="post-title">Audit Multiple Sites With Lighthouse and Write Results to BigQuery</h1>
        <small>Set up a simple GCP Cloud Function that uses Lighthouse to periodically audit a set of URLs and writes the audit results to BigQuery and Google Cloud Storage.</small>

        <section class="post-meta">
            


    




    <amp-img class="author-thumb" src="https://www.simoahava.com/images/simo.png" layout="fixed" width="24" height="24" alt="Author image"></amp-img>

Simo Ahava

in
    
        <a href="https://www.simoahava.com/amp/categories/google-cloud">Google Cloud</a>
    


on
    
        <a href="https://www.simoahava.com/amp/tags/google-cloud">#google cloud</a>
    
        , <a href="https://www.simoahava.com/amp/tags/cloud-functions">#cloud functions</a>
    
        , <a href="https://www.simoahava.com/amp/tags/bigquery">#bigquery</a>
    
        , <a href="https://www.simoahava.com/amp/tags/nodejs">#nodejs</a>
    
        , <a href="https://www.simoahava.com/amp/tags/lighthouse">#lighthouse</a>
    

<time class="post-date" datetime="2018-12-18T09:03:08&#43;02:00">
    18 December 2018
</time>


        </section>
    </header>

    <section class="post-content">
      

<p><a href="https://cloud.google.com/">Google Cloud Platform</a> is very, very cool. It&rsquo;s a fully capable, enterprise-grade, scalable cloud ecosystem which lets even total novices get started with building their first cloud applications. I wrote a long guide for installing <a href="https://www.simoahava.com/amp/analytics/install-snowplow-on-the-google-cloud-platform/">Snowplow on the GCP</a>, and you might want to read that if you want to see how you can build your own analytics tool using some nifty open-source modules.</p>

<p>But this guide will not be about <a href="https://snowplowanalytics.com/">Snowplow</a>. Rather, it will tackle Google&rsquo;s own open-source performance audit tool: <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a>.</p>

<p>With this guide, <strong>you&rsquo;ll be able to build your own Google Cloud project, using Lighthouse to audit any number of sites you like, and write the results into storage and a BigQuery table</strong>!</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/lighthouse.jpg" title="Lighthouse">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/lighthouse.jpg" layout="responsive" alt="Lighthouse" height="462" width="1413"></amp-img>
  
    </a>
  


<p>You can try Lighthouse in your Chrome browser right now. Just follow the instructions <a href="https://developers.google.com/web/tools/lighthouse/#devtools">here</a> to see how you can enable the <strong>Audit</strong> tool in DevTools.</p>

<p>One of the limitations of the DevTools feature is that you can only run it on one site at a time, and only through your web browser. I wanted to build something that lets me audit a whole bunch of sites, and automate it as well. For that reason, I wrote an <strong>extremely</strong> simple <a href="https://nodejs.org/en/">Node.js</a> app, <a href="https://github.com/sahava/multisite-lighthouse">multisite-lighthouse</a> which fulfils these requirements. Simply by editing a configuration file and then running the script, you can run an audit against multiple sites, and the results will be written in a local folder.</p>

<p>So that was fun. But then I got a bit more ambitious. Would it be possible to run this app in a <em>serverless</em> cloud environment, and have the results be written in a database or storage somewhere, where they can be queried and fetched at leisure?</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/bigquery.jpg" title="BigQuery output">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/bigquery.jpg" layout="responsive" alt="BigQuery output" height="394" width="1349"></amp-img>
  
    </a>
  


<p>Well, sure! In this guide, I&rsquo;ll walk you through how to run a Node.js application in a GCP <a href="https://cloud.google.com/functions/">Cloud Function</a>, which writes the results into a <a href="https://cloud.google.com/bigquery/">BigQuery</a> table, and stores the reports into a <a href="https://cloud.google.com/storage/">Cloud Storage</a> bucket. Oh, and it&rsquo;s practically free.</p>

<!-- toc -->

<h2 id="how-it-works">How it works</h2>

<p>First, check out my mad Powerpoint-driven design skills:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/process-diagram.jpg">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/process-diagram.jpg" layout="responsive"  height="839" width="1414"></amp-img>
  
    </a>
  


<p>Let&rsquo;s step through what goes on here.</p>

<ol>
<li><p>The <a href="https://cloud.google.com/functions/"><strong>Cloud Function</strong></a> is a piece of <a href="https://cloud.google.com/functions/docs/concepts/nodejs-8-runtime"><strong>Node.js</strong></a> code running in the Google Cloud. It&rsquo;s called &ldquo;serverless&rdquo; because the setup is fully self-contained. The environment itself takes care of running the code <strong>and</strong> the infrastructure necessary to do so.</p></li>

<li><p>The <strong>Cloud Function</strong> is triggered by a message pushed into a <a href="https://cloud.google.com/pubsub/docs/overview"><strong>Pub/Sub</strong></a> topic. Pub/Sub is short for Publish/Subscribe, which means you can <strong>publish</strong> messages into a topic, which will then alert any <strong>subscribers</strong> of that topic. In other words, it can be used as a simple real-time messaging queue, where published messages can trigger services within the Google Cloud.</p></li>

<li><p>The message itself can be published by you <strong>manually</strong>, by using the <a href="https://cloud.google.com/sdk/">Google Cloud SDK</a> in your local terminal, or by other applications which have been authorized to communicate with the topic. A nice use case would be to have your site&rsquo;s build pipeline trigger the audit as soon as the new release of the site has been deployed.</p></li>

<li><p>The message can also be published by <a href="https://cloud.google.com/scheduler/"><strong>Cloud Scheduler</strong></a>, which is a Google Cloud service that lets you schedule certain actions such as the publishing of a Pub/Sub message. You can set the scheduler to trigger your Cloud Function every night, or every week, or every month, for example.</p></li>

<li><p>When the Cloud Function is triggered, it fires up an instance of the <strong>Google Chrome</strong> browser in headless mode, using a piece of software called <a href="https://github.com/GoogleChrome/puppeteer">Puppeteer</a>.</p></li>

<li><p>The <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> audit tool is run in this browser instance, and it will perform the audit on any URLs you have defined in a special configuration file.</p></li>

<li><p>Once the audit is complete, the results are written into <a href="https://cloud.google.com/storage/"><strong>Google Cloud Storage</strong></a>, which functions as a file archive in the cloud, allowing you to store and fetch items from it at will (and at low cost).</p></li>

<li><p>The results are also written into a <a href="https://cloud.google.com/bigquery/"><strong>BigQuery</strong></a> table. BigQuery is a scalable data warehouse, where records are stored in table format (as opposed to a more traditional relational database). Due to its flat nature, it&rsquo;s fast, scalable, and extremely responsive. We don&rsquo;t need its full potential in this project, but having the data stored in BigQuery opens up opportunities in e.g. <a href="https://datastudio.google.com/">Google Data Studio</a> for visualization of the results.</p></li>
</ol>

<p>The <strong>cost</strong>? Next to nothing. With just one or two URLs you&rsquo;re facing practically <strong>zero cost</strong>. At most, it will be a handful of cents per month thanks to Google Cloud Storage.</p>

<h2 id="preparations">Preparations</h2>

<p>To be able to follow this guide, you&rsquo;ll need to install some tools and create a Google Cloud Platform project.</p>

<h3 id="install-command-line-tools">Install command line tools</h3>

<p>First, install the following command line tools:</p>

<ol>
<li><p><a href="https://nodejs.org/en/download/">Node.js and npm</a>.</p></li>

<li><p><a href="https://cloud.google.com/sdk/">Google Cloud SDK</a>.</p></li>

<li><p><a href="https://git-scm.com/downloads">Git</a>.</p></li>
</ol>

<p>To verify you have these up and running, run the following commands in your terminal (example from OS X):</p>

<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ node -v
v11.0.0

$ npm -v
<span class="m">6</span>.4.1

$ gcloud -v
Google Cloud SDK <span class="m">228</span>.0.0

$ git --version
git version <span class="m">2</span>.19.2</code></pre></div>

<p>Naturally, you might see some other version numbers, and that&rsquo;s OK. Just try to work with recent releases.</p>

<h3 id="set-up-a-new-google-cloud-platform-project-with-billing">Set up a new Google Cloud Platform project with Billing</h3>

<p>The other thing you&rsquo;ll need to do is <strong>create a GCP project</strong>, and you&rsquo;ll need to <strong>enable billing</strong> for this project. The things you build with this guide will most likely <strong>cost you absolutely nothing</strong>, or, at worst, just a handful of cents a month. But you still need to provide a credit card to enable some of the services we&rsquo;ll need.</p>

<p>To set up a new project, you can follow <a href="https://www.simoahava.com/amp/analytics/install-snowplow-on-the-google-cloud-platform/#step-1-set-up-a-new-project">Step 1</a> and <a href="https://www.simoahava.com/amp/analytics/install-snowplow-on-the-google-cloud-platform/#step-2-enable-billing">Step 2</a> in my Snowplow + GCP guide.</p>

<p>Once you&rsquo;ve created the project, make sure you copy its <strong>Project ID</strong> - you&rsquo;ll need it when walking through this guide.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/gcp-project-id.jpg" title="GCP Project ID">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/gcp-project-id.jpg" layout="responsive" alt="GCP Project ID" height="298" width="771"></amp-img>
  
    </a>
  


<p>Once you&rsquo;ve got the command line tools running and the GCP project created, it&rsquo;s time to get to work!</p>

<h2 id="set-things-up-in-gcp">Set things up in GCP</h2>

<p>We&rsquo;ll need to enable some <strong>services</strong> in your Google Cloud Platform project. Also, we&rsquo;ll need <strong>create a BigQuery dataset</strong>, a <strong>storage bucket</strong> in Cloud Storage, and we&rsquo;ll need to configure a <strong>Cloud Scheduler</strong> job to run the audits periodically.</p>

<h3 id="enable-the-services">Enable the services</h3>

<p>First, make sure you&rsquo;ve got the correct project selected while in your <a href="https://console.cloud.google.com/home/dashboard">GCP console dashboard</a>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/temp-test-simo.jpg" title="GCP Project selected">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/temp-test-simo.jpg" layout="responsive" alt="GCP Project selected" height="288" width="706"></amp-img>
  
    </a>
  


<p>Then, go to <a href="https://console.cloud.google.com/apis/library/cloudfunctions.googleapis.com">https://console.cloud.google.com/apis/library/cloudfunctions.googleapis.com</a> and click the blue <strong>ENABLE</strong> button to enable the <strong>Cloud Functions API</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/enable-cf-api.jpg" title="Enable CF API">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/enable-cf-api.jpg" layout="responsive" alt="Enable CF API" height="372" width="885"></amp-img>
  
    </a>
  


<p>Once enabled, go to <a href="https://console.cloud.google.com/apis/library/cloudscheduler.googleapis.com">https://console.cloud.google.com/apis/library/cloudscheduler.googleapis.com</a> and click the blue <strong>ENABLE</strong> button to enable the <strong>Cloud Scheduler API</strong>.</p>

<p>The other services we&rsquo;ll need (<strong>BigQuery API</strong>, <strong>Cloud Storage API</strong>, and <strong>Pub/Sub API</strong>) are already enabled in your project.</p>

<h3 id="create-the-bigquery-dataset">Create the BigQuery dataset</h3>

<p>Now, browse to <a href="https://console.cloud.google.com/bigquery">https://console.cloud.google.com/bigquery</a>, and click your project ID in the list of availabe projects.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/create-new-dataset.jpg" title="Create dataset">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/create-new-dataset.jpg" layout="responsive" alt="Create dataset" height="281" width="964"></amp-img>
  
    </a>
  


<p>We need to create a <strong>dataset</strong> which will soon contain a <strong>table</strong> where the audit results will be loaded to.</p>

<p>Type <code>lighthouse</code> as the dataset ID, like this:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/new-dataset-id.jpg" title="Dataset ID">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/new-dataset-id.jpg" layout="responsive" alt="Dataset ID" height="240" width="647"></amp-img>
  
    </a>
  


<p>You can set the location of the dataset to somewhere in your geographical vicinity, if you wish. Once done, click <strong>Create dataset</strong>.</p>

<h3 id="create-the-gcs-bucket">Create the GCS bucket</h3>

<p>We&rsquo;ll need to create a <strong>bucket</strong> in Google Cloud Storage. You can think of it like a storage drive, where the bucket represents a specific root directory to which the audit reports will be written.</p>

<p>We&rsquo;ll also use the bucket to handle <strong>state</strong> in the Cloud Function. This is necessary to prevent unintentional retries from writing your data over and over again into BigQuery and storage.</p>

<p>Browse to <a href="https://console.cloud.google.com/storage/browser">https://console.cloud.google.com/storage/browser</a> and click <strong>Create bucket</strong>.</p>

<p>You&rsquo;ll need to edit some options.</p>

<ol>
<li><p><strong>Name</strong>: Give the bucket a name that&rsquo;s <em>globally</em> unique. <code>&lt;yourname&gt;-lighthouse-reports</code> should work nicely. You&rsquo;ll need this name when configuring the application, so you might as well make note of it now.</p></li>

<li><p><strong>Default storage class</strong>: Choose an applicable storage class. The storage class determines how much it costs to store and query the data. You&rsquo;ll be doing a little bit of fetching and a little bit of storing, so the Regional option is typically a good one to go with.</p></li>

<li><p><strong>Location</strong>, choosing the location will impact costs and latency, so find one that suits you best. Honestly, the costs will be so low you might as well just take the one which is geographically closest to you.</p></li>
</ol>



    <a href="https://www.simoahava.com/amp/images/2018/12/gcs-bucket-settings.jpg" title="Google Cloud Storage bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/gcs-bucket-settings.jpg" layout="responsive" alt="Google Cloud Storage bucket" height="608" width="596"></amp-img>
  
    </a>
  


<p>Once happy with the settings, click <strong>Create</strong>.</p>

<h3 id="set-up-the-scheduled-job">Set up the scheduled job</h3>

<p>Finally, browse to <a href="https://console.cloud.google.com/cloudscheduler">https://console.cloud.google.com/cloudscheduler</a> and click <strong>Create job</strong>. We&rsquo;ll use the Cloud Scheduler to fire up our Cloud Function periodically.</p>

<p>In the first screen, you&rsquo;ll need to choose a region. You might as well choose one that&rsquo;s geographically close to you. Click <strong>Next</strong> when ready.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/scheduler-region.jpg" title="Scheduler-region">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/scheduler-region.jpg" layout="responsive" alt="Scheduler-region" height="528" width="803"></amp-img>
  
    </a>
  


<p>Next, after some deliberation, you&rsquo;ll need to give your job a name. Just use something descriptive.</p>

<p>Then, you need to establish the <strong>frequency</strong> of the job. Cloud Scheduler uses UNIX&rsquo; <code>cron</code> format, which can be a bit of a mystery, but it does have a nice logic to it. You can read how it works <a href="https://cloud.google.com/scheduler/docs/configuring/cron-job-schedules">here</a>, but here are some examples you can input into the field.</p>

<ol>
<li><p>Every day at 04:00 AM (daily): <code>0 4 * * *</code></p></li>

<li><p>Every Monday at 04:00 AM (weekly): <code>0 4 * * 1</code></p></li>

<li><p>First day of every month at 04:00 AM (monthly): <code>0 4 1 * *</code></p></li>
</ol>

<p>Next, choose a <strong>Timezone</strong> with which the &ldquo;04:00 AM&rdquo; part is calculated.</p>

<p>Then, choose <strong>Pub/Sub</strong> as the <strong>Target</strong> of the job.</p>

<p>Type <code>launch-lighthouse</code> into the <strong>Topic</strong> field, and <code>all</code> into the <strong>Payload</strong> field. Don&rsquo;t worry, these settings will become more apparent as we trod along.</p>

<p>In the end, the setup should look something like this:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/cloud-scheduler-job.jpg" title="Cloud Scheduler Job">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/cloud-scheduler-job.jpg" layout="responsive" alt="Cloud Scheduler Job" height="632" width="498"></amp-img>
  
    </a>
  


<p>Once ready, click <strong>Create</strong>.</p>

<p>Good job! That&rsquo;s it for the <strong>Google Cloud Platform</strong> preparations. Now we&rsquo;ll need to actually <strong>build the application</strong> itself.</p>

<h2 id="build-and-configure-the-application">Build and configure the application</h2>

<p>In this part of the guide, you&rsquo;ll install application source from my <strong>GitHub repo</strong>, update its <strong>configuration</strong>, and <strong>deploy it</strong> to GCP&rsquo;s Cloud Function environment.</p>

<h3 id="clone-the-repo-and-install-dependencies">Clone the repo and install dependencies</h3>

<p>Open your terminal (or other command line) application, browse to a directory you&rsquo;re comfortable to work with, and type the following command:</p>

<p><code>git clone https://github.com/sahava/multisite-lighthouse-gcp.git</code></p>

<p>This will download and install the source files from <a href="https://github.com/sahava/multisite-lighthouse-gcp">my GitHub repo</a> into the directory <code>multisite-lighthouse-gcp/</code> in the folder where you ran the command.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/git-clone.jpg" title="Git clone">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/git-clone.jpg" layout="responsive" alt="Git clone" height="133" width="529"></amp-img>
  
    </a>
  


<p>Next, type <code>cd multisite-lighthouse-gcp</code> and press enter. You should now be in the folder with the source files.</p>

<p>Now, type <code>npm install</code> to install the <strong>dependencies</strong> of the project:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/npm-install-done.jpg" title="npm install done">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/npm-install-done.jpg" layout="responsive" alt="npm install done" height="718" width="1154"></amp-img>
  
    </a>
  


<p>This will take a while, depending on your internet connection. The dependencies include some heavy pieces of software (such as <code>puppeteer</code>, which I use to launch a headless Google Chrome instance for the audits). Once it&rsquo;s done, you should see a note that a bunch of packages were successfully installed.</p>

<h3 id="modify-the-configuration-file">Modify the configuration file</h3>

<p>While in the <code>multisite-lighthouse-gcp</code> directory, the next thing you&rsquo;ll need to do is edit the <code>config.json</code> file. So open the file with the text editor of your choice. This is what the default configuration looks like:</p>

<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;source&#34;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.google.com/&#34;</span><span class="p">,</span>
      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;googlesearch&#34;</span>
    <span class="p">},{</span>
      <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://www.ebay.com/&#34;</span><span class="p">,</span>
      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;ebay&#34;</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&#34;projectId&#34;</span><span class="p">:</span> <span class="s2">&#34;multisite-lighthouse-gcp&#34;</span><span class="p">,</span>
  <span class="nt">&#34;pubsubTopicId&#34;</span><span class="p">:</span> <span class="s2">&#34;launch-lighthouse&#34;</span><span class="p">,</span>
  <span class="nt">&#34;datasetId&#34;</span><span class="p">:</span> <span class="s2">&#34;lighthouse&#34;</span><span class="p">,</span>
  <span class="nt">&#34;minTimeBetweenTriggers&#34;</span><span class="p">:</span> <span class="mi">300000</span><span class="p">,</span>
  <span class="nt">&#34;gcs&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;bucketName&#34;</span><span class="p">:</span> <span class="s2">&#34;lighthouse-reports&#34;</span>
  <span class="p">},</span>
  <span class="nt">&#34;lighthouseFlags&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;output&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;html&#34;</span><span class="p">,</span> <span class="s2">&#34;csv&#34;</span><span class="p">],</span>
    <span class="nt">&#34;emulatedFormFactor&#34;</span><span class="p">:</span> <span class="s2">&#34;desktop&#34;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Please see the following list of fields and possible values, and edit the configuration file accordingly.</p>

<table>
<thead>
<tr>
<th>Field</th>
<th>Values</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>source</code></td>
<td>{url, id}</td>
<td>Yes</td>
<td>An array of objects, each object representing one URL to audit. Type the full URL into the <code>url</code> field, and give a unique, descriptive <code>id</code> value into the respective field. For each additional URL you want to audit, add another object into the array.</td>
</tr>

<tr>
<td><code>projectId</code></td>
<td><code>temp-test-simo</code></td>
<td>Yes</td>
<td>The <a href="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/#set-up-a-new-google-cloud-platform-project-with-billing"><strong>Project ID</strong></a> of your Google Cloud Platform project.</td>
</tr>

<tr>
<td><code>pubsubTopicId</code></td>
<td><code>launch-lighthouse</code></td>
<td>Yes</td>
<td>Set this to <code>launch-lighthouse</code>. It&rsquo;s the name of the Pub/Sub <strong>topic</strong> that will be used to trigger the audits.</td>
</tr>

<tr>
<td><code>datasetId</code></td>
<td><code>lighthouse</code></td>
<td>Yes</td>
<td>The <strong>Dataset ID</strong> of the dataset you <a href="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/#create-the-bigquery-dataset">just created</a> in BigQuery.</td>
</tr>

<tr>
<td><code>minTimeBetweenTriggers</code></td>
<td><code>300000</code></td>
<td>Yes</td>
<td>The minimum time in milliseconds to wait before a Pub/Sub trigger can start the Cloud Function for any given ID. This is to add some <em>idempotency</em> to the function (more on this below).</td>
</tr>

<tr>
<td><code>gcs</code></td>
<td>{bucketName}</td>
<td>Yes</td>
<td>The name of the Google Cloud Storage bucket <a href="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/#create-the-gcs-bucket">you created earlier</a>.</td>
</tr>

<tr>
<td><code>lighthouseFlags</code></td>
<td>See <a href="https://github.com/GoogleChrome/lighthouse#cli-options">here</a>.</td>
<td>No</td>
<td>If you want to store the reports in Google Cloud Storage, set the <code>output</code> field to have an array of the formats you want to write the reports in. Available values are <code>&quot;csv&quot;</code>, <code>&quot;json&quot;</code>, and <code>&quot;html&quot;</code>. For each value in this array, a report will be written for every URL audited.</td>
</tr>
</tbody>
</table>

<p>The only optional field is <code>lighthouseFlags</code>. If you don&rsquo;t set <code>lighthouseFlags.output</code> to an array of available filetypes, no reports will be written to Google Cloud Storage. The other field provided by default is <code>emulatedFormFactor</code>, which specifies that the performance audit should emulate a desktop browser.</p>

<p>The <code>minTimeBetweenTriggers</code> flag is used to add a wait time before you can audit any given ID again. The Cloud Functions service doesn&rsquo;t guarantee that a function is run just once per trigger. This means that any code that&rsquo;s run should aim to be <em>idempotent</em>; that is, multiple executions of the code in a short amount of time should not result in additional state changes (e.g. BigQuery loads).</p>

<p>I ended up using a simple stateful mechanism in Google Cloud Storage. A file named <code>states.json</code> is written into the root of the GCS bucket, and this contains timestamps for when each trigger last activated its respective event. If this activation was less than 300 seconds ago (or whatever you specify in the configuration file), the function will abort.</p>

<p>Once done with the configuration, save the changes you made.</p>

<h2 id="deploy-the-function-and-test">Deploy the function and test</h2>

<p>You&rsquo;re almost done! Now you&rsquo;ll need to just <strong>deploy</strong> the function, and then run a <strong>simple test</strong>.</p>

<p>The Cloud Function itself is the <code>launchLighthouse()</code> method you can find if you browse the source code of <code>index.js</code>. This function is what your Pub/Sub trigger will launch when your Cloud Scheduler job goes off, or when you manually instruct the trigger to fire.</p>

<p>The Cloud Function will run in Google Cloud&rsquo;s serverless environment, launching instances of headless Google Chrome to perform the audits on the URLs you provide in the configuration file. The results will then be written into a BigQuery table, as well as stored into the GCS bucket if you so wish.</p>

<h3 id="deploy-the-cloud-function">Deploy the Cloud Function</h3>

<p>While in the <code>multisite-lighthouse-gcp</code> folder, type the following command:</p>

<p><code>gcloud auth login</code></p>

<p>This should open up a browser window where you need to enter your Google ID credentials. Make sure you <strong>log in with the same Google ID you use to manage your Google Cloud Platform project with</strong>! You&rsquo;ll see that Google Cloud SDK wants to access a bunch of things in your name, so click <strong>Allow</strong> to let it do just that.</p>

<p>It&rsquo;s Google - what evil could they do?</p>

<p>If successful, you should see this screen:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/gcloud-auth-login.jpg" title="gcloud auth login">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/gcloud-auth-login.jpg" layout="responsive" alt="gcloud auth login" height="487" width="1147"></amp-img>
  
    </a>
  


<p>Now, open your terminal window again, and type the following command in the <code>multisite-lighthouse-gcp</code> folder:</p>

<p><code>gcloud config set project &lt;projectId&gt;</code></p>

<p>Type your GCP <strong>Project ID</strong> in lieu of <code>&lt;projectID&gt;</code>, and press enter.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/set-project.jpg" title="Set project">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/set-project.jpg" layout="responsive" alt="Set project" height="276" width="895"></amp-img>
  
    </a>
  


<p>Now that you&rsquo;ve authenticated against Google Cloud, and now that you&rsquo;ve switched the project to your GCP project, it&rsquo;s time to finally deploy the function with (type it all in one line):</p>

<p><code>gcloud functions deploy launchLighthouse --trigger-topic launch-lighthouse --memory 2048 --timeout 540 --runtime=nodejs8</code></p>

<p>If you want to run the function in a specific region, you can add <code>--region=&lt;some GCP region&gt;</code>, e.g. <code>--region=europe-west1</code> to the command.</p>

<p>It will take a minute or two for the function to be deployed to the cloud. Once done, you should see this as a result:</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/function-deployed.jpg" title="Function deployed">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/function-deployed.jpg" layout="responsive" alt="Function deployed" height="336" width="856"></amp-img>
  
    </a>
  


<p>The deploy should fail in an error if you have mistakes in the configuration file <code>config.json</code>, so make sure you follow the <a href="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/#modify-the-configuration-file">instructions above</a> for how to configure the function.</p>

<p>The initial deployment creates the <code>launch-lighthouse</code> <a href="https://console.cloud.google.com/cloudpubsub/topicList">Pub/Sub topic and subscriptions</a> automatically.</p>

<p>So now that the Pub/Sub topic has been created, you can actually test the whole thing.</p>

<h3 id="test-with-pub-sub">Test with Pub/Sub</h3>

<p>The Cloud Scheduler will send the message <code>all</code> to the Pub/Sub topic <code>launch-lighthouse</code> using the schedule you defined earlier. The topic <code>all</code> will, in turn, trigger the Cloud Function you just deployed as many times as it takes to audit all the URLs in the <code>source</code> field of the configuration.</p>

<p>You can test this in two ways.</p>

<ol>
<li><p>You can browse to <a href="https://console.cloud.google.com/cloudscheduler">https://console.cloud.google.com/cloudscheduler</a> and click <strong>Run now</strong> next to the schedule job.</p></li>

<li><p>You can use the command line to publish the <code>all</code> message.</p></li>
</ol>

<p>Since the first is so easy, I&rsquo;ll show you how to do the second.</p>

<p>Open the terminal, and make sure you have your Google Cloud Platform set with:</p>

<p><code>gcloud config set project &lt;projectId&gt;</code></p>

<p>Just remember to replace <code>&lt;projectId&gt;</code> with your actual project ID.</p>

<p>Now, run:</p>

<p><code>gcloud pubsub topics publish launch-lighthouse --message all</code></p>



    <a href="https://www.simoahava.com/amp/images/2018/12/pubsub-message-all.jpg" title="Pub/Sub message">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/pubsub-message-all.jpg" layout="responsive" alt="Pub/Sub message" height="63" width="600"></amp-img>
  
    </a>
  


<p>You should see a <code>messageIds</code> response - that means the message was published successfully.</p>

<h3 id="check-logs">Check logs</h3>

<p>Now, browse to <a href="https://console.cloud.google.com/functions/list">https://console.cloud.google.com/functions/list</a>, where you should see details about your Cloud Function, hopefully with a green checkmark next to its name.</p>

<p>Click the action menu at the end of the row, and choose <strong>View logs</strong>.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/view-logs-cf.jpg" title="View CF logs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/view-logs-cf.jpg" layout="responsive" alt="View CF logs" height="315" width="1181"></amp-img>
  
    </a>
  


<p>You&rsquo;ll see a bunch of log results here. Here are the entries you should see (in approximately, but not definitely, this order):</p>

<table>
<thead>
<tr>
<th>Message</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>Function execution started</td>
<td>The Cloud Function starts. If you sent the message <code>all</code>, it now sends a <strong>new</strong> Pub/Sub message for all the IDs in your configuration file, thus starting new Cloud Functions by itself (one for each <code>source</code> entry in the config).</td>
</tr>

<tr>
<td>{id}: Sending init PubSub message</td>
<td>This is the initialization message for source ID {id}.</td>
</tr>

<tr>
<td>{id}: Init PubSub message sent</td>
<td>The initialization message was sent successfully.</td>
</tr>

<tr>
<td>Function execution took N ms, finished with status: &lsquo;ok&rsquo;</td>
<td>The Cloud Function triggered with <code>all</code> has now completed its task.</td>
</tr>

<tr>
<td>Function execution started</td>
<td>The Cloud Function triggered by the initialization message now starts.</td>
</tr>

<tr>
<td>{id}: Received message to start with URL {url}</td>
<td>Message to start audit received.</td>
</tr>

<tr>
<td>{id}: Starting browser for {url}</td>
<td>A headless browser is started for the audit.</td>
</tr>

<tr>
<td>{id}: Browser started for {url}</td>
<td>The browser startup is successful.</td>
</tr>

<tr>
<td>{id}: Starting lighthouse for {url}</td>
<td>Beginning the actual audit.</td>
</tr>

<tr>
<td>{id}: Lighthouse done for {url}</td>
<td>Lighthouse audit complete.</td>
</tr>

<tr>
<td>{id}: Browser closed for {url}</td>
<td>Browser instance shut down.</td>
</tr>

<tr>
<td>{id}: Writing {output} report to bucket {bucketName}</td>
<td>If you&rsquo;ve defined the <code>output</code> Lighthouse flag, then a report for each filetype listed in <code>output</code> will now be written into your GCS bucket.</td>
</tr>

<tr>
<td>{id}: Writing log to bucket {bucketName}</td>
<td>The full log of the audit is written to storage, too.</td>
</tr>

<tr>
<td>{id}: BigQuery job with ID {UUID} starting for {url}</td>
<td>The BigQuery job starts and signals the end of the Cloud Function.</td>
</tr>

<tr>
<td>Function execution took N ms, finished with status &lsquo;ok&rsquo;</td>
<td>Function complete.</td>
</tr>
</tbody>
</table>



    <a href="https://www.simoahava.com/amp/images/2018/12/log-sample.jpg" title="Sample of the log">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/log-sample.jpg" layout="responsive" alt="Sample of the log" height="659" width="1329"></amp-img>
  
    </a>
  


<p>If you had multiple URLs defined in the <code>source</code> of the configuration file, then you&rsquo;ll see parallel entries for all the URLs. Each URL is treated in its own Cloud Function, so there will be a lot of overlap in the logs.</p>

<p>If you see permission errors then they are almost certainly because you&rsquo;ve either forgotten to enable the required services, or because you haven&rsquo;t filled in the <a href="https://www.simoahava.com/amp/google-cloud/lighthouse-bigquery-google-cloud-platform/#modify-the-configuration-file">configuration file</a> correctly.</p>

<h3 id="check-bigquery">Check BigQuery</h3>

<p>Now, browse to <a href="https://console.cloud.google.com/bigquery">https://console.cloud.google.com/bigquery</a>. Here, click open your project in the left navigation, and choose the dataset you created. You should see a new table under it, named <code>reports</code>. Click it.</p>

<p>In the main console, you should now see a bunch of column definitions. Above those definitions is the link titled <strong>Preview</strong>, so go ahead and click it. This will &ldquo;Preview&rdquo; the BigQuery data stored in the data, and thus not cost you a penny.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/bigquery-check.jpg" title="BigQuery check">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/bigquery-check.jpg" layout="responsive" alt="BigQuery check" height="483" width="1342"></amp-img>
  
    </a>
  


<p>Feel free to scroll around the columns.</p>

<p>Do note that the BigQuery schema <strong>only contains those audits that have a &ldquo;weight&rdquo; in determining the total score</strong>. I did this purely out of convenience. I might update the schema at some point to simply contain all the audit fields, but this made more sense to start with.</p>

<h3 id="check-cloud-storage">Check Cloud Storage</h3>

<p>Browse to <a href="https://console.cloud.google.com/storage/browser">https://console.cloud.google.com/storage/browser</a> and click the bucket name you created earlier. You might see some <code>.appspot.com</code> buckets there, too. Don&rsquo;t worry - they were created automatically when you deployed your Cloud Function.</p>

<p>You should now see new folders within the bucket - each named after an <code>id</code> value in your configuration file&rsquo;s <code>source</code> array. You&rsquo;ll also see the <code>states.json</code> file, which makes sure your function only runs when it&rsquo;s supposed to.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/folders-in-bucket.jpg" title="Folders in bucket">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/folders-in-bucket.jpg" layout="responsive" alt="Folders in bucket" height="393" width="967"></amp-img>
  
    </a>
  


<p>Click one of the folders to see the contents.</p>

<p>If you defined an <code>output</code> array in the Lighthouse flags of the configuration file, you will now see a file prefixed with <code>report_</code> for each file type you added to the array. Remember, there were three possible reports Lighthouse can provide you: CSV, HTML, and JSON.</p>



    <a href="https://www.simoahava.com/amp/images/2018/12/storage-logs.jpg" title="Storage logs">
  
    <amp-img src="https://www.simoahava.com/amp/images/2018/12/storage-logs.jpg" layout="responsive" alt="Storage logs" height="426" width="975"></amp-img>
  
    </a>
  


<p>You&rsquo;ll also see a JSON file prefixed with <code>log_</code>, which will contain the full audit object for you to peruse.</p>

<p>Feel free to download the files and explore them. The HTML report is especially interesting (and visually pleasing) to read.</p>

<h2 id="things-to-note">Things to note</h2>

<h3 id="cloud-scheduler">Cloud Scheduler</h3>

<p>Don&rsquo;t forget that you have a <strong>Cloud Scheduler</strong> running! Periodically, it will push the <code>all</code> message into your Pub/Sub topic, thus auditing each URL in your <code>source</code> list, writing the results into BigQuery, and storing the logs in Cloud Storage.</p>

<h3 id="manually-trigger-the-audit">Manually trigger the audit</h3>

<p>You can always trigger the audit manually with</p>

<p><code>gcloud pubsub topics publish launch-lighthouse --message all</code></p>

<p>or, if you want to trigger an audit for a specific ID only, the command is</p>

<p><code>gcloud pubsub topics publish launch-lighthouse --message &lt;id&gt;</code></p>

<p>where <code>&lt;id&gt;</code> is the ID of the URL you set in the <code>source</code> array of the configuration file.</p>

<h3 id="cloud-functions-don-t-have-the-best-performance">Cloud Functions don&rsquo;t have the best performance</h3>

<p>Unfortunately, running the headless browser in the Cloud Function is not the most efficient thing in the world. In fact, the <strong>Performance</strong> report (which is, for many, the most interesting one), will most likely under-report the load times quite severely.</p>

<p>There&rsquo;s not much to do about this currently. Cloud Functions simply do not have the CPU power required to perform complex or expensive tasks like this.</p>

<p>This has been identified by the developers (see <a href="https://github.com/GoogleChrome/puppeteer/issues/3120">here</a>), and it&rsquo;s possible that in the near future either Cloud Functions, Puppeteer, or Google Chrome will enable the processes to run smoother and faster.</p>

<h3 id="updating-the-configuration-file-is-a-bit-annoying">Updating the configuration file is a bit annoying</h3>

<p>Due to how the configuration file has been bundled with the Cloud Function itself, any update to the configuration file requires you to <strong>redeploy</strong> the Cloud Function itself. This is annoying, since deployment always takes a couple of minutes.</p>

<p>I&rsquo;m probably going to update the application so that the configuration file is stored in a Google Cloud Storage bucket. That way when you want to update the file, all you need to do is upload it to the bucket using the Google Cloud Console user interface. And that&rsquo;s really fast.</p>

<h3 id="other-ideas">Other ideas</h3>

<p>You can follow the <a href="https://github.com/sahava/multisite-lighthouse-gcp">GitHub project</a> to see where things are heading. Especially the <a href="https://github.com/sahava/multisite-lighthouse-gcp/issues">Issues</a> page should be of interest, since it&rsquo;s essentially a to-do list for me.</p>

<h2 id="final-thoughts">Final thoughts</h2>

<p>This was a fun exercise, and I hope you managed to complete it following the guide above. If not, please let me know in the comments where you had trouble.</p>

<p>I&rsquo;m not too happy with the fact that Chrome is just too slow when run through a Cloud Function. It&rsquo;s possible that the whole thing is quite useless until the browser&rsquo;s performance in the sandbox is improved. I might have to add the option of using an AppEngine or Kubernetes Engine instance instead. This way you could scale the environment as much as you like to improve the accuracy of the performance audit. Naturally, this will incur some costs not present in the current setup.</p>

<p>On the other hand, I love the fact that the data is being collected in BigQuery, since I can create a nice dashboard with Data Studio that shows the performance progress of the URLs I&rsquo;ve selected for auditing.</p>

<p>Cloud Functions themselves are simply wonderful. Total game-changers. Running serverless applications with almost no cost at all, and triggering them in different ways (HTTP requests, Pub/Sub triggers) has huge potential for the future. Thanks to some background service magic, it&rsquo;s so refreshing not having to worry about authentication and access control levels - the Cloud Function has all the required access levels for performing a wide variety of tasks.</p>

<p>Check the Cloud Function documentation for inspiration: <a href="https://cloud.google.com/functions/docs/tutorials/">https://cloud.google.com/functions/docs/tutorials/</a>.</p>

<p>As always, please let me know in comments if you have questions about this setup, or if you have suggestions for improvement.</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://www.simoahava.com/amp/"></a>
    </figure>
    

    
    
    
        
    
    

    <section class="author">
      <h4>Simo Ahava</h4>
      
        <p>Husband | Father | Analytics developer</p>
      
      <div class="author-meta">
        <span class="author-location icon-location">Espoo, Finland</span>
        <span class="author-link icon-link"><a href="https://www.simoahava.com/">https://www.simoahava.com/</a></span>
      </div>
    </section>


    
    <div class="social">

<amp-social-share type="twitter"
  width="60"
  height="44"> </amp-social-share>


    <amp-social-share type="gplus"
                      width="60"
                      height="44"></amp-social-share>




<amp-social-share type="linkedin"
                  width="60"
                  height="44"></amp-social-share>


    <amp-social-share type="facebook"
                      width="60"
                      height="44"></amp-social-share>

</div>


    
  </footer>
</article>

</main>
</div>

</body>
</html>

